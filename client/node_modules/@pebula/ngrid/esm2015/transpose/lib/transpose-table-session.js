/**
 * @fileoverview added by tsickle
 * Generated from: lib/transpose-table-session.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { isObservable, of as obsOf, from as obsFrom } from 'rxjs';
import { map, tap } from 'rxjs/operators';
import { UnRx } from '@pebula/utils';
/** @type {?} */
export const LOCAL_COLUMN_DEF = Symbol('LOCAL_COLUMN_DEF');
/** @type {?} */
export const VIRTUAL_REFRESH = {};
export class TransposeTableSession {
    /**
     * @param {?} grid
     * @param {?} pluginCtrl
     * @param {?} updateColumns
     * @param {?} sourceFactoryWrapper
     */
    constructor(grid, pluginCtrl, updateColumns, sourceFactoryWrapper) {
        this.grid = grid;
        this.pluginCtrl = pluginCtrl;
        this.updateColumns = updateColumns;
        this.sourceFactoryWrapper = sourceFactoryWrapper;
        this.init();
        if (grid.columns && grid.columnApi.visibleColumns.length > 0) {
            this.onInvalidateHeaders();
        }
        this.onDataSource(this.grid.ds);
    }
    /**
     * @param {?} updateTable
     * @return {?}
     */
    destroy(updateTable) {
        if (!this.destroyed) {
            this.destroyed = true;
            UnRx.kill(this, this.grid);
            this.grid.showHeader = this.headerRow;
            this.grid.columns = this.columnsInput;
            if (updateTable) {
                this.grid.invalidateColumns();
                this.grid.ds.refresh(VIRTUAL_REFRESH);
            }
        }
    }
    /**
     * @private
     * @return {?}
     */
    init() {
        this.headerRow = this.grid.showHeader;
        this.grid.showHeader = false;
        this.pluginCtrl.events
            .pipe(UnRx(this, this.grid))
            .subscribe((/**
         * @param {?} e
         * @return {?}
         */
        e => e.kind === 'onInvalidateHeaders' && this.onInvalidateHeaders()));
        this.pluginCtrl.events
            .pipe(UnRx(this, this.grid))
            .subscribe((/**
         * @param {?} e
         * @return {?}
         */
        e => e.kind === 'onDataSource' && this.onDataSource(e.curr)));
    }
    /**
     * @private
     * @return {?}
     */
    onInvalidateHeaders() {
        if (!this.grid.columns[LOCAL_COLUMN_DEF]) {
            this.columnsInput = this.grid.columns;
            this.storeColumns = this.grid.columnApi.visibleColumns;
            this.updateColumns();
        }
    }
    /**
     * @private
     * @param {?=} ds
     * @return {?}
     */
    onDataSource(ds) {
        this.unPatchDataSource();
        if (ds) {
            this.ds = ds;
            this.dsSourceFactory = ds.adapter.sourceFactory;
            this.ds.adapter.sourceFactory = (/**
             * @param {?} event
             * @return {?}
             */
            (event) => {
                /** @type {?} */
                const rawSource = event.data.changed && event.data.curr === VIRTUAL_REFRESH
                    ? this.ds.source
                    : this.dsSourceFactory(event);
                if (rawSource === false) {
                    return rawSource;
                }
                else if (this.destroyed) {
                    this.unPatchDataSource();
                    return this.rawSource;
                }
                /** @type {?} */
                const obs = isObservable(rawSource)
                    ? rawSource
                    : Array.isArray(rawSource) ? obsOf(rawSource) : obsFrom(rawSource) // promise...
                ;
                return obs
                    .pipe(tap((/**
                 * @param {?} source
                 * @return {?}
                 */
                source => this.rawSource = source)), map(this.sourceFactoryWrapper));
            });
        }
    }
    /**
     * @private
     * @return {?}
     */
    unPatchDataSource() {
        if (this.ds) {
            this.ds.adapter.sourceFactory = this.dsSourceFactory;
            this.ds = this.dsSourceFactory = undefined;
        }
    }
}
if (false) {
    /** @type {?} */
    TransposeTableSession.prototype.dsSourceFactory;
    /** @type {?} */
    TransposeTableSession.prototype.ds;
    /** @type {?} */
    TransposeTableSession.prototype.columnsInput;
    /** @type {?} */
    TransposeTableSession.prototype.storeColumns;
    /** @type {?} */
    TransposeTableSession.prototype.headerRow;
    /**
     * @type {?}
     * @private
     */
    TransposeTableSession.prototype.destroyed;
    /**
     * @type {?}
     * @private
     */
    TransposeTableSession.prototype.rawSource;
    /**
     * @type {?}
     * @private
     */
    TransposeTableSession.prototype.grid;
    /**
     * @type {?}
     * @private
     */
    TransposeTableSession.prototype.pluginCtrl;
    /**
     * @type {?}
     * @private
     */
    TransposeTableSession.prototype.updateColumns;
    /**
     * @type {?}
     * @private
     */
    TransposeTableSession.prototype.sourceFactoryWrapper;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhbnNwb3NlLXRhYmxlLXNlc3Npb24uanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcGVidWxhL25ncmlkL3RyYW5zcG9zZS8iLCJzb3VyY2VzIjpbImxpYi90cmFuc3Bvc2UtdGFibGUtc2Vzc2lvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBYyxZQUFZLEVBQUUsRUFBRSxJQUFJLEtBQUssRUFBRSxJQUFJLElBQUksT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzlFLE9BQU8sRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFMUMsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLGVBQWUsQ0FBQzs7QUFVckMsTUFBTSxPQUFPLGdCQUFnQixHQUFHLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQzs7QUFDMUQsTUFBTSxPQUFPLGVBQWUsR0FBRyxFQUFFO0FBRWpDLE1BQU0sT0FBTyxxQkFBcUI7Ozs7Ozs7SUFVaEMsWUFBb0IsSUFBNEIsRUFDNUIsVUFBb0MsRUFDcEMsYUFBeUIsRUFDekIsb0JBQStDO1FBSC9DLFNBQUksR0FBSixJQUFJLENBQXdCO1FBQzVCLGVBQVUsR0FBVixVQUFVLENBQTBCO1FBQ3BDLGtCQUFhLEdBQWIsYUFBYSxDQUFZO1FBQ3pCLHlCQUFvQixHQUFwQixvQkFBb0IsQ0FBMkI7UUFDakUsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ1osSUFBSSxJQUFJLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDNUQsSUFBSSxDQUFDLG1CQUFtQixFQUFFLENBQUM7U0FDNUI7UUFDRCxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDbEMsQ0FBQzs7Ozs7SUFFRCxPQUFPLENBQUMsV0FBb0I7UUFDMUIsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVB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QyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBTSxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLGFBQWE7O2dCQUV2RixPQUFPLEdBQUc7cUJBQ1AsSUFBSSxDQUNILEdBQUc7Ozs7Z0JBQUUsTUFBTSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsU0FBUyxHQUFHLE1BQU0sRUFBRSxFQUN4QyxHQUFHLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLENBQy9CLENBQUM7WUFDTixDQUFDLENBQUEsQ0FBQTtTQUNGO0lBQ0gsQ0FBQzs7Ozs7SUFFTyxpQkFBaUI7UUFDdkIsSUFBSSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ1gsSUFBSSxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUM7WUFDckQsSUFBSSxDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUMsZUFBZSxHQUFHLFNBQVMsQ0FBQztTQUM1QztJQUNILENBQUM7Q0FDRjs7O0lBM0ZDLGdEQUFxQjs7SUFDckIsbUNBQXVCOztJQUN2Qiw2Q0FBMEM7O0lBQzFDLDZDQUEwQjs7SUFDMUIsMENBQW1COzs7OztJQUVuQiwwQ0FBMkI7Ozs7O0lBQzNCLDBDQUF5Qjs7Ozs7SUFFYixxQ0FBb0M7Ozs7O0lBQ3BDLDJDQUE0Qzs7Ozs7SUFDNUMsOENBQWlDOzs7OztJQUNqQyxxREFBdUQiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBPYnNlcnZhYmxlLCBpc09ic2VydmFibGUsIG9mIGFzIG9ic09mLCBmcm9tIGFzIG9ic0Zyb20gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IG1hcCwgdGFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5pbXBvcnQgeyBVblJ4IH0gZnJvbSAnQHBlYnVsYS91dGlscyc7XG5pbXBvcnQge1xuICBQYmxOZ3JpZENvbHVtbkRlZmluaXRpb25TZXQsXG4gIFBibE5ncmlkQ29tcG9uZW50LFxuICBQYmxOZ3JpZFBsdWdpbkNvbnRyb2xsZXIsXG4gIFBibERhdGFTb3VyY2UsXG4gIFBibENvbHVtbixcbiAgUGJsRGF0YVNvdXJjZVRyaWdnZXJDaGFuZ2VkRXZlbnQsXG59IGZyb20gJ0BwZWJ1bGEvbmdyaWQnO1xuXG5leHBvcnQgY29uc3QgTE9DQUxfQ09MVU1OX0RFRiA9IFN5bWJvbCgnTE9DQUxfQ09MVU1OX0RFRicpO1xuZXhwb3J0IGNvbnN0IFZJUlRVQUxfUkVGUkVTSCA9IHt9O1xuXG5leHBvcnQgY2xhc3MgVHJhbnNwb3NlVGFibGVTZXNzaW9uIHtcbiAgZHNTb3VyY2VGYWN0b3J5OiBhbnk7XG4gIGRzOiBQYmxEYXRhU291cmNlPGFueT47XG4gIGNvbHVtbnNJbnB1dDogUGJsTmdyaWRDb2x1bW5EZWZpbml0aW9uU2V0O1xuICBzdG9yZUNvbHVtbnM6IFBibENvbHVtbltdO1xuICBoZWFkZXJSb3c6IGJvb2xlYW47XG5cbiAgcHJpdmF0ZSBkZXN0cm95ZWQ6IGJvb2xlYW47XG4gIHByaXZhdGUgcmF3U291cmNlOiBhbnlbXTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGdyaWQ6IFBibE5ncmlkQ29tcG9uZW50PGFueT4sXG4gICAgICAgICAgICAgIHByaXZhdGUgcGx1Z2luQ3RybDogUGJsTmdyaWRQbHVnaW5Db250cm9sbGVyLFxuICAgICAgICAgICAgICBwcml2YXRlIHVwZGF0ZUNvbHVtbnM6ICgpID0+IHZvaWQsXG4gICAgICAgICAgICAgIHByaXZhdGUgc291cmNlRmFjdG9yeVdyYXBwZXI6IChyZXN1bHRzOiBhbnlbXSkgPT4gYW55W10pIHtcbiAgICB0aGlzLmluaXQoKTtcbiAgICBpZiAoZ3JpZC5jb2x1bW5zICYmIGdyaWQuY29sdW1uQXBpLnZpc2libGVDb2x1bW5zLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMub25JbnZhbGlkYXRlSGVhZGVycygpO1xuICAgIH1cbiAgICB0aGlzLm9uRGF0YVNvdXJjZSh0aGlzLmdyaWQuZHMpO1xuICB9XG5cbiAgZGVzdHJveSh1cGRhdGVUYWJsZTogYm9vbGVhbik6IHZvaWQge1xuICAgIGlmICghdGhpcy5kZXN0cm95ZWQpIHtcbiAgICAgIHRoaXMuZGVzdHJveWVkID0gdHJ1ZTtcbiAgICAgIFVuUngua2lsbCh0aGlzLCB0aGlzLmdyaWQpO1xuXG4gICAgICB0aGlzLmdyaWQuc2hvd0hlYWRlciA9IHRoaXMuaGVhZGVyUm93O1xuICAgICAgdGhpcy5ncmlkLmNvbHVtbnMgPSB0aGlzLmNvbHVtbnNJbnB1dDtcbiAgICAgIGlmICh1cGRhdGVUYWJsZSkge1xuICAgICAgICB0aGlzLmdyaWQuaW52YWxpZGF0ZUNvbHVtbnMoKTtcbiAgICAgICAgdGhpcy5ncmlkLmRzLnJlZnJlc2goVklSVFVBTF9SRUZSRVNIKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5oZWFkZXJSb3cgPSB0aGlzLmdyaWQuc2hvd0hlYWRlcjtcbiAgICB0aGlzLmdyaWQuc2hvd0hlYWRlciA9IGZhbHNlO1xuICAgIHRoaXMucGx1Z2luQ3RybC5ldmVudHNcbiAgICAgIC5waXBlKFVuUngodGhpcywgdGhpcy5ncmlkKSlcbiAgICAgIC5zdWJzY3JpYmUoIGUgPT4gZS5raW5kID09PSAnb25JbnZhbGlkYXRlSGVhZGVycycgJiYgdGhpcy5vbkludmFsaWRhdGVIZWFkZXJzKCkgKTtcblxuICAgIHRoaXMucGx1Z2luQ3RybC5ldmVudHNcbiAgICAgIC5waXBlKFVuUngodGhpcywgdGhpcy5ncmlkKSlcbiAgICAgIC5zdWJzY3JpYmUoIGUgPT4gZS5raW5kID09PSAnb25EYXRhU291cmNlJyAmJiB0aGlzLm9uRGF0YVNvdXJjZShlLmN1cnIpICk7XG4gIH1cblxuICBwcml2YXRlIG9uSW52YWxpZGF0ZUhlYWRlcnMoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmdyaWQuY29sdW1uc1tMT0NBTF9DT0xVTU5fREVGXSkge1xuICAgICAgdGhpcy5jb2x1bW5zSW5wdXQgPSB0aGlzLmdyaWQuY29sdW1ucztcbiAgICAgIHRoaXMuc3RvcmVDb2x1bW5zID0gdGhpcy5ncmlkLmNvbHVtbkFwaS52aXNpYmxlQ29sdW1ucztcbiAgICAgIHRoaXMudXBkYXRlQ29sdW1ucygpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgb25EYXRhU291cmNlKGRzPzogUGJsRGF0YVNvdXJjZSk6IHZvaWQge1xuICAgIHRoaXMudW5QYXRjaERhdGFTb3VyY2UoKTtcbiAgICBpZiAoZHMpIHtcbiAgICAgIHRoaXMuZHMgPSBkcztcbiAgICAgIHRoaXMuZHNTb3VyY2VGYWN0b3J5ID0gZHMuYWRhcHRlci5zb3VyY2VGYWN0b3J5O1xuICAgICAgdGhpcy5kcy5hZGFwdGVyLnNvdXJjZUZhY3RvcnkgPSAoZXZlbnQ6IFBibERhdGFTb3VyY2VUcmlnZ2VyQ2hhbmdlZEV2ZW50KSA9PiB7XG4gICAgICAgIGNvbnN0IHJhd1NvdXJjZSA9IGV2ZW50LmRhdGEuY2hhbmdlZCAmJiBldmVudC5kYXRhLmN1cnIgPT09IFZJUlRVQUxfUkVGUkVTSFxuICAgICAgICAgID8gdGhpcy5kcy5zb3VyY2VcbiAgICAgICAgICA6IHRoaXMuZHNTb3VyY2VGYWN0b3J5KGV2ZW50KVxuICAgICAgICA7XG5cbiAgICAgICAgaWYgKHJhd1NvdXJjZSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICByZXR1cm4gcmF3U291cmNlO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZGVzdHJveWVkKSB7XG4gICAgICAgICAgdGhpcy51blBhdGNoRGF0YVNvdXJjZSgpO1xuICAgICAgICAgIHJldHVybiB0aGlzLnJhd1NvdXJjZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG9iczogT2JzZXJ2YWJsZTxhbnlbXT4gPSBpc09ic2VydmFibGUocmF3U291cmNlKVxuICAgICAgICAgID8gcmF3U291cmNlXG4gICAgICAgICAgOiBBcnJheS5pc0FycmF5KHJhd1NvdXJjZSkgPyBvYnNPZjxhbnk+KHJhd1NvdXJjZSkgOiBvYnNGcm9tKHJhd1NvdXJjZSkgLy8gcHJvbWlzZS4uLlxuICAgICAgICA7XG4gICAgICAgIHJldHVybiBvYnNcbiAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgIHRhcCggc291cmNlID0+IHRoaXMucmF3U291cmNlID0gc291cmNlICksXG4gICAgICAgICAgICBtYXAodGhpcy5zb3VyY2VGYWN0b3J5V3JhcHBlciksXG4gICAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHVuUGF0Y2hEYXRhU291cmNlKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmRzKSB7XG4gICAgICB0aGlzLmRzLmFkYXB0ZXIuc291cmNlRmFjdG9yeSA9IHRoaXMuZHNTb3VyY2VGYWN0b3J5O1xuICAgICAgdGhpcy5kcyA9IHRoaXMuZHNTb3VyY2VGYWN0b3J5ID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgfVxufVxuIl19