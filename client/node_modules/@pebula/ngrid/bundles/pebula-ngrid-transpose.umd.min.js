!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("@pebula/ngrid"),require("rxjs/operators"),require("@angular/cdk/coercion"),require("@pebula/utils"),require("rxjs")):"function"==typeof define&&define.amd?define("@pebula/ngrid/transpose",["exports","@angular/core","@angular/common","@pebula/ngrid","rxjs/operators","@angular/cdk/coercion","@pebula/utils","rxjs"],t):t(((e=e||self).pebula=e.pebula||{},e.pebula.ngrid=e.pebula.ngrid||{},e.pebula.ngrid.transpose={}),e.ng.core,e.ng.common,e.pebula.ngrid,e.rxjs.operators,e.ng.cdk.coercion,e.pebula.utils,e.rxjs)}(this,(function(e,t,r,o,n,i,a,s){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function l(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function u(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}function d(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var o,n,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return a}var c=Symbol("LOCAL_COLUMN_DEF"),p={},h=function(){function e(e,t,r,o){this.grid=e,this.pluginCtrl=t,this.updateColumns=r,this.sourceFactoryWrapper=o,this.init(),e.columns&&e.columnApi.visibleColumns.length>0&&this.onInvalidateHeaders(),this.onDataSource(this.grid.ds)}return e.prototype.destroy=function(e){this.destroyed||(this.destroyed=!0,a.UnRx.kill(this,this.grid),this.grid.showHeader=this.headerRow,this.grid.columns=this.columnsInput,e&&(this.grid.invalidateColumns(),this.grid.ds.refresh(p)))},e.prototype.init=function(){var e=this;this.headerRow=this.grid.showHeader,this.grid.showHeader=!1,this.pluginCtrl.events.pipe(a.UnRx(this,this.grid)).subscribe((function(t){return"onInvalidateHeaders"===t.kind&&e.onInvalidateHeaders()})),this.pluginCtrl.events.pipe(a.UnRx(this,this.grid)).subscribe((function(t){return"onDataSource"===t.kind&&e.onDataSource(t.curr)}))},e.prototype.onInvalidateHeaders=function(){this.grid.columns[c]||(this.columnsInput=this.grid.columns,this.storeColumns=this.grid.columnApi.visibleColumns,this.updateColumns())},e.prototype.onDataSource=function(e){var t=this;this.unPatchDataSource(),e&&(this.ds=e,this.dsSourceFactory=e.adapter.sourceFactory,this.ds.adapter.sourceFactory=function(e){var r=e.data.changed&&e.data.curr===p?t.ds.source:t.dsSourceFactory(e);return!1===r?r:t.destroyed?(t.unPatchDataSource(),t.rawSource):(s.isObservable(r)?r:Array.isArray(r)?s.of(r):s.from(r)).pipe(n.tap((function(e){return t.rawSource=e})),n.map(t.sourceFactoryWrapper))})},e.prototype.unPatchDataSource=function(){this.ds&&(this.ds.adapter.sourceFactory=this.dsSourceFactory,this.ds=this.dsSourceFactory=void 0)},e}();var f=Symbol("TRANSFORM_ROW_REF");function g(e){return e.getValue(this.data[f])}function y(e,t){var r;return{prop:"__transform_item_"+t+"__",data:(r={},r[f]=e,r)}}var m={prop:"__transpose__",css:"pbl-ngrid-header-cell pbl-ngrid-transposed-header-cell"},b=function(){function e(e,t,r){var o=this;this.grid=e,this.pluginCtrl=t,this._header=m,this._removePlugin=t.setPlugin("transpose",this);var i=r.get("transposePlugin");i&&(this.header=i.header,this.defaultCol=i.defaultCol||{},this.matchTemplates=i.matchTemplates||!1),t.events.pipe(n.filter((function(e){return"onInit"===e.kind})),n.take(1),a.UnRx(this,this.grid)).subscribe((function(e){void 0!==o.enabled&&o.updateState(void 0,o.enabled)}))}return Object.defineProperty(e.prototype,"transpose",{get:function(){return this.enabled},set:function(e){(e=i.coerceBooleanProperty(e))!==this.enabled&&this.grid.isInit&&this.updateState(this.enabled,e),this.enabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"header",{set:function(e){this._header=Object.assign({},m,e||{})},enumerable:!0,configurable:!0}),e.prototype.ngOnDestroy=function(){this._removePlugin(this.grid),this.disable(!1)},e.prototype.disable=function(e){if(this.gridState){var t=this.gridState;this.columns=this.selfColumn=this.gridState=this.columns=this.selfColumn=void 0,t.destroy(e)}},e.prototype.enable=function(e){var t=this;void 0===e&&(e=!1),this.gridState&&this.disable(!1);this.gridState=new h(this.grid,this.pluginCtrl,(function(){return t.updateColumns(t.grid.columnApi.visibleColumns)}),(function(e){var r,n,a,s,l;if(e){var p=t.grid.columns=(r=o.columnFactory().default(t.defaultCol||{})).table.apply(r,function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(d(arguments[t]));return e}([t.selfColumn],e.map(y))).build(),h=t.gridState.columnsInput;p.header=h.header,p.headerGroup=h.headerGroup,p.footer=h.footer,p[c]=!0,t.grid.invalidateColumns();var f,m=i.coerceBooleanProperty(t.matchTemplates),b=t._header.prop,v=["type"];m&&v.push("cellTpl");try{for(var C=u(t.grid.columnApi.visibleColumns),S=C.next();!S.done;S=C.next()){var P=S.value;if(P.orgProp===b)P.getValue=function(e){return f=e,e.label};else{P.getValue=g;var x=function(e){Object.defineProperty(P,e,{configurable:!0,get:function(){return f&&f[e]},set:function(e){}})};try{for(var _=(s=void 0,u(v)),R=_.next();!R.done;R=_.next()){x(R.value)}}catch(e){s={error:e}}finally{try{R&&!R.done&&(l=_.return)&&l.call(_)}finally{if(s)throw s.error}}}}}catch(e){n={error:e}}finally{try{S&&!S.done&&(a=C.return)&&a.call(C)}finally{if(n)throw n.error}}return t.columns}return e})),e?(this.pluginCtrl.extApi.contextApi.clear(),this.grid.ds.refresh()):this.grid.ds.length>0&&this.grid.ds.refresh(p)},e.prototype.updateState=function(e,t){var r=void 0===e;t?this.enable(!r):this.disable(!0)},e.prototype.updateColumns=function(e){var t,r,n=this._header.prop;this.columns=[];try{for(var i=u(e),a=i.next();!a.done;a=i.next()){var s=a.value;s.orgProp===n?this.selfColumn=s:this.columns.push(s)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}this.selfColumn||(this.selfColumn=new o.PblColumn(this._header,this.pluginCtrl.extApi.columnStore.groupStore))},e.decorators=[{type:t.Directive,args:[{selector:"pbl-ngrid[transpose]"}]}],e.ctorParameters=function(){return[{type:o.PblNgridComponent},{type:o.PblNgridPluginController},{type:o.PblNgridConfigService}]},e.propDecorators={transpose:[{type:t.Input}],header:[{type:t.Input,args:["transposeHeaderCol"]}],defaultCol:[{type:t.Input,args:["transposeDefaultCol"]}],matchTemplates:[{type:t.Input}]},e=function(e,t,r,o){var n,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(i<3?n(a):i>3?n(t,r,a):n(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a}([o.NgridPlugin({id:"transpose"}),a.UnRx(),l("design:paramtypes",[o.PblNgridComponent,o.PblNgridPluginController,o.PblNgridConfigService])],e)}();var v=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[r.CommonModule,o.PblNgridModule],declarations:[b],exports:[b]}]}],e}();e.PblNgridTransposeModule=v,e.Éµa=b,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=pebula-ngrid-transpose.umd.min.js.map