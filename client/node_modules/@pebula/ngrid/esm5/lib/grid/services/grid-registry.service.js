/**
 * @fileoverview added by tsickle
 * Generated from: lib/grid/services/grid-registry.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { __decorate, __metadata, __read, __spread } from "tslib";
import { Subject } from 'rxjs';
import { Injectable, Optional, SkipSelf, } from '@angular/core';
import { UnRx } from '@pebula/utils';
import * as i0 from "@angular/core";
/**
 * @record
 */
export function RegistryChangedEvent() { }
if (false) {
    /** @type {?} */
    RegistryChangedEvent.prototype.op;
    /** @type {?} */
    RegistryChangedEvent.prototype.type;
    /** @type {?} */
    RegistryChangedEvent.prototype.value;
}
/**
 * A map of valid single-item value that can be registered, and their type.
 * @record
 */
export function PblNgridSingleRegistryMap() { }
if (false) {
    /** @type {?|undefined} */
    PblNgridSingleRegistryMap.prototype.noData;
    /** @type {?|undefined} */
    PblNgridSingleRegistryMap.prototype.paginator;
}
/**
 * A map of valid multi-item value that can be registered, and their type (the single type, i.e. T in Array<T>)
 * @record
 */
export function PblNgridMultiRegistryMap() { }
if (false) {
    /** @type {?|undefined} */
    PblNgridMultiRegistryMap.prototype.headerCell;
    /** @type {?|undefined} */
    PblNgridMultiRegistryMap.prototype.tableCell;
    /** @type {?|undefined} */
    PblNgridMultiRegistryMap.prototype.editorCell;
    /** @type {?|undefined} */
    PblNgridMultiRegistryMap.prototype.footerCell;
    /** @type {?|undefined} */
    PblNgridMultiRegistryMap.prototype.dataHeaderExtensions;
}
/**
 * A Registry for templates of table parts.
 *
 * The registry is hierarchical, where each instance of a registry has a parent which allows cascading templates.
 * The hierarchy is manged by angular DI.
 *
 * > The root registry does not have a parent.
 *
 * Each instance of a registry (including root) is a hierarchy by itself, composed of 2 internal levels.
 * The first level (L1 below) is used for fixed templates, the second level (L2 below) is used for dynamic templates.
 *
 * - Root Registry
 *   - Child Registry
 *     - ChildOfChild Registry
 *
 * In the example above there are 3 registries: Root, Child and ChildOfChild.
 *
 * When searching for a template in `ChildOfChild` it will search in the following order (top to bottom):
 *   - ChildOfChild
 *   - Child
 *   - Root
 *
 * If a registry does not contain the template the search will move to the next one.
 */
var PblNgridRegistryService = /** @class */ (function () {
    function PblNgridRegistryService(_parent) {
        this._parent = _parent;
        this._multi = {};
        this._multiDefaults = {};
        this._singles = {};
        this.changes$ = new Subject();
        this.changes = this.changes$.asObservable();
        if (this._parent) {
            this._parent.changes.pipe(UnRx(this)).subscribe(this.changes$);
            this.root = this._parent.root;
        }
        else {
            this.root = this;
        }
    }
    Object.defineProperty(PblNgridRegistryService.prototype, "parent", {
        get: /**
         * @return {?}
         */
        function () { return this._parent; },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    PblNgridRegistryService.prototype.getRoot = /**
     * @return {?}
     */
    function () { return this.root; };
    /**
     * Returns the registered value for the single `kind`.
     * If not found will try to search the parent.
     */
    /**
     * Returns the registered value for the single `kind`.
     * If not found will try to search the parent.
     * @template P
     * @param {?} kind
     * @return {?}
     */
    PblNgridRegistryService.prototype.getSingle = /**
     * Returns the registered value for the single `kind`.
     * If not found will try to search the parent.
     * @template P
     * @param {?} kind
     * @return {?}
     */
    function (kind) {
        return this._singles[kind] || (this._parent && this._parent.getSingle(kind));
    };
    /**
     * @template P
     * @param {?} kind
     * @param {?} value
     * @return {?}
     */
    PblNgridRegistryService.prototype.setSingle = /**
     * @template P
     * @param {?} kind
     * @param {?} value
     * @return {?}
     */
    function (kind, value) {
        /** @type {?} */
        var previous = this.getSingle(kind);
        if (value !== previous) {
            this._singles[kind] = value;
            this.emitChanges({ op: value ? 'add' : 'remove', type: kind, value: value });
        }
    };
    /**
     * Returns the registered default value for the multi `kind`.
     * If not found will try to search the parent.
     */
    /**
     * Returns the registered default value for the multi `kind`.
     * If not found will try to search the parent.
     * @template P
     * @param {?} kind
     * @return {?}
     */
    PblNgridRegistryService.prototype.getMultiDefault = /**
     * Returns the registered default value for the multi `kind`.
     * If not found will try to search the parent.
     * @template P
     * @param {?} kind
     * @return {?}
     */
    function (kind) {
        return this._multiDefaults[kind] || (this._parent && this._parent.getMultiDefault(kind));
    };
    /**
     * @template P
     * @param {?} kind
     * @param {?} value
     * @return {?}
     */
    PblNgridRegistryService.prototype.setMultiDefault = /**
     * @template P
     * @param {?} kind
     * @param {?} value
     * @return {?}
     */
    function (kind, value) {
        /** @type {?} */
        var previous = this.getMultiDefault(kind);
        if (value !== previous) {
            this._multiDefaults[kind] = value;
            this.emitChanges({ op: value ? 'add' : 'remove', type: kind, value: value });
        }
    };
    /**
     * Returns the registered values for the multi `kind`.
     * If not found WILL NOT search the parent.
     */
    /**
     * Returns the registered values for the multi `kind`.
     * If not found WILL NOT search the parent.
     * @template T
     * @param {?} kind
     * @return {?}
     */
    PblNgridRegistryService.prototype.getMulti = /**
     * Returns the registered values for the multi `kind`.
     * If not found WILL NOT search the parent.
     * @template T
     * @param {?} kind
     * @return {?}
     */
    function (kind) {
        return (/** @type {?} */ (this._multi[kind]));
    };
    /**
     * @template T
     * @param {?} kind
     * @param {?} cellDef
     * @return {?}
     */
    PblNgridRegistryService.prototype.addMulti = /**
     * @template T
     * @param {?} kind
     * @param {?} cellDef
     * @return {?}
     */
    function (kind, cellDef) {
        /** @type {?} */
        var multi = this.getMulti(kind) || (this._multi[kind] = []);
        multi.push(cellDef);
        if (cellDef.name === '*') {
            this.setMultiDefault(kind, cellDef);
        }
        this.emitChanges({ op: 'add', type: kind, value: cellDef });
    };
    /**
     * @template T
     * @param {?} kind
     * @param {?} cellDef
     * @return {?}
     */
    PblNgridRegistryService.prototype.removeMulti = /**
     * @template T
     * @param {?} kind
     * @param {?} cellDef
     * @return {?}
     */
    function (kind, cellDef) {
        /** @type {?} */
        var multi = this.getMulti(kind);
        if (multi) {
            /** @type {?} */
            var idx = multi.indexOf(cellDef);
            if (idx > -1) {
                multi.splice(idx, 1);
            }
            this.emitChanges({ op: 'remove', type: kind, value: cellDef });
        }
    };
    /**
     * Iterate over all multi-registry value of the provided `kind` ascending order, starting from the last ancestor (this registry) up to
     * the root parent.
     *
     * Each time a collection for the `kind` is found the handler is invoked and then repeating the process on the parent.
     * If the `kind` does not exist the handler is not called moving on to the next parent.
     *
     * To bail out (stop the process and don't iterate to the next parent), return true from the handler.
     *
     * @returns The number of times that handler was invoked, i.e 0 means no matches.
     */
    /**
     * Iterate over all multi-registry value of the provided `kind` ascending order, starting from the last ancestor (this registry) up to
     * the root parent.
     *
     * Each time a collection for the `kind` is found the handler is invoked and then repeating the process on the parent.
     * If the `kind` does not exist the handler is not called moving on to the next parent.
     *
     * To bail out (stop the process and don't iterate to the next parent), return true from the handler.
     *
     * @template T
     * @param {?} kind
     * @param {?} handler
     * @return {?} The number of times that handler was invoked, i.e 0 means no matches.
     */
    PblNgridRegistryService.prototype.forMulti = /**
     * Iterate over all multi-registry value of the provided `kind` ascending order, starting from the last ancestor (this registry) up to
     * the root parent.
     *
     * Each time a collection for the `kind` is found the handler is invoked and then repeating the process on the parent.
     * If the `kind` does not exist the handler is not called moving on to the next parent.
     *
     * To bail out (stop the process and don't iterate to the next parent), return true from the handler.
     *
     * @template T
     * @param {?} kind
     * @param {?} handler
     * @return {?} The number of times that handler was invoked, i.e 0 means no matches.
     */
    function (kind, handler) {
        /** @type {?} */
        var registry = this;
        /** @type {?} */
        var hasSome = 0;
        while (registry) {
            /** @type {?} */
            var values = registry.getMulti(kind);
            if (values) {
                hasSome++;
                if (handler(values) === true) {
                    return;
                }
            }
            registry = registry.parent;
        }
        return hasSome;
    };
    /**
     * @return {?}
     */
    PblNgridRegistryService.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.changes$.complete();
    };
    /**
     * Delay all notifications sent through `changes` and buffer then until next call to `bufferEnd()`.
     * When `bufferEnd()` is called it will flush all changes.
     *
     * > It's important to note that buffering does not freeze the registry, adding and removing templates will change the
     * registry and will effect queries. Buffering block the `changes` event stream and nothing more.
     */
    /**
     * Delay all notifications sent through `changes` and buffer then until next call to `bufferEnd()`.
     * When `bufferEnd()` is called it will flush all changes.
     *
     * > It's important to note that buffering does not freeze the registry, adding and removing templates will change the
     * registry and will effect queries. Buffering block the `changes` event stream and nothing more.
     * @return {?}
     */
    PblNgridRegistryService.prototype.bufferStart = /**
     * Delay all notifications sent through `changes` and buffer then until next call to `bufferEnd()`.
     * When `bufferEnd()` is called it will flush all changes.
     *
     * > It's important to note that buffering does not freeze the registry, adding and removing templates will change the
     * registry and will effect queries. Buffering block the `changes` event stream and nothing more.
     * @return {?}
     */
    function () {
        if (!this.root.bufferedData) {
            this.root.bufferedData = [];
        }
    };
    /**
     * @return {?}
     */
    PblNgridRegistryService.prototype.bufferEnd = /**
     * @return {?}
     */
    function () {
        if (this.root.bufferedData) {
            /** @type {?} */
            var data = this.root.bufferedData;
            this.root.bufferedData = undefined;
            this.emitChanges(data);
        }
    };
    /**
     * @private
     * @param {?} events
     * @return {?}
     */
    PblNgridRegistryService.prototype.emitChanges = /**
     * @private
     * @param {?} events
     * @return {?}
     */
    function (events) {
        var _a;
        /** @type {?} */
        var e = Array.isArray(events) ? events : [events];
        if (this.root.bufferedData) {
            (_a = this.root.bufferedData).push.apply(_a, __spread(e));
        }
        else {
            this.changes$.next(e);
        }
    };
    PblNgridRegistryService.decorators = [
        { type: Injectable, args: [{ providedIn: 'root' },] }
    ];
    /** @nocollapse */
    PblNgridRegistryService.ctorParameters = function () { return [
        { type: PblNgridRegistryService, decorators: [{ type: Optional }, { type: SkipSelf }] }
    ]; };
    /** @nocollapse */ PblNgridRegistryService.ɵprov = i0.ɵɵdefineInjectable({ factory: function PblNgridRegistryService_Factory() { return new PblNgridRegistryService(i0.ɵɵinject(PblNgridRegistryService, 12)); }, token: PblNgridRegistryService, providedIn: "root" });
    /**
     * A Registry for templates of table parts.
     *
     * The registry is hierarchical, where each instance of a registry has a parent which allows cascading templates.
     * The hierarchy is manged by angular DI.
     *
     * > The root registry does not have a parent.
     *
     * Each instance of a registry (including root) is a hierarchy by itself, composed of 2 internal levels.
     * The first level (L1 below) is used for fixed templates, the second level (L2 below) is used for dynamic templates.
     *
     * - Root Registry
     *   - Child Registry
     *     - ChildOfChild Registry
     *
     * In the example above there are 3 registries: Root, Child and ChildOfChild.
     *
     * When searching for a template in `ChildOfChild` it will search in the following order (top to bottom):
     *   - ChildOfChild
     *   - Child
     *   - Root
     *
     * If a registry does not contain the template the search will move to the next one.
     */
    PblNgridRegistryService = __decorate([
        UnRx(),
        __metadata("design:paramtypes", [PblNgridRegistryService])
    ], PblNgridRegistryService);
    return PblNgridRegistryService;
}());
export { PblNgridRegistryService };
if (false) {
    /** @type {?} */
    PblNgridRegistryService.prototype.changes;
    /**
     * @type {?}
     * @protected
     */
    PblNgridRegistryService.prototype.root;
    /**
     * @type {?}
     * @protected
     */
    PblNgridRegistryService.prototype._multi;
    /**
     * @type {?}
     * @protected
     */
    PblNgridRegistryService.prototype._multiDefaults;
    /**
     * @type {?}
     * @protected
     */
    PblNgridRegistryService.prototype._singles;
    /**
     * @type {?}
     * @protected
     */
    PblNgridRegistryService.prototype.changes$;
    /**
     * @type {?}
     * @private
     */
    PblNgridRegistryService.prototype._parent;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JpZC1yZWdpc3RyeS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHBlYnVsYS9uZ3JpZC8iLCJzb3VyY2VzIjpbImxpYi9ncmlkL3NlcnZpY2VzL2dyaWQtcmVnaXN0cnkuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxPQUFPLEVBQUUsT0FBTyxFQUFjLE1BQU0sTUFBTSxDQUFDO0FBQzNDLE9BQU8sRUFDTCxVQUFVLEVBQ1YsUUFBUSxFQUNSLFFBQVEsR0FFVCxNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sZUFBZSxDQUFDOzs7OztBQWlCckMsMENBSUM7OztJQUhDLGtDQUFxQjs7SUFDckIsb0NBQXVFOztJQUN2RSxxQ0FBVzs7Ozs7O0FBTWIsK0NBR0M7OztJQUZDLDJDQUFvQzs7SUFDcEMsOENBQTBDOzs7Ozs7QUFNNUMsOENBUUM7OztJQVBDLDhDQUFpRDs7SUFDakQsNkNBQTBDOztJQUMxQyw4Q0FBaUQ7O0lBQ2pELDhDQUFpRDs7SUFDakQsd0RBRW1HOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7SUEwQ25HLGlDQUE0QyxPQUFpQztRQUFqQyxZQUFPLEdBQVAsT0FBTyxDQUEwQjtRQU5uRSxXQUFNLEdBQWtGLEVBQUUsQ0FBQztRQUMzRixtQkFBYyxHQUE2QixFQUFFLENBQUM7UUFDOUMsYUFBUSxHQUE4QixFQUFFLENBQUM7UUFLakQsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLE9BQU8sRUFBRSxDQUFDO1FBQzlCLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUM1QyxJQUFJLElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDaEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENB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QUFtRDs7Ozs7SUFFbkQsMkNBQTZEOzs7OztJQUVqRCwwQ0FBaUUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTdWJqZWN0LCBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQge1xuICBJbmplY3RhYmxlLFxuICBPcHRpb25hbCxcbiAgU2tpcFNlbGYsXG4gIE9uRGVzdHJveSxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IFVuUnggfSBmcm9tICdAcGVidWxhL3V0aWxzJztcblxuaW1wb3J0IHtcbiAgUGJsTmdyaWRDZWxsRGVmRGlyZWN0aXZlLFxuICBQYmxOZ3JpZEVkaXRvckNlbGxEZWZEaXJlY3RpdmUsXG4gIFBibE5ncmlkSGVhZGVyQ2VsbERlZkRpcmVjdGl2ZSxcbiAgUGJsTmdyaWRGb290ZXJDZWxsRGVmRGlyZWN0aXZlLFxuXG4gIFBibE5ncmlkTXVsdGlUZW1wbGF0ZVJlZ2lzdHJ5LFxuICBQYmxOZ3JpZE11bHRpQ29tcG9uZW50UmVnaXN0cnksXG4gIFBibE5ncmlkRGF0YUhlYWRlckV4dGVuc2lvbkNvbnRleHQsXG4gIFBibE5ncmlkRGF0YUhlYWRlckV4dGVuc2lvblJlZixcblxuICBQYmxOZ3JpZE5vRGF0YVJlZkRpcmVjdGl2ZSxcbiAgUGJsTmdyaWRQYWdpbmF0b3JSZWZEaXJlY3RpdmUsXG59IGZyb20gJy4uL2RpcmVjdGl2ZXMnO1xuXG5leHBvcnQgaW50ZXJmYWNlIFJlZ2lzdHJ5Q2hhbmdlZEV2ZW50IHtcbiAgb3A6ICdhZGQnIHwgJ3JlbW92ZSc7XG4gIHR5cGU6IGtleW9mIFBibE5ncmlkTXVsdGlSZWdpc3RyeU1hcCB8IGtleW9mIFBibE5ncmlkU2luZ2xlUmVnaXN0cnlNYXA7XG4gIHZhbHVlOiBhbnk7XG59XG5cbi8qKlxuICogQSBtYXAgb2YgdmFsaWQgc2luZ2xlLWl0ZW0gdmFsdWUgdGhhdCBjYW4gYmUgcmVnaXN0ZXJlZCwgYW5kIHRoZWlyIHR5cGUuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgUGJsTmdyaWRTaW5nbGVSZWdpc3RyeU1hcCB7XG4gIG5vRGF0YT86IFBibE5ncmlkTm9EYXRhUmVmRGlyZWN0aXZlO1xuICBwYWdpbmF0b3I/OiBQYmxOZ3JpZFBhZ2luYXRvclJlZkRpcmVjdGl2ZTtcbn1cblxuLyoqXG4gKiBBIG1hcCBvZiB2YWxpZCBtdWx0aS1pdGVtIHZhbHVlIHRoYXQgY2FuIGJlIHJlZ2lzdGVyZWQsIGFuZCB0aGVpciB0eXBlICh0aGUgc2luZ2xlIHR5cGUsIGkuZS4gVCBpbiBBcnJheTxUPilcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBQYmxOZ3JpZE11bHRpUmVnaXN0cnlNYXAge1xuICBoZWFkZXJDZWxsPzogUGJsTmdyaWRIZWFkZXJDZWxsRGVmRGlyZWN0aXZlPGFueT47XG4gIHRhYmxlQ2VsbD86IFBibE5ncmlkQ2VsbERlZkRpcmVjdGl2ZTxhbnk+O1xuICBlZGl0b3JDZWxsPzogUGJsTmdyaWRFZGl0b3JDZWxsRGVmRGlyZWN0aXZlPGFueT47XG4gIGZvb3RlckNlbGw/OiBQYmxOZ3JpZEZvb3RlckNlbGxEZWZEaXJlY3RpdmU8YW55PjtcbiAgZGF0YUhlYWRlckV4dGVuc2lvbnM/OlxuICAgIChQYmxOZ3JpZE11bHRpVGVtcGxhdGVSZWdpc3RyeTxQYmxOZ3JpZERhdGFIZWFkZXJFeHRlbnNpb25Db250ZXh0LCAnZGF0YUhlYWRlckV4dGVuc2lvbnMnPiAmIFBibE5ncmlkRGF0YUhlYWRlckV4dGVuc2lvblJlZilcbiAgICB8IChQYmxOZ3JpZE11bHRpQ29tcG9uZW50UmVnaXN0cnk8YW55LCAnZGF0YUhlYWRlckV4dGVuc2lvbnMnPiAmIFBibE5ncmlkRGF0YUhlYWRlckV4dGVuc2lvblJlZik7XG59XG5cbi8qKlxuICogQSBSZWdpc3RyeSBmb3IgdGVtcGxhdGVzIG9mIHRhYmxlIHBhcnRzLlxuICpcbiAqIFRoZSByZWdpc3RyeSBpcyBoaWVyYXJjaGljYWwsIHdoZXJlIGVhY2ggaW5zdGFuY2Ugb2YgYSByZWdpc3RyeSBoYXMgYSBwYXJlbnQgd2hpY2ggYWxsb3dzIGNhc2NhZGluZyB0ZW1wbGF0ZXMuXG4gKiBUaGUgaGllcmFyY2h5IGlzIG1hbmdlZCBieSBhbmd1bGFyIERJLlxuICpcbiAqID4gVGhlIHJvb3QgcmVnaXN0cnkgZG9lcyBub3QgaGF2ZSBhIHBhcmVudC5cbiAqXG4gKiBFYWNoIGluc3RhbmNlIG9mIGEgcmVnaXN0cnkgKGluY2x1ZGluZyByb290KSBpcyBhIGhpZXJhcmNoeSBieSBpdHNlbGYsIGNvbXBvc2VkIG9mIDIgaW50ZXJuYWwgbGV2ZWxzLlxuICogVGhlIGZpcnN0IGxldmVsIChMMSBiZWxvdykgaXMgdXNlZCBmb3IgZml4ZWQgdGVtcGxhdGVzLCB0aGUgc2Vjb25kIGxldmVsIChMMiBiZWxvdykgaXMgdXNlZCBmb3IgZHluYW1pYyB0ZW1wbGF0ZXMuXG4gKlxuICogLSBSb290IFJlZ2lzdHJ5XG4gKiAgIC0gQ2hpbGQgUmVnaXN0cnlcbiAqICAgICAtIENoaWxkT2ZDaGlsZCBSZWdpc3RyeVxuICpcbiAqIEluIHRoZSBleGFtcGxlIGFib3ZlIHRoZXJlIGFyZSAzIHJlZ2lzdHJpZXM6IFJvb3QsIENoaWxkIGFuZCBDaGlsZE9mQ2hpbGQuXG4gKlxuICogV2hlbiBzZWFyY2hpbmcgZm9yIGEgdGVtcGxhdGUgaW4gYENoaWxkT2ZDaGlsZGAgaXQgd2lsbCBzZWFyY2ggaW4gdGhlIGZvbGxvd2luZyBvcmRlciAodG9wIHRvIGJvdHRvbSk6XG4gKiAgIC0gQ2hpbGRPZkNoaWxkXG4gKiAgIC0gQ2hpbGRcbiAqICAgLSBSb290XG4gKlxuICogSWYgYSByZWdpc3RyeSBkb2VzIG5vdCBjb250YWluIHRoZSB0ZW1wbGF0ZSB0aGUgc2VhcmNoIHdpbGwgbW92ZSB0byB0aGUgbmV4dCBvbmUuXG4gKi9cbkBJbmplY3RhYmxlKHsgcHJvdmlkZWRJbjogJ3Jvb3QnIH0pXG5AVW5SeCgpXG5leHBvcnQgY2xhc3MgUGJsTmdyaWRSZWdpc3RyeVNlcnZpY2UgaW1wbGVtZW50cyBPbkRlc3Ryb3kge1xuXG4gIHJlYWRvbmx5IGNoYW5nZXM6IE9ic2VydmFibGU8UmVnaXN0cnlDaGFuZ2VkRXZlbnRbXT47XG4gIGdldCBwYXJlbnQoKTogUGJsTmdyaWRSZWdpc3RyeVNlcnZpY2UgfCB1bmRlZmluZWQgeyByZXR1cm4gdGhpcy5fcGFyZW50OyB9XG5cbiAgcHJvdGVjdGVkIHJvb3Q6IFBibE5ncmlkUmVnaXN0cnlTZXJ2aWNlICYgeyBidWZmZXJlZERhdGE/OiBSZWdpc3RyeUNoYW5nZWRFdmVudFtdIH07XG5cbiAgcHJvdGVjdGVkIF9tdWx0aTogeyBbSyBpbiBrZXlvZiBQYmxOZ3JpZE11bHRpUmVnaXN0cnlNYXBdOiBBcnJheTxQYmxOZ3JpZE11bHRpUmVnaXN0cnlNYXBbS10+IH0gPSB7fTtcbiAgcHJvdGVjdGVkIF9tdWx0aURlZmF1bHRzOiBQYmxOZ3JpZE11bHRpUmVnaXN0cnlNYXAgPSB7fTtcbiAgcHJvdGVjdGVkIF9zaW5nbGVzOiBQYmxOZ3JpZFNpbmdsZVJlZ2lzdHJ5TWFwID0ge307XG5cbiAgcHJvdGVjdGVkIHJlYWRvbmx5IGNoYW5nZXMkOiBTdWJqZWN0PFJlZ2lzdHJ5Q2hhbmdlZEV2ZW50W10+O1xuXG4gIGNvbnN0cnVjdG9yKEBPcHRpb25hbCgpIEBTa2lwU2VsZigpIHByaXZhdGUgX3BhcmVudD86IFBibE5ncmlkUmVnaXN0cnlTZXJ2aWNlKSB7XG4gICAgdGhpcy5jaGFuZ2VzJCA9IG5ldyBTdWJqZWN0KCk7XG4gICAgdGhpcy5jaGFuZ2VzID0gdGhpcy5jaGFuZ2VzJC5hc09ic2VydmFibGUoKTtcbiAgICBpZiAodGhpcy5fcGFyZW50KSB7XG4gICAgICB0aGlzLl9wYXJlbnQuY2hhbmdlcy5waXBlKFVuUngodGhpcykpLnN1YnNjcmliZSh0aGlzLmNoYW5nZXMkKTtcbiAgICAgIHRoaXMucm9vdCA9IHRoaXMuX3BhcmVudC5yb290O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnJvb3QgPSB0aGlzO1xuICAgIH1cbiAgfVxuXG4gIGdldFJvb3QoKTogUGJsTmdyaWRSZWdpc3RyeVNlcnZpY2UgeyByZXR1cm4gdGhpcy5yb290OyB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIHJlZ2lzdGVyZWQgdmFsdWUgZm9yIHRoZSBzaW5nbGUgYGtpbmRgLlxuICAgKiBJZiBub3QgZm91bmQgd2lsbCB0cnkgdG8gc2VhcmNoIHRoZSBwYXJlbnQuXG4gICAqL1xuICBnZXRTaW5nbGU8UCBleHRlbmRzIGtleW9mIFBibE5ncmlkU2luZ2xlUmVnaXN0cnlNYXA+KGtpbmQ6IFApOiBQYmxOZ3JpZFNpbmdsZVJlZ2lzdHJ5TWFwW1BdIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5fc2luZ2xlc1traW5kXSB8fCAodGhpcy5fcGFyZW50ICYmIHRoaXMuX3BhcmVudC5nZXRTaW5nbGUoa2luZCkpO1xuICB9XG5cbiAgc2V0U2luZ2xlPFAgZXh0ZW5kcyBrZXlvZiBQYmxOZ3JpZFNpbmdsZVJlZ2lzdHJ5TWFwPihraW5kOiBQLCB2YWx1ZTogUGJsTmdyaWRTaW5nbGVSZWdpc3RyeU1hcFtQXSB8IHVuZGVmaW5lZCk6IHZvaWQge1xuICAgIGNvbnN0IHByZXZpb3VzID0gdGhpcy5nZXRTaW5nbGUoa2luZCk7XG4gICAgaWYgKHZhbHVlICE9PSBwcmV2aW91cykge1xuICAgICAgdGhpcy5fc2luZ2xlc1traW5kXSA9IHZhbHVlO1xuICAgICAgdGhpcy5lbWl0Q2hhbmdlcyh7IG9wOiB2YWx1ZSA/ICdhZGQnIDogJ3JlbW92ZScsIHR5cGU6IGtpbmQsIHZhbHVlIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSByZWdpc3RlcmVkIGRlZmF1bHQgdmFsdWUgZm9yIHRoZSBtdWx0aSBga2luZGAuXG4gICAqIElmIG5vdCBmb3VuZCB3aWxsIHRyeSB0byBzZWFyY2ggdGhlIHBhcmVudC5cbiAgICovXG4gIGdldE11bHRpRGVmYXVsdDxQIGV4dGVuZHMga2V5b2YgUGJsTmdyaWRNdWx0aVJlZ2lzdHJ5TWFwPihraW5kOiBQKTogUGJsTmdyaWRNdWx0aVJlZ2lzdHJ5TWFwW1BdIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5fbXVsdGlEZWZhdWx0c1traW5kXSB8fCAodGhpcy5fcGFyZW50ICYmIHRoaXMuX3BhcmVudC5nZXRNdWx0aURlZmF1bHQoa2luZCkpO1xuICB9XG5cbiAgc2V0TXVsdGlEZWZhdWx0PFAgZXh0ZW5kcyBrZXlvZiBQYmxOZ3JpZE11bHRpUmVnaXN0cnlNYXA+KGtpbmQ6IFAsIHZhbHVlOiBQYmxOZ3JpZE11bHRpUmVnaXN0cnlNYXBbUF0gfCB1bmRlZmluZWQpOiB2b2lkIHtcbiAgICBjb25zdCBwcmV2aW91cyA9IHRoaXMuZ2V0TXVsdGlEZWZhdWx0KGtpbmQpO1xuICAgIGlmICh2YWx1ZSAhPT0gcHJldmlvdXMpIHtcbiAgICAgIHRoaXMuX211bHRpRGVmYXVsdHNba2luZF0gPSB2YWx1ZTtcbiAgICAgIHRoaXMuZW1pdENoYW5nZXMoeyBvcDogdmFsdWUgPyAnYWRkJyA6ICdyZW1vdmUnLCB0eXBlOiBraW5kLCB2YWx1ZSB9KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgcmVnaXN0ZXJlZCB2YWx1ZXMgZm9yIHRoZSBtdWx0aSBga2luZGAuXG4gICAqIElmIG5vdCBmb3VuZCBXSUxMIE5PVCBzZWFyY2ggdGhlIHBhcmVudC5cbiAgICovXG4gIGdldE11bHRpPFQgZXh0ZW5kcyBrZXlvZiBQYmxOZ3JpZE11bHRpUmVnaXN0cnlNYXA+KGtpbmQ6IFQpOiBBcnJheTxQYmxOZ3JpZE11bHRpUmVnaXN0cnlNYXBbVF0+IHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5fbXVsdGlba2luZF0gYXMgQXJyYXk8UGJsTmdyaWRNdWx0aVJlZ2lzdHJ5TWFwW1RdPjtcbiAgfVxuXG4gIGFkZE11bHRpPFQgZXh0ZW5kcyBrZXlvZiBQYmxOZ3JpZE11bHRpUmVnaXN0cnlNYXA+KGtpbmQ6IFQsIGNlbGxEZWY6IFBibE5ncmlkTXVsdGlSZWdpc3RyeU1hcFtUXSk6IHZvaWQge1xuICAgIGNvbnN0IG11bHRpID0gdGhpcy5nZXRNdWx0aShraW5kKSB8fCAodGhpcy5fbXVsdGlba2luZF0gPSBbXSk7XG4gICAgbXVsdGkucHVzaChjZWxsRGVmKTtcbiAgICBpZiAoY2VsbERlZi5uYW1lID09PSAnKicpIHtcbiAgICAgIHRoaXMuc2V0TXVsdGlEZWZhdWx0KGtpbmQsIGNlbGxEZWYpO1xuICAgIH1cbiAgICB0aGlzLmVtaXRDaGFuZ2VzKHsgb3A6ICdhZGQnLCB0eXBlOiBraW5kLCB2YWx1ZTogY2VsbERlZiB9KVxuICB9XG5cbiAgcmVtb3ZlTXVsdGk8VCBleHRlbmRzIGtleW9mIFBibE5ncmlkTXVsdGlSZWdpc3RyeU1hcD4oa2luZDogVCwgY2VsbERlZjogUGJsTmdyaWRNdWx0aVJlZ2lzdHJ5TWFwW1RdKTogdm9pZCB7XG4gICAgY29uc3QgbXVsdGkgPSB0aGlzLmdldE11bHRpKGtpbmQpO1xuICAgIGlmIChtdWx0aSkge1xuICAgICAgY29uc3QgaWR4ID0gbXVsdGkuaW5kZXhPZihjZWxsRGVmKTtcbiAgICAgIGlmIChpZHggPiAtMSkge1xuICAgICAgICBtdWx0aS5zcGxpY2UoaWR4LCAxKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuZW1pdENoYW5nZXMoeyBvcDogJ3JlbW92ZScsIHR5cGU6IGtpbmQsIHZhbHVlOiBjZWxsRGVmIH0pXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEl0ZXJhdGUgb3ZlciBhbGwgbXVsdGktcmVnaXN0cnkgdmFsdWUgb2YgdGhlIHByb3ZpZGVkIGBraW5kYCBhc2NlbmRpbmcgb3JkZXIsIHN0YXJ0aW5nIGZyb20gdGhlIGxhc3QgYW5jZXN0b3IgKHRoaXMgcmVnaXN0cnkpIHVwIHRvXG4gICAqIHRoZSByb290IHBhcmVudC5cbiAgICpcbiAgICogRWFjaCB0aW1lIGEgY29sbGVjdGlvbiBmb3IgdGhlIGBraW5kYCBpcyBmb3VuZCB0aGUgaGFuZGxlciBpcyBpbnZva2VkIGFuZCB0aGVuIHJlcGVhdGluZyB0aGUgcHJvY2VzcyBvbiB0aGUgcGFyZW50LlxuICAgKiBJZiB0aGUgYGtpbmRgIGRvZXMgbm90IGV4aXN0IHRoZSBoYW5kbGVyIGlzIG5vdCBjYWxsZWQgbW92aW5nIG9uIHRvIHRoZSBuZXh0IHBhcmVudC5cbiAgICpcbiAgICogVG8gYmFpbCBvdXQgKHN0b3AgdGhlIHByb2Nlc3MgYW5kIGRvbid0IGl0ZXJhdGUgdG8gdGhlIG5leHQgcGFyZW50KSwgcmV0dXJuIHRydWUgZnJvbSB0aGUgaGFuZGxlci5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIG51bWJlciBvZiB0aW1lcyB0aGF0IGhhbmRsZXIgd2FzIGludm9rZWQsIGkuZSAwIG1lYW5zIG5vIG1hdGNoZXMuXG4gICAqL1xuICBmb3JNdWx0aTxUIGV4dGVuZHMga2V5b2YgUGJsTmdyaWRNdWx0aVJlZ2lzdHJ5TWFwPihraW5kOiBULFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyOiAoICh2YWx1ZXM6IEFycmF5PFBibE5ncmlkTXVsdGlSZWdpc3RyeU1hcFtUXT4pID0+IGJvb2xlYW4gfCB2b2lkKSk6IG51bWJlciB7XG4gICAgbGV0IHJlZ2lzdHJ5OiBQYmxOZ3JpZFJlZ2lzdHJ5U2VydmljZSA9IHRoaXM7XG4gICAgbGV0IGhhc1NvbWUgPSAwO1xuICAgIHdoaWxlIChyZWdpc3RyeSkge1xuICAgICAgY29uc3QgdmFsdWVzID0gcmVnaXN0cnkuZ2V0TXVsdGkoa2luZCk7XG4gICAgICBpZiAodmFsdWVzKSB7XG4gICAgICAgIGhhc1NvbWUrKztcbiAgICAgICAgaWYgKGhhbmRsZXIodmFsdWVzKSA9PT0gdHJ1ZSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmVnaXN0cnkgPSByZWdpc3RyeS5wYXJlbnQ7XG4gICAgfVxuICAgIHJldHVybiBoYXNTb21lO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy5jaGFuZ2VzJC5jb21wbGV0ZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIERlbGF5IGFsbCBub3RpZmljYXRpb25zIHNlbnQgdGhyb3VnaCBgY2hhbmdlc2AgYW5kIGJ1ZmZlciB0aGVuIHVudGlsIG5leHQgY2FsbCB0byBgYnVmZmVyRW5kKClgLlxuICAgKiBXaGVuIGBidWZmZXJFbmQoKWAgaXMgY2FsbGVkIGl0IHdpbGwgZmx1c2ggYWxsIGNoYW5nZXMuXG4gICAqXG4gICAqID4gSXQncyBpbXBvcnRhbnQgdG8gbm90ZSB0aGF0IGJ1ZmZlcmluZyBkb2VzIG5vdCBmcmVlemUgdGhlIHJlZ2lzdHJ5LCBhZGRpbmcgYW5kIHJlbW92aW5nIHRlbXBsYXRlcyB3aWxsIGNoYW5nZSB0aGVcbiAgICogcmVnaXN0cnkgYW5kIHdpbGwgZWZmZWN0IHF1ZXJpZXMuIEJ1ZmZlcmluZyBibG9jayB0aGUgYGNoYW5nZXNgIGV2ZW50IHN0cmVhbSBhbmQgbm90aGluZyBtb3JlLlxuICAgKi9cbiAgYnVmZmVyU3RhcnQoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLnJvb3QuYnVmZmVyZWREYXRhKSB7XG4gICAgICB0aGlzLnJvb3QuYnVmZmVyZWREYXRhID0gW107XG4gICAgfVxuICB9XG5cbiAgYnVmZmVyRW5kKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLnJvb3QuYnVmZmVyZWREYXRhKSB7XG4gICAgICBjb25zdCBkYXRhID0gdGhpcy5yb290LmJ1ZmZlcmVkRGF0YTtcbiAgICAgIHRoaXMucm9vdC5idWZmZXJlZERhdGEgPSB1bmRlZmluZWQ7XG4gICAgICB0aGlzLmVtaXRDaGFuZ2VzKGRhdGEpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZW1pdENoYW5nZXMoZXZlbnRzOiBSZWdpc3RyeUNoYW5nZWRFdmVudCB8IFJlZ2lzdHJ5Q2hhbmdlZEV2ZW50W10pOiB2b2lkIHtcbiAgICBjb25zdCBlID0gQXJyYXkuaXNBcnJheShldmVudHMpID8gZXZlbnRzIDogW2V2ZW50c107XG4gICAgaWYgKHRoaXMucm9vdC5idWZmZXJlZERhdGEpIHtcbiAgICAgIHRoaXMucm9vdC5idWZmZXJlZERhdGEucHVzaCguLi5lKVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNoYW5nZXMkLm5leHQoZSk7XG4gICAgfVxuICB9XG59XG4iXX0=