/**
 * @fileoverview added by tsickle
 * Generated from: lib/transpose-table-session.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { isObservable, of as obsOf, from as obsFrom } from 'rxjs';
import { map, tap } from 'rxjs/operators';
import { UnRx } from '@pebula/utils';
/** @type {?} */
export var LOCAL_COLUMN_DEF = Symbol('LOCAL_COLUMN_DEF');
/** @type {?} */
export var VIRTUAL_REFRESH = {};
var TransposeTableSession = /** @class */ (function () {
    function TransposeTableSession(grid, pluginCtrl, updateColumns, sourceFactoryWrapper) {
        this.grid = grid;
        this.pluginCtrl = pluginCtrl;
        this.updateColumns = updateColumns;
        this.sourceFactoryWrapper = sourceFactoryWrapper;
        this.init();
        if (grid.columns && grid.columnApi.visibleColumns.length > 0) {
            this.onInvalidateHeaders();
        }
        this.onDataSource(this.grid.ds);
    }
    /**
     * @param {?} updateTable
     * @return {?}
     */
    TransposeTableSession.prototype.destroy = /**
     * @param {?} updateTable
     * @return {?}
     */
    function (updateTable) {
        if (!this.destroyed) {
            this.destroyed = true;
            UnRx.kill(this, this.grid);
            this.grid.showHeader = this.headerRow;
            this.grid.columns = this.columnsInput;
            if (updateTable) {
                this.grid.invalidateColumns();
                this.grid.ds.refresh(VIRTUAL_REFRESH);
            }
        }
    };
    /**
     * @private
     * @return {?}
     */
    TransposeTableSession.prototype.init = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.headerRow = this.grid.showHeader;
        this.grid.showHeader = false;
        this.pluginCtrl.events
            .pipe(UnRx(this, this.grid))
            .subscribe((/**
         * @param {?} e
         * @return {?}
         */
        function (e) { return e.kind === 'onInvalidateHeaders' && _this.onInvalidateHeaders(); }));
        this.pluginCtrl.events
            .pipe(UnRx(this, this.grid))
            .subscribe((/**
         * @param {?} e
         * @return {?}
         */
        function (e) { return e.kind === 'onDataSource' && _this.onDataSource(e.curr); }));
    };
    /**
     * @private
     * @return {?}
     */
    TransposeTableSession.prototype.onInvalidateHeaders = /**
     * @private
     * @return {?}
     */
    function () {
        if (!this.grid.columns[LOCAL_COLUMN_DEF]) {
            this.columnsInput = this.grid.columns;
            this.storeColumns = this.grid.columnApi.visibleColumns;
            this.updateColumns();
        }
    };
    /**
     * @private
     * @param {?=} ds
     * @return {?}
     */
    TransposeTableSession.prototype.onDataSource = /**
     * @private
     * @param {?=} ds
     * @return {?}
     */
    function (ds) {
        var _this = this;
        this.unPatchDataSource();
        if (ds) {
            this.ds = ds;
            this.dsSourceFactory = ds.adapter.sourceFactory;
            this.ds.adapter.sourceFactory = (/**
             * @param {?} event
             * @return {?}
             */
            function (event) {
                /** @type {?} */
                var rawSource = event.data.changed && event.data.curr === VIRTUAL_REFRESH
                    ? _this.ds.source
                    : _this.dsSourceFactory(event);
                if (rawSource === false) {
                    return rawSource;
                }
                else if (_this.destroyed) {
                    _this.unPatchDataSource();
                    return _this.rawSource;
                }
                /** @type {?} */
                var obs = isObservable(rawSource)
                    ? rawSource
                    : Array.isArray(rawSource) ? obsOf(rawSource) : obsFrom(rawSource) // promise...
                ;
                return obs
                    .pipe(tap((/**
                 * @param {?} source
                 * @return {?}
                 */
                function (source) { return _this.rawSource = source; })), map(_this.sourceFactoryWrapper));
            });
        }
    };
    /**
     * @private
     * @return {?}
     */
    TransposeTableSession.prototype.unPatchDataSource = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.ds) {
            this.ds.adapter.sourceFactory = this.dsSourceFactory;
            this.ds = this.dsSourceFactory = undefined;
        }
    };
    return TransposeTableSession;
}());
export { TransposeTableSession };
if (false) {
    /** @type {?} */
    TransposeTableSession.prototype.dsSourceFactory;
    /** @type {?} */
    TransposeTableSession.prototype.ds;
    /** @type {?} */
    TransposeTableSession.prototype.columnsInput;
    /** @type {?} */
    TransposeTableSession.prototype.storeColumns;
    /** @type {?} */
    TransposeTableSession.prototype.headerRow;
    /**
     * @type {?}
     * @private
     */
    TransposeTableSession.prototype.destroyed;
    /**
     * @type {?}
     * @private
     */
    TransposeTableSession.prototype.rawSource;
    /**
     * @type {?}
     * @private
     */
    TransposeTableSession.prototype.grid;
    /**
     * @type {?}
     * @private
     */
    TransposeTableSession.prototype.pluginCtrl;
    /**
     * @type {?}
     * @private
     */
    TransposeTableSession.prototype.updateColumns;
    /**
     * @type {?}
     * @private
     */
    TransposeTableSession.prototype.sourceFactoryWrapper;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhbnNwb3NlLXRhYmxlLXNlc3Npb24uanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcGVidWxhL25ncmlkL3RyYW5zcG9zZS8iLCJzb3VyY2VzIjpbImxpYi90cmFuc3Bvc2UtdGFibGUtc2Vzc2lvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBYyxZQUFZLEVBQUUsRUFBRSxJQUFJLEtBQUssRUFBRSxJQUFJLElBQUksT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzlFLE9BQU8sRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFMUMsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLGVBQWUsQ0FBQzs7QUFVckMsTUFBTSxLQUFPLGdCQUFnQixHQUFHLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQzs7QUFDMUQsTUFBTSxLQUFPLGVBQWUsR0FBRyxFQUFFO0FBRWpDO0lBVUUsK0JBQW9CLElBQTRCLEVBQzVCLFVBQW9DLEVBQ3BDLGFBQXlCLEVBQ3pCLG9CQUErQztRQUgvQyxTQUFJLEdBQUosSUFBSSxDQUF3QjtRQUM1QixlQUFVLEdBQVYsVUFBVSxDQUEwQjtRQUNwQyxrQkFBYSxHQUFiLGFBQWEsQ0FBWTtRQUN6Qix5QkFBb0IsR0FBcEIsb0JBQW9CLENBQTJCO1FBQ2pFLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNaLElBQUksSUFBSSxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLGNBQWMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1lBQzVELElBQUksQ0FBQyxtQkFBbUIsRUFBRSxDQUFDO1NBQzVCO1FBQ0QsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ2xDLENBQUM7Ozs7O0lBRUQsdUNBQU87Ozs7SUFBUCxVQUFRLFdBQW9CO1FBQzFCLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFO1lBQ25CLElBQUks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UyxDQUFDO29CQUNwRCxDQUFDLENBQUMsU0FBUztvQkFDWCxDQUFDLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFNLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUMsYUFBYTs7Z0JBRXZGLE9BQU8sR0FBRztxQkFDUCxJQUFJLENBQ0gsR0FBRzs7OztnQkFBRSxVQUFBLE1BQU0sSUFBSSxPQUFBLEtBQUksQ0FBQyxTQUFTLEdBQUcsTUFBTSxFQUF2QixDQUF1QixFQUFFLEVBQ3hDLEdBQUcsQ0FBQyxLQUFJLENBQUMsb0JBQW9CLENBQUMsQ0FDL0IsQ0FBQztZQUNOLENBQUMsQ0FBQSxDQUFBO1NBQ0Y7SUFDSCxDQUFDOzs7OztJQUVPLGlEQUFpQjs7OztJQUF6QjtRQUNFLElBQUksSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNYLElBQUksQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDO1lBQ3JELElBQUksQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLGVBQWUsR0FBRyxTQUFTLENBQUM7U0FDNUM7SUFDSCxDQUFDO0lBQ0gsNEJBQUM7QUFBRCxDQUFDLEFBNUZELElBNEZDOzs7O0lBM0ZDLGdEQUFxQjs7SUFDckIsbUNBQXVCOztJQUN2Qiw2Q0FBMEM7O0lBQzFDLDZDQUEwQjs7SUFDMUIsMENBQW1COzs7OztJQUVuQiwwQ0FBMkI7Ozs7O0lBQzNCLDBDQUF5Qjs7Ozs7SUFFYixxQ0FBb0M7Ozs7O0lBQ3BDLDJDQUE0Qzs7Ozs7SUFDNUMsOENBQWlDOzs7OztJQUNqQyxxREFBdUQiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBPYnNlcnZhYmxlLCBpc09ic2VydmFibGUsIG9mIGFzIG9ic09mLCBmcm9tIGFzIG9ic0Zyb20gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IG1hcCwgdGFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5pbXBvcnQgeyBVblJ4IH0gZnJvbSAnQHBlYnVsYS91dGlscyc7XG5pbXBvcnQge1xuICBQYmxOZ3JpZENvbHVtbkRlZmluaXRpb25TZXQsXG4gIFBibE5ncmlkQ29tcG9uZW50LFxuICBQYmxOZ3JpZFBsdWdpbkNvbnRyb2xsZXIsXG4gIFBibERhdGFTb3VyY2UsXG4gIFBibENvbHVtbixcbiAgUGJsRGF0YVNvdXJjZVRyaWdnZXJDaGFuZ2VkRXZlbnQsXG59IGZyb20gJ0BwZWJ1bGEvbmdyaWQnO1xuXG5leHBvcnQgY29uc3QgTE9DQUxfQ09MVU1OX0RFRiA9IFN5bWJvbCgnTE9DQUxfQ09MVU1OX0RFRicpO1xuZXhwb3J0IGNvbnN0IFZJUlRVQUxfUkVGUkVTSCA9IHt9O1xuXG5leHBvcnQgY2xhc3MgVHJhbnNwb3NlVGFibGVTZXNzaW9uIHtcbiAgZHNTb3VyY2VGYWN0b3J5OiBhbnk7XG4gIGRzOiBQYmxEYXRhU291cmNlPGFueT47XG4gIGNvbHVtbnNJbnB1dDogUGJsTmdyaWRDb2x1bW5EZWZpbml0aW9uU2V0O1xuICBzdG9yZUNvbHVtbnM6IFBibENvbHVtbltdO1xuICBoZWFkZXJSb3c6IGJvb2xlYW47XG5cbiAgcHJpdmF0ZSBkZXN0cm95ZWQ6IGJvb2xlYW47XG4gIHByaXZhdGUgcmF3U291cmNlOiBhbnlbXTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGdyaWQ6IFBibE5ncmlkQ29tcG9uZW50PGFueT4sXG4gICAgICAgICAgICAgIHByaXZhdGUgcGx1Z2luQ3RybDogUGJsTmdyaWRQbHVnaW5Db250cm9sbGVyLFxuICAgICAgICAgICAgICBwcml2YXRlIHVwZGF0ZUNvbHVtbnM6ICgpID0+IHZvaWQsXG4gICAgICAgICAgICAgIHByaXZhdGUgc291cmNlRmFjdG9yeVdyYXBwZXI6IChyZXN1bHRzOiBhbnlbXSkgPT4gYW55W10pIHtcbiAgICB0aGlzLmluaXQoKTtcbiAgICBpZiAoZ3JpZC5jb2x1bW5zICYmIGdyaWQuY29sdW1uQXBpLnZpc2libGVDb2x1bW5zLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMub25JbnZhbGlkYXRlSGVhZGVycygpO1xuICAgIH1cbiAgICB0aGlzLm9uRGF0YVNvdXJjZSh0aGlzLmdyaWQuZHMpO1xuICB9XG5cbiAgZGVzdHJveSh1cGRhdGVUYWJsZTogYm9vbGVhbik6IHZvaWQge1xuICAgIGlmICghdGhpcy5kZXN0cm95ZWQpIHtcbiAgICAgIHRoaXMuZGVzdHJveWVkID0gdHJ1ZTtcbiAgICAgIFVuUngua2lsbCh0aGlzLCB0aGlzLmdyaWQpO1xuXG4gICAgICB0aGlzLmdyaWQuc2hvd0hlYWRlciA9IHRoaXMuaGVhZGVyUm93O1xuICAgICAgdGhpcy5ncmlkLmNvbHVtbnMgPSB0aGlzLmNvbHVtbnNJbnB1dDtcbiAgICAgIGlmICh1cGRhdGVUYWJsZSkge1xuICAgICAgICB0aGlzLmdyaWQuaW52YWxpZGF0ZUNvbHVtbnMoKTtcbiAgICAgICAgdGhpcy5ncmlkLmRzLnJlZnJlc2goVklSVFVBTF9SRUZSRVNIKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5oZWFkZXJSb3cgPSB0aGlzLmdyaWQuc2hvd0hlYWRlcjtcbiAgICB0aGlzLmdyaWQuc2hvd0hlYWRlciA9IGZhbHNlO1xuICAgIHRoaXMucGx1Z2luQ3RybC5ldmVudHNcbiAgICAgIC5waXBlKFVuUngodGhpcywgdGhpcy5ncmlkKSlcbiAgICAgIC5zdWJzY3JpYmUoIGUgPT4gZS5raW5kID09PSAnb25JbnZhbGlkYXRlSGVhZGVycycgJiYgdGhpcy5vbkludmFsaWRhdGVIZWFkZXJzKCkgKTtcblxuICAgIHRoaXMucGx1Z2luQ3RybC5ldmVudHNcbiAgICAgIC5waXBlKFVuUngodGhpcywgdGhpcy5ncmlkKSlcbiAgICAgIC5zdWJzY3JpYmUoIGUgPT4gZS5raW5kID09PSAnb25EYXRhU291cmNlJyAmJiB0aGlzLm9uRGF0YVNvdXJjZShlLmN1cnIpICk7XG4gIH1cblxuICBwcml2YXRlIG9uSW52YWxpZGF0ZUhlYWRlcnMoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmdyaWQuY29sdW1uc1tMT0NBTF9DT0xVTU5fREVGXSkge1xuICAgICAgdGhpcy5jb2x1bW5zSW5wdXQgPSB0aGlzLmdyaWQuY29sdW1ucztcbiAgICAgIHRoaXMuc3RvcmVDb2x1bW5zID0gdGhpcy5ncmlkLmNvbHVtbkFwaS52aXNpYmxlQ29sdW1ucztcbiAgICAgIHRoaXMudXBkYXRlQ29sdW1ucygpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgb25EYXRhU291cmNlKGRzPzogUGJsRGF0YVNvdXJjZSk6IHZvaWQge1xuICAgIHRoaXMudW5QYXRjaERhdGFTb3VyY2UoKTtcbiAgICBpZiAoZHMpIHtcbiAgICAgIHRoaXMuZHMgPSBkcztcbiAgICAgIHRoaXMuZHNTb3VyY2VGYWN0b3J5ID0gZHMuYWRhcHRlci5zb3VyY2VGYWN0b3J5O1xuICAgICAgdGhpcy5kcy5hZGFwdGVyLnNvdXJjZUZhY3RvcnkgPSAoZXZlbnQ6IFBibERhdGFTb3VyY2VUcmlnZ2VyQ2hhbmdlZEV2ZW50KSA9PiB7XG4gICAgICAgIGNvbnN0IHJhd1NvdXJjZSA9IGV2ZW50LmRhdGEuY2hhbmdlZCAmJiBldmVudC5kYXRhLmN1cnIgPT09IFZJUlRVQUxfUkVGUkVTSFxuICAgICAgICAgID8gdGhpcy5kcy5zb3VyY2VcbiAgICAgICAgICA6IHRoaXMuZHNTb3VyY2VGYWN0b3J5KGV2ZW50KVxuICAgICAgICA7XG5cbiAgICAgICAgaWYgKHJhd1NvdXJjZSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICByZXR1cm4gcmF3U291cmNlO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZGVzdHJveWVkKSB7XG4gICAgICAgICAgdGhpcy51blBhdGNoRGF0YVNvdXJjZSgpO1xuICAgICAgICAgIHJldHVybiB0aGlzLnJhd1NvdXJjZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG9iczogT2JzZXJ2YWJsZTxhbnlbXT4gPSBpc09ic2VydmFibGUocmF3U291cmNlKVxuICAgICAgICAgID8gcmF3U291cmNlXG4gICAgICAgICAgOiBBcnJheS5pc0FycmF5KHJhd1NvdXJjZSkgPyBvYnNPZjxhbnk+KHJhd1NvdXJjZSkgOiBvYnNGcm9tKHJhd1NvdXJjZSkgLy8gcHJvbWlzZS4uLlxuICAgICAgICA7XG4gICAgICAgIHJldHVybiBvYnNcbiAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgIHRhcCggc291cmNlID0+IHRoaXMucmF3U291cmNlID0gc291cmNlICksXG4gICAgICAgICAgICBtYXAodGhpcy5zb3VyY2VGYWN0b3J5V3JhcHBlciksXG4gICAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHVuUGF0Y2hEYXRhU291cmNlKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmRzKSB7XG4gICAgICB0aGlzLmRzLmFkYXB0ZXIuc291cmNlRmFjdG9yeSA9IHRoaXMuZHNTb3VyY2VGYWN0b3J5O1xuICAgICAgdGhpcy5kcyA9IHRoaXMuZHNTb3VyY2VGYWN0b3J5ID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgfVxufVxuIl19