function _createForOfIteratorHelper(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,r=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw r}}}}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{"30jZ":function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var i=n("4X/P");function a(t){switch(t.type){case i.b.TYPE_REPLACEMENT:return"Replacement";case i.b.TYPE_INSERTION:return"Insertion";case i.b.TYPE_DELETION:return"Deletion";default:return t.other_description}}},BBYV:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n("3Y4h"),a=n("fXoL"),r=function(){var t=function(){function t(){_classCallCheck(this,t),this.LI_MARGIN_BOTTOM=8,this.LINE_HEIGHT=1.25,this.P_MARGIN_BOTTOM=4,this.H_MARGIN_TOP=10,this.elementStyles={b:["font-weight:bold"],strong:["font-weight:bold"],u:["text-decoration:underline"],em:["font-style:italic"],i:["font-style:italic"],h1:["font-size:14","font-weight:bold"],h2:["font-size:12","font-weight:bold"],h3:["font-size:10","font-weight:bold"],h4:["font-size:10","font-style:italic"],h5:["font-size:10"],h6:["font-size:10"],a:["color:blue","text-decoration:underline"],strike:["text-decoration:line-through"],del:["color:red","text-decoration:line-through"],ins:["color:green","text-decoration:underline"]},this.classStyles={delete:["color:red","text-decoration:line-through"],insert:["color:green","text-decoration:underline"],paragraphcontext:["color:grey"]}}return _createClass(t,[{key:"getMarginTop",value:function(t){switch(t){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return this.H_MARGIN_TOP;default:return 0}}},{key:"getMarginBottom",value:function(t){switch(t){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":case"li":default:return this.P_MARGIN_BOTTOM}}},{key:"addPlainText",value:function(t){return{columns:[{stack:this.convertHtml(t,i.d.None)}]}}},{key:"convertHtml",value:function(t,e){var n=[];this.lineNumberingMode=e||i.d.None;for(var a=(new DOMParser).parseFromString(t,"text/html"),r=0,o=Array.from(a.body.childNodes);r<o.length;r++){var s=o[r],c=this.parseElement(s);n.push(c)}return n}},{key:"parseElement",value:function(t,e){var n,a=t.nodeName.toLowerCase(),r=[];if(e=e||[],t.getAttribute){var o=t.getAttribute("style"),s=t.getAttribute("class");if(o&&(e=o.split(";").map((function(t){return t.replace(/\s/g,"")})).concat(e)),s){var c,l=_createForOfIteratorHelper(r=s.toLowerCase().split(" "));try{for(l.s();!(c=l.n()).done;){var u=c.value;this.classStyles[u]&&this.classStyles[u].forEach((function(t){e.push(t)}))}}catch(k){l.e(k)}finally{l.f()}}}switch(a){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":case"li":case"p":case"div":var h=this.parseChildren(t,e);this.lineNumberingMode!==i.d.Outside||r.includes("insert")?(n=this.create("text")).text=h:(n=this.create("stack")).stack=h,n.margin=[0,0,0,0],n.margin[1]=this.getMarginTop(a),n.margin[3]=this.getMarginBottom(a),this.lineNumberingMode===i.d.Outside&&r.includes("insert")&&(n.margin[0]=20,n.margin[3]=this.P_MARGIN_BOTTOM),r.includes("os-split-before")&&(n.listType="none"),(r.includes("os-split-after")||this.withSublist(t))&&(n.margin[3]=0),n.lineHeight=this.LINE_HEIGHT,n=Object.assign(Object.assign(Object.assign({},n),this.computeStyle(e)),this.computeStyle(this.elementStyles[a]));break;case"a":case"b":case"strong":case"u":case"em":case"i":case"ins":case"del":case"strike":var d=this.parseChildren(t,e.concat(this.elementStyles[a]));(n=this.create("text")).text=d;break;case"span":if(t.getAttribute("data-line-number")&&!this.isInsideAList(t)){if(this.lineNumberingMode===i.d.Inside);else if(this.lineNumberingMode===i.d.Outside){var f=t.getAttribute("data-line-number");n={columns:[this.getLineNumberObject({lineNumber:+f}),{text:[]}]}}}else{var m=this.parseChildren(t,e);(n=Object.assign(Object.assign({},this.create("text")),this.computeStyle(e))).text=m}break;case"br":if(this.lineNumberingMode===i.d.None&&r.includes("os-line-break")||this.lineNumberingMode===i.d.Outside&&this.isInsideAList(t))break;(n=this.create("text")).text="\n",n.lineHeight=this.LINE_HEIGHT;break;case"ul":case"ol":var g=this.create(a);if("ol"===a){var p=t.getAttribute("start");p&&(g.start=parseInt(p,10))}if(this.lineNumberingMode===i.d.Outside){var v=this.extractLineNumbers(t),b=this.cleanLineNumbers(t),y=this.parseChildren(b,e);if(v.length>0){var T={columns:[{width:20,stack:[]}],margin:[0,0,0,0]};this.isFakeList(t)&&(T.margin[3]=-this.LI_MARGIN_BOTTOM);var x,S=_createForOfIteratorHelper(v);try{for(S.s();!(x=S.n()).done;){var _=x.value;T.columns[0].stack.push(this.getLineNumberObject(_))}}catch(k){S.e(k)}finally{S.f()}g[a]=y,T.columns.push(g),n=T}else g.margin=[20,0,0,0],(n=g)[a]=y}else{var L=this.parseChildren(t,e);(n=g)[a]=L}break;default:n=Object.assign(Object.assign({},this.create("text",t.textContent.replace(/\n/g,""))),this.computeStyle(e))}return n}},{key:"parseChildren",value:function(t,e){var n=Array.from(t.childNodes),a=[];if(n.length>0){var r,o=_createForOfIteratorHelper(n);try{for(o.s();!(r=o.n()).done;){var s=r.value;if("#text"!==s.nodeName||""!==s.textContent.trim()){var c=this.parseElement(s,e),l=t.firstChild;if(this.lineNumberingMode===i.d.Outside&&s&&s.classList&&s.classList.contains("os-line-number"))a.push(c);else if(this.lineNumberingMode===i.d.Outside&&l&&l.classList&&l.classList.contains("os-line-number")){var u=a.pop();u.columns[1].text.push(c),a.push(u)}else a.push(c)}}}catch(h){o.e(h)}finally{o.f()}}return a}},{key:"getLineNumberObject",value:function(t){return{width:20,text:[{text:" ",fontSize:10,decoration:""},{text:t.lineNumber,color:"gray",fontSize:8}],marginBottom:t.marginBottom,lineHeight:this.LINE_HEIGHT}}},{key:"withSublist",value:function(t){return"li"===t.nodeName.toLowerCase()&&Array.from(t.children).some((function(t){return"ul"===t.nodeName.toLowerCase()}))}},{key:"cleanLineNumbers",value:function(t){for(var e=t.cloneNode(!0),n=e.childNodes,i=0;i<n.length;i++)if(this.getLineNumber(n[i])&&n[i].remove(),n[i].childNodes.length>0){var a=this.cleanLineNumbers(n[i]);e.replaceChild(a,n[i])}return e}},{key:"extractLineNumbers",value:function(t){var e=[],n=this.getLineNumber(t);if(n)e.push({lineNumber:n});else if("BR"===t.nodeName)this.getLineNumber(t.nextSibling)||e.push({lineNumber:""});else{for(var i=Array.from(t.childNodes),a=i.length,r=[],o=0;o<i.length;o++)r=r.concat(this.extractLineNumbers(i[o])),i.length<a&&(o-=a-i.length,a=i.length);r.length&&"LI"===t.nodeName?r[r.length-1].marginBottom=this.LI_MARGIN_BOTTOM:r.length&&"LI"===t.parentNode.nodeName&&(r[r.length-1].marginBottom=this.P_MARGIN_BOTTOM),e=e.concat(r)}return e}},{key:"isInsideAList",value:function(t){for(var e=t.parentNode;null!==e;){if("UL"===e.nodeName||"OL"===e.nodeName)return!0;e=e.parentNode}return!1}},{key:"isFakeList",value:function(t){if(t.firstElementChild&&t.classList.contains("os-split-after")){var e=t.firstElementChild,n=t.childNodes[t.childNodes.length-1],i="LI"===e.nodeName&&e.classList.contains("os-split-before"),a="LI"===n.nodeName&&n.classList.contains("os-split-after");return i||a}return!1}},{key:"getLineNumber",value:function(t){if(t&&"SPAN"===t.nodeName&&t.getAttribute("class")&&t.getAttribute("class").indexOf("os-line-number")>-1)return parseInt(t.getAttribute("data-line-number"),10)}},{key:"computeStyle",value:function(t){var e={};if(t&&t.length>0){var n,i=_createForOfIteratorHelper(t);try{for(i.s();!(n=i.n()).done;){var a=n.value.trim().toLowerCase().split(":"),r=a[0],o=a[1];if(2===a.length)switch(r){case"padding-left":e.margin=[parseInt(o,10),0,0,0];break;case"font-size":e.fontSize=parseInt(o,10);break;case"text-align":switch(o){case"right":case"center":case"justify":e.alignment=o}break;case"font-weight":switch(o){case"bold":e.bold=!0}break;case"text-decoration":switch(o){case"underline":e.decoration="underline";break;case"line-through":e.decoration="lineThrough"}break;case"font-style":switch(o){case"italic":e.italics=!0}break;case"color":e.color=this.parseColor(o);break;case"background-color":e.background=this.parseColor(o)}}}catch(s){i.e(s)}finally{i.f()}}return e}},{key:"parseColor",value:function(t){var e=new RegExp("^#([0-9a-f]{3}|[0-9a-f]{6})$"),n=new RegExp("^rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)$"),i=new RegExp("^[a-z]+$");if(e.test(t))return t;if(n.test(t)){for(var a=n.exec(t).slice(1),r=0;r<3;r++){var o=parseInt(a[r],10);o>255&&(o=255);var s="0"+o.toString(16);s=s.slice(-2),a[r]=s}return"#"+a.join("")}return i.test(t)||console.error('Could not parse color "'+t+'"'),t}},{key:"create",value:function(t,e){var n={};return n[t]=e||[],n}}]),t}();return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=a.Pb({token:t,factory:t.\u0275fac,providedIn:"root"}),t}()},y50V:function(t,e,n){"use strict";n.d(e,"a",(function(){return N}));var i,a,r,o,s=n("BBYV"),c=n("dOok"),l=n("fXoL"),u=n("sYmb"),h=((i=function(){function t(e,n,i){_classCallCheck(this,t),this.motionRepo=e,this.translate=n,this.htmlToPdfService=i}return _createClass(t,[{key:"renderDiffLines",value:function(t){if(t.diffLines&&t.diffLines.length){var e=t.diffLines.map((function(t){return t.text})).join("<br />[...]<br />");return this.htmlToPdfService.convertHtml(e)}}},{key:"amendmentToTableRow",value:function(t){var e="";return t.recommendation&&(e+=t.recommendation.show_recommendation_extension_field&&t.recommendationExtension?" "+this.motionRepo.getExtendedRecommendationLabel(t):this.translate.instant(t.recommendation.recommendation_label)),[{text:t.identifierOrTitle},{text:t.getChangeLines()},{text:t.submittersAsUsers.toString()},{stack:this.renderDiffLines(t)},{text:e}]}},{key:"overviewToDocDef",value:function(t,e){var n,i={text:t,style:"title"},a=[[{text:this.translate.instant("Motion"),style:"tableHeader"},{text:this.translate.instant("Line"),style:"tableHeader"},{text:this.translate.instant("Submitters"),style:"tableHeader"},{text:this.translate.instant("Changes"),style:"tableHeader"},{text:this.translate.instant("Recommendation"),style:"tableHeader"}]],r=[],o=_createForOfIteratorHelper(e);try{for(o.s();!(n=o.n()).done;){var s=n.value;r.push(this.amendmentToTableRow(s))}}catch(c){o.e(c)}finally{o.f()}return[i,{table:{widths:["auto","auto","auto","*","auto"],headerRows:1,dontBreakRows:!0,body:a.concat(r)},layout:"switchColorTableLayout"}]}}]),t}()).\u0275fac=function(t){return new(t||i)(l.dc(c.a),l.dc(u.k),l.dc(s.a))},i.\u0275prov=l.Pb({token:i,factory:i.\u0275fac,providedIn:"root"}),i),d=n("a9GI"),f=n("+KbT"),m=n("iTQr"),g=n("pSLD"),p=n("+B0n"),v=n("Mluu"),b=n("a9XT"),y=n("GEzB"),T=n("j7f2"),x=n("6ako"),S=n("30jZ"),_=n("ykax"),L=n("3Y4h"),k=((o=function(){function t(e,n,i,a,r,o,s,c,l,u,h,d){_classCallCheck(this,t),this.translate=e,this.motionRepo=n,this.statuteRepo=i,this.changeRecoRepo=a,this.configService=r,this.pdfDocumentService=o,this.htmlToPdfService=s,this.linenumberingService=c,this.commentRepo=l,this.pollKeyVerbose=u,this.parsePollNumber=h,this.motionPollService=d,this.getRecommendationTypeName=S.a}return _createClass(t,[{key:"motionToDocDef",value:function(t,e){var n=e&&e.lnMode?e.lnMode:null,i=e&&e.crMode?e.crMode:null,a=e?e.metaInfo:null,r=e?e.content:null,o=e?e.comments:null,s=this.configService.instant("motions_line_length"),c=this.configService.instant("motions_export_follow_recommendation"),l=[];t.isStatuteAmendment()&&(n=L.d.None,i=L.b.Diff),n||(n=this.configService.instant("motions_default_line_numbering")),i||(i=this.configService.instant("motions_recommendation_text_mode"));var u=this.createTitle(t,i,s),h=!a||a.includes("id");if(l=[u,this.createSubtitle(t,h)],a&&a.length>0||!a){var d=this.createMetaInfoTable(t,s,i,a,c);l.push(d)}if(!r||r.includes("text")){var f=this.createPreamble(t);l.push(f);var m=this.createText(t,s,n,i);l.push(m)}if(!r||r.includes("reason")){var g=this.createReason(t,n);l.push(g)}return a&&a.includes("allcomments")&&(o=this.commentRepo.getViewModelList().map((function(t){return t.id}))),o&&l.push(this.createComments(t,o)),l}},{key:"createTitle",value:function(t,e,n){var i=this.getUnifiedChanges(t,n).find((function(t){return t.isTitleChange()})),a=this.changeRecoRepo.getTitleWithChanges(t.title,i,e),r=t.identifier?" "+t.identifier:"",o="";return"A4"===this.configService.instant("general_export_pdf_pagesize")&&(o+=this.translate.instant("Motion")+" "),{text:o+="".concat(r,": ").concat(a),style:"title"}}},{key:"createSubtitle",value:function(t,e){var n=[];return e&&n.push("".concat(this.translate.instant("Sequential number"),": ").concat(t.id)),t.parent_id&&(e&&n.push(" \u2022 "),n.push("".concat(this.translate.instant("Amendment to")," ").concat(t.parent.identifier||t.parent.title))),{text:n,style:"subtitle"}}},{key:"createMetaInfoTable",value:function(t,e,n,i,a){var r,o,s=this,c=[];if(!i||i.includes("submitters")){var l=t.submittersAsUsers.map((function(t){return t.full_name})).join(", ");c.push([{text:this.translate.instant("Submitters")+":",style:"boldText"},{text:l}])}if(this.configService.instant("motions_min_supporters")&&t.supporters.length>0){var u=t.supporters.map((function(t){return t.full_name})).join(", ");c.push([{text:this.translate.instant("Supporters")+":",style:"boldText"},{text:u}])}(i&&!i.includes("state")||c.push([{text:this.translate.instant("State")+":",style:"boldText"},{text:this.motionRepo.getExtendedStateLabel(t)}]),!t.recommendation||i&&!i.includes("recommendation")||(r=t.isStatuteAmendment()?this.configService.instant("motions_statute_recommendations_by"):this.configService.instant("motions_recommendations_by"),c.push([{text:r+":",style:"boldText"},{text:this.motionRepo.getExtendedRecommendationLabel(t)}])),!t.category||i&&!i.includes("category"))||(o=t.category.parent?"".concat(t.category.parent.toString(),"\n").concat(this.translate.instant("Subcategory"),": ").concat(t.category.toString()):t.category.toString(),c.push([{text:this.translate.instant("Category")+":",style:"boldText"},{text:o}]));if(t.tags.length&&(!i||i.includes("tags"))){var h=t.tags.map((function(t){return t})).join(", ");c.push([{text:this.translate.instant("Tags")+":",style:"boldText"},{text:h}])}if(!t.motion_block||i&&!i.includes("motion_block")||c.push([{text:this.translate.instant("Motion block")+":",style:"boldText"},{text:t.motion_block.title}]),!t.origin||i&&!i.includes("origin")||c.push([{text:this.translate.instant("Origin")+":",style:"boldText"},{text:t.origin}]),t.polls.length&&(!i||i.includes("polls"))){var d=[],f=[],m=[];t.polls.forEach((function(t){t.hasVotes&&s.motionPollService.generateTableData(t).forEach((function(e){var n=s.translate.instant(s.pollKeyVerbose.transform(e.votingOption)),i=e.value[0],a=s.parsePollNumber.transform(i.amount);if(d.push(n+":"),i.showPercent){var r=s.motionPollService.getVoteValueInPercent(i.amount,t);f.push(null!==r?"(".concat(r,")"):"")}else f.push("");m.push(a)}))})),c.push([{text:this.translate.instant("Voting result")+":",style:"boldText"},{columns:[{text:d.join("\n"),width:"auto"},{text:f.join("\n"),width:"auto",alignment:"right"},{text:m.join("\n"),width:"auto",alignment:"right"}],columnGap:7}])}var g=this.getUnifiedChanges(t,e);if(n===L.b.Diff&&g.length>0){var p=[],v=[];g.forEach((function(t){if(t.isTitleChange()){var e=t;p.push(s.translate.instant("Title")+": "),v.push("(".concat(s.translate.instant("Change recommendation"),") - ").concat(s.translate.instant(s.getRecommendationTypeName(e))))}else{var n;if(n=t.getLineFrom()>=t.getLineTo()-1?t.getLineFrom():t.getLineFrom()+" - "+(t.getLineTo()-1),t.getChangeType()===y.a.TYPE_CHANGE_RECOMMENDATION){var i=t;p.push("".concat(s.translate.instant("Line")," ").concat(n,": ")),v.push("(".concat(s.translate.instant("Change recommendation"),") - ").concat(s.translate.instant(s.getRecommendationTypeName(i))))}else if(t.getChangeType()===y.a.TYPE_AMENDMENT){var a=t,r="(".concat(s.translate.instant("Amendment")," ").concat(a.getIdentifier(),") -");a.isRejected()?r+=" "+s.translate.instant("Rejected"):a.isAccepted()&&(r+=" "+s.translate.instant(a.stateName),p.push("".concat(s.translate.instant("Line")," ").concat(n,": ")),v.push(r))}}})),v.length>0&&c.push([{text:this.translate.instant("Summary of changes:"),style:"boldText"},{columns:[{text:p.join("\n"),width:"auto"},{text:v.join("\n"),width:"auto"}],columnGap:7}])}if(a&&c.push([{text:this.translate.instant("Decision")+":",style:"boldText"},{margin:[5,2,0,2],columns:[{width:8,canvas:this.pdfDocumentService.drawCircle(6.5,4)},{width:"auto",text:this.translate.instant("As recommendation")},{width:20,text:""},{width:8,canvas:this.pdfDocumentService.drawCircle(6.5,4)},{width:"auto",text:this.translate.instant("Divergent:")}]}]),c.length>0)return{table:{widths:["35%","65%"],body:c},margin:[0,0,0,20],layout:"metaboxLayout"}}},{key:"createPreamble",value:function(t){var e=this.configService.instant("motions_preamble");return{text:""+this.translate.instant(e),margin:[0,10,0,10]}}},{key:"createText",value:function(t,e,n,i){var a="";if(t.isParagraphBasedAmendment()){var r,o=this.changeRecoRepo.getChangeRecoOfMotion(t.id),s=_createForOfIteratorHelper(this.motionRepo.getAmendmentParagraphLines(t,e,i,o,!1));try{for(s.s();!(r=s.n()).done;){var c=r.value;a+="<h3>"+this.motionRepo.getAmendmentParagraphLinesTitle(c)+"</h3>",a+='<div class="paragraphcontext">'.concat(c.textPre,"</div>"),a+=c.text,a+='<div class="paragraphcontext">'.concat(c.textPost,"</div>")}}catch(g){s.e(g)}finally{s.f()}}else if(t.isStatuteAmendment()){var l=this.statuteRepo.getViewModelList();a=this.motionRepo.formatStatuteAmendment(l,t,e)}else{var u=this.getUnifiedChanges(t,e),h=u.filter((function(t){return!t.isTitleChange()})),d=u.find((function(t){return t.isTitleChange()}));if(i===L.b.Diff&&d){var f=this.changeRecoRepo.getTitleChangesAsDiff(t.title,d);a+="<span><strong>"+this.translate.instant("Changed title")+":</strong><br>"+f+"</span><br>"}var m=this.motionRepo.formatMotion(t.id,i,h,e);a+=this.linenumberingService.splitInlineElementsAtLineBreaks(m)}return this.htmlToPdfService.convertHtml(a,n)}},{key:"getUnifiedChanges",value:function(t,e){var n=this,i=this.changeRecoRepo.getChangeRecoOfMotion(t.id);return i&&i.length?i.concat(this.motionRepo.getAmendmentsInstantly(t.id).flatMap((function(t){var i=n.changeRecoRepo.getChangeRecoOfMotion(t.id).filter((function(t){return t.showInFinalView()}));if(i&&i.length)return n.motionRepo.getAmendmentAmendedParagraphs(t,e,i)}))).sort((function(t,e){return t.getLineFrom()-e.getLineFrom()})):[]}},{key:"createReason",value:function(t,e){if(t.reason){var n=[];return n.push({text:this.translate.instant("Reason"),style:"heading3",margin:[0,25,0,10]}),n.push(this.htmlToPdfService.addPlainText(t.reason)),n}return{}}},{key:"callListToDoc",value:function(t){var e=this;t.sort((function(t,e){return t.weight-e.weight}));var n={text:this.translate.instant("Call list"),style:"title"},i=[[{text:this.translate.instant("Called"),style:"tableHeader"},{text:this.translate.instant("Called with"),style:"tableHeader"},{text:this.translate.instant("Submitters"),style:"tableHeader"},{text:this.translate.instant("Title"),style:"tableHeader"},{text:this.translate.instant("Recommendation"),style:"tableHeader"},{text:this.translate.instant("Notes"),style:"tableHeader"}]],a=[],r="";return t.forEach((function(t){if(!t.sort_parent_id){var n=t.tags?t.tags.map((function(t){return t.name})).join(", "):"";n!==r&&(a.push([{text:n,colSpan:6,style:"heading3",margin:[0,10,0,10]},"","","","",""]),r=n)}a.push(e.createCallListRow(t))})),[n,{table:{widths:["auto","auto","auto","*","auto","auto"],headerRows:1,dontBreakRows:!0,body:i.concat(a)},layout:"switchColorTableLayout"}]}},{key:"createCallListRow",value:function(t){return[{text:t.sort_parent_id?"":t.identifierOrTitle},{text:t.sort_parent_id?t.identifierOrTitle:""},{text:t.submitters.length?t.submittersAsUsers.map((function(t){return t.short_name})).join(", "):""},{text:t.title},{text:t.recommendation?this.motionRepo.getExtendedRecommendationLabel(t):""},{text:""}]}},{key:"textToDocDef",value:function(t,e,n){var i=this.configService.instant("motions_line_length"),a=this.configService.instant("motions_recommendation_text_mode"),r=this.createTitle(e,a,i),o=this.createSubtitle(e),s=this.createMetaInfoTable(e,i,a,["submitters","state","category"]),c=this.htmlToPdfService.convertHtml(t,L.d.None);return[r,o,s,{text:this.translate.instant(n),style:"heading2"},c]}},{key:"createComments",value:function(t,e){var n,i=[],a=_createForOfIteratorHelper(e);try{for(a.s();!(n=a.n()).done;){var r=n.value,o="",s="";if(r===L.f)o=this.translate.instant("Personal note"),s=t&&t.personalNote&&t.personalNote.note;else{var c=this.commentRepo.getViewModel(r),l=t.getCommentForSection(c);o=c.name,s=l&&l.comment}o&&s&&(i.push({text:o,style:"heading3",margin:[0,25,0,10]}),i.push(this.htmlToPdfService.addPlainText(s)))}}catch(u){a.e(u)}finally{a.f()}return i}}]),t}()).\u0275fac=function(t){return new(t||o)(l.dc(u.k),l.dc(c.a),l.dc(v.a),l.dc(g.a),l.dc(f.a),l.dc(d.b),l.dc(s.a),l.dc(b.a),l.dc(p.a),l.dc(x.a),l.dc(T.a),l.dc(_.a))},o.\u0275prov=l.Pb({token:o,factory:o.\u0275fac,providedIn:"root"}),o),w=((r=function(){function t(e,n,i,a,r,o){_classCallCheck(this,t),this.translate=e,this.configService=n,this.motionPdfService=i,this.pdfService=a,this.motionRepo=r,this.categoryRepo=o,this.categoryObserver=this.categoryRepo.getViewModelListBehaviorSubject()}return _createClass(t,[{key:"motionListToDocDef",value:function(t,e){for(var n=[],i=[],a=e.pdfOptions.includes("toc"),r=e.pdfOptions.includes("addBreaks"),o=0;o<t.length;++o)try{var s=this.motionPdfService.motionToDocDef(t[o],e);s[0].id=""+t[o].id,i.push(s),o<t.length-1&&r?i.push(this.pdfService.getPageBreak()):o<t.length-1&&!r&&i.push(this.pdfService.getSpacer())}catch(l){var c="".concat(this.translate.instant("Error during PDF creation of motion:")," ").concat(t[o].identifierOrTitle);throw console.error(c+"\nDebugInfo:\n",l),new d.c(c)}return t.length>1&&(!e.pdfOptions||a)&&n.push(this.pdfService.createTitle("motions_export_title"),this.pdfService.createPreamble("motions_export_preamble"),this.createToc(t)),n=n.concat(i)}},{key:"createToc",value:function(t,e){var n=this,i=[],a=this.categoryObserver.value,r={text:this.translate.instant("Table of contents"),style:"heading2"},o=this.configService.instant("motions_export_submitter_recommendation"),s=o?this.getTocHeaderDefinition():void 0,c=o?d.a.LIGHT_HORIZONTAL_LINES:d.a.DEFAULT;if(a&&a.length){var l,u=[],h=_createForOfIteratorHelper(a.sort((function(t,e){return t.weight-e.weight})));try{var f=function(){var e=l.value,i=t.filter((function(t){return e===t.category}));if(i&&i.length){u.length&&u.push(n.pdfService.getPageBreak()),u.push({table:{body:[[{text:e.nameWithParentAbove,style:e.parent?"tocSubcategoryTitle":"tocCategoryTitle"}]]},layout:o?"lightHorizontalLines":"noBorders"});var a,r=[],h=_createForOfIteratorHelper(i);try{for(h.s();!(a=h.n()).done;){var f=a.value;r.push(o?n.appendSubmittersAndRecommendation(f,d.d.CATEGORY_SECTION):n.pdfService.createTocLine(""+(f.identifier?f.identifier:""),f.title,""+f.id,d.d.CATEGORY_SECTION))}}catch(m){h.e(m)}finally{h.f()}u.push(n.pdfService.createTocTableDef(r,d.d.CATEGORY_SECTION,c,s?JSON.parse(JSON.stringify(s)):null))}};for(h.s();!(l=h.n()).done;)f()}catch(y){h.e(y)}finally{h.f()}var m=t.filter((function(t){return!t.category})).map((function(t){return n.pdfService.createTocLine(""+(t.identifier?t.identifier:""),t.title,""+t.id)}));m.length>0&&(u.push(this.pdfService.getPageBreak()),u.push(this.pdfService.createTocTableDef(m,d.d.CATEGORY_SECTION))),i.push(u)}else{var g,p=[],v=_createForOfIteratorHelper(t);try{for(v.s();!(g=v.n()).done;){var b=g.value;p.push(o?this.appendSubmittersAndRecommendation(b):this.pdfService.createTocLine(""+(b.identifier?b.identifier:""),b.title,""+b.id))}}catch(y){v.e(y)}finally{v.f()}i.push(this.pdfService.createTocTableDef(p,d.d.CATEGORY_SECTION,c,s))}return[r,i,this.pdfService.getPageBreak()]}},{key:"getTocHeaderDefinition",value:function(){return[{text:this.translate.instant("Identifier"),style:"tocHeaderRow"},{style:"tocHeaderRow",text:["".concat(this.translate.instant("Title")," \xb7 ").concat(this.translate.instant("Submitters")," \xb7 "),{text:""+this.translate.instant("Recommendation"),italics:!0}]},{text:this.translate.instant("Page"),style:"tocHeaderRow",alignment:"right"}]}},{key:"appendSubmittersAndRecommendation",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.d.DEFAULT,n="",i="";i=t.state.isFinalState?this.motionRepo.getExtendedStateLabel(t):this.motionRepo.getExtendedRecommendationLabel(t);for(var a=0;a<t.submitters.length;++a)n+=a!==t.submitters.length-1?t.submitters[a].getTitle()+", ":t.submitters[a].getTitle();return this.pdfService.createTocLine(""+(t.identifier?t.identifier:""),t.title,""+t.id,e,this.pdfService.createTocLineInline(n),this.pdfService.createTocLineInline(i,!0))}}]),t}()).\u0275fac=function(t){return new(t||r)(l.dc(u.k),l.dc(f.a),l.dc(k),l.dc(d.b),l.dc(c.a),l.dc(m.a))},r.\u0275prov=l.Pb({token:r,factory:r.\u0275fac,providedIn:"root"}),r),N=((a=function(){function t(e,n,i,a,r,o){_classCallCheck(this,t),this.translate=e,this.configService=n,this.motionPdfService=i,this.amendmentListPdfService=a,this.pdfCatalogService=r,this.pdfDocumentService=o}return _createClass(t,[{key:"exportSingleMotion",value:function(t,e){var n=this.motionPdfService.motionToDocDef(t,e),i="".concat(this.translate.instant("Motion")," ").concat(t.identifierOrTitle);this.pdfDocumentService.download(n,i,{title:i})}},{key:"exportMotionCatalog",value:function(t,e){var n=this.pdfCatalogService.motionListToDocDef(t,e),i=this.configService.instant("motions_export_title"),a=this.translate.instant(i);this.pdfDocumentService.download(n,a,{title:a},e)}},{key:"exportPdfCallList",value:function(t){var e=this.motionPdfService.callListToDoc(t),n=this.translate.instant("Call list");this.pdfDocumentService.downloadLandscape(e,n,{title:n})}},{key:"exportPersonalNote",value:function(t,e){var n=this.motionPdfService.textToDocDef(t.note,e,"Personal note"),i="".concat(e.identifierOrTitle," - ").concat(this.translate.instant("Personal note"));this.pdfDocumentService.download(n,i,{title:i})}},{key:"exportComment",value:function(t,e){var n=e.getCommentForSection(t);if(n&&n.comment){var i=this.motionPdfService.textToDocDef(n.comment,e,t.name),a="".concat(e.identifierOrTitle," - ").concat(t.name);this.pdfDocumentService.download(i,a,{title:a})}}},{key:"exportAmendmentList",value:function(t,e){var n;n=e?"".concat(this.translate.instant("Amendments to")," ").concat(e.getListTitle()):""+this.translate.instant("Amendments");var i=this.amendmentListPdfService.overviewToDocDef(n,t);this.pdfDocumentService.downloadLandscape(i,n,{title:n})}}]),t}()).\u0275fac=function(t){return new(t||a)(l.dc(u.k),l.dc(f.a),l.dc(k),l.dc(h),l.dc(w),l.dc(d.b))},a.\u0275prov=l.Pb({token:a,factory:a.\u0275fac,providedIn:"root"}),a)}}]);