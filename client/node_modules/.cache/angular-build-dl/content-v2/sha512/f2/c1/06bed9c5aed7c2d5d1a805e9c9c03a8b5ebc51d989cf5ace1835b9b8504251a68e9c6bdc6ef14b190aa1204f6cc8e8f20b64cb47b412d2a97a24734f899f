function _get(t,e,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var a=_superPropBase(t,e);if(a){var i=Object.getOwnPropertyDescriptor(a,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _createSuper(t){var e=_isNativeReflectConstruct();return function(){var n,a=_getPrototypeOf(t);if(e){var i=_getPrototypeOf(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _createForOfIteratorHelper(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var a=0,i=function(){};return{s:i,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r=!0,c=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return r=t.done,t},e:function(t){c=!0,o=t},f:function(){try{r||null==n.return||n.return()}finally{if(c)throw o}}}}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[20,38],{"6Ehv":function(t,e,n){"use strict";n.d(e,"a",(function(){return k}));var a=n("InfO"),i=n("+KbT"),o=n("+az0"),r=n("fXoL"),c=n("3Xi6"),s=n("ofXK"),l=n("3Pt+"),u=n("bSwM"),b=n("kmnG"),d=n("d3UM"),m=n("FKr1"),f=n("oqD5"),p=n("sYmb");function g(t,e){if(1&t&&(r.Zb(0,"mat-option",7),r.Zb(1,"span"),r.Sc(2),r.mc(3,"translate"),r.Yb(),r.Yb()),2&t){var n=e.$implicit;r.tc("value",n.key),r.Gb(2),r.Tc(r.nc(3,2,n.name))}}function h(t,e){if(1&t&&(r.Zb(0,"div",2),r.Zb(1,"mat-form-field"),r.Ub(2,"os-search-value-selector",8),r.mc(3,"translate"),r.Yb(),r.Yb()),2&t){var n=r.lc(4);r.tc("formGroup",n.form),r.Gb(2),r.uc("placeholder",r.nc(3,5,"Parent agenda item")),r.tc("multiple",!1)("includeNone",!0)("inputListValues",n.itemObserver)}}function v(t,e){if(1&t&&(r.Xb(0),r.Zb(1,"div"),r.Zb(2,"mat-form-field",2),r.Zb(3,"mat-select",4),r.mc(4,"translate"),r.Qc(5,g,4,4,"mat-option",5),r.Yb(),r.Yb(),r.Yb(),r.Qc(6,h,4,7,"div",6),r.Wb()),2&t){var n=r.lc(3);r.Gb(2),r.tc("formGroup",n.form),r.Gb(1),r.uc("placeholder",r.nc(4,4,"Agenda visibility")),r.Gb(2),r.tc("ngForOf",n.ItemVisibilityChoices),r.Gb(1),r.tc("ngIf",n.itemObserver.value.length>0)}}function y(t,e){if(1&t&&(r.Xb(0),r.Zb(1,"div",2),r.Zb(2,"p"),r.Zb(3,"mat-checkbox",3),r.Zb(4,"span"),r.Sc(5),r.mc(6,"translate"),r.Yb(),r.Yb(),r.Yb(),r.Yb(),r.Qc(7,v,7,6,"ng-container",1),r.Wb()),2&t){var n=r.lc(2);r.Gb(1),r.tc("formGroup",n.form),r.Gb(4),r.Tc(r.nc(6,3,"Add to agenda")),r.Gb(2),r.tc("ngIf",!!n.checkbox.value)}}function _(t,e){if(1&t&&(r.Xb(0),r.Qc(1,y,8,5,"ng-container",1),r.Wb()),2&t){var n=r.lc();r.Gb(1),r.tc("ngIf",n.showForm)}}var k=function(){var t=function(){function t(e,n){_classCallCheck(this,t),this.configService=e,this.itemRepo=n,this.showForm=!1,this.ItemVisibilityChoices=o.b}return _createClass(t,[{key:"ngOnInit",value:function(){var t=this;this.checkbox=this.form.controls.agenda_create,this.configService.get("agenda_item_creation").subscribe((function(e){if("always"===e)t.showForm=!0,t.checkbox.disable(),t.form.patchValue({agenda_create:!0});else if("never"===e)t.showForm=!1,t.checkbox.disable(),t.form.patchValue({agenda_create:!1});else{var n="default_yes"===e;t.showForm=!0,t.checkbox.enable(),t.form.patchValue({agenda_create:n})}})),this.configService.get("agenda_new_items_default_visibility").subscribe((function(e){t.form.get("agenda_type").setValue(+e)})),this.itemObserver=this.itemRepo.getViewModelListBehaviorSubject()}}]),t}();return t.\u0275fac=function(e){return new(e||t)(r.Tb(i.a),r.Tb(a.a))},t.\u0275cmp=r.Nb({type:t,selectors:[["os-agenda-content-object-form"]],inputs:{form:"form"},decls:1,vars:1,consts:[[4,"osPerms"],[4,"ngIf"],[3,"formGroup"],["formControlName","agenda_create"],["formControlName","agenda_type",3,"placeholder"],[3,"value",4,"ngFor","ngForOf"],[3,"formGroup",4,"ngIf"],[3,"value"],["formControlName","agenda_parent_id",3,"multiple","includeNone","placeholder","inputListValues"]],template:function(t,e){1&t&&r.Qc(0,_,2,1,"ng-container",0),2&t&&r.tc("osPerms","agenda.can_manage")},directives:[c.a,s.t,l.t,l.k,u.a,l.s,l.i,b.c,d.a,s.s,m.n,f.a],pipes:[p.j],styles:[""]}),t}()},BBYV:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var a=n("3Y4h"),i=n("fXoL"),o=function(){var t=function(){function t(){_classCallCheck(this,t),this.LI_MARGIN_BOTTOM=8,this.LINE_HEIGHT=1.25,this.P_MARGIN_BOTTOM=4,this.H_MARGIN_TOP=10,this.elementStyles={b:["font-weight:bold"],strong:["font-weight:bold"],u:["text-decoration:underline"],em:["font-style:italic"],i:["font-style:italic"],h1:["font-size:14","font-weight:bold"],h2:["font-size:12","font-weight:bold"],h3:["font-size:10","font-weight:bold"],h4:["font-size:10","font-style:italic"],h5:["font-size:10"],h6:["font-size:10"],a:["color:blue","text-decoration:underline"],strike:["text-decoration:line-through"],del:["color:red","text-decoration:line-through"],ins:["color:green","text-decoration:underline"]},this.classStyles={delete:["color:red","text-decoration:line-through"],insert:["color:green","text-decoration:underline"],paragraphcontext:["color:grey"]}}return _createClass(t,[{key:"getMarginTop",value:function(t){switch(t){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return this.H_MARGIN_TOP;default:return 0}}},{key:"getMarginBottom",value:function(t){switch(t){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":case"li":default:return this.P_MARGIN_BOTTOM}}},{key:"addPlainText",value:function(t){return{columns:[{stack:this.convertHtml(t,a.d.None)}]}}},{key:"convertHtml",value:function(t,e){var n=[];this.lineNumberingMode=e||a.d.None;for(var i=(new DOMParser).parseFromString(t,"text/html"),o=0,r=Array.from(i.body.childNodes);o<r.length;o++){var c=r[o],s=this.parseElement(c);n.push(s)}return n}},{key:"parseElement",value:function(t,e){var n,i=t.nodeName.toLowerCase(),o=[];if(e=e||[],t.getAttribute){var r=t.getAttribute("style"),c=t.getAttribute("class");if(r&&(e=r.split(";").map((function(t){return t.replace(/\s/g,"")})).concat(e)),c){var s,l=_createForOfIteratorHelper(o=c.toLowerCase().split(" "));try{for(l.s();!(s=l.n()).done;){var u=s.value;this.classStyles[u]&&this.classStyles[u].forEach((function(t){e.push(t)}))}}catch(O){l.e(O)}finally{l.f()}}}switch(i){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":case"li":case"p":case"div":var b=this.parseChildren(t,e);this.lineNumberingMode!==a.d.Outside||o.includes("insert")?(n=this.create("text")).text=b:(n=this.create("stack")).stack=b,n.margin=[0,0,0,0],n.margin[1]=this.getMarginTop(i),n.margin[3]=this.getMarginBottom(i),this.lineNumberingMode===a.d.Outside&&o.includes("insert")&&(n.margin[0]=20,n.margin[3]=this.P_MARGIN_BOTTOM),o.includes("os-split-before")&&(n.listType="none"),(o.includes("os-split-after")||this.withSublist(t))&&(n.margin[3]=0),n.lineHeight=this.LINE_HEIGHT,n=Object.assign(Object.assign(Object.assign({},n),this.computeStyle(e)),this.computeStyle(this.elementStyles[i]));break;case"a":case"b":case"strong":case"u":case"em":case"i":case"ins":case"del":case"strike":var d=this.parseChildren(t,e.concat(this.elementStyles[i]));(n=this.create("text")).text=d;break;case"span":if(t.getAttribute("data-line-number")&&!this.isInsideAList(t)){if(this.lineNumberingMode===a.d.Inside);else if(this.lineNumberingMode===a.d.Outside){var m=t.getAttribute("data-line-number");n={columns:[this.getLineNumberObject({lineNumber:+m}),{text:[]}]}}}else{var f=this.parseChildren(t,e);(n=Object.assign(Object.assign({},this.create("text")),this.computeStyle(e))).text=f}break;case"br":if(this.lineNumberingMode===a.d.None&&o.includes("os-line-break")||this.lineNumberingMode===a.d.Outside&&this.isInsideAList(t))break;(n=this.create("text")).text="\n",n.lineHeight=this.LINE_HEIGHT;break;case"ul":case"ol":var p=this.create(i);if("ol"===i){var g=t.getAttribute("start");g&&(p.start=parseInt(g,10))}if(this.lineNumberingMode===a.d.Outside){var h=this.extractLineNumbers(t),v=this.cleanLineNumbers(t),y=this.parseChildren(v,e);if(h.length>0){var _={columns:[{width:20,stack:[]}],margin:[0,0,0,0]};this.isFakeList(t)&&(_.margin[3]=-this.LI_MARGIN_BOTTOM);var k,S=_createForOfIteratorHelper(h);try{for(S.s();!(k=S.n()).done;){var C=k.value;_.columns[0].stack.push(this.getLineNumberObject(C))}}catch(O){S.e(O)}finally{S.f()}p[i]=y,_.columns.push(p),n=_}else p.margin=[20,0,0,0],(n=p)[i]=y}else{var P=this.parseChildren(t,e);(n=p)[i]=P}break;default:n=Object.assign(Object.assign({},this.create("text",t.textContent.replace(/\n/g,""))),this.computeStyle(e))}return n}},{key:"parseChildren",value:function(t,e){var n=Array.from(t.childNodes),i=[];if(n.length>0){var o,r=_createForOfIteratorHelper(n);try{for(r.s();!(o=r.n()).done;){var c=o.value;if("#text"!==c.nodeName||""!==c.textContent.trim()){var s=this.parseElement(c,e),l=t.firstChild;if(this.lineNumberingMode===a.d.Outside&&c&&c.classList&&c.classList.contains("os-line-number"))i.push(s);else if(this.lineNumberingMode===a.d.Outside&&l&&l.classList&&l.classList.contains("os-line-number")){var u=i.pop();u.columns[1].text.push(s),i.push(u)}else i.push(s)}}}catch(b){r.e(b)}finally{r.f()}}return i}},{key:"getLineNumberObject",value:function(t){return{width:20,text:[{text:" ",fontSize:10,decoration:""},{text:t.lineNumber,color:"gray",fontSize:8}],marginBottom:t.marginBottom,lineHeight:this.LINE_HEIGHT}}},{key:"withSublist",value:function(t){return"li"===t.nodeName.toLowerCase()&&Array.from(t.children).some((function(t){return"ul"===t.nodeName.toLowerCase()}))}},{key:"cleanLineNumbers",value:function(t){for(var e=t.cloneNode(!0),n=e.childNodes,a=0;a<n.length;a++)if(this.getLineNumber(n[a])&&n[a].remove(),n[a].childNodes.length>0){var i=this.cleanLineNumbers(n[a]);e.replaceChild(i,n[a])}return e}},{key:"extractLineNumbers",value:function(t){var e=[],n=this.getLineNumber(t);if(n)e.push({lineNumber:n});else if("BR"===t.nodeName)this.getLineNumber(t.nextSibling)||e.push({lineNumber:""});else{for(var a=Array.from(t.childNodes),i=a.length,o=[],r=0;r<a.length;r++)o=o.concat(this.extractLineNumbers(a[r])),a.length<i&&(r-=i-a.length,i=a.length);o.length&&"LI"===t.nodeName?o[o.length-1].marginBottom=this.LI_MARGIN_BOTTOM:o.length&&"LI"===t.parentNode.nodeName&&(o[o.length-1].marginBottom=this.P_MARGIN_BOTTOM),e=e.concat(o)}return e}},{key:"isInsideAList",value:function(t){for(var e=t.parentNode;null!==e;){if("UL"===e.nodeName||"OL"===e.nodeName)return!0;e=e.parentNode}return!1}},{key:"isFakeList",value:function(t){if(t.firstElementChild&&t.classList.contains("os-split-after")){var e=t.firstElementChild,n=t.childNodes[t.childNodes.length-1],a="LI"===e.nodeName&&e.classList.contains("os-split-before"),i="LI"===n.nodeName&&n.classList.contains("os-split-after");return a||i}return!1}},{key:"getLineNumber",value:function(t){if(t&&"SPAN"===t.nodeName&&t.getAttribute("class")&&t.getAttribute("class").indexOf("os-line-number")>-1)return parseInt(t.getAttribute("data-line-number"),10)}},{key:"computeStyle",value:function(t){var e={};if(t&&t.length>0){var n,a=_createForOfIteratorHelper(t);try{for(a.s();!(n=a.n()).done;){var i=n.value.trim().toLowerCase().split(":"),o=i[0],r=i[1];if(2===i.length)switch(o){case"padding-left":e.margin=[parseInt(r,10),0,0,0];break;case"font-size":e.fontSize=parseInt(r,10);break;case"text-align":switch(r){case"right":case"center":case"justify":e.alignment=r}break;case"font-weight":switch(r){case"bold":e.bold=!0}break;case"text-decoration":switch(r){case"underline":e.decoration="underline";break;case"line-through":e.decoration="lineThrough"}break;case"font-style":switch(r){case"italic":e.italics=!0}break;case"color":e.color=this.parseColor(r);break;case"background-color":e.background=this.parseColor(r)}}}catch(c){a.e(c)}finally{a.f()}}return e}},{key:"parseColor",value:function(t){var e=new RegExp("^#([0-9a-f]{3}|[0-9a-f]{6})$"),n=new RegExp("^rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)$"),a=new RegExp("^[a-z]+$");if(e.test(t))return t;if(n.test(t)){for(var i=n.exec(t).slice(1),o=0;o<3;o++){var r=parseInt(i[o],10);r>255&&(r=255);var c="0"+r.toString(16);c=c.slice(-2),i[o]=c}return"#"+i.join("")}return a.test(t)||console.error('Could not parse color "'+t+'"'),t}},{key:"create",value:function(t,e){var n={};return n[t]=e||[],n}}]),t}();return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=i.Pb({token:t,factory:t.\u0275fac,providedIn:"root"}),t}()},DNKu:function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));var a=n("mrSG"),i=n("TG9O"),o=n("qnZ9"),r=n("Izkr"),c=n("fXoL"),s=n("0IaG"),l=function(){var t=function(){function t(e,n){_classCallCheck(this,t),this.dialog=e,this.mapper=n}return _createClass(t,[{key:"openDialog",value:function(t){return Object(a.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n,a,i,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.dialog.open(this.dialogComponent,Object.assign({data:t},r.c)),e.next=3,n.afterClosed().toPromise();case 3:if(!(a=e.sent)){e.next=15;break}if(i=this.mapper.getRepository(t.collectionString),!t.poll){e.next=13;break}return c=a,t.state!==o.e.Created&&(c={title:a.title,onehundred_percent_base:a.onehundred_percent_base,majority_method:a.majority_method,description:a.description},t.type===o.f.Analog&&(c=Object.assign(Object.assign({},c),{votes:a.votes,publish_immediately:a.publish_immediately}))),e.next=11,i.patch(c,t);case 11:e.next=15;break;case 13:return e.next=15,i.create(a);case 15:case"end":return e.stop()}}),e,this)})))}}]),t}();return t.\u0275fac=function(e){return new(e||t)(c.dc(s.b),c.dc(i.a))},t.\u0275prov=c.Pb({token:t,factory:t.\u0275fac,providedIn:"root"}),t}()},JAMN:function(t,e,n){"use strict";n.d(e,"a",(function(){return S}));var a=n("fXoL"),i=n("kmnG"),o=n("lJxs"),r=n("SSyl"),c=n("aAo1"),s=n("Izkr"),l=n("3Pt+"),u=n("u47x"),b=n("0IaG"),d=n("ofXK"),m=n("oqD5"),f=n("3Xi6"),p=n("bTqV"),g=n("NFeN"),h=n("GTZY"),v=n("sYmb");function y(t,e){if(1&t){var n=a.ac();a.Zb(0,"button",5),a.hc("click",(function(){a.Ic(n);var t=a.lc(2),e=a.Ec(2);return t.openUploadDialog(e)})),a.Zb(1,"mat-icon"),a.Sc(2,"cloud_upload"),a.Yb(),a.Yb()}}function _(t,e){if(1&t&&(a.Zb(0,"div",2),a.Zb(1,"mat-form-field"),a.Ub(2,"os-search-value-selector",3),a.mc(3,"translate"),a.Yb(),a.Qc(4,y,3,0,"button",4),a.Yb()),2&t){var n=a.lc();a.Gb(2),a.uc("placeholder",a.nc(3,5,"Attachments")),a.tc("multiple",!0)("formControl",n.contentForm)("inputListValues",n.mediaFileList),a.Gb(2),a.tc("osPerms","mediafiles.can_manage")}}function k(t,e){if(1&t){var n=a.ac();a.Zb(0,"h1",6),a.Zb(1,"span"),a.Sc(2),a.mc(3,"translate"),a.Yb(),a.Yb(),a.Zb(4,"os-media-upload-content",7),a.hc("uploadSuccessEvent",(function(t){return a.Ic(n),a.lc().uploadSuccess(t)}))("errorEvent",(function(t){return a.Ic(n),a.lc().uploadError(t)})),a.Yb()}2&t&&(a.Gb(2),a.Tc(a.nc(3,1,"Upload files")))}var S=function(){var t=function(t){_inherits(n,t);var e=_createSuper(n);function n(t,i,o,r,c,s){var l;return _classCallCheck(this,n),(l=e.call(this,t,i,o,r)).ngControl=r,l.dialogService=c,l.mediaService=s,l.errorHandler=new a.p,l}return _createClass(n,[{key:"ngOnInit",value:function(){this.mediaFileList=this.mediaService.getViewModelListObservable().pipe(Object(o.a)((function(t){return t.filter((function(t){return!t.is_directory}))})))}},{key:"openUploadDialog",value:function(t){this.dialogRef=this.dialogService.open(t,Object.assign(Object.assign({},s.c),{disableClose:!1}))}},{key:"uploadSuccess",value:function(t){var e=[].concat(_toConsumableArray(this.contentForm.value),_toConsumableArray(t));this.updateForm(e),this.dialogRef.close()}},{key:"uploadError",value:function(t){this.errorHandler.emit(t)}},{key:"onContainerClick",value:function(t){}},{key:"initializeForm",value:function(){this.contentForm=this.fb.control([])}},{key:"updateForm",value:function(t){this.contentForm.setValue(t||[])}},{key:"empty",get:function(){return!this.contentForm.value.length}},{key:"controlType",get:function(){return"attachment-control"}}]),n}(c.a);return t.\u0275fac=function(e){return new(e||t)(a.Tb(l.f),a.Tb(u.h),a.Tb(a.m),a.Tb(l.r,10),a.Tb(b.b),a.Tb(r.a))},t.\u0275cmp=a.Nb({type:t,selectors:[["os-attachment-control"]],outputs:{errorHandler:"errorHandler"},features:[a.Fb([{provide:i.d,useExisting:t}]),a.Db],decls:3,vars:1,consts:[["class","attachment-container",4,"ngIf"],["uploadDialog",""],[1,"attachment-container"],[1,"selector",3,"multiple","placeholder","formControl","inputListValues"],["type","button","mat-icon-button","",3,"click",4,"osPerms"],["type","button","mat-icon-button","",3,"click"],["mat-dialog-title",""],[3,"uploadSuccessEvent","errorEvent"]],template:function(t,e){1&t&&(a.Qc(0,_,5,7,"div",0),a.Qc(1,k,5,3,"ng-template",null,1,a.Rc)),2&t&&a.tc("ngIf",e.contentForm)},directives:[d.t,i.c,m.a,l.s,l.h,f.a,p.b,g.a,b.i,h.a],pipes:[v.j],styles:["[_nghost-%COMP%]{width:100%}[_nghost-%COMP%]   .attachment-container[_ngcontent-%COMP%]{-ms-flex-pack:justify;justify-content:space-between;display:-ms-flexbox;display:flex}[_nghost-%COMP%]   .attachment-container[_ngcontent-%COMP%]   .selector[_ngcontent-%COMP%]{width:95%}[_nghost-%COMP%]   .attachment-container[_ngcontent-%COMP%]   .mat-icon-button[_ngcontent-%COMP%]{top:20px}"],changeDetection:0}),t}()},QFkl:function(t,e,n){"use strict";n.r(e),n.d(e,"AssignmentsModule",(function(){return Ma}));var a,i,o=n("ofXK"),r=n("tyNb"),c=n("OwvW"),s=n("mrSG"),l=n("3Pt+"),u=n("2Vo4"),b=n("InfO"),d=n("ctLh"),m=n("SSyl"),f=n("lv9T"),p=n("ZDbo"),g=n("F48D"),h=n("2BSV"),v=n("mV3u"),y=n("f3I0"),_=n("a9GI"),k=n("BBYV"),S=n("HRp2"),C=n("j7f2"),P=n("6ako"),O=n("QUb3"),Y=n("o7cs"),w=n("fXoL"),G=n("sYmb"),Z=((i=function(){function t(e,n,a,i,o,r){_classCallCheck(this,t),this.translate=e,this.htmlToPdfService=n,this.pollKeyVerbose=a,this.parsePollNumber=i,this.pollPercentBase=o,this.assignmentPollService=r}return _createClass(t,[{key:"assignmentToDocDef",value:function(t){return[this.createTitle(t),this.createPreamble(t),this.createDescription(t),this.createCandidateList(t),this.createPollResultTable(t)]}},{key:"createTitle",value:function(t){return{text:t.title,style:"title"}}},{key:"createPreamble",value:function(t){return{text:[{text:this.translate.instant("Number of persons to be elected")+": ",bold:!0,style:"textItem"},{text:""+t.open_posts,style:"textItem"}]}}},{key:"createDescription",value:function(t){if(t.description){var e=this.htmlToPdfService.addPlainText(t.description);return[{text:this.translate.instant("Description")+": ",bold:!0,style:"textItem"},e]}return{}}},{key:"createCandidateList",value:function(t){if(2!==t.phase){var e,n=t.assignment_related_users.sort((function(t,e){return t.weight-e.weight})),a=this.translate.instant("Candidates")+": ",i=n.map((function(t){return{text:t.user.full_name,margin:[0,0,0,10]}}));return{columns:[{text:a,bold:!0,width:"25%",style:"textItem"},(e={},_defineProperty(e,t.number_poll_candidates?"ol":"ul",i),_defineProperty(e,"style","textItem"),e)]}}return{}}},{key:"createPollResultTable",value:function(t){var e,n=[],a=_createForOfIteratorHelper(t.polls);try{for(a.s();!(e=a.n()).done;){var i=e.value;if(i.isPublished){var o=[];n.push({text:i.title,bold:!0,style:"textItem",margin:[0,15,0,0]}),o.push([{text:this.translate.instant("Candidates"),style:"tableHeader"},{text:this.translate.instant("Votes"),style:"tableHeader"}]);var r,c=_createForOfIteratorHelper(this.assignmentPollService.generateTableData(i));try{for(c.s();!(r=c.n()).done;){var s=r.value,l=this.translate.instant(this.pollKeyVerbose.transform(s.votingOption)),u=this.getPollResult(s,i);o.push([{text:l},{text:u}])}}catch(b){c.e(b)}finally{c.f()}n.push({table:{widths:["64%","33%"],headerRows:1,body:o},layout:"switchColorTableLayout"})}}}catch(b){a.e(b)}finally{a.f()}return n}},{key:"getPollResult",value:function(t,e){var n=this;return t.value.filter((function(t){return e.pollmethod===S.b.Votes?"no"!==t.vote&&"abstain"!==t.vote:e.pollmethod!==S.b.YN||"abstain"!==t.vote})).map((function(t){var a=n.translate.instant(n.pollKeyVerbose.transform(t.vote)),i=n.parsePollNumber.transform(t.amount),o=n.pollPercentBase.transform(t.amount,e);return"".concat(a).concat(a?": ":"").concat(i," ").concat(t.showPercent&&o?o:"")})).join("\n")}}]),t}()).\u0275fac=function(t){return new(t||i)(w.dc(G.k),w.dc(k.a),w.dc(P.a),w.dc(C.a),w.dc(O.a),w.dc(Y.a))},i.\u0275prov=w.Pb({token:i,factory:i.\u0275fac,providedIn:"root"}),i),I=((a=function(){function t(e,n,a){_classCallCheck(this,t),this.translate=e,this.assignmentPdfService=n,this.pdfDocumentService=a}return _createClass(t,[{key:"exportSingleAssignment",value:function(t){var e=this.assignmentPdfService.assignmentToDocDef(t),n="".concat(this.translate.instant("Election"),"_").concat(t.title);this.pdfDocumentService.download(e,n,{title:n})}},{key:"exportMultipleAssignments",value:function(t){var e=this.createDocOfMultipleAssignments(t),n=this.translate.instant("Elections");this.pdfDocumentService.download(e,n,{title:n})}},{key:"createDocOfMultipleAssignments",value:function(t){var e=this,n=[],a=t.map((function(n,a){try{var i=e.assignmentPdfService.assignmentToDocDef(n);return i[0].id=""+n.id,a<t.length-1?[i,e.pdfDocumentService.getPageBreak()]:[i]}catch(r){var o="".concat(e.translate.instant("Error during PDF creation of election:")," ").concat(n.title);throw console.error(o+"\nDebugInfo:\n",r),new _.c(o)}}));return t.length>1&&n.push(this.pdfDocumentService.createTitle("assignments_pdf_title"),this.pdfDocumentService.createPreamble("assignments_pdf_preamble"),this.createToc(t)),n.push(a),n}},{key:"createToc",value:function(t){var e=this,n=[],a={text:this.translate.instant("Table of contents"),style:"heading2"},i=t.map((function(t,n){return e.pdfDocumentService.createTocLine(""+(n+1),t.title,""+t.id)}));return n.push(this.pdfDocumentService.createTocTableDef(i)),[a,n,this.pdfDocumentService.getPageBreak()]}}]),t}()).\u0275fac=function(t){return new(t||a)(w.dc(G.k),w.dc(Z),w.dc(_.b))},a.\u0275prov=w.Pb({token:a,factory:a.\u0275fac,providedIn:"root"}),a),T=n("TG9O"),M=n("DNKu"),x=n("0IaG"),A=n("Kj3r"),N=n("/uUt"),V=n("qnZ9"),D=n("YIhf"),F=n("aOHa"),R=n("b1ae"),Q=n("5NaA"),L=n("jhN1"),j=n("dNgK"),E=n("bTqV"),U=n("bSwM"),B=n("acT5"),H=n("kmnG"),q=["pollForm"];function z(t,e){if(1&t&&(w.Zb(0,"span"),w.Sc(1),w.Yb()),2&t){var n=w.lc().$implicit;w.Gb(1),w.Tc(n.user.getFullName())}}function W(t,e){1&t&&(w.Zb(0,"span"),w.Sc(1),w.mc(2,"translate"),w.Yb()),2&t&&(w.Gb(1),w.Tc(w.nc(2,1,"Unknown user")))}function X(t,e){if(1&t&&(w.Zb(0,"div",15),w.Ub(1,"os-check-input",16),w.mc(2,"translate"),w.mc(3,"translate"),w.Yb()),2&t){var n=e.$implicit,a=w.lc().$implicit,i=w.lc(2);w.tc("formGroupName",a.user_id),w.Gb(1),w.tc("placeholder",w.nc(2,5,i.voteValueVerbose[n]))("checkboxValue",-1)("checkboxLabel",w.nc(3,7,"majority"))("formControlName",n)}}function K(t,e){if(1&t&&(w.Zb(0,"div",13),w.Zb(1,"div"),w.Qc(2,z,2,1,"span",2),w.Qc(3,W,3,3,"span",2),w.Yb(),w.Zb(4,"div"),w.Qc(5,X,4,9,"div",14),w.Yb(),w.Yb()),2&t){var n=e.$implicit,a=w.lc(2);w.Gb(2),w.tc("ngIf",n.user),w.Gb(1),w.tc("ngIf",!n.user),w.Gb(2),w.tc("ngForOf",a.analogPollValues)}}function $(t,e){if(1&t&&(w.Zb(0,"div",13),w.Ub(1,"div"),w.Ub(2,"os-check-input",16),w.mc(3,"translate"),w.mc(4,"translate"),w.Yb()),2&t){var n=e.$implicit,a=w.lc(2);w.Gb(2),w.tc("placeholder",w.nc(3,4,a.generalValueVerbose[n]))("checkboxValue",-1)("checkboxLabel",w.nc(4,6,"majority"))("formControlName",n)}}function J(t,e){1&t&&(w.Ub(0,"os-check-input",17),w.mc(1,"translate"),w.mc(2,"translate")),2&t&&(w.uc("placeholder",w.nc(1,3,"General No")),w.tc("checkboxValue",-1)("checkboxLabel",w.nc(2,5,"majority")))}function tt(t,e){1&t&&(w.Ub(0,"os-check-input",18),w.mc(1,"translate"),w.mc(2,"translate")),2&t&&(w.uc("placeholder",w.nc(1,3,"General Abstain")),w.tc("checkboxValue",-1)("checkboxLabel",w.nc(2,5,"majority")))}function et(t,e){1&t&&(w.Zb(0,"mat-error"),w.Sc(1),w.mc(2,"translate"),w.Yb()),2&t&&(w.Gb(1),w.Uc(" ",w.nc(2,1,"Error in form field."),""))}function nt(t,e){if(1&t){var n=w.ac();w.Xb(0),w.Zb(1,"form",6),w.Zb(2,"div",7),w.Qc(3,K,6,3,"div",8),w.Yb(),w.Qc(4,$,5,8,"div",8),w.Zb(5,"div"),w.Qc(6,J,3,7,"os-check-input",9),w.Qc(7,tt,3,7,"os-check-input",10),w.Yb(),w.Yb(),w.Zb(8,"div",11),w.Zb(9,"mat-checkbox",12),w.hc("ngModelChange",(function(t){return w.Ic(n),w.lc().publishImmediately=t}))("change",(function(t){return w.Ic(n),w.lc().publishStateChanged(t.checked)})),w.Zb(10,"span"),w.Sc(11),w.mc(12,"translate"),w.Yb(),w.Yb(),w.Qc(13,et,3,3,"mat-error",2),w.Yb(),w.Wb()}if(2&t){var a=w.lc();w.Gb(1),w.tc("formGroup",a.dialogVoteForm),w.Gb(2),w.tc("ngForOf",a.options),w.Gb(1),w.tc("ngForOf",a.sumValues),w.Gb(2),w.tc("ngIf",a.globalNoEnabled),w.Gb(1),w.tc("ngIf",a.globalAbstainEnabled),w.Gb(2),w.tc("ngModel",a.publishImmediately),w.Gb(2),w.Tc(w.nc(12,8,"Publish immediately")),w.Gb(2),w.tc("ngIf",!a.dialogVoteForm.valid)}}function at(t,e){if(1&t){var n=w.ac();w.Zb(0,"button",19),w.hc("click",(function(){return w.Ic(n),w.lc().submitPoll()})),w.Zb(1,"span"),w.Sc(2),w.mc(3,"translate"),w.Yb(),w.Yb()}if(2&t){var a=w.lc(),i=w.Ec(1);w.tc("disabled",i.contentForm.invalid||a.dialogVoteForm.invalid),w.Gb(2),w.Tc(w.nc(3,2,"Save"))}}var it,ot,rt,ct=((ot=function(t){_inherits(n,t);var e=_createSuper(n);function n(t,a,i,o,r,c,s){var l;return _classCallCheck(this,n),(l=e.call(this,a,i,o,r)).fb=t,l.translate=i,l.dialogRef=r,l.assignmentPollService=c,l.pollData=s,l.voteValueVerbose=D.c,l.generalValueVerbose=D.b,l.AssignmentPollMethodVerbose=F.a,l.AssignmentPollPercentBaseVerbose=F.b,l}return _createClass(n,[{key:"ngOnInit",value:function(){var t=this;this.pollData&&(this.pollData.options?this.options=this.pollData.options:this.pollData.assignment&&this.pollData.assignment.candidates&&this.pollData.assignment.candidates.length&&(this.options=this.pollData.assignment.candidates.map((function(t){return{user_id:t.id,user:t}}),{}))),this.subscriptions.push(this.pollForm.contentForm.valueChanges.pipe(Object(A.a)(150),Object(N.a)()).subscribe((function(){t.createDialog()})))}},{key:"setAnalogPollValues",value:function(){var t=this.pollForm.contentForm.get("pollmethod").value;this.globalNoEnabled=this.pollForm.contentForm.get("global_no").value,this.globalAbstainEnabled=this.pollForm.contentForm.get("global_abstain").value;var e=["Y"];t!==S.b.Votes&&e.push("N"),t===S.b.YNA&&e.push("A"),this.analogPollValues=e}},{key:"updateDialogVoteForm",value:function(t){var e,n={options:{},votesvalid:t.votesvalid,votesinvalid:t.votesinvalid,votescast:t.votescast,amount_global_no:t.amount_global_no,amount_global_abstain:t.amount_global_abstain},a=_createForOfIteratorHelper(t.options);try{for(a.s();!(e=a.n()).done;){var i=e.value,o={};o.Y=i.yes,t.pollmethod!==S.b.Votes&&(o.N=i.no),t.pollmethod===S.b.YNA&&(o.A=i.abstain),n.options[i.user_id]=o}}catch(c){a.e(c)}finally{a.f()}if(this.dialogVoteForm){var r=this.undoReplaceEmptyValues(n);this.dialogVoteForm.patchValue(r)}}},{key:"createDialog",value:function(){var t=this;this.setAnalogPollValues(),this.dialogVoteForm=this.fb.group(Object.assign({options:this.fb.group(this.options.mapToObject((function(e){return _defineProperty({},e.user_id,t.fb.group(t.analogPollValues.mapToObject((function(t){return _defineProperty({},t,["",[l.G.min(V.b)]])}))))}))),amount_global_no:["",[l.G.min(V.b)]],amount_global_abstain:["",[l.G.min(V.b)]]},this.sumValues.mapToObject((function(t){return _defineProperty({},t,["",[l.G.min(V.b)]])})))),this.isAnalogPoll&&this.pollData.poll&&this.updateDialogVoteForm(this.pollData)}},{key:"sumValues",get:function(){return["votesvalid","votesinvalid","votescast"]}},{key:"isAnalogPoll",get:function(){return this.pollForm&&this.pollForm.contentForm&&this.pollForm.contentForm.get("type").value===V.f.Analog}}]),n}(R.a)).\u0275fac=function(t){return new(t||ot)(w.Tb(l.f),w.Tb(L.d),w.Tb(G.k),w.Tb(j.a),w.Tb(x.h),w.Tb(Y.a),w.Tb(x.a))},ot.\u0275cmp=w.Nb({type:ot,selectors:[["os-assignment-poll-dialog"]],viewQuery:function(t,e){var n;1&t&&w.Oc(q,!0),2&t&&w.Dc(n=w.ic())&&(e.pollForm=n.first)},features:[w.Db],decls:9,vars:10,consts:[[3,"data","pollService","pollMethods","percentBases"],["pollForm",""],[4,"ngIf"],["mat-dialog-actions",""],["mat-button","",3,"disabled","click",4,"ngIf"],["mat-button","",3,"mat-dialog-close"],[3,"formGroup"],["formGroupName","options"],["class","votes-grid",4,"ngFor","ngForOf"],["inputType","number","formControlName","amount_global_no",3,"placeholder","checkboxValue","checkboxLabel",4,"ngIf"],["inputType","number","formControlName","amount_global_abstain",3,"placeholder","checkboxValue","checkboxLabel",4,"ngIf"],[1,"spacer-top-20"],[3,"ngModel","ngModelChange","change"],[1,"votes-grid"],[3,"formGroupName",4,"ngFor","ngForOf"],[3,"formGroupName"],["inputType","number",3,"placeholder","checkboxValue","checkboxLabel","formControlName"],["inputType","number","formControlName","amount_global_no",3,"placeholder","checkboxValue","checkboxLabel"],["inputType","number","formControlName","amount_global_abstain",3,"placeholder","checkboxValue","checkboxLabel"],["mat-button","",3,"disabled","click"]],template:function(t,e){if(1&t&&(w.Ub(0,"os-poll-form",0,1),w.Qc(2,nt,14,10,"ng-container",2),w.Zb(3,"div",3),w.Qc(4,at,4,4,"button",4),w.Zb(5,"button",5),w.Zb(6,"span"),w.Sc(7),w.mc(8,"translate"),w.Yb(),w.Yb(),w.Yb()),2&t){var n=w.Ec(1);w.tc("data",e.pollData)("pollService",e.assignmentPollService)("pollMethods",e.AssignmentPollMethodVerbose)("percentBases",e.AssignmentPollPercentBaseVerbose),w.Gb(2),w.tc("ngIf",e.isAnalogPoll&&e.dialogVoteForm),w.Gb(2),w.tc("ngIf",n&&e.dialogVoteForm&&n.contentForm),w.Gb(1),w.tc("mat-dialog-close",!1),w.Gb(2),w.Tc(w.nc(8,8,"Cancel"))}},directives:[Q.a,o.t,x.c,E.b,x.d,l.I,l.t,l.k,l.l,o.s,U.a,l.s,l.v,B.a,l.i,H.b],pipes:[G.j],styles:[".submit-buttons[_ngcontent-%COMP%]{display:-ms-flexbox;display:flex;-ms-flex-pack:end;justify-content:flex-end}.meta-text[_ngcontent-%COMP%]{font-style:italic;margin-left:10px;margin-right:10px}.meta-text[_ngcontent-%COMP%]   mat-chip[_ngcontent-%COMP%]{margin-left:5px;margin-right:2px}.candidate-name[_ngcontent-%COMP%]{word-wrap:break-word;width:100%;border-bottom:1px solid grey}.votes-grid[_ngcontent-%COMP%]{display:grid;grid-gap:5px;margin-bottom:10px;-ms-flex-align:baseline;align-items:baseline;grid-template-columns:auto -webkit-max-content;grid-template-columns:auto max-content}.votes-grid[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]{width:100%}.sum-value[_ngcontent-%COMP%]{display:-ms-flexbox;display:flex;-ms-flex-pack:end;justify-content:flex-end}.width-600[_ngcontent-%COMP%]{max-width:600px}"]}),ot),st=((it=function(t){_inherits(n,t);var e=_createSuper(n);function n(t,a){var i;return _classCallCheck(this,n),(i=e.call(this,t,a)).dialogComponent=ct,i}return n}(M.a)).\u0275fac=function(t){return new(t||it)(w.dc(x.b),w.dc(T.a))},it.\u0275prov=w.Pb({token:it,factory:it.\u0275fac,providedIn:"root"}),it),lt=n("ITcc"),ut=n("mksl"),bt=n("STbY"),dt=n("NFeN"),mt=n("Tp2j"),ft=n("3Xi6"),pt=n("40uZ"),gt=n("f0Cb"),ht=n("tCBf"),vt=n("owL4"),yt=n("Izkr"),_t=n("c3p6"),kt=n("EHvM"),St=n("+KbT"),Ct=((rt=function(t){_inherits(n,t);var e=_createSuper(n);function n(t,a,i,o,r){var c;return _classCallCheck(this,n),(c=e.call(this,i,o)).translate=t,c.assignmentRepo=a,c.pdfService=r,c.configService.get("assignments_pdf_ballot_papers_number").subscribe((function(t){return c.ballotCustomCount=t})),c.configService.get("assignments_pdf_ballot_papers_selection").subscribe((function(t){return c.ballotCountSelection=t})),c}return _createClass(n,[{key:"printBallots",value:function(t,e,n){var a,i=this.assignmentRepo.getViewModel(t.assignment_id),o="".concat(this.translate.instant("Election")," - ").concat(i.getTitle()," - ").concat(this.translate.instant("ballot-paper"));e||(e=i.getTitle()),n||(n=""),i.polls.length>1&&(n="".concat(this.translate.instant("Ballot")," ").concat(i.polls.length," ").concat(n)),n.length>90&&(n=n.substring(0,90)+"..."),a="votes"===t.pollmethod?t.options.length<=2?4:t.options.length<=5?3:t.options.length<=10?2:1:t.options.length<=2?4:t.options.length<=3?3:t.options.length<=7?2:1;var r=Math.floor(417/a);this.pdfService.downloadWithBallotPaper(this.getPages(a,{sheetend:r,title:e,subtitle:n,poll:t}),o,this.logo)}},{key:"createBallot",value:function(t){return{columns:[{width:1,margin:[0,t.sheetend],text:""},{width:"*",stack:[this.getHeader(),this.getTitle(t.title),this.getSubtitle(t.subtitle),this.createPollHint(t.poll),this.createCandidateFields(t.poll)],margin:[0,0,0,0]}]}}},{key:"createCandidateFields",value:function(t){var e=this,n=t.options.sort((function(t,e){return t.weight-e.weight})).map((function(n){return"votes"===t.pollmethod?e.createBallotOption(n.user.full_name):e.createYNBallotEntry(n.user.full_name,t.pollmethod)}));if("votes"===t.pollmethod){if(t.global_no){var a=this.createBallotOption(this.translate.instant("No"));a.margin[1]=25,n.push(a)}if(t.global_abstain){var i=this.createBallotOption(this.translate.instant("Abstain"));i.margin[1]=25,n.push(i)}}return n}},{key:"createYNBallotEntry",value:function(t,e){var n=this;return[{text:t,margin:[40,10,0,0]},{width:"auto",columns:("YNA"===e?["Yes","No","Abstain"]:["Yes","No"]).map((function(t){return{width:"auto",stack:[n.createBallotOption(n.translate.instant(t))]}}))}]}},{key:"createPollHint",value:function(t){return{text:t.assignment.default_poll_description||"",style:"description"}}}]),n}(kt.a)).\u0275fac=function(t){return new(t||rt)(w.dc(G.k),w.dc(d.a),w.dc(St.a),w.dc(p.a),w.dc(_.b))},rt.\u0275prov=w.Pb({token:rt,factory:rt.\u0275fac,providedIn:"root"}),rt),Pt=n("Wp6s"),Ot=n("DGQJ"),Yt=n("pA48"),wt=n("M0z7"),Gt=n("Xqcw"),Zt=n("Xa2L");function It(t,e){if(1&t&&(w.Zb(0,"p"),w.Zb(1,"i"),w.Sc(2),w.Yb(),w.Yb()),2&t){var n=w.lc(3);w.Gb(2),w.Tc(n.pollHint)}}function Tt(t,e){if(1&t&&(w.Zb(0,"h4"),w.Sc(1),w.mc(2,"translate"),w.Zb(3,"b"),w.Sc(4),w.Yb(),w.Yb()),2&t){var n=w.lc(3);w.Gb(1),w.Uc(" ",w.nc(2,3,"Available votes"),": "),w.Gb(3),w.Vc(" ",n.getVotesAvailable(),"/",n.poll.votes_amount," ")}}function Mt(t,e){if(1&t&&(w.Zb(0,"div",9),w.Sc(1),w.Yb()),2&t){var n=w.lc(3).$implicit;w.Gb(1),w.Uc(" ",n.user.getLevelAndNumber()," ")}}function xt(t,e){if(1&t&&(w.Zb(0,"span"),w.Zb(1,"span"),w.Sc(2),w.Yb(),w.Qc(3,Mt,2,1,"div",8),w.Yb()),2&t){var n=w.lc(2).$implicit;w.Gb(2),w.Tc(n.user.short_name),w.Gb(1),w.tc("ngIf",n.user.getLevelAndNumber())}}function At(t,e){1&t&&(w.Zb(0,"span"),w.Sc(1),w.mc(2,"translate"),w.Yb()),2&t&&(w.Gb(1),w.Tc(w.nc(2,1,"Unknown user")))}function Nt(t,e){if(1&t&&(w.Zb(0,"span",12),w.Sc(1),w.mc(2,"translate"),w.Yb()),2&t){var n=w.lc().$implicit;w.Gb(1),w.Uc(" ",w.nc(2,1,n.label)," ")}}function Vt(t,e){if(1&t){var n=w.ac();w.Zb(0,"div"),w.Zb(1,"button",10),w.hc("click",(function(){w.Ic(n);var t=e.$implicit,a=w.lc(2).$implicit;return w.lc(3).saveSingleVote(a.id,t.vote)})),w.Zb(2,"mat-icon"),w.Sc(3),w.Yb(),w.Yb(),w.Qc(4,Nt,3,3,"span",11),w.Yb()}if(2&t){var a=e.$implicit,i=w.lc(2).$implicit,o=w.lc(3);w.Gb(1),w.tc("disabled",o.deliveringVote)("ngClass",o.voteRequestData.votes[i.id]===a.vote||1===o.voteRequestData.votes[i.id]?a.css:""),w.Gb(2),w.Uc(" ",a.icon,""),w.Gb(1),w.tc("ngIf",o.poll.pollmethod!==o.AssignmentPollMethod.Votes)}}function Dt(t,e){1&t&&w.Ub(0,"mat-divider")}var Ft=function(t,e,n){return{"yna-grid":t,"yn-grid":e,"single-vote-grid":n}};function Rt(t,e){if(1&t&&(w.Zb(0,"div"),w.Zb(1,"div",6),w.Zb(2,"div",7),w.Qc(3,xt,4,2,"span",0),w.Qc(4,At,3,3,"span",0),w.Yb(),w.Qc(5,Vt,5,4,"div",4),w.Yb(),w.Qc(6,Dt,1,0,"mat-divider",0),w.Yb()),2&t){var n=w.lc(),a=n.$implicit,i=n.index,o=w.lc(3);w.Gb(1),w.tc("ngClass",w.Bc(5,Ft,o.poll.pollmethod===o.AssignmentPollMethod.YNA,o.poll.pollmethod===o.AssignmentPollMethod.YN,o.poll.pollmethod===o.AssignmentPollMethod.Votes)),w.Gb(2),w.tc("ngIf",a.user),w.Gb(1),w.tc("ngIf",!a.user),w.Gb(1),w.tc("ngForOf",o.voteActions),w.Gb(1),w.tc("ngIf",o.poll.options.length-1>i)}}function Qt(t,e){if(1&t&&(w.Zb(0,"div"),w.Qc(1,Rt,7,9,"div",0),w.Yb()),2&t){var n=e.$implicit,a=w.lc(3);w.Gb(1),w.tc("ngIf",a.poll.type!==a.PollType.Pseudoanonymous||!n.user_has_voted)}}function Lt(t,e){if(1&t){var n=w.ac();w.Zb(0,"div"),w.Zb(1,"button",14),w.hc("click",(function(){return w.Ic(n),w.lc(4).saveGlobalVote("N")})),w.Zb(2,"mat-icon"),w.Sc(3," thumb_down "),w.Yb(),w.Yb(),w.Zb(4,"span",12),w.Sc(5),w.mc(6,"translate"),w.Yb(),w.Yb()}if(2&t){var a=w.lc(4);w.Gb(1),w.tc("ngClass","N"===a.voteRequestData.global?"voted-no":"")("disabled",a.deliveringVote),w.Gb(4),w.Uc(" ",w.nc(6,3,"General No")," ")}}function jt(t,e){if(1&t){var n=w.ac();w.Zb(0,"div"),w.Zb(1,"button",15),w.hc("click",(function(){return w.Ic(n),w.lc(4).saveGlobalVote("A")})),w.Zb(2,"mat-icon"),w.Sc(3," trip_origin"),w.Yb(),w.Yb(),w.Zb(4,"span",12),w.Sc(5),w.mc(6,"translate"),w.Yb(),w.Yb()}if(2&t){var a=w.lc(4);w.Gb(1),w.tc("ngClass","A"===a.voteRequestData.global?"voted-abstain":""),w.Gb(4),w.Uc(" ",w.nc(6,2,"General Abstain")," ")}}function Et(t,e){if(1&t&&(w.Xb(0),w.Ub(1,"mat-divider"),w.Zb(2,"div",13),w.Qc(3,Lt,7,5,"div",0),w.Qc(4,jt,7,4,"div",0),w.Yb(),w.Wb()),2&t){var n=w.lc(3);w.Gb(3),w.tc("ngIf",n.poll.global_no),w.Gb(1),w.tc("ngIf",n.poll.global_abstain)}}function Ut(t,e){if(1&t&&(w.Xb(0),w.Qc(1,It,3,1,"p",0),w.Qc(2,Tt,5,5,"h4",0),w.Qc(3,Qt,2,1,"div",4),w.Qc(4,Et,5,2,"ng-container",0),w.Vb(5,5),w.Wb()),2&t){var n=w.lc(2),a=w.Ec(4);w.Gb(1),w.tc("ngIf",n.pollHint),w.Gb(1),w.tc("ngIf",n.poll.pollmethod===n.AssignmentPollMethod.Votes&&n.poll.votes_amount>1),w.Gb(1),w.tc("ngForOf",n.poll.options),w.Gb(1),w.tc("ngIf",n.poll.pollmethod===n.AssignmentPollMethod.Votes&&(n.poll.global_no||n.poll.global_abstain)),w.Gb(1),w.tc("ngTemplateOutlet",a)}}function Bt(t,e){if(1&t&&(w.Xb(0),w.Zb(1,"span"),w.Sc(2),w.mc(3,"translate"),w.Yb(),w.Wb()),2&t){var n=w.lc(2);w.Gb(2),w.Tc(w.nc(3,1,n.vmanager.getVotePermissionErrorVerbose(n.poll)))}}function Ht(t,e){if(1&t&&(w.Xb(0),w.Qc(1,Ut,6,5,"ng-container",3),w.Qc(2,Bt,4,3,"ng-container",0),w.Wb()),2&t){var n=w.lc(),a=w.Ec(2);w.Gb(1),w.tc("ngIf",n.vmanager.canVote(n.poll)&&!n.alreadyVoted&&!n.deliveringVote)("ngIfElse",a),w.Gb(1),w.tc("ngIf",!n.vmanager.canVote(n.poll))}}function qt(t,e){1&t&&(w.Zb(0,"div"),w.Zb(1,"mat-icon",18),w.Sc(2," check_circle "),w.Yb(),w.Ub(3,"br"),w.Zb(4,"span"),w.Sc(5),w.mc(6,"translate"),w.Yb(),w.Yb()),2&t&&(w.Gb(5),w.Tc(w.nc(6,1,"Voting successful.")))}function zt(t,e){1&t&&(w.Zb(0,"div",19),w.Ub(1,"mat-spinner",20),w.Ub(2,"br"),w.Zb(3,"span"),w.Sc(4),w.mc(5,"translate"),w.Yb(),w.Yb()),2&t&&(w.Gb(4),w.Tc(w.nc(5,1,"Delivering vote... Please wait!")))}function Wt(t,e){if(1&t&&(w.Zb(0,"div",16),w.Qc(1,qt,7,3,"div",0),w.Qc(2,zt,6,3,"div",17),w.Yb()),2&t){var n=w.lc();w.Gb(1),w.tc("ngIf",!n.deliveringVote),w.Gb(1),w.tc("ngIf",n.deliveringVote)}}function Xt(t,e){if(1&t){var n=w.ac();w.Zb(0,"div",16),w.Zb(1,"button",21),w.hc("click",(function(){return w.Ic(n),w.lc().submitVote()})),w.Zb(2,"mat-icon"),w.Sc(3," how_to_vote "),w.Yb(),w.Zb(4,"span"),w.Sc(5),w.mc(6,"translate"),w.Yb(),w.Yb(),w.Yb()}2&t&&(w.Gb(5),w.Uc(" ",w.nc(6,1,"Submit vote now")," "))}var Kt,$t=((Kt=function(t){_inherits(n,t);var e=_createSuper(n);function n(t,a,i,o,r,c,s,l){var u;return _classCallCheck(this,n),(u=e.call(this,t,a,i,o)).translate=a,u.vmanager=r,u.pollRepo=c,u.promptService=s,u.cd=l,u.AssignmentPollMethod=S.b,u.PollType=V.f,u.voteActions=[],u.voteRequestData={votes:{}},u}return _createClass(n,[{key:"ngOnInit",value:function(){this.poll&&!this.poll.user_has_voted?(this.alreadyVoted=!1,this.defineVoteOptions()):(this.alreadyVoted=!0,this.cd.markForCheck())}},{key:"defineVoteOptions",value:function(){this.voteActions.push({vote:"Y",css:"voted-yes",icon:"thumb_up",label:"Yes"}),this.poll.pollmethod!==S.b.Votes&&this.voteActions.push({vote:"N",css:"voted-no",icon:"thumb_down",label:"No"}),this.poll.pollmethod===S.b.YNA&&this.voteActions.push({vote:"A",css:"voted-abstain",icon:"trip_origin",label:"Abstain"})}},{key:"getVotesCount",value:function(){var t=this;return Object.keys(this.voteRequestData.votes).filter((function(e){return t.voteRequestData.votes[e]})).length}},{key:"getVotesAvailable",value:function(){return this.poll.votes_amount-this.getVotesCount()}},{key:"isGlobalOptionSelected",value:function(){return!!this.voteRequestData.global}},{key:"submitVote",value:function(){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var e,n,a=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.translate.instant("Submit selection now?"),n=this.translate.instant("Your decision cannot be changed afterwards."),t.next=3,this.promptService.open(e,n);case 3:if(t.t0=t.sent,!t.t0){t.next=6;break}this.deliveringVote=!0,this.cd.markForCheck(),this.pollRepo.vote(this.voteRequestData,this.poll.id).then((function(){a.alreadyVoted=!0})).catch(this.raiseError).finally((function(){a.deliveringVote=!1}));case 6:case"end":return t.stop()}}),t,this)})))}},{key:"saveSingleVote",value:function(t,e){var n=this;if(this.isGlobalOptionSelected()&&delete this.voteRequestData.global,this.poll.pollmethod===S.b.Votes){var a=this.poll.votes_amount,i=this.poll.options.map((function(t){return t.id})).reduce((function(e,i){return e[i]=0,1===a?i===t&&1!==n.voteRequestData.votes[i]&&(e[i]=1):i===t!=(1===n.voteRequestData.votes[i])&&(e[i]=1),e}),{});Object.keys(i).filter((function(t){return i[t]})).length<=a?(this.voteRequestData.votes=i,this.getVotesCount()===a&&this.submitVote()):this.raiseError(this.translate.instant("You reached the maximum amount of votes. Deselect somebody first."))}else this.voteRequestData.votes[t]&&this.voteRequestData.votes[t]===e?delete this.voteRequestData.votes[t]:this.voteRequestData.votes[t]=e,Object.keys(this.voteRequestData.votes).length===this.poll.options.length&&this.submitVote()}},{key:"saveGlobalVote",value:function(t){this.voteRequestData.votes={},this.voteRequestData.global&&this.voteRequestData.global===t?delete this.voteRequestData.global:(this.voteRequestData.global=t,this.submitVote())}},{key:"pollHint",get:function(){return this.poll.assignment.default_poll_description}}]),n}(Gt.a)).\u0275fac=function(t){return new(t||Kt)(w.Tb(L.d),w.Tb(G.k),w.Tb(j.a),w.Tb(c.a),w.Tb(wt.b),w.Tb(ht.a),w.Tb(g.a),w.Tb(w.h))},Kt.\u0275cmp=w.Nb({type:Kt,selectors:[["os-assignment-poll-vote"]],features:[w.Db],decls:5,vars:1,consts:[[4,"ngIf"],["cannotVote",""],["sendNow",""],[4,"ngIf","ngIfElse"],[4,"ngFor","ngForOf"],[3,"ngTemplateOutlet"],[3,"ngClass"],[1,"vote-candidate-name"],["class","user-subtitle",4,"ngIf"],[1,"user-subtitle"],["mat-raised-button","",1,"vote-button",3,"disabled","ngClass","click"],["class","vote-label",4,"ngIf"],[1,"vote-label"],[1,"global-option-grid"],["mat-raised-button","",1,"vote-button",3,"ngClass","disabled","click"],["mat-raised-button","",1,"vote-button",3,"ngClass","click"],[1,"centered-button-wrapper"],["class","submit-vote-indicator",4,"ngIf"],[1,"vote-submitted"],[1,"submit-vote-indicator"],[1,"small-spinner"],["mat-flat-button","","color","accent",3,"click"]],template:function(t,e){1&t&&(w.Qc(0,Ht,3,3,"ng-container",0),w.Qc(1,Wt,3,2,"ng-template",null,1,w.Rc),w.Qc(3,Xt,7,3,"ng-template",null,2,w.Rc)),2&t&&w.tc("ngIf",e.poll)},directives:[o.t,o.s,o.A,o.q,E.b,dt.a,gt.a,Zt.c],pipes:[G.j],styles:['.yes[_ngcontent-%COMP%]{color:#4caf50}.no[_ngcontent-%COMP%]{color:#cc6c5b}.abstain[_ngcontent-%COMP%]{color:#a6a6a6}.voted-yes[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff}.voted-no[_ngcontent-%COMP%]{background-color:#cc6c5b;color:#fff}.voted-abstain[_ngcontent-%COMP%]{background-color:#a6a6a6;color:#fff}.start-poll-button[_ngcontent-%COMP%]{color:#4caf50}.stop-poll-button[_ngcontent-%COMP%]{color:#ff5252}.publish-poll-button[_ngcontent-%COMP%]{color:#e6b100}.global-option-grid[_ngcontent-%COMP%], .single-vote-grid[_ngcontent-%COMP%], .yn-grid[_ngcontent-%COMP%], .yna-grid[_ngcontent-%COMP%]{display:grid;grid-gap:10px;margin:20px 0}.yn-grid[_ngcontent-%COMP%]{grid-template-areas:"name name" "yes no"}.yna-grid[_ngcontent-%COMP%]{grid-template-areas:"name name name" "yes no abstain"}.single-vote-grid[_ngcontent-%COMP%]{grid-template-areas:"yes name";grid-template-columns:-webkit-min-content auto;grid-template-columns:min-content auto}.global-option-grid[_ngcontent-%COMP%]{grid-template-columns:auto auto}.vote-candidate-name[_ngcontent-%COMP%]{grid-area:name;display:-ms-flexbox;display:flex}.vote-candidate-name[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-top:auto;margin-bottom:auto}.centered-button-wrapper[_ngcontent-%COMP%]{display:-ms-flexbox;display:flex;text-align:center}.centered-button-wrapper[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-left:auto;margin-right:auto}.centered-button-wrapper[_ngcontent-%COMP%]   .vote-submitted[_ngcontent-%COMP%]{color:#4caf50;font-size:200%}.vote-button[_ngcontent-%COMP%]{min-width:50px;min-height:50px}.vote-label[_ngcontent-%COMP%]{margin-left:10px}.mat-divider-horizontal[_ngcontent-%COMP%]{position:static}.submit-vote-indicator[_ngcontent-%COMP%]{text-align:center}.submit-vote-indicator[_ngcontent-%COMP%]   .mat-spinner[_ngcontent-%COMP%]{margin:auto}'],changeDetection:0}),Kt),Jt=n("Qu3c");function te(t,e){if(1&t){var n=w.ac();w.Zb(0,"span"),w.Zb(1,"button",15),w.hc("click",(function(){return w.Ic(n),w.lc(2).openVotingWarning()})),w.Zb(2,"mat-icon"),w.Sc(3," warning "),w.Yb(),w.Yb(),w.Yb()}}function ee(t,e){if(1&t&&(w.Zb(0,"span"),w.Sc(1),w.mc(2,"translate"),w.Yb()),2&t){var n=w.lc(2);w.Gb(1),w.Uc(" ",w.nc(2,1,n.poll.typeVerbose)," \xb7 ")}}function ne(t,e){if(1&t){var n=w.ac();w.Zb(0,"button",16),w.hc("click",(function(t){return w.Ic(n),t.stopPropagation()})),w.Zb(1,"mat-icon"),w.Sc(2,"more_horiz"),w.Yb(),w.Yb()}if(2&t){w.lc(2);var a=w.Ec(2);w.tc("matMenuTriggerFor",a)}}function ae(t,e){if(1&t&&(w.Xb(0),w.Sc(1),w.mc(2,"translate"),w.Wb()),2&t){var n=w.lc(3);w.Gb(1),w.Uc(" ",w.nc(2,1,n.poll.nextStateActionVerbose)," ")}}function ie(t,e){1&t&&(w.Xb(0),w.Sc(1),w.mc(2,"translate"),w.Wb()),2&t&&(w.Gb(1),w.Uc(" ",w.nc(2,1,"In progress, please wait...")," "))}function oe(t,e){if(1&t){var n=w.ac();w.Zb(0,"div"),w.Zb(1,"button",17),w.hc("click",(function(){w.Ic(n);var t=w.lc(2);return t.changeState(t.poll.nextState)})),w.Zb(2,"mat-icon"),w.Sc(3),w.Yb(),w.Zb(4,"span",18),w.Qc(5,ae,3,3,"ng-container",8),w.Qc(6,ie,3,3,"ng-container",8),w.Yb(),w.Yb(),w.Yb()}if(2&t){var a=w.lc(2);w.Gb(1),w.tc("ngClass",a.pollStateActions[a.poll.state].css)("disabled",a.stateChangePending),w.Gb(2),w.Uc(" ",a.pollStateActions[a.poll.state].icon,""),w.Gb(2),w.tc("ngIf",!a.stateChangePending),w.Gb(1),w.tc("ngIf",a.stateChangePending)}}function re(t,e){1&t&&(w.Zb(0,"div"),w.Sc(1),w.mc(2,"translate"),w.Yb()),2&t&&(w.Gb(1),w.Uc(" ",w.nc(2,1,"Edit to enter votes.")," "))}function ce(t,e){if(1&t&&(w.Zb(0,"div"),w.Ub(1,"os-assignment-poll-detail-content",22),w.Yb()),2&t){var n=w.lc(3);w.Gb(1),w.vc("routerLink","/assignments/polls/",n.poll.id,""),w.tc("poll",n.poll)}}function se(t,e){1&t&&(w.Zb(0,"span"),w.Sc(1),w.mc(2,"translate"),w.Yb()),2&t&&(w.Gb(1),w.Uc(" ",w.nc(2,1,"Counting of votes is in progress ...")," "))}function le(t,e){if(1&t&&(w.Zb(0,"div"),w.Qc(1,se,3,3,"span",8),w.Yb()),2&t){var n=w.lc(3);w.Gb(1),w.tc("ngIf",n.poll.isFinished)}}function ue(t,e){if(1&t&&(w.Zb(0,"div",19),w.Qc(1,ce,2,2,"div",20),w.Qc(2,le,2,1,"div",21),w.Yb()),2&t){var n=w.lc(2);w.Gb(1),w.tc("osPerms","assignments.can_manage")("osPermsOr",n.poll.isPublished),w.Gb(1),w.tc("osPerms","assignments.can_manage")("osPermsComplement",!0)}}function be(t,e){if(1&t&&(w.Zb(0,"div"),w.Ub(1,"os-poll-progress",23),w.Yb()),2&t){var n=w.lc(2);w.Gb(1),w.tc("poll",n.poll)}}function de(t,e){if(1&t&&w.Ub(0,"os-assignment-poll-vote",23),2&t){var n=w.lc(2);w.tc("poll",n.poll)}}function me(t,e){if(1&t&&(w.Zb(0,"a",24),w.mc(1,"translate"),w.Zb(2,"mat-icon",25),w.Sc(3," visibility "),w.Yb(),w.Yb()),2&t){var n=w.lc(2);w.vc("routerLink","/assignments/polls/",n.poll.id,""),w.uc("matTooltip",w.nc(1,2,"More"))}}var fe=function(){return["core.can_manage_projector","assignments.can_manage"]};function pe(t,e){if(1&t&&(w.Zb(0,"mat-card",3),w.Zb(1,"div",4),w.Zb(2,"div"),w.Zb(3,"mat-card-title"),w.Zb(4,"a",5),w.Sc(5),w.Yb(),w.Yb(),w.Zb(6,"div",6),w.Qc(7,te,4,0,"span",7),w.Qc(8,ee,3,3,"span",8),w.Zb(9,"span"),w.Sc(10),w.mc(11,"translate"),w.Yb(),w.Yb(),w.Zb(12,"div",9),w.Qc(13,ne,3,1,"button",10),w.Yb(),w.Qc(14,oe,7,5,"div",7),w.Qc(15,re,3,3,"div",7),w.Yb(),w.Qc(16,ue,3,4,"div",11),w.Qc(17,be,2,1,"div",7),w.Qc(18,de,1,1,"os-assignment-poll-vote",12),w.Zb(19,"div",13),w.Qc(20,me,4,4,"a",14),w.Yb(),w.Yb(),w.Yb()),2&t){var n=w.lc();w.Gb(4),w.vc("routerLink","/assignments/polls/",n.poll.id,""),w.Gb(1),w.Uc(" ",n.poll.title," "),w.Gb(2),w.tc("osPerms","assignments.can_manage")("osPermsAnd","pseudoanonymous"===n.poll.type),w.Gb(1),w.tc("ngIf","analog"!==n.poll.type),w.Gb(2),w.Uc(" ",w.nc(11,16,n.poll.stateVerbose)," "),w.Gb(3),w.tc("osPerms",w.yc(18,fe)),w.Gb(1),w.tc("osPerms","assignments.can_manage")("osPermsAnd",!n.hideChangeState),w.Gb(1),w.tc("osPerms","assignments.can_manage")("osPermsAnd","analog"===n.poll.type&&!n.poll.stateHasVotes),w.Gb(1),w.tc("ngIf",n.poll.stateHasVotes),w.Gb(1),w.tc("osPerms","assignments.can_manage")("osPermsAnd",n.poll&&n.poll.isStarted),w.Gb(1),w.tc("ngIf",n.poll.canBeVotedFor()),w.Gb(2),w.tc("ngIf",n.poll.isPublished)}}function ge(t,e){if(1&t){var n=w.ac();w.Zb(0,"div"),w.Zb(1,"button",26),w.hc("click",(function(){return w.Ic(n),w.lc().openDialog()})),w.Zb(2,"mat-icon"),w.Sc(3,"edit"),w.Yb(),w.Zb(4,"span"),w.Sc(5),w.mc(6,"translate"),w.Yb(),w.Yb(),w.Yb()}2&t&&(w.Gb(5),w.Tc(w.nc(6,1,"Edit")))}function he(t,e){if(1&t&&(w.Zb(0,"div"),w.Ub(1,"os-projector-button",27),w.Yb()),2&t){var n=w.lc();w.Gb(1),w.tc("object",n.poll)}}function ve(t,e){if(1&t){var n=w.ac();w.Zb(0,"div"),w.Zb(1,"button",26),w.hc("click",(function(){return w.Ic(n),w.lc().printBallot()})),w.Zb(2,"mat-icon"),w.Sc(3,"picture_as_pdf"),w.Yb(),w.Zb(4,"span"),w.Sc(5),w.mc(6,"translate"),w.Yb(),w.Yb(),w.Ub(7,"mat-divider"),w.Zb(8,"button",26),w.hc("click",(function(){return w.Ic(n),w.lc().refreshPoll()})),w.Zb(9,"mat-icon"),w.Sc(10,"refresh"),w.Yb(),w.Zb(11,"span"),w.Sc(12),w.mc(13,"translate"),w.Yb(),w.Yb(),w.Zb(14,"button",26),w.hc("click",(function(){return w.Ic(n),w.lc().resetState()})),w.Zb(15,"mat-icon",28),w.Sc(16,"replay"),w.Yb(),w.Zb(17,"span"),w.Sc(18),w.mc(19,"translate"),w.Yb(),w.Yb(),w.Zb(20,"button",29),w.hc("click",(function(){return w.Ic(n),w.lc().onDeletePoll()})),w.Zb(21,"mat-icon"),w.Sc(22,"delete"),w.Yb(),w.Zb(23,"span"),w.Sc(24),w.mc(25,"translate"),w.Yb(),w.Yb(),w.Yb()}2&t&&(w.Gb(5),w.Tc(w.nc(6,4,"Ballot papers")),w.Gb(7),w.Tc(w.nc(13,6,"Refresh")),w.Gb(6),w.Tc(w.nc(19,8,"Reset state")),w.Gb(6),w.Tc(w.nc(25,10,"Delete")))}var ye,_e=((ye=function(t){_inherits(n,t);var e=_createSuper(n);function n(t,a,i,o,r,c,s,l,u,b){var d;return _classCallCheck(this,n),(d=e.call(this,t,a,i,o,r,c,s)).pollService=l,d.formBuilder=u,d.pdfService=b,d.candidatesLabels=[],d}return _createClass(n,[{key:"ngOnInit",value:function(){this.descriptionForm=this.formBuilder.group({description:this.poll?this.poll.description:""})}},{key:"printBallot",value:function(){this.pdfService.printBallots(this.poll)}},{key:"openVotingWarning",value:function(){this.dialog.open(vt.a,yt.a)}},{key:"poll",set:function(t){this.initPoll(t),this.candidatesLabels=this.pollService.getChartLabels(t);var e=this.pollService.generateChartData(t);this.chartDataSubject.next(e)},get:function(){return this._poll}},{key:"dirtyDescription",get:function(){return this.descriptionForm.get("description").value!==this.poll.description}}]),n}(_t.a)).\u0275fac=function(t){return new(t||ye)(w.Tb(L.d),w.Tb(j.a),w.Tb(G.k),w.Tb(x.b),w.Tb(g.a),w.Tb(ht.a),w.Tb(st),w.Tb(Y.a),w.Tb(l.f),w.Tb(Ct))},ye.\u0275cmp=w.Nb({type:ye,selectors:[["os-assignment-poll"]],inputs:{poll:"poll"},features:[w.Db],decls:6,vars:4,consts:[["class","os-card",4,"ngIf"],["pollItemMenu","matMenu"],[4,"osPerms"],[1,"os-card"],[1,"assignment-poll-wrapper"],[3,"routerLink"],[1,"italic","spacer-bottom-20"],[4,"osPerms","osPermsAnd"],[4,"ngIf"],[1,"poll-menu"],["mat-icon-button","",3,"matMenuTriggerFor","click",4,"osPerms"],["class","poll-result-wrapper",4,"ngIf"],[3,"poll",4,"ngIf"],[1,"poll-detail-button-wrapper"],["mat-icon-button","",3,"routerLink","matTooltip",4,"ngIf"],["mat-icon-button","","color","warn",3,"click"],["mat-icon-button","",3,"matMenuTriggerFor","click"],["mat-stroked-button","",3,"ngClass","disabled","click"],[1,"next-state-label"],[1,"poll-result-wrapper"],[4,"osPerms","osPermsOr"],[4,"osPerms","osPermsComplement"],[3,"routerLink","poll"],[3,"poll"],["mat-icon-button","",3,"routerLink","matTooltip"],[1,"small-icon"],["mat-menu-item","",3,"click"],["menuItem","true",3,"object"],["color","warn"],["mat-menu-item","",1,"red-warning-text",3,"click"]],template:function(t,e){1&t&&(w.Qc(0,pe,21,19,"mat-card",0),w.Zb(1,"mat-menu",null,1),w.Qc(3,ge,7,3,"div",2),w.Qc(4,he,2,1,"div",2),w.Qc(5,ve,26,12,"div",2),w.Yb()),2&t&&(w.tc("ngIf",e.poll),w.Gb(3),w.tc("osPerms","assignments.can_manage"),w.Gb(1),w.tc("osPerms","core.can_manage_projector"),w.Gb(1),w.tc("osPerms","assignments.can_manage"))},directives:[o.t,bt.f,ft.a,Pt.a,Pt.m,r.i,E.b,dt.a,bt.e,o.q,Ot.a,r.g,Yt.a,$t,E.a,Jt.c,bt.c,mt.a,gt.a],pipes:[G.j],styles:[".yes[_ngcontent-%COMP%]{color:#4caf50}.no[_ngcontent-%COMP%]{color:#cc6c5b}.abstain[_ngcontent-%COMP%]{color:#a6a6a6}.voted-yes[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff}.voted-no[_ngcontent-%COMP%]{background-color:#cc6c5b;color:#fff}.voted-abstain[_ngcontent-%COMP%]{background-color:#a6a6a6;color:#fff}.start-poll-button[_ngcontent-%COMP%]{color:#4caf50}.stop-poll-button[_ngcontent-%COMP%]{color:#ff5252}.publish-poll-button[_ngcontent-%COMP%]{color:#e6b100}.assignment-poll-wrapper[_ngcontent-%COMP%]{position:relative;margin:0 15px}.assignment-poll-wrapper[_ngcontent-%COMP%]   .poll-menu[_ngcontent-%COMP%]{position:absolute;top:0;right:0}.assignment-poll-wrapper[_ngcontent-%COMP%]   .poll-result-wrapper[_ngcontent-%COMP%]{cursor:pointer}.assignment-poll-wrapper[_ngcontent-%COMP%]   .poll-detail-button-wrapper[_ngcontent-%COMP%]{display:-ms-flexbox;display:flex;margin:auto 0}.assignment-poll-wrapper[_ngcontent-%COMP%]   .poll-detail-button-wrapper[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{margin-left:auto}"]}),ye),ke=n("A5z7"),Se=n("MutI"),Ce=n("IBZR"),Pe=n("oqD5"),Oe=n("qFsG"),Ye=n("fB2i"),we=n("JAMN"),Ge=n("6Ehv"),Ze=n("DShQ"),Ie=n("7jBc");function Te(t,e){1&t&&(w.Zb(0,"h2"),w.Sc(1),w.mc(2,"translate"),w.Yb()),2&t&&(w.Gb(1),w.Tc(w.nc(2,1,"Election")))}function Me(t,e){1&t&&(w.Zb(0,"h2"),w.Sc(1),w.mc(2,"translate"),w.Yb()),2&t&&(w.Gb(1),w.Tc(w.nc(2,1,"New election")))}function xe(t,e){if(1&t){var n=w.ac();w.Zb(0,"div"),w.Zb(1,"button",11),w.hc("click",(function(){return w.Ic(n),w.lc().onDownloadPdf()})),w.Zb(2,"mat-icon"),w.Sc(3,"picture_as_pdf"),w.Yb(),w.Zb(4,"span"),w.Sc(5),w.mc(6,"translate"),w.Yb(),w.Yb(),w.Ub(7,"os-speaker-button",6),w.Yb()}if(2&t){var a=w.lc();w.Gb(5),w.Tc(w.nc(6,3,"PDF")),w.Gb(2),w.tc("object",a.assignment)("menuItem",!0)}}function Ae(t,e){if(1&t){var n=w.ac();w.Zb(0,"button",11),w.hc("click",(function(){return w.Ic(n),w.lc(2).addToAgenda()})),w.Zb(1,"mat-icon"),w.Sc(2,"add"),w.Yb(),w.Zb(3,"span"),w.Sc(4),w.mc(5,"translate"),w.Yb(),w.Yb()}2&t&&(w.Gb(4),w.Tc(w.nc(5,1,"Add to agenda")))}function Ne(t,e){if(1&t){var n=w.ac();w.Zb(0,"button",11),w.hc("click",(function(){return w.Ic(n),w.lc(2).removeFromAgenda()})),w.Zb(1,"mat-icon"),w.Sc(2,"remove"),w.Yb(),w.Zb(3,"span"),w.Sc(4),w.mc(5,"translate"),w.Yb(),w.Yb()}2&t&&(w.Gb(4),w.Tc(w.nc(5,1,"Remove from agenda")))}function Ve(t,e){if(1&t&&(w.Zb(0,"div"),w.Qc(1,Ae,6,3,"button",12),w.Qc(2,Ne,6,3,"button",12),w.Yb()),2&t){var n=w.lc();w.Gb(1),w.tc("ngIf",n.assignment&&!n.assignment.item),w.Gb(1),w.tc("ngIf",n.assignment&&n.assignment.item)}}function De(t,e){if(1&t){var n=w.ac();w.Zb(0,"div"),w.Ub(1,"mat-divider"),w.Zb(2,"button",13),w.hc("click",(function(){return w.Ic(n),w.lc().onDeleteAssignmentButton()})),w.Zb(3,"mat-icon"),w.Sc(4,"delete"),w.Yb(),w.Zb(5,"span"),w.Sc(6),w.mc(7,"translate"),w.Yb(),w.Yb(),w.Yb()}2&t&&(w.Gb(6),w.Tc(w.nc(7,1,"Delete")))}function Fe(t,e){if(1&t&&(w.Zb(0,"div"),w.Vb(1,14),w.Yb()),2&t){w.lc();var n=w.Ec(22);w.Gb(1),w.tc("ngTemplateOutlet",n)}}function Re(t,e){if(1&t&&(w.Xb(0),w.Ub(1,"os-assignment-poll",17),w.Wb()),2&t){var n=e.$implicit;w.Gb(1),w.tc("poll",n)}}function Qe(t,e){if(1&t&&(w.Xb(0),w.Qc(1,Re,2,1,"ng-container",16),w.mc(2,"reverse"),w.Wb()),2&t){var n=w.lc(2);w.Gb(1),w.tc("ngForOf",w.nc(2,2,n.assignment.polls))("ngForTrackBy",n.trackByIndex)}}function Le(t,e){if(1&t){var n=w.ac();w.Zb(0,"div",18),w.Zb(1,"button",19),w.hc("click",(function(){return w.Ic(n),w.lc(2).openDialog()})),w.Zb(2,"mat-icon"),w.Sc(3,"add"),w.Yb(),w.Zb(4,"span"),w.Sc(5),w.mc(6,"translate"),w.Yb(),w.Yb(),w.Yb()}2&t&&(w.Gb(5),w.Tc(w.nc(6,1,"New ballot")))}function je(t,e){if(1&t&&(w.Zb(0,"div"),w.Vb(1,14),w.Qc(2,Qe,3,4,"ng-container",2),w.Qc(3,Le,7,3,"div",15),w.Vb(4,14),w.Yb()),2&t){var n=w.lc(),a=w.Ec(18),i=w.Ec(20);w.Gb(1),w.tc("ngTemplateOutlet",a),w.Gb(1),w.tc("ngIf",n.assignment&&n.assignment.polls.length),w.Gb(1),w.tc("ngIf",n.assignment&&n.hasPerms("createPoll")),w.Gb(1),w.tc("ngTemplateOutlet",i)}}function Ee(t,e){if(1&t&&(w.Zb(0,"div"),w.Zb(1,"h1"),w.Sc(2),w.Yb(),w.Yb()),2&t){var n=w.lc(3);w.Gb(2),w.Tc(n.assignment.getTitle())}}function Ue(t,e){if(1&t&&(w.Ub(0,"div",30),w.mc(1,"trust")),2&t){var n=w.lc(4);w.tc("innerHTML",w.oc(1,1,n.assignment.assignment.description,"html"),w.Jc)}}function Be(t,e){if(1&t&&(w.Zb(0,"div"),w.Qc(1,Ue,2,4,"div",29),w.Yb()),2&t){var n=w.lc(3);w.Gb(1),w.tc("ngIf",n.assignment.assignment.description)}}function He(t,e){if(1&t&&(w.Zb(0,"mat-basic-chip",31),w.Sc(1),w.mc(2,"translate"),w.Yb()),2&t){w.lc();var n=w.Ec(17),a=w.lc(2);w.tc("matMenuTriggerFor",n),w.Gb(1),w.Uc(" ",w.nc(2,2,a.assignment.phaseString)," ")}}function qe(t,e){if(1&t&&(w.Zb(0,"mat-basic-chip",32),w.Sc(1),w.mc(2,"translate"),w.Yb()),2&t){var n=w.lc(3);w.Gb(1),w.Uc(" ",w.nc(2,1,n.assignment.phaseString)," ")}}function ze(t,e){if(1&t){var n=w.ac();w.Zb(0,"button",11),w.hc("click",(function(){w.Ic(n);var t=e.$implicit;return w.lc(3).onSetPhaseButton(t.value)})),w.Sc(1),w.mc(2,"translate"),w.Yb()}if(2&t){var a=e.$implicit;w.Gb(1),w.Uc(" ",w.nc(2,1,a.display_name)," ")}}function We(t,e){if(1&t&&(w.Zb(0,"mat-list-item"),w.Zb(1,"a",35),w.Sc(2),w.Yb(),w.Yb()),2&t){var n=e.$implicit;w.Gb(1),w.tc("routerLink",n.url),w.Gb(1),w.Tc(n.getTitle())}}function Xe(t,e){if(1&t&&(w.Zb(0,"div"),w.Zb(1,"h4"),w.Sc(2),w.mc(3,"translate"),w.Yb(),w.Zb(4,"mat-list",33),w.Qc(5,We,3,2,"mat-list-item",34),w.Yb(),w.Yb()),2&t){var n=w.lc(3);w.Gb(2),w.Tc(w.nc(3,2,"Election documents")),w.Gb(3),w.tc("ngForOf",n.assignment.attachments)}}function Ke(t,e){if(1&t&&(w.Zb(0,"mat-card",21),w.Qc(1,Ee,3,1,"div",2),w.Qc(2,Be,2,1,"div",2),w.Zb(3,"div",22),w.Zb(4,"div",23),w.Zb(5,"h4"),w.Sc(6),w.mc(7,"translate"),w.Yb(),w.Zb(8,"span"),w.Sc(9),w.Yb(),w.Yb(),w.Zb(10,"div",24),w.Zb(11,"h4"),w.Sc(12),w.mc(13,"translate"),w.Yb(),w.Qc(14,He,3,4,"mat-basic-chip",25),w.Qc(15,qe,3,3,"mat-basic-chip",26),w.Zb(16,"mat-menu",null,27),w.Qc(18,ze,3,3,"button",28),w.Yb(),w.Yb(),w.Yb(),w.Qc(19,Xe,6,4,"div",2),w.Yb()),2&t){var n=w.lc(2);w.Gb(1),w.tc("ngIf",!n.editAssignment&&n.assignment.getTitle),w.Gb(1),w.tc("ngIf",n.assignment),w.Gb(4),w.Tc(w.nc(7,9,"Number of persons to be elected")),w.Gb(3),w.Tc(n.assignment.assignment.open_posts),w.Gb(3),w.Tc(w.nc(13,11,"Phase")),w.Gb(2),w.tc("ngIf",n.hasPerms("manage")),w.Gb(1),w.tc("ngIf",!n.hasPerms("manage")),w.Gb(3),w.tc("ngForOf",n.phaseOptions),w.Gb(1),w.tc("ngIf",n.assignment.attachments.length)}}function $e(t,e){if(1&t&&w.Qc(0,Ke,20,13,"mat-card",20),2&t){var n=w.lc();w.tc("ngIf",n.assignment)}}function Je(t,e){if(1&t){var n=w.ac();w.Zb(0,"span"),w.Zb(1,"button",41),w.hc("click",(function(){w.Ic(n);var t=w.lc().$implicit;return w.lc(4).removeUser(t)})),w.mc(2,"translate"),w.Zb(3,"mat-icon"),w.Sc(4,"clear"),w.Yb(),w.Yb(),w.Yb()}2&t&&(w.Gb(1),w.uc("matTooltip",w.nc(2,1,"Remove candidate")))}function tn(t,e){if(1&t&&w.Qc(0,Je,5,3,"span",2),2&t){var n=w.lc(4);w.tc("ngIf",n.hasPerms("manage"))}}function en(t,e){if(1&t){var n=w.ac();w.Zb(0,"div",39),w.Zb(1,"os-sorting-list",40),w.hc("sortEvent",(function(t){return w.Ic(n),w.lc(3).onSortingChange(t)})),w.Qc(2,tn,1,1,"ng-template"),w.Yb(),w.Yb()}if(2&t){var a=w.lc(3);w.Gb(1),w.tc("input",a.assignment.assignment_related_users)("live",!0)("count",a.assignment.number_poll_candidates)("enable",a.hasPerms("manage"))}}function nn(t,e){if(1&t&&(w.Zb(0,"form",44),w.Zb(1,"mat-form-field"),w.Ub(2,"os-search-value-selector",45),w.mc(3,"translate"),w.Yb(),w.Yb()),2&t){var n=w.lc(4);w.tc("formGroup",n.candidatesForm),w.Gb(2),w.uc("placeholder",w.nc(3,4,"Select a new candidate")),w.tc("multiple",!1)("inputListValues",n.filteredCandidates)}}function an(t,e){if(1&t&&(w.Zb(0,"div",42),w.Qc(1,nn,4,6,"form",43),w.Yb()),2&t){var n=w.lc(3);w.Gb(1),w.tc("ngIf",n.hasPerms("addOthers")&&n.filteredCandidates&&n.filteredCandidates.value&&n.filteredCandidates.value.length)}}function on(t,e){if(1&t){var n=w.ac();w.Zb(0,"button",47),w.hc("click",(function(){return w.Ic(n),w.lc(4).addSelf()})),w.Zb(1,"mat-icon"),w.Sc(2,"add"),w.Yb(),w.Zb(3,"span"),w.Sc(4),w.mc(5,"translate"),w.Yb(),w.Yb()}2&t&&(w.Gb(4),w.Tc(w.nc(5,1,"Add me")))}function rn(t,e){if(1&t){var n=w.ac();w.Zb(0,"button",47),w.hc("click",(function(){return w.Ic(n),w.lc(4).removeSelf()})),w.Zb(1,"mat-icon"),w.Sc(2,"remove"),w.Yb(),w.Zb(3,"span"),w.Sc(4),w.mc(5,"translate"),w.Yb(),w.Yb()}2&t&&(w.Gb(4),w.Tc(w.nc(5,1,"Remove me")))}function cn(t,e){if(1&t&&(w.Zb(0,"div"),w.Zb(1,"div"),w.Qc(2,on,6,3,"button",46),w.Qc(3,rn,6,3,"button",46),w.Yb(),w.Yb()),2&t){var n=w.lc(3);w.Gb(2),w.tc("ngIf",!n.isSelfCandidate),w.Gb(1),w.tc("ngIf",n.isSelfCandidate)}}function sn(t,e){if(1&t&&(w.Zb(0,"mat-card",21),w.Xb(1),w.Zb(2,"h3"),w.Sc(3),w.mc(4,"translate"),w.Yb(),w.Zb(5,"div"),w.Qc(6,en,3,4,"div",36),w.Zb(7,"div",37),w.Qc(8,an,2,1,"div",38),w.Qc(9,cn,4,2,"div",2),w.Yb(),w.Yb(),w.Wb(),w.Yb()),2&t){var n=w.lc(2);w.Gb(3),w.Tc(w.nc(4,4,"Candidates")),w.Gb(3),w.tc("ngIf",n.assignment&&n.assignment.assignment_related_users&&n.assignment.assignment_related_users.length>0),w.Gb(2),w.tc("ngIf",n.hasPerms("addOthers")),w.Gb(1),w.tc("ngIf",n.assignment&&n.hasPerms("addSelf")&&n.assignment.candidates)}}function ln(t,e){if(1&t&&w.Qc(0,sn,10,6,"mat-card",20),2&t){var n=w.lc();w.tc("ngIf",n.assignment&&!n.assignment.isFinished)}}function un(t,e){if(1&t&&w.Ub(0,"editor",59),2&t){var n=w.lc(3);w.tc("init",n.tinyMceSettings)}}function bn(t,e){if(1&t){var n=w.ac();w.Zb(0,"div",60),w.Zb(1,"mat-form-field"),w.Ub(2,"os-search-value-selector",61),w.mc(3,"translate"),w.Yb(),w.Zb(4,"os-attachment-control",62),w.hc("errorHandler",(function(t){return w.Ic(n),w.lc(3).raiseError(t)})),w.Yb(),w.Yb()}if(2&t){var a=w.lc(3);w.tc("formGroup",a.assignmentForm),w.Gb(2),w.uc("placeholder",w.nc(3,5,"Tags")),w.tc("multiple",!0)("includeNone",!0)("inputListValues",a.tagsObserver)}}function dn(t,e){if(1&t&&w.Ub(0,"os-agenda-content-object-form",63),2&t){var n=w.lc(3);w.tc("form",n.assignmentForm)}}function mn(t,e){1&t&&(w.Zb(0,"mat-error"),w.Sc(1),w.mc(2,"translate"),w.Yb()),2&t&&(w.Gb(1),w.Uc(" ",w.nc(2,1,"This field is required.")," "))}function fn(t,e){1&t&&(w.Zb(0,"mat-error"),w.Sc(1),w.mc(2,"translate"),w.Yb()),2&t&&(w.Gb(1),w.Uc(" ",w.nc(2,1,"The number has to be greater than 0.")," "))}function pn(t,e){if(1&t){var n=w.ac();w.Zb(0,"form",50),w.hc("keydown",(function(t){return w.Ic(n),w.lc(2).onKeyDown(t)})),w.Zb(1,"div"),w.Zb(2,"mat-form-field",51),w.Ub(3,"input",52),w.mc(4,"translate"),w.Zb(5,"mat-error"),w.Sc(6),w.mc(7,"translate"),w.Yb(),w.Yb(),w.Yb(),w.Zb(8,"h4"),w.Sc(9),w.mc(10,"translate"),w.Yb(),w.Qc(11,un,1,1,"editor",53),w.Qc(12,bn,5,7,"div",54),w.Qc(13,dn,1,1,"os-agenda-content-object-form",55),w.Zb(14,"div"),w.Zb(15,"mat-form-field"),w.Ub(16,"input",56),w.mc(17,"translate"),w.Yb(),w.Yb(),w.Zb(18,"div"),w.Zb(19,"mat-form-field"),w.Ub(20,"input",57),w.mc(21,"translate"),w.Qc(22,mn,3,3,"mat-error",2),w.Qc(23,fn,3,3,"mat-error",2),w.Yb(),w.Yb(),w.Zb(24,"div"),w.Zb(25,"mat-checkbox",58),w.Zb(26,"span"),w.Sc(27),w.mc(28,"translate"),w.Yb(),w.Yb(),w.Yb(),w.Yb()}if(2&t){var a=w.lc(2);w.tc("formGroup",a.assignmentForm),w.Gb(3),w.uc("placeholder",w.nc(4,12,"Title")),w.Gb(3),w.Tc(w.nc(7,14,"The title is required")),w.Gb(3),w.Uc("",w.nc(10,16,"Description"),":"),w.Gb(2),w.tc("ngIf",a.assignment&&a.editAssignment),w.Gb(1),w.tc("ngIf",a.tagsAvailable),w.Gb(1),w.tc("ngIf",a.newAssignment),w.Gb(3),w.uc("placeholder",w.nc(17,18,"Hint on voting")),w.Gb(4),w.uc("placeholder",w.nc(21,20,"Number of persons to be elected")),w.Gb(2),w.tc("ngIf",a.assignmentForm.get("open_posts").hasError("required")),w.Gb(1),w.tc("ngIf",a.assignmentForm.get("open_posts").hasError("min")),w.Gb(4),w.Tc(w.nc(28,22,"Number candidates"))}}function gn(t,e){if(1&t&&(w.Zb(0,"mat-card",48),w.Qc(1,pn,29,24,"form",49),w.Yb()),2&t){var n=w.lc();w.Gb(1),w.tc("ngIf",n.assignment&&n.editAssignment)}}var hn,vn,yn,_n=((hn=function(t){_inherits(n,t);var e=_createSuper(n);function n(t,a,i,o,r,c,s,b,d,m,f,p,g,h,v,y,_){var k;return _classCallCheck(this,n),(k=e.call(this,t,a,i)).translate=a,k.operator=o,k.perms=r,k.router=c,k.route=s,k.repo=d,k.userRepo=m,k.itemRepo=f,k.tagRepo=p,k.promptService=g,k.pdfService=h,k.mediafileRepo=v,k.pollDialog=y,k.assignmentPollService=_,k.newAssignment=!1,k.editAssignment=!1,k.phaseOptions=lt.a,k.availableCandidates=new u.a([]),k.filteredCandidates=new u.a([]),k.subscriptions.push(k.userRepo.getViewModelListObservable().subscribe((function(t){k.availableCandidates.next(t),k.filterCandidates()}))),k.assignmentForm=b.group({phase:null,tags_id:[],attachments_id:[],title:["",l.G.required],description:[""],default_poll_description:[""],open_posts:[1,[l.G.required,l.G.min(1)]],agenda_create:[""],agenda_parent_id:[],agenda_type:[""],number_poll_candidates:[!1]}),k.candidatesForm=b.group({userId:null}),k}return _createClass(n,[{key:"ngOnInit",value:function(){this.getAssignmentByUrl(),this.agendaObserver=this.itemRepo.getViewModelListBehaviorSubject(),this.tagsObserver=this.tagRepo.getViewModelListBehaviorSubject(),this.mediafilesObserver=this.mediafileRepo.getViewModelListBehaviorSubject()}},{key:"hasPerms",value:function(t){var e=this.operator.hasPerms(c.b.assignmentsCanManage);switch(t){case"addSelf":return!(!e||this.assignment.isFinished)||this.assignment.isSearchingForCandidates&&this.operator.hasPerms(c.b.assignmentsCanNominateSelf)&&!this.assignment.isFinished;case"addOthers":return!(!e||this.assignment.isFinished)||this.assignment.isSearchingForCandidates&&this.operator.hasPerms(c.b.assignmentsCanNominateOther)&&!this.assignment.isFinished;case"createPoll":return e&&this.assignment&&!this.assignment.isFinished&&this.assignment.candidateAmount>0;case"manage":return e;default:return!1}}},{key:"setEditMode",value:function(t){t&&this.hasPerms("manage")&&(this.patchForm(this.assignment),this.editAssignment=!0),!t&&this.newAssignment&&this.router.navigate(["./assignments/"]),t||(this.editAssignment=!1)}},{key:"patchForm",value:function(t){var e={};Object.keys(this.assignmentForm.controls).forEach((function(n){e[n]=t[n]})),this.assignmentForm.patchValue(e)}},{key:"saveAssignment",value:function(){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.newAssignment){t.next=4;break}this.createAssignment(),t.next=6;break;case 4:return t.next=6,this.updateAssignmentFromForm();case 6:case"end":return t.stop()}}),t,this)})))}},{key:"openDialog",value:function(){var t=Object.assign({collectionString:F.c.COLLECTIONSTRING,assignment_id:this.assignment.id,assignment:this.assignment},this.assignmentPollService.getDefaultPollData(this.assignment.id));this.pollDialog.openDialog(t)}},{key:"addSelf",value:function(){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.repo.addSelf(this.assignment).catch(this.raiseError);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"removeSelf",value:function(){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.repo.deleteSelf(this.assignment).catch(this.raiseError);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"addUser",value:function(t){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.userRepo.getViewModel(t),e.t0=n,!e.t0){e.next=5;break}return e.next=5,this.repo.changeCandidate(n,this.assignment,!0).catch(this.raiseError);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"removeUser",value:function(t){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.repo.changeCandidate(t.user,this.assignment,!1).catch(this.raiseError);case 2:case"end":return e.stop()}}),e,this)})))}},{key:"getAssignmentByUrl",value:function(){var t=this,e=this.route.snapshot.params;e&&e.id?(this.subscriptions.push(this.repo.getViewModelObservable(+e.id).subscribe((function(e){if(e){var a=e.getTitle();_get(_getPrototypeOf(n.prototype),"setTitle",t).call(t,a),t.assignment=e,t.editAssignment||t.patchForm(t.assignment)}}))),this.subscriptions.push(this.candidatesForm.valueChanges.subscribe((function(e){e&&e.userId&&(t.addUser(e.userId),t.candidatesForm.setValue({userId:null}))})))):(_get(_getPrototypeOf(n.prototype),"setTitle",this).call(this,"New election"),this.newAssignment=!0,this.editAssignment=!0,this.assignment=new lt.b(new h.a))}},{key:"onDeleteAssignmentButton",value:function(){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var e,n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.translate.instant("Are you sure you want to delete this election?"),t.next=3,this.promptService.open(e,this.assignment.getTitle());case 3:if(t.t0=t.sent,!t.t0){t.next=6;break}this.repo.delete(this.assignment).then((function(){return n.router.navigate(["../"])}),this.raiseError);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"onTabChange",value:function(){}},{key:"onSetPhaseButton",value:function(t){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.repo.update({phase:t},this.assignment).catch(this.raiseError);case 1:case"end":return e.stop()}}),e,this)})))}},{key:"onDownloadPdf",value:function(){this.pdfService.exportSingleAssignment(this.assignment)}},{key:"createAssignment",value:function(){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var e,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(e=Object.assign({},this.assignmentForm.value)).agenda_parent_id||delete e.agenda_parent_id,t.prev=2,t.next=5,this.repo.create(e);case 5:n=t.sent,this.router.navigate(["./assignments/"+n.id]),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(2),this.raiseError(this.translate.instant(t.t0));case 12:case"end":return t.stop()}}),t,this,[[2,9]])})))}},{key:"updateAssignmentFromForm",value:function(){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.repo.patch(Object.assign({},this.assignmentForm.value),this.assignment);case 3:this.editAssignment=!1,t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),this.raiseError(t.t0);case 9:case"end":return t.stop()}}),t,this,[[0,6]])})))}},{key:"onKeyDown",value:function(t){"Enter"===t.key&&t.shiftKey&&this.saveAssignment(),"Escape"===t.key&&this.setEditMode(!1)}},{key:"filterCandidates",value:function(){var t=this;this.filteredCandidates.next(this.assignment&&this.assignment.candidates.length?this.availableCandidates.getValue().filter((function(e){return!t.assignment.candidates.some((function(t){return t.id===e.id}))})):this.availableCandidates.getValue())}},{key:"onSortingChange",value:function(t){this.repo.sortCandidates(t.map((function(t){return t.id})),this.assignment).catch(this.raiseError)}},{key:"addToAgenda",value:function(){this.itemRepo.addItemToAgenda(this.assignment).catch(this.raiseError)}},{key:"removeFromAgenda",value:function(){this.itemRepo.removeFromAgenda(this.assignment.item).catch(this.raiseError)}},{key:"assignment",set:function(t){this._assignment=t,this.filterCandidates()},get:function(){return this._assignment}},{key:"isSelfCandidate",get:function(){var t=this;return!!this.assignment.candidates.find((function(e){return e.id===t.operator.user.id}))}},{key:"tagsAvailable",get:function(){return this.tagsObserver.getValue().length>0}},{key:"mediafilesAvailable",get:function(){return this.mediafilesObserver.getValue().length>0}},{key:"parentsAvailable",get:function(){return this.agendaObserver.getValue().length>0}}]),n}(v.a)).\u0275fac=function(t){return new(t||hn)(w.Tb(L.d),w.Tb(G.k),w.Tb(j.a),w.Tb(c.a),w.Tb(y.a),w.Tb(r.f),w.Tb(r.a),w.Tb(l.f),w.Tb(d.a),w.Tb(p.a),w.Tb(b.a),w.Tb(f.a),w.Tb(g.a),w.Tb(I),w.Tb(m.a),w.Tb(st),w.Tb(Y.a))},hn.\u0275cmp=w.Nb({type:hn,selectors:[["os-assignment-detail"]],features:[w.Db],decls:23,vars:14,consts:[["mainButtonIcon","edit",3,"hasMainButton","nav","editMode","isSaveButtonEnabled","mainEvent","saveEvent"],[1,"title-slot"],[4,"ngIf"],[1,"menu-slot"],["type","button","mat-icon-button","",3,"matMenuTriggerFor"],["assignmentDetailMenu","matMenu"],[3,"object","menuItem"],[4,"osPerms"],["metaInfoTemplate",""],["candidatesTemplate",""],["assignmentFormTemplate",""],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"click",4,"ngIf"],["mat-menu-item","",1,"red-warning-text",3,"click"],[3,"ngTemplateOutlet"],["class","new-ballot-button",4,"ngIf"],[4,"ngFor","ngForOf","ngForTrackBy"],[3,"poll"],[1,"new-ballot-button"],["mat-stroked-button","",3,"click"],["class","os-card spacer-bottom-60",4,"ngIf"],[1,"os-card","spacer-bottom-60"],[1,"meta-info-grid"],[1,"number-of-elected"],[1,"current-phase"],["class","bluegrey","disableRipple","",3,"matMenuTriggerFor",4,"ngIf"],["class","bluegrey","disableRipple","",4,"ngIf"],["phaseMenu","matMenu"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],[3,"innerHTML",4,"ngIf"],[3,"innerHTML"],["disableRipple","",1,"bluegrey",3,"matMenuTriggerFor"],["disableRipple","",1,"bluegrey"],["dense","",1,"election-document-list"],[4,"ngFor","ngForOf"],["target","_blank",3,"routerLink"],["class","candidates-list",4,"ngIf"],[1,"add-candidates"],["class","search-field",4,"ngIf"],[1,"candidates-list"],[3,"input","live","count","enable","sortEvent"],["mat-icon-button","",3,"matTooltip","click"],[1,"search-field"],[3,"formGroup",4,"ngIf"],[3,"formGroup"],["formControlName","userId",3,"multiple","placeholder","inputListValues"],["mat-button","","color","accent",3,"click",4,"ngIf"],["mat-button","","color","accent",3,"click"],[1,"os-form-card","spacer-bottom-60"],["class","content",3,"formGroup","keydown",4,"ngIf"],[1,"content",3,"formGroup","keydown"],[1,"full-width"],["matInput","","formControlName","title",3,"placeholder"],["formControlName","description",3,"init",4,"ngIf"],["class","content-field",3,"formGroup",4,"ngIf"],[3,"form",4,"ngIf"],["matInput","","formControlName","default_poll_description",3,"placeholder"],["matInput","","formControlName","open_posts","type","number","required","",3,"placeholder"],["formControlName","number_poll_candidates"],["formControlName","description",3,"init"],[1,"content-field",3,"formGroup"],["formControlName","tags_id",3,"multiple","includeNone","placeholder","inputListValues"],["formControlName","attachments_id",3,"errorHandler"],[3,"form"]],template:function(t,e){if(1&t&&(w.Zb(0,"os-head-bar",0),w.hc("mainEvent",(function(){return e.setEditMode(!e.editAssignment)}))("saveEvent",(function(){return e.saveAssignment()})),w.Zb(1,"div",1),w.Qc(2,Te,3,3,"h2",2),w.Qc(3,Me,3,3,"h2",2),w.Yb(),w.Zb(4,"div",3),w.Zb(5,"button",4),w.Zb(6,"mat-icon"),w.Sc(7,"more_vert"),w.Yb(),w.Yb(),w.Yb(),w.Zb(8,"mat-menu",null,5),w.Qc(10,xe,8,5,"div",2),w.Ub(11,"os-projector-button",6),w.Qc(12,Ve,3,2,"div",7),w.Qc(13,De,8,3,"div",2),w.Yb(),w.Yb(),w.Zb(14,"div"),w.Qc(15,Fe,2,1,"div",2),w.Qc(16,je,5,4,"div",2),w.Yb(),w.Qc(17,$e,1,1,"ng-template",null,8,w.Rc),w.Qc(19,ln,1,1,"ng-template",null,9,w.Rc),w.Qc(21,gn,2,1,"ng-template",null,10,w.Rc)),2&t){var n=w.Ec(9);w.tc("hasMainButton",e.hasPerms("manage"))("nav",!1)("editMode",e.editAssignment)("isSaveButtonEnabled",e.assignmentForm.valid),w.Gb(2),w.tc("ngIf",!e.newAssignment),w.Gb(1),w.tc("ngIf",e.newAssignment),w.Gb(2),w.tc("matMenuTriggerFor",n),w.Gb(5),w.tc("ngIf",e.assignment),w.Gb(1),w.tc("object",e.assignment)("menuItem",!0),w.Gb(1),w.tc("osPerms","agenda.can_manage"),w.Gb(1),w.tc("ngIf",e.assignment&&e.hasPerms("manage")),w.Gb(2),w.tc("ngIf",e.editAssignment),w.Gb(1),w.tc("ngIf",!e.editAssignment)}},directives:[ut.a,o.t,E.b,bt.e,dt.a,bt.f,mt.a,ft.a,bt.c,pt.a,gt.a,o.A,o.s,_e,Pt.a,ke.a,Se.a,Se.d,r.i,Ce.a,Jt.c,l.I,l.t,l.k,H.c,Pe.a,l.s,l.i,Oe.b,l.c,H.b,l.y,l.D,U.a,Ye.a,we.a,Ge.a],pipes:[G.j,Ze.a,Ie.a],styles:[".full-width[_ngcontent-%COMP%]{width:100%}.meta-info-grid[_ngcontent-%COMP%]{display:grid;grid-column-gap:30px;grid-template-columns:1fr}.meta-info-grid[_ngcontent-%COMP%]   .current-phase[_ngcontent-%COMP%], .meta-info-grid[_ngcontent-%COMP%]   .number-of-elected[_ngcontent-%COMP%]{grid-column:1}@media (min-width:960px){.meta-info-grid[_ngcontent-%COMP%]{grid-template-columns:1fr 2fr}.meta-info-grid[_ngcontent-%COMP%]   .current-phase[_ngcontent-%COMP%]{grid-column:2}}.new-ballot-button[_ngcontent-%COMP%]{display:-ms-flexbox;display:flex}.new-ballot-button[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-left:auto;margin-right:auto}.election-document-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]{height:20px}.candidates-list[_ngcontent-%COMP%]{padding:10px 25px 0}.add-candidates[_ngcontent-%COMP%]   .search-field[_ngcontent-%COMP%]{padding:15px 25px 0;width:auto}.add-candidates[_ngcontent-%COMP%]   .search-field[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]{width:100%}.ballot-controls-grid[_ngcontent-%COMP%]{display:grid;grid-column-gap:10px;grid-template-columns:auto -webkit-min-content;grid-template-columns:auto min-content}.ballot-controls-grid[_ngcontent-%COMP%]   .ballot-title[_ngcontent-%COMP%]{grid-column:1}.ballot-controls-grid[_ngcontent-%COMP%]   .ballot-title[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0}.candidate-list-separator[_ngcontent-%COMP%]{position:static!important;margin:20px 0}.candidate[_ngcontent-%COMP%]{display:-ms-flexbox;display:flex;width:100%;border-bottom:1px solid #d3d3d3;vertical-align:top}.candidate[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{word-wrap:break-word;-ms-flex:1;flex:1}.top-aligned[_ngcontent-%COMP%]{position:absolute;top:0;left:0}"]}),hn),kn=n("AqIO"),Sn=n("KL36"),Cn=n("wL0i"),Pn=n("D/ll"),On=n("+8Rz"),Yn=((vn=function(t){_inherits(n,t);var e=_createSuper(n);function n(t,a){var i;return _classCallCheck(this,n),(i=e.call(this,t,a)).storageKey="AssignmentList",i}return _createClass(n,[{key:"getFilterDefinitions",value:function(){return[{label:"Phase",property:"phase",options:this.createPhaseOptions()}]}},{key:"createPhaseOptions",value:function(){return lt.a.map((function(t){return{label:t.display_name,condition:t.value,isActive:!1}}))}}]),n}(On.a)).\u0275fac=function(t){return new(t||vn)(w.dc(kn.a),w.dc(Pn.a))},vn.\u0275prov=w.Pb({token:vn,factory:vn.\u0275fac,providedIn:"root"}),vn),wn=n("A6Ob"),Gn=((yn=function(t){_inherits(n,t);var e=_createSuper(n);function n(t,a,i){var o;return _classCallCheck(this,n),(o=e.call(this,t,a,i)).storageKey="AssignmentList",o.assignmentSortOptions=[{property:"title",label:"Name"},{property:"phase",label:"Phase"},{property:"candidateAmount",label:"Number of candidates"},{property:"id",label:"Creation date"}],o}return _createClass(n,[{key:"getSortOptions",value:function(){return this.assignmentSortOptions}},{key:"getDefaultDefinition",value:function(){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",{sortProperty:"title",sortAscending:!0});case 1:case"end":return t.stop()}}),t)})))}}]),n}(wn.a)).\u0275fac=function(t){return new(t||yn)(w.dc(G.k),w.dc(kn.a),w.dc(Pn.a))},yn.\u0275prov=w.Pb({token:yn,factory:yn.\u0275fac,providedIn:"root"}),yn),Zn=n("0Obk"),In=n("dRZP");function Tn(t,e){if(1&t&&w.Ub(0,"a",18),2&t){var n=w.lc().row;w.tc("routerLink",n.id)}}function Mn(t,e){if(1&t&&(w.Zb(0,"mat-chip-list",19),w.Zb(1,"mat-chip",20),w.Sc(2),w.mc(3,"translate"),w.Yb(),w.Yb()),2&t){var n=w.lc().row;w.Gb(2),w.Uc(" ",w.nc(3,1,n.phaseString)," ")}}function xn(t,e){if(1&t&&(w.Zb(0,"div",13),w.Qc(1,Tn,1,1,"a",14),w.Zb(2,"div",15),w.Zb(3,"div",16),w.Sc(4),w.Yb(),w.Qc(5,Mn,4,3,"mat-chip-list",17),w.Yb(),w.Yb()),2&t){var n=e.row,a=w.lc();w.Gb(1),w.tc("ngIf",!a.isMultiSelect),w.Gb(3),w.Uc(" ",n.getListTitle()," "),w.Gb(1),w.tc("ngIf",a.vp.isMobile)}}function An(t,e){if(1&t&&(w.Zb(0,"div",21),w.Zb(1,"mat-chip-list"),w.Zb(2,"mat-chip",20),w.Sc(3),w.mc(4,"translate"),w.Yb(),w.Yb(),w.Yb()),2&t){var n=e.row;w.Gb(3),w.Uc(" ",w.nc(4,1,n.phaseString)," ")}}function Nn(t,e){if(1&t&&(w.Zb(0,"div",13),w.Zb(1,"mat-chip-list"),w.Zb(2,"mat-chip",22),w.mc(3,"translate"),w.Sc(4),w.Yb(),w.Yb(),w.Yb()),2&t){var n=e.row;w.Gb(2),w.uc("matTooltip",w.nc(3,2,"Number of candidates")),w.Gb(2),w.Uc(" ",n.candidateAmount," ")}}var Vn=function(t){return{assignment:t}};function Dn(t,e){if(1&t){var n=w.ac();w.Zb(0,"div",13),w.Zb(1,"button",23),w.hc("click",(function(t){return w.Ic(n),t.stopPropagation()})),w.Zb(2,"mat-icon"),w.Sc(3,"more_vert"),w.Yb(),w.Yb(),w.Yb()}if(2&t){var a=e.row,i=w.lc(),o=w.Ec(24);w.Gb(1),w.tc("disabled",i.isMultiSelect)("matMenuTriggerFor",o)("matMenuTriggerData",w.zc(3,Vn,a))}}function Fn(t,e){if(1&t&&(w.Ub(0,"os-projector-button",24),w.Ub(1,"os-speaker-button",24)),2&t){var n=e.assignment;w.tc("object",n)("menuItem",!0),w.Gb(1),w.tc("object",n)("menuItem",!0)}}function Rn(t,e){if(1&t){var n=w.ac();w.Zb(0,"button",26),w.hc("click",(function(){return w.Ic(n),w.lc(2).toggleMultiSelect()})),w.Zb(1,"mat-icon"),w.Sc(2,"library_add"),w.Yb(),w.Zb(3,"span"),w.Sc(4),w.mc(5,"translate"),w.Yb(),w.Yb()}2&t&&(w.Gb(4),w.Tc(w.nc(5,1,"Multiselect")))}function Qn(t,e){1&t&&(w.Zb(0,"div"),w.Ub(1,"mat-divider"),w.Zb(2,"button",28),w.Zb(3,"mat-icon"),w.Sc(4,"settings"),w.Yb(),w.Zb(5,"span"),w.Sc(6),w.mc(7,"translate"),w.Yb(),w.Yb(),w.Yb()),2&t&&(w.Gb(6),w.Tc(w.nc(7,1,"Settings")))}function Ln(t,e){if(1&t){var n=w.ac();w.Zb(0,"div"),w.Qc(1,Rn,6,3,"button",25),w.Zb(2,"button",26),w.hc("click",(function(){return w.Ic(n),w.lc().downloadAssignmentButton()})),w.Zb(3,"mat-icon"),w.Sc(4,"archive"),w.Yb(),w.Zb(5,"span"),w.Sc(6),w.mc(7,"translate"),w.Yb(),w.Yb(),w.Qc(8,Qn,8,3,"div",27),w.Yb()}2&t&&(w.Gb(1),w.tc("osPerms","assignment.can_manage"),w.Gb(5),w.Tc(w.nc(7,3,"Export as PDF")),w.Gb(2),w.tc("osPerms","core.can_manage_config"))}function jn(t,e){if(1&t){var n=w.ac();w.Zb(0,"button",29),w.hc("click",(function(){w.Ic(n);var t=w.lc(2);return t.downloadAssignmentButton(t.selectedRows)})),w.Zb(1,"mat-icon"),w.Sc(2,"archive"),w.Yb(),w.Zb(3,"span"),w.Sc(4),w.mc(5,"translate"),w.Yb(),w.Yb()}if(2&t){var a=w.lc(2);w.tc("disabled",!a.selectedRows.length),w.Gb(4),w.Tc(w.nc(5,2,"Export selected elections"))}}function En(t,e){if(1&t){var n=w.ac();w.Zb(0,"button",32),w.hc("click",(function(){return w.Ic(n),w.lc(2).deleteSelected()})),w.Zb(1,"mat-icon"),w.Sc(2,"delete"),w.Yb(),w.Zb(3,"span"),w.Sc(4),w.mc(5,"translate"),w.Yb(),w.Yb()}if(2&t){var a=w.lc(2);w.tc("disabled",!a.selectedRows.length),w.Gb(4),w.Tc(w.nc(5,2,"Delete"))}}function Un(t,e){if(1&t){var n=w.ac();w.Zb(0,"div"),w.Zb(1,"button",26),w.hc("click",(function(){return w.Ic(n),w.lc().selectAll()})),w.Zb(2,"mat-icon"),w.Sc(3,"done_all"),w.Yb(),w.Zb(4,"span"),w.Sc(5),w.mc(6,"translate"),w.Yb(),w.Yb(),w.Zb(7,"button",29),w.hc("click",(function(){return w.Ic(n),w.lc().deselectAll()})),w.Zb(8,"mat-icon"),w.Sc(9,"clear"),w.Yb(),w.Zb(10,"span"),w.Sc(11),w.mc(12,"translate"),w.Yb(),w.Yb(),w.Ub(13,"mat-divider"),w.Qc(14,jn,6,4,"button",30),w.Ub(15,"mat-divider"),w.Qc(16,En,6,4,"button",31),w.Yb()}if(2&t){var a=w.lc();w.Gb(5),w.Tc(w.nc(6,5,"Select all")),w.Gb(2),w.tc("disabled",!a.selectedRows.length),w.Gb(4),w.Tc(w.nc(12,7,"Deselect all")),w.Gb(3),w.tc("osPerms","assignment.can_manage"),w.Gb(2),w.tc("osPerms","assignment.can_manage")}}var Bn,Hn=((Bn=function(t){_inherits(n,t);var e=_createSuper(n);function n(t,a,i,o,r,c,s,l,u,b,d,m,f){var p;return _classCallCheck(this,n),(p=e.call(this,t,i,o,a)).translate=i,p.repo=r,p.promptService=c,p.filterService=s,p.sortService=l,p.pdfService=u,p.route=b,p.router=d,p.operator=m,p.vp=f,p.phaseOptions=lt.a,p.tableColumnDefinition=[{prop:"title",width:"auto"},{prop:"phase",width:"20%",minWidth:180},{prop:"candidates",width:p.singleButtonWidth}],p.filterProps=["title","candidates","assignment_related_users","tags","candidateAmount"],p.canMultiSelect=!0,p}return _createClass(n,[{key:"ngOnInit",value:function(){_get(_getPrototypeOf(n.prototype),"setTitle",this).call(this,"Elections")}},{key:"onPlusButton",value:function(){this.router.navigate(["./new"],{relativeTo:this.route})}},{key:"getColumnsHiddenInMobile",value:function(){var t=["phase","candidates"];return this.operator.hasPerms(c.b.agendaCanSeeListOfSpeakers,c.b.coreCanManageProjector)||t.push("menu"),t}},{key:"downloadAssignmentButton",value:function(t){this.pdfService.exportMultipleAssignments(t||this.repo.getViewModelList())}},{key:"deleteSelected",value:function(){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var e,n,a,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.translate.instant("Are you sure you want to delete all selected elections?"),t.next=3,this.promptService.open(e);case 3:if(!t.sent){t.next=21;break}n=_createForOfIteratorHelper(this.selectedRows),t.prev=5,n.s();case 7:if((a=n.n()).done){t.next=13;break}return i=a.value,t.next=11,this.repo.delete(i);case 11:t.next=7;break;case 13:t.next=18;break;case 15:t.prev=15,t.t0=t.catch(5),n.e(t.t0);case 18:return t.prev=18,n.f(),t.finish(18);case 21:case"end":return t.stop()}}),t,this,[[5,15,18,21]])})))}},{key:"canManageAssignments",get:function(){return this.operator.hasPerms(c.b.assignmentsCanManage)}}]),n}(Cn.a)).\u0275fac=function(t){return new(t||Bn)(w.Tb(L.d),w.Tb(kn.a),w.Tb(G.k),w.Tb(j.a),w.Tb(d.a),w.Tb(g.a),w.Tb(Yn),w.Tb(Gn),w.Tb(I),w.Tb(r.a),w.Tb(r.f),w.Tb(c.a),w.Tb(Sn.a))},Bn.\u0275cmp=w.Nb({type:Bn,selectors:[["os-assignment-list"]],features:[w.Db],decls:30,vars:24,consts:[[3,"hasMainButton","multiSelectMode","mainEvent"],[1,"title-slot"],[1,"menu-slot"],["type","button","mat-icon-button","",3,"matMenuTriggerFor"],[1,"central-info-slot"],["mat-icon-button","",3,"click"],["listStorageKey","assignments",3,"listObservableProvider","filterService","sortService","columns","filterProps","multiSelect","hiddenInMobile","selectedRows","selectedRowsChange","dataSourceChange"],["class","cell-slot fill",4,"pblNgridCellDef"],["class","cell-slot fill mat-chip-wrapper",4,"pblNgridCellDef"],["singleItemMenu","matMenu"],["matMenuContent",""],["assignmentMenu","matMenu"],[4,"ngIf"],[1,"cell-slot","fill"],["class","detail-link",3,"routerLink",4,"ngIf"],[1,"innerTable"],[1,"title-line","ellipsis-overflow"],["class","ellipsis-overflow",4,"ngIf"],[1,"detail-link",3,"routerLink"],[1,"ellipsis-overflow"],["color","primary","selected",""],[1,"cell-slot","fill","mat-chip-wrapper"],["color","accent","selected","",3,"matTooltip"],["mat-icon-button","",3,"disabled","matMenuTriggerFor","matMenuTriggerData","click"],[3,"object","menuItem"],["mat-menu-item","",3,"click",4,"osPerms"],["mat-menu-item","",3,"click"],[4,"osPerms"],["mat-menu-item","","routerLink","/settings/elections"],["mat-menu-item","",3,"disabled","click"],["mat-menu-item","",3,"disabled","click",4,"osPerms"],["mat-menu-item","","class","red-warning-text",3,"disabled","click",4,"osPerms"],["mat-menu-item","",1,"red-warning-text",3,"disabled","click"]],template:function(t,e){if(1&t&&(w.Zb(0,"os-head-bar",0),w.hc("mainEvent",(function(){return e.onPlusButton()})),w.Zb(1,"div",1),w.Zb(2,"h2"),w.Sc(3),w.mc(4,"translate"),w.Yb(),w.Yb(),w.Zb(5,"div",2),w.Zb(6,"button",3),w.Zb(7,"mat-icon"),w.Sc(8,"more_vert"),w.Yb(),w.Yb(),w.Yb(),w.Zb(9,"div",4),w.Zb(10,"button",5),w.hc("click",(function(){return e.toggleMultiSelect()})),w.Zb(11,"mat-icon"),w.Sc(12,"arrow_back"),w.Yb(),w.Yb(),w.Zb(13,"span"),w.Sc(14),w.Yb(),w.Zb(15,"span"),w.Sc(16),w.mc(17,"translate"),w.Yb(),w.Yb(),w.Yb(),w.Zb(18,"os-list-view-table",6),w.hc("selectedRowsChange",(function(t){return e.selectedRows=t}))("dataSourceChange",(function(t){return e.onDataSourceChange(t)})),w.Qc(19,xn,6,3,"div",7),w.Qc(20,An,5,3,"div",8),w.Qc(21,Nn,5,4,"div",7),w.Qc(22,Dn,4,5,"div",7),w.Yb(),w.Zb(23,"mat-menu",null,9),w.Qc(25,Fn,2,4,"ng-template",10),w.Yb(),w.Zb(26,"mat-menu",null,11),w.Qc(28,Ln,9,5,"div",12),w.Qc(29,Un,17,9,"div",12),w.Yb()),2&t){var n=w.Ec(27);w.tc("hasMainButton",e.canManageAssignments)("multiSelectMode",e.isMultiSelect),w.Gb(3),w.Tc(w.nc(4,20,"Elections")),w.Gb(3),w.tc("matMenuTriggerFor",n),w.Gb(8),w.Uc("",e.selectedRows.length,"\xa0"),w.Gb(2),w.Tc(w.nc(17,22,"selected")),w.Gb(2),w.tc("listObservableProvider",e.repo)("filterService",e.filterService)("sortService",e.sortService)("columns",e.tableColumnDefinition)("filterProps",e.filterProps)("multiSelect",e.isMultiSelect)("hiddenInMobile",e.getColumnsHiddenInMobile())("selectedRows",e.selectedRows),w.Gb(1),w.tc("pblNgridCellDef","title"),w.Gb(1),w.tc("pblNgridCellDef","phase"),w.Gb(1),w.tc("pblNgridCellDef","candidates"),w.Gb(1),w.tc("pblNgridCellDef","menu"),w.Gb(6),w.tc("ngIf",!e.isMultiSelect),w.Gb(1),w.tc("ngIf",e.isMultiSelect)}},directives:[ut.a,E.b,bt.e,dt.a,Zn.a,In.c,bt.f,bt.b,o.t,r.i,ke.d,ke.a,Jt.c,mt.a,pt.a,ft.a,bt.c,gt.a,r.g],pipes:[G.j],styles:[".title-line[_ngcontent-%COMP%]{font-weight:500;font-size:16px}.title-line[_ngcontent-%COMP%]   .icon-prefix[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{display:-ms-inline-flexbox;display:inline-flex;vertical-align:middle;font-size:16px;height:16px;width:16px}.title-line[_ngcontent-%COMP%]   .favorite-star[_ngcontent-%COMP%]{padding-right:3px}.mat-table[_ngcontent-%COMP%]{width:100%}.mat-table[_ngcontent-%COMP%]   .mat-header-row[_ngcontent-%COMP%]   .mat-column-anchor[_ngcontent-%COMP%]{display:none}.mat-table[_ngcontent-%COMP%]   .mat-row[_ngcontent-%COMP%]{position:relative}.mat-table[_ngcontent-%COMP%]   .mat-row[_ngcontent-%COMP%]   .mat-column-anchor[_ngcontent-%COMP%]{position:absolute!important;top:0;right:0;bottom:0;left:0;opacity:.1;z-index:1}.mat-table[_ngcontent-%COMP%]   .mat-row[_ngcontent-%COMP%]   .mat-column-anchor[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:block;height:100%;width:100%}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]{position:relative}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]   .fill[_ngcontent-%COMP%]{position:absolute;display:inherit;height:100%;width:100%;line-height:0}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]   .fill[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{margin-top:auto;margin-bottom:auto}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{z-index:2}.mat-table[_ngcontent-%COMP%]   .mat-table-sticky[_ngcontent-%COMP%]{z-index:3!important}.mat-chip-wrapper[_ngcontent-%COMP%]   .mat-standard-chip[_ngcontent-%COMP%]{height:auto}"],changeDetection:0}),Bn),qn=n("TZkb"),zn=n("R+Vs"),Wn=n("g4jF"),Xn=n("iCsr");function Kn(t,e){if(1&t&&(w.Zb(0,"h2"),w.Sc(1),w.Yb()),2&t){var n=w.lc();w.Gb(1),w.Tc(n.poll.title)}}function $n(t,e){if(1&t&&(w.Zb(0,"div",11),w.Zb(1,"button",12),w.Zb(2,"mat-icon"),w.Sc(3,"more_vert"),w.Yb(),w.Yb(),w.Yb()),2&t){w.lc();var n=w.Ec(9);w.Gb(1),w.tc("matMenuTriggerFor",n)}}function Jn(t,e){if(1&t&&(w.Zb(0,"span"),w.Sc(1),w.mc(2,"translate"),w.Yb()),2&t){var n=w.lc(3);w.Gb(1),w.Uc(" ",w.nc(2,1,n.poll.typeVerbose)," \xb7 ")}}function ta(t,e){if(1&t&&(w.Ub(0,"os-charts",20),w.mc(1,"async")),2&t){var n=w.lc(4);w.tc("labels",n.candidatesLabels)("data",w.nc(1,2,n.chartDataSubject))}}function ea(t,e){if(1&t&&(w.Zb(0,"div"),w.Sc(1),w.mc(2,"translate"),w.Yb()),2&t){var n=e.col;w.Gb(1),w.Uc(" ",w.nc(2,1,n.label)," ")}}function na(t,e){if(1&t&&(w.Zb(0,"div"),w.Sc(1),w.mc(2,"translate"),w.Yb()),2&t){var n=e.col;w.Gb(1),w.Uc(" ",w.nc(2,1,n.label)," ")}}function aa(t,e){if(1&t&&(w.Zb(0,"div"),w.Sc(1),w.Yb()),2&t){var n=w.lc(2).row;w.Gb(1),w.Uc(" ",n.user.getLevelAndNumber()," ")}}function ia(t,e){if(1&t&&(w.Zb(0,"div"),w.Sc(1),w.mc(2,"translate"),w.Yb()),2&t){var n=w.lc(2).row;w.Gb(1),w.Vc(" ",w.nc(2,2,"Vote weight"),": ",n.user.vote_weight," ")}}function oa(t,e){if(1&t&&(w.Zb(0,"div"),w.Sc(1),w.Zb(2,"div",26),w.Qc(3,aa,2,1,"div",2),w.Qc(4,ia,3,4,"div",2),w.Yb(),w.Yb()),2&t){var n=w.lc().row,a=w.lc(6);w.Gb(1),w.Uc(" ",n.user.getShortName()," "),w.Gb(2),w.tc("ngIf",n.user.getLevelAndNumber()),w.Gb(1),w.tc("ngIf",a.isVoteWeightActive)}}function ra(t,e){1&t&&(w.Zb(0,"div"),w.Sc(1),w.mc(2,"translate"),w.Yb()),2&t&&(w.Gb(1),w.Uc(" ",w.nc(2,1,"Anonymous")," "))}function ca(t,e){if(1&t&&(w.Zb(0,"div"),w.Qc(1,oa,5,3,"div",2),w.Qc(2,ra,3,3,"div",2),w.Yb()),2&t){var n=e.row;w.Gb(1),w.tc("ngIf",n.user),w.Gb(1),w.tc("ngIf",!n.user)}}function sa(t,e){if(1&t&&(w.Zb(0,"div",28),w.Sc(1),w.Yb()),2&t){var n=e.$implicit;w.Gb(1),w.Tc(n)}}function la(t,e){if(1&t&&(w.Zb(0,"div"),w.Qc(1,sa,2,1,"div",27),w.Yb()),2&t){var n=e.row;w.Gb(1),w.tc("ngForOf",n.votes)}}function ua(t,e){if(1&t&&(w.Zb(0,"os-list-view-table",23),w.Qc(1,ea,3,3,"div",24),w.Qc(2,na,3,3,"div",24),w.Qc(3,ca,3,2,"div",25),w.Qc(4,la,2,1,"div",25),w.Yb()),2&t){var n=w.lc(5);w.tc("listObservable",n.votesDataObservable)("columns",n.columnDefinitionSingleVotes)("filterProps",n.filterProps)("allowProjector",!1)("fullScreen",!1)("vScrollFixed",-1)("showListOfSpeakers",!1)("showMenu",!1),w.Gb(1),w.tc("pblNgridHeaderCellDef","user"),w.Gb(1),w.tc("pblNgridHeaderCellDef","votes"),w.Gb(1),w.tc("pblNgridCellDef","user"),w.Gb(1),w.tc("pblNgridCellDef","votes")}}function ba(t,e){1&t&&(w.Zb(0,"div"),w.Sc(1),w.mc(2,"translate"),w.Yb()),2&t&&(w.Gb(1),w.Uc(" ",w.nc(2,1,"The individual votes were anonymized.")," "))}function da(t,e){if(1&t&&(w.Zb(0,"div",21),w.Zb(1,"h3"),w.Sc(2),w.mc(3,"translate"),w.Yb(),w.Qc(4,ua,5,12,"os-list-view-table",22),w.Qc(5,ba,3,3,"div",2),w.Yb()),2&t){var n=w.lc(4);w.Gb(2),w.Tc(w.nc(3,3,"Single votes")),w.Gb(2),w.tc("ngIf",n.votesDataObservable),w.Gb(1),w.tc("ngIf",!n.votesDataObservable)}}function ma(t,e){if(1&t&&(w.Zb(0,"div",15),w.Ub(1,"os-assignment-poll-detail-content",16),w.Zb(2,"div",17),w.Qc(3,ta,2,4,"os-charts",18),w.Yb(),w.Qc(4,da,6,5,"div",19),w.Yb()),2&t){var n=w.lc(3);w.Gb(1),w.tc("poll",n.poll),w.Gb(2),w.tc("ngIf",n.chartDataSubject.value),w.Gb(1),w.tc("ngIf","named"===n.poll.type)}}function fa(t,e){if(1&t&&(w.Zb(0,"div"),w.Zb(1,"h1"),w.Sc(2),w.Yb(),w.Zb(3,"div"),w.Qc(4,Jn,3,3,"span",2),w.Zb(5,"span"),w.Sc(6),w.mc(7,"translate"),w.Yb(),w.Yb(),w.Qc(8,ma,5,3,"div",14),w.Yb()),2&t){var n=w.lc(2);w.Gb(2),w.Tc(n.poll.title),w.Gb(2),w.tc("ngIf","analog"!==n.poll.type),w.Gb(2),w.Uc(" ",w.nc(7,4,n.poll.stateVerbose)," "),w.Gb(2),w.tc("ngIf",n.poll&&n.poll.stateHasVotes)}}function pa(t,e){1&t&&(w.Zb(0,"span"),w.Sc(1,", "),w.Yb())}function ga(t,e){if(1&t&&(w.Zb(0,"span"),w.Sc(1),w.mc(2,"translate"),w.Qc(3,pa,2,0,"span",2),w.Yb()),2&t){var n=e.$implicit,a=e.index,i=w.lc(4);w.Gb(1),w.Uc(" ",w.nc(2,2,n.getTitle()),""),w.Gb(2),w.tc("ngIf",a<i.poll.groups.length-1)}}function ha(t,e){if(1&t&&(w.Zb(0,"small"),w.Sc(1),w.mc(2,"translate"),w.Qc(3,ga,4,4,"span",30),w.Yb()),2&t){var n=w.lc(3);w.Gb(1),w.Uc(" ",w.nc(2,2,"Groups"),": "),w.Gb(2),w.tc("ngForOf",n.poll.groups)}}function va(t,e){if(1&t&&(w.Zb(0,"small"),w.Sc(1),w.mc(2,"translate"),w.mc(3,"translate"),w.Yb()),2&t){var n=w.lc(3);w.Gb(1),w.Vc(" ",w.nc(2,2,"100% base"),": ",w.nc(3,4,n.poll.percentBaseVerbose)," ")}}function ya(t,e){if(1&t&&(w.Zb(0,"div",29),w.Qc(1,ha,4,4,"small",2),w.Qc(2,va,4,6,"small",2),w.Yb()),2&t){var n=w.lc(2);w.Gb(1),w.tc("ngIf",n.poll.groups&&n.poll.type&&"analog"!==n.poll.type),w.Gb(1),w.tc("ngIf",n.poll.onehundred_percent_base)}}function _a(t,e){if(1&t&&(w.Qc(0,fa,9,6,"div",2),w.Qc(1,ya,3,2,"div",13)),2&t){var n=w.lc();w.tc("ngIf",n.isReady),w.Gb(1),w.tc("ngIf",n.poll)}}function ka(t,e){if(1&t&&w.Ub(0,"os-projector-button",31),2&t){var n=w.lc();w.tc("menuItem",!0)("object",n.poll)}}function Sa(t,e){if(1&t){var n=w.ac();w.Zb(0,"button",32),w.hc("click",(function(){w.Ic(n);var t=w.lc();return t.openDialog(t.poll)})),w.Zb(1,"mat-icon"),w.Sc(2,"edit"),w.Yb(),w.Zb(3,"span"),w.Sc(4),w.mc(5,"translate"),w.Yb(),w.Yb()}2&t&&(w.Gb(4),w.Tc(w.nc(5,1,"Edit")))}function Ca(t,e){if(1&t){var n=w.ac();w.Zb(0,"button",32),w.hc("click",(function(){return w.Ic(n),w.lc().pseudoanonymizePoll()})),w.Zb(1,"mat-icon"),w.Sc(2,"warning"),w.Yb(),w.Zb(3,"span"),w.Sc(4),w.mc(5,"translate"),w.Yb(),w.Yb()}2&t&&(w.Gb(4),w.Tc(w.nc(5,1,"Anonymize votes")))}function Pa(t,e){if(1&t){var n=w.ac();w.Zb(0,"button",32),w.hc("click",(function(){return w.Ic(n),w.lc().deletePoll()})),w.Zb(1,"mat-icon",33),w.Sc(2,"delete"),w.Yb(),w.Zb(3,"span"),w.Sc(4),w.mc(5,"translate"),w.Yb(),w.Yb()}2&t&&(w.Gb(4),w.Tc(w.nc(5,1,"Delete")))}var Oa,Ya,wa,Ga=[{path:"",component:Hn,pathMatch:"full"},{path:"new",component:_n,data:{basePerm:c.b.assignmentsCanManage}},{path:":id",component:_n,data:{basePerm:c.b.assignmentsCanSee}},{path:"polls",children:[{path:":id",component:(Oa=function(t){_inherits(n,t);var e=_createSuper(n);function n(t,a,i,o,r,c,s,l,u,b,d,m,f){var p;return _classCallCheck(this,n),(p=e.call(this,t,a,i,o,r,c,s,l,b,d)).pollService=b,p.operator=m,p.router=f,p.filterProps=["user.getFullName"],p.isReady=!1,p.candidatesLabels=[],u.get("users_activate_vote_weight").subscribe((function(t){return p.isVoteWeightActive=t})),p}return _createClass(n,[{key:"createVotesData",value:function(){var t,e={},n=!0,a=_createForOfIteratorHelper(this.poll.options);try{for(a.s();!(t=a.n()).done;){var i,o=t.value,r=_createForOfIteratorHelper(o.votes);try{for(r.s();!(i=r.n()).done;){var c=i.value,s=c.user_id;s&&(n=!1,e[s]||(e[s]={user:c.user,votes:[]}),c.weight>0&&e[s].votes.push(this.poll.isMethodY?"Y"===c.value?o.user.getFullName():this.voteValueToLabel(c.value):"".concat(o.user.getShortName(),": ").concat(this.voteValueToLabel(c.value))))}}catch(d){r.e(d)}finally{r.f()}}}catch(d){a.e(d)}finally{a.f()}if(!n){var l,u=_createForOfIteratorHelper(this.poll.voted);try{for(u.s();!(l=u.n()).done;){var b=l.value;e[b.id]||(e[b.id]={user:b,votes:[this.translate.instant("empty vote")]})}}catch(d){u.e(d)}finally{u.f()}}this.setVotesData(Object.values(e)),this.candidatesLabels=this.pollService.getChartLabels(this.poll),this.columnDefinitionSingleVotes=[{prop:"user",label:"Participant",width:"40%",minWidth:300},{prop:"votes",label:"Votes",width:"60%",minWidth:300}],this.isReady=!0}},{key:"voteValueToLabel",value:function(t){if("Y"===t)return this.translate.instant("Yes");if("N"===t)return this.translate.instant("No");if("A"===t)return this.translate.instant("Abstain");throw new Error("voteValueToLabel received illegal arguments: "+t)}},{key:"hasPerms",value:function(){return this.operator.hasPerms(c.b.assignmentsCanManage)}},{key:"onDeleted",value:function(){this.router.navigate(["assignments",this.poll.assignment_id])}}]),n}(Wn.a),Oa.\u0275fac=function(t){return new(t||Oa)(w.Tb(L.d),w.Tb(G.k),w.Tb(j.a),w.Tb(ht.a),w.Tb(r.a),w.Tb(zn.a),w.Tb(g.a),w.Tb(st),w.Tb(St.a),w.Tb(Y.a),w.Tb(qn.a),w.Tb(c.a),w.Tb(r.f))},Oa.\u0275cmp=w.Nb({type:Oa,selectors:[["os-assignment-poll-detail"]],features:[w.Db],decls:15,vars:10,consts:[[3,"goBack","nav"],[1,"title-slot"],[4,"ngIf"],["class","menu-slot",4,"osPerms"],[1,"os-card","spacer-bottom-60"],[3,"ngTemplateOutlet"],["viewTemplate",""],["pollDetailMenu","matMenu"],[3,"menuItem","object",4,"osPerms"],["mat-menu-item","",3,"click",4,"osPerms"],["mat-menu-item","",3,"click",4,"osPerms","osPermsAnd"],[1,"menu-slot"],["type","button","mat-icon-button","",3,"matMenuTriggerFor"],["class","assignment-poll-meta",4,"ngIf"],["class","assignment-result-wrapper",4,"ngIf"],[1,"assignment-result-wrapper"],[3,"poll"],[1,"chart-wrapper"],["class","assignment-result-chart",3,"labels","data",4,"ngIf"],["class","named-result-table",4,"ngIf"],[1,"assignment-result-chart",3,"labels","data"],[1,"named-result-table"],["class","single-votes-table","listStorageKey","assignment-poll-vote",3,"listObservable","columns","filterProps","allowProjector","fullScreen","vScrollFixed","showListOfSpeakers","showMenu",4,"ngIf"],["listStorageKey","assignment-poll-vote",1,"single-votes-table",3,"listObservable","columns","filterProps","allowProjector","fullScreen","vScrollFixed","showListOfSpeakers","showMenu"],[4,"pblNgridHeaderCellDef"],[4,"pblNgridCellDef"],[1,"user-subtitle"],["class","single-vote-result",4,"ngFor","ngForOf"],[1,"single-vote-result"],[1,"assignment-poll-meta"],[4,"ngFor","ngForOf"],[3,"menuItem","object"],["mat-menu-item","",3,"click"],["color","warn"]],template:function(t,e){if(1&t&&(w.Zb(0,"os-head-bar",0),w.Zb(1,"div",1),w.Qc(2,Kn,2,1,"h2",2),w.Yb(),w.Qc(3,$n,4,1,"div",3),w.Yb(),w.Zb(4,"mat-card",4),w.Vb(5,5),w.Yb(),w.Qc(6,_a,2,2,"ng-template",null,6,w.Rc),w.Zb(8,"mat-menu",null,7),w.Qc(10,ka,1,2,"os-projector-button",8),w.Qc(11,Sa,6,3,"button",9),w.Qc(12,Ca,6,3,"button",10),w.Ub(13,"mat-divider"),w.Qc(14,Pa,6,3,"button",9),w.Yb()),2&t){var n=w.Ec(7);w.tc("goBack",!0)("nav",!1),w.Gb(2),w.tc("ngIf",!!e.poll),w.Gb(1),w.tc("osPerms","assignments.can_manage"),w.Gb(2),w.tc("ngTemplateOutlet",n),w.Gb(5),w.tc("osPerms","core.can_manage_projector"),w.Gb(1),w.tc("osPerms","assignments.can_manage"),w.Gb(1),w.tc("osPerms","assignments.can_manage")("osPermsAnd",e.poll&&"named"===e.poll.type),w.Gb(2),w.tc("osPerms","assignments.can_manage")}},directives:[ut.a,o.t,ft.a,Pt.a,o.A,bt.f,gt.a,E.b,bt.e,dt.a,Ot.a,Xn.a,Zn.a,In.h,In.c,o.s,mt.a,bt.c],pipes:[G.j,o.b],styles:['.assignment-result-wrapper .chart-wrapper{margin-top:2em}.assignment-result-wrapper .named-result-table .mat-form-field{font-size:14px;width:100%}.assignment-result-wrapper .named-result-table .single-votes-table{display:block;height:500px}.assignment-result-wrapper .named-result-table .single-votes-table .list-view-frame{height:100%}.assignment-result-wrapper .named-result-table .single-votes-table .single-vote-result+.single-vote-result{margin-top:1em}.assignment-result-wrapper .named-result-table .vote-field{text-align:center;width:100%;padding-right:12px}.assignment-poll-meta{display:grid;text-align:right;padding-top:20px}.openslides-theme .pbl-ngrid-no-data{top:10%}.openslides-theme .pbl-ngrid-header-cell:first-child{overflow:visible}.openslides-theme .pbl-ngrid-header-cell:first-child:after{content:"";display:block;position:absolute;top:0;right:-1px;height:100%}'],encapsulation:2}),Oa)}]}],Za=((Ya=function t(){_classCallCheck(this,t)}).\u0275mod=w.Rb({type:Ya}),Ya.\u0275inj=w.Qb({factory:function(t){return new(t||Ya)},imports:[[r.j.forChild(Ga)],r.j]}),Ya),Ia=n("bVYn"),Ta=n("PCNd"),Ma=((wa=function t(){_classCallCheck(this,t)}).\u0275mod=w.Rb({type:wa}),wa.\u0275inj=w.Qb({factory:function(t){return new(t||wa)},imports:[[o.c,Za,Ta.a,Ia.PollsModule]]}),wa)},bVYn:function(t,e,n){"use strict";n.r(e),n.d(e,"PollsModule",(function(){return F}));var a,i=n("ofXK"),o=n("tyNb"),r=n("AqIO"),c=n("M0z7"),s=n("wL0i"),l=n("D/ll"),u=n("+8Rz"),b=n("qnZ9"),d=n("fXoL"),m=n("sYmb"),f=((a=function(t){_inherits(n,t);var e=_createSuper(n);function n(t,a,i){var o;return _classCallCheck(this,n),(o=e.call(this,t,a)).translate=i,o.storageKey="PollList",o}return _createClass(n,[{key:"preFilter",value:function(t){return t.filter((function(t){return!t.isAnalog}))}},{key:"getFilterDefinitions",value:function(){return[{property:"state",label:this.translate.instant("State"),options:[{condition:b.e.Created,label:this.translate.instant("created")},{condition:b.e.Started,label:this.translate.instant("started")},{condition:b.e.Finished,label:this.translate.instant("finished (unpublished)")},{condition:b.e.Published,label:this.translate.instant("published")}]},{property:"hasVote",label:this.translate.instant("Votings"),options:[{condition:!1,label:this.translate.instant("Voting is currently in progress.")},{condition:!0,label:this.translate.instant("You have already voted.")}]}]}}]),n}(u.a)).\u0275fac=function(t){return new(t||a)(d.dc(r.a),d.dc(l.a),d.dc(m.k))},a.\u0275prov=d.Pb({token:a,factory:a.\u0275fac,providedIn:"root"}),a),p=n("PoOO"),g=n("jhN1"),h=n("dNgK"),v=n("mksl"),y=n("0Obk"),_=n("dRZP"),k=n("NFeN"),S=n("Qu3c");function C(t,e){if(1&t&&d.Ub(0,"a",5),2&t){var n=d.lc().row;d.tc("routerLink",n.parentLink)}}function P(t,e){if(1&t&&(d.Zb(0,"div",3),d.Qc(1,C,1,1,"a",4),d.Zb(2,"span"),d.Sc(3),d.Yb(),d.Yb()),2&t){var n=e.row,a=d.lc();d.Gb(1),d.tc("ngIf",!a.isMultiSelect),d.Gb(2),d.Tc(n.title)}}function O(t,e){if(1&t&&d.Ub(0,"a",5),2&t){var n=d.lc().row;d.tc("routerLink",n.parentLink)}}function Y(t,e){if(1&t&&(d.Zb(0,"div",3),d.Qc(1,O,1,1,"a",4),d.Zb(2,"span"),d.Sc(3),d.Yb(),d.Yb()),2&t){var n=e.row,a=d.lc();d.Gb(1),d.tc("ngIf",!a.isMultiSelect),d.Gb(2),d.Tc(n.getContentObject().getListTitle())}}function w(t,e){if(1&t&&d.Ub(0,"a",5),2&t){var n=d.lc().row;d.tc("routerLink",n.parentLink)}}function G(t,e){if(1&t&&(d.Zb(0,"div",3),d.Qc(1,w,1,1,"a",4),d.Zb(2,"span"),d.Sc(3),d.mc(4,"translate"),d.Yb(),d.Yb()),2&t){var n=e.row,a=d.lc();d.Gb(1),d.tc("ngIf",!a.isMultiSelect),d.Gb(2),d.Tc(d.nc(4,2,n.stateVerbose))}}function Z(t,e){1&t&&(d.Zb(0,"mat-icon",8),d.mc(1,"translate"),d.Sc(2," check_circle "),d.Yb()),2&t&&d.uc("matTooltip",d.nc(1,1,"You have already voted."))}function I(t,e){1&t&&(d.Zb(0,"mat-icon",9),d.mc(1,"translate"),d.Sc(2," warning "),d.Yb()),2&t&&d.uc("matTooltip",d.nc(1,1,"Voting is currently in progress."))}function T(t,e){if(1&t&&(d.Zb(0,"div",3),d.Qc(1,Z,3,3,"mat-icon",6),d.Qc(2,I,3,3,"mat-icon",7),d.Yb()),2&t){var n=e.row;d.Gb(1),d.tc("ngIf",n.hasVote),d.Gb(1),d.tc("ngIf",!n.hasVote&&null!==n.hasVote)}}var M,x,A,N=[{path:"",component:(M=function(t){_inherits(n,t);var e=_createSuper(n);function n(t,a,i,o,r,c,s){var l,u;return _classCallCheck(this,n),(u=e.call(this,r,c,s,o)).polls=t,u.filterService=a,u.votingService=i,u.storage=o,u.tableColumnDefinition=[{prop:"title",width:"auto"},{prop:"classType",width:"auto"},{prop:"state",width:"auto"},{prop:"votability",width:"25px"}],u.filterProps=["title","state"],_get((l=_assertThisInitialized(u),_getPrototypeOf(n.prototype)),"setTitle",l).call(l,"List of electronic votes"),u}return n}(s.a),M.\u0275fac=function(t){return new(t||M)(d.Tb(p.a),d.Tb(f),d.Tb(c.b),d.Tb(r.a),d.Tb(g.d),d.Tb(m.k),d.Tb(h.a))},M.\u0275cmp=d.Nb({type:M,selectors:[["os-poll-list"]],features:[d.Db],decls:9,vars:12,consts:[[1,"title-slot"],["listStorageKey","polls",3,"listObservableProvider","vScrollFixed","columns","filterProps","filterService"],["class","cell-slot fill",4,"pblNgridCellDef"],[1,"cell-slot","fill"],["class","detail-link",3,"routerLink",4,"ngIf"],[1,"detail-link",3,"routerLink"],["color","accent",3,"matTooltip",4,"ngIf"],["color","warn",3,"matTooltip",4,"ngIf"],["color","accent",3,"matTooltip"],["color","warn",3,"matTooltip"]],template:function(t,e){1&t&&(d.Zb(0,"os-head-bar"),d.Zb(1,"div",0),d.Sc(2),d.mc(3,"translate"),d.Yb(),d.Yb(),d.Zb(4,"os-list-view-table",1),d.Qc(5,P,4,2,"div",2),d.Qc(6,Y,4,2,"div",2),d.Qc(7,G,5,4,"div",2),d.Qc(8,T,3,2,"div",2),d.Yb()),2&t&&(d.Gb(2),d.Tc(d.nc(3,10,"List of electronic votes")),d.Gb(2),d.tc("listObservableProvider",e.polls)("vScrollFixed",64)("columns",e.tableColumnDefinition)("filterProps",e.filterProps)("filterService",e.filterService),d.Gb(1),d.tc("pblNgridCellDef","title"),d.Gb(1),d.tc("pblNgridCellDef","classType"),d.Gb(1),d.tc("pblNgridCellDef","state"),d.Gb(1),d.tc("pblNgridCellDef","votability"))},directives:[v.a,y.a,_.c,i.t,o.i,k.a,S.c],pipes:[m.j],styles:[""]}),M),pathMatch:"full"}],V=((x=function t(){_classCallCheck(this,t)}).\u0275mod=d.Rb({type:x}),x.\u0275inj=d.Qb({factory:function(t){return new(t||x)},imports:[[o.j.forChild(N)],o.j]}),x),D=n("PCNd"),F=((A=function t(){_classCallCheck(this,t)}).\u0275mod=d.Rb({type:A}),A.\u0275inj=d.Qb({factory:function(t){return new(t||A)},imports:[[i.c,V,D.a]]}),A)},g4jF:function(t,e,n){"use strict";n.d(e,"a",(function(){return b}));var a=n("mrSG"),i=n("2Vo4"),o=n("Cfvw"),r=n("pLZG"),c=n("lJxs"),s=n("g96W"),l=n("mV3u"),u=n("fXoL"),b=function(){var t=function(t){_inherits(n,t);var e=_createSuper(n);function n(t,a,o,r,c,l,u,b,d,m){var f;return _classCallCheck(this,n),(f=e.call(this,t,a,o)).translate=a,f.repo=r,f.route=c,f.groupRepo=l,f.promptService=u,f.pollDialog=b,f.pollService=d,f.votesRepo=m,f.userGroups=[],f.groupObservable=null,f.voteOptionStyle={Y:{css:"yes",icon:"thumb_up"},N:{css:"no",icon:"thumb_down"},A:{css:"abstain",icon:"trip_origin"}},f.poll=null,f.labels=[],f.chartDataSubject=new i.a(null),f.optionsLoaded=new s.a,f.setup(),f}return _createClass(n,[{key:"setup",value:function(){return Object(a.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.optionsLoaded;case 2:this.votesRepo.getViewModelListObservable().pipe(Object(r.a)((function(){return e.poll&&e.canSeeVotes})),Object(c.a)((function(t){return t.filter((function(t){return t.option.poll_id===e.poll.id}))})),Object(r.a)((function(t){return!!t.length}))).subscribe((function(){e.createVotesData()}));case 3:case"end":return t.stop()}}),t,this)})))}},{key:"ngOnInit",value:function(){var t=this;this.findComponentById(),this.groupObservable=this.groupRepo.getViewModelListObservable(),this.subscriptions.push(this.groupRepo.getViewModelListObservable().subscribe((function(e){return t.userGroups=e})))}},{key:"deletePoll",value:function(){return Object(a.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var e,n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.translate.instant("Are you sure you want to delete this vote?"),t.next=3,this.promptService.open(e);case 3:if(t.t0=t.sent,!t.t0){t.next=6;break}this.repo.delete(this.poll).then((function(){return n.onDeleted()}),this.raiseError);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"pseudoanonymizePoll",value:function(){return Object(a.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.translate.instant("Are you sure you want to anonymize all votes? This cannot be undone."),t.next=3,this.promptService.open(e);case 3:if(t.t0=t.sent,!t.t0){t.next=6;break}this.repo.pseudoanonymize(this.poll).catch(this.raiseError);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"openDialog",value:function(t){this.pollDialog.openDialog(t)}},{key:"onStateChanged",value:function(){}},{key:"setVotesData",value:function(t){this.votesDataObservable=t.every((function(t){return!t.user}))?null:Object(o.a)([t])}},{key:"initChartData",value:function(){this.chartDataSubject.next(this.pollService.generateChartData(this.poll))}},{key:"findComponentById",value:function(){var t=this,e=this.route.snapshot.params;e&&e.id&&this.subscriptions.push(this.repo.getViewModelObservable(e.id).subscribe((function(e){e&&(t.poll=e,t.createVotesData(),t.initChartData(),t.optionsLoaded.resolve())})))}},{key:"canSeeVotes",get:function(){return this.hasPerms&&this.poll.isFinished||this.poll.isPublished}}]),n}(l.a);return t.\u0275fac=function(t){u.gc()},t.\u0275dir=u.Ob({type:t,features:[u.Db]}),t}()},wL0i:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var a=function(t){_inherits(n,t);var e=_createSuper(n);function n(t,a,i,o){var r;return _classCallCheck(this,n),(r=e.call(this,t,a,i)).storage=o,r.canMultiSelect=!1,r._multiSelectMode=!1,r.singleButtonWidth="40px",r.badgeButtonWidth="45px",r.selectedRows=[],r}return _createClass(n,[{key:"onDataSourceChange",value:function(t){this.dataSource=t}},{key:"toggleMultiSelect",value:function(){!this.canMultiSelect||this.isMultiSelect?(this._multiSelectMode=!1,this.deselectAll()):this._multiSelectMode=!0}},{key:"selectAll",value:function(){var t;(t=this.dataSource.selection).select.apply(t,_toConsumableArray(this.dataSource.filteredData))}},{key:"deselectAll",value:function(){this.dataSource&&this.dataSource.selection.clear()}},{key:"isMultiSelect",get:function(){return this._multiSelectMode}}]),n}(n("mV3u").a)}}]);