(window.webpackJsonp=window.webpackJsonp||[]).push([[20,38],{"6Ehv":function(t,e,n){"use strict";n.d(e,"a",(function(){return P}));var i=n("InfO"),s=n("+KbT"),o=n("+az0"),a=n("fXoL"),c=n("3Xi6"),l=n("ofXK"),r=n("3Pt+"),b=n("bSwM"),d=n("kmnG"),m=n("d3UM"),u=n("FKr1"),p=n("oqD5"),g=n("sYmb");function h(t,e){if(1&t&&(a.Zb(0,"mat-option",7),a.Zb(1,"span"),a.Sc(2),a.mc(3,"translate"),a.Yb(),a.Yb()),2&t){const t=e.$implicit;a.tc("value",t.key),a.Gb(2),a.Tc(a.nc(3,2,t.name))}}function f(t,e){if(1&t&&(a.Zb(0,"div",2),a.Zb(1,"mat-form-field"),a.Ub(2,"os-search-value-selector",8),a.mc(3,"translate"),a.Yb(),a.Yb()),2&t){const t=a.lc(4);a.tc("formGroup",t.form),a.Gb(2),a.uc("placeholder",a.nc(3,5,"Parent agenda item")),a.tc("multiple",!1)("includeNone",!0)("inputListValues",t.itemObserver)}}function v(t,e){if(1&t&&(a.Xb(0),a.Zb(1,"div"),a.Zb(2,"mat-form-field",2),a.Zb(3,"mat-select",4),a.mc(4,"translate"),a.Qc(5,h,4,4,"mat-option",5),a.Yb(),a.Yb(),a.Yb(),a.Qc(6,f,4,7,"div",6),a.Wb()),2&t){const t=a.lc(3);a.Gb(2),a.tc("formGroup",t.form),a.Gb(1),a.uc("placeholder",a.nc(4,4,"Agenda visibility")),a.Gb(2),a.tc("ngForOf",t.ItemVisibilityChoices),a.Gb(1),a.tc("ngIf",t.itemObserver.value.length>0)}}function S(t,e){if(1&t&&(a.Xb(0),a.Zb(1,"div",2),a.Zb(2,"p"),a.Zb(3,"mat-checkbox",3),a.Zb(4,"span"),a.Sc(5),a.mc(6,"translate"),a.Yb(),a.Yb(),a.Yb(),a.Yb(),a.Qc(7,v,7,6,"ng-container",1),a.Wb()),2&t){const t=a.lc(2);a.Gb(1),a.tc("formGroup",t.form),a.Gb(4),a.Tc(a.nc(6,3,"Add to agenda")),a.Gb(2),a.tc("ngIf",!!t.checkbox.value)}}function _(t,e){if(1&t&&(a.Xb(0),a.Qc(1,S,8,5,"ng-container",1),a.Wb()),2&t){const t=a.lc();a.Gb(1),a.tc("ngIf",t.showForm)}}let P=(()=>{class t{constructor(t,e){this.configService=t,this.itemRepo=e,this.showForm=!1,this.ItemVisibilityChoices=o.b}ngOnInit(){this.checkbox=this.form.controls.agenda_create,this.configService.get("agenda_item_creation").subscribe(t=>{if("always"===t)this.showForm=!0,this.checkbox.disable(),this.form.patchValue({agenda_create:!0});else if("never"===t)this.showForm=!1,this.checkbox.disable(),this.form.patchValue({agenda_create:!1});else{const e="default_yes"===t;this.showForm=!0,this.checkbox.enable(),this.form.patchValue({agenda_create:e})}}),this.configService.get("agenda_new_items_default_visibility").subscribe(t=>{this.form.get("agenda_type").setValue(+t)}),this.itemObserver=this.itemRepo.getViewModelListBehaviorSubject()}}return t.\u0275fac=function(e){return new(e||t)(a.Tb(s.a),a.Tb(i.a))},t.\u0275cmp=a.Nb({type:t,selectors:[["os-agenda-content-object-form"]],inputs:{form:"form"},decls:1,vars:1,consts:[[4,"osPerms"],[4,"ngIf"],[3,"formGroup"],["formControlName","agenda_create"],["formControlName","agenda_type",3,"placeholder"],[3,"value",4,"ngFor","ngForOf"],[3,"formGroup",4,"ngIf"],[3,"value"],["formControlName","agenda_parent_id",3,"multiple","includeNone","placeholder","inputListValues"]],template:function(t,e){1&t&&a.Qc(0,_,2,1,"ng-container",0),2&t&&a.tc("osPerms","agenda.can_manage")},directives:[c.a,l.t,r.t,r.k,b.a,r.s,r.i,d.c,m.a,l.s,u.n,p.a],pipes:[g.j],styles:[""]}),t})()},BBYV:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var i=n("3Y4h"),s=n("fXoL");let o=(()=>{class t{constructor(){this.LI_MARGIN_BOTTOM=8,this.LINE_HEIGHT=1.25,this.P_MARGIN_BOTTOM=4,this.H_MARGIN_TOP=10,this.elementStyles={b:["font-weight:bold"],strong:["font-weight:bold"],u:["text-decoration:underline"],em:["font-style:italic"],i:["font-style:italic"],h1:["font-size:14","font-weight:bold"],h2:["font-size:12","font-weight:bold"],h3:["font-size:10","font-weight:bold"],h4:["font-size:10","font-style:italic"],h5:["font-size:10"],h6:["font-size:10"],a:["color:blue","text-decoration:underline"],strike:["text-decoration:line-through"],del:["color:red","text-decoration:line-through"],ins:["color:green","text-decoration:underline"]},this.classStyles={delete:["color:red","text-decoration:line-through"],insert:["color:green","text-decoration:underline"],paragraphcontext:["color:grey"]}}getMarginTop(t){switch(t){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return this.H_MARGIN_TOP;default:return 0}}getMarginBottom(t){switch(t){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":case"li":default:return this.P_MARGIN_BOTTOM}}addPlainText(t){return{columns:[{stack:this.convertHtml(t,i.d.None)}]}}convertHtml(t,e){const n=[];this.lineNumberingMode=e||i.d.None;const s=(new DOMParser).parseFromString(t,"text/html"),o=Array.from(s.body.childNodes);for(const i of o){const t=this.parseElement(i);n.push(t)}return n}parseElement(t,e){const n=t.nodeName.toLowerCase();let s,o=[];if(e=e||[],t.getAttribute){const n=t.getAttribute("style"),i=t.getAttribute("class");if(n&&(e=n.split(";").map(t=>t.replace(/\s/g,"")).concat(e)),i){o=i.toLowerCase().split(" ");for(const t of o)this.classStyles[t]&&this.classStyles[t].forEach(t=>{e.push(t)})}}switch(n){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":case"li":case"p":case"div":{const a=this.parseChildren(t,e);this.lineNumberingMode!==i.d.Outside||o.includes("insert")?(s=this.create("text"),s.text=a):(s=this.create("stack"),s.stack=a),s.margin=[0,0,0,0],s.margin[1]=this.getMarginTop(n),s.margin[3]=this.getMarginBottom(n),this.lineNumberingMode===i.d.Outside&&o.includes("insert")&&(s.margin[0]=20,s.margin[3]=this.P_MARGIN_BOTTOM),o.includes("os-split-before")&&(s.listType="none"),(o.includes("os-split-after")||this.withSublist(t))&&(s.margin[3]=0),s.lineHeight=this.LINE_HEIGHT,s=Object.assign(Object.assign(Object.assign({},s),this.computeStyle(e)),this.computeStyle(this.elementStyles[n]));break}case"a":case"b":case"strong":case"u":case"em":case"i":case"ins":case"del":case"strike":{const i=this.parseChildren(t,e.concat(this.elementStyles[n]));s=this.create("text"),s.text=i;break}case"span":if(t.getAttribute("data-line-number")&&!this.isInsideAList(t)){if(this.lineNumberingMode===i.d.Inside);else if(this.lineNumberingMode===i.d.Outside){const e=t.getAttribute("data-line-number");s={columns:[this.getLineNumberObject({lineNumber:+e}),{text:[]}]}}}else{const n=this.parseChildren(t,e);s=Object.assign(Object.assign({},this.create("text")),this.computeStyle(e)),s.text=n}break;case"br":if(this.lineNumberingMode===i.d.None&&o.includes("os-line-break")||this.lineNumberingMode===i.d.Outside&&this.isInsideAList(t))break;s=this.create("text"),s.text="\n",s.lineHeight=this.LINE_HEIGHT;break;case"ul":case"ol":{const o=this.create(n);if("ol"===n){const e=t.getAttribute("start");e&&(o.start=parseInt(e,10))}if(this.lineNumberingMode===i.d.Outside){const i=this.extractLineNumbers(t),a=this.cleanLineNumbers(t),c=this.parseChildren(a,e);if(i.length>0){const e={columns:[{width:20,stack:[]}],margin:[0,0,0,0]};this.isFakeList(t)&&(e.margin[3]=-this.LI_MARGIN_BOTTOM);for(const t of i)e.columns[0].stack.push(this.getLineNumberObject(t));o[n]=c,e.columns.push(o),s=e}else o.margin=[20,0,0,0],s=o,s[n]=c}else{const i=this.parseChildren(t,e);s=o,s[n]=i}break}default:s=Object.assign(Object.assign({},this.create("text",t.textContent.replace(/\n/g,""))),this.computeStyle(e))}return s}parseChildren(t,e){const n=Array.from(t.childNodes),s=[];if(n.length>0)for(const o of n)if("#text"!==o.nodeName||""!==o.textContent.trim()){const n=this.parseElement(o,e),a=t.firstChild;if(this.lineNumberingMode===i.d.Outside&&o&&o.classList&&o.classList.contains("os-line-number"))s.push(n);else if(this.lineNumberingMode===i.d.Outside&&a&&a.classList&&a.classList.contains("os-line-number")){const t=s.pop();t.columns[1].text.push(n),s.push(t)}else s.push(n)}return s}getLineNumberObject(t){return{width:20,text:[{text:" ",fontSize:10,decoration:""},{text:t.lineNumber,color:"gray",fontSize:8}],marginBottom:t.marginBottom,lineHeight:this.LINE_HEIGHT}}withSublist(t){return"li"===t.nodeName.toLowerCase()&&Array.from(t.children).some(t=>"ul"===t.nodeName.toLowerCase())}cleanLineNumbers(t){const e=t.cloneNode(!0),n=e.childNodes;for(let i=0;i<n.length;i++)if(this.getLineNumber(n[i])&&n[i].remove(),n[i].childNodes.length>0){const t=this.cleanLineNumbers(n[i]);e.replaceChild(t,n[i])}return e}extractLineNumbers(t){let e=[];const n=this.getLineNumber(t);if(n)e.push({lineNumber:n});else if("BR"===t.nodeName)this.getLineNumber(t.nextSibling)||e.push({lineNumber:""});else{const n=Array.from(t.childNodes);let i=n.length,s=[];for(let t=0;t<n.length;t++)s=s.concat(this.extractLineNumbers(n[t])),n.length<i&&(t-=i-n.length,i=n.length);s.length&&"LI"===t.nodeName?s[s.length-1].marginBottom=this.LI_MARGIN_BOTTOM:s.length&&"LI"===t.parentNode.nodeName&&(s[s.length-1].marginBottom=this.P_MARGIN_BOTTOM),e=e.concat(s)}return e}isInsideAList(t){let e=t.parentNode;for(;null!==e;){if("UL"===e.nodeName||"OL"===e.nodeName)return!0;e=e.parentNode}return!1}isFakeList(t){if(t.firstElementChild&&t.classList.contains("os-split-after")){const e=t.firstElementChild,n=t.childNodes[t.childNodes.length-1],i="LI"===e.nodeName&&e.classList.contains("os-split-before"),s="LI"===n.nodeName&&n.classList.contains("os-split-after");return i||s}return!1}getLineNumber(t){if(t&&"SPAN"===t.nodeName&&t.getAttribute("class")&&t.getAttribute("class").indexOf("os-line-number")>-1)return parseInt(t.getAttribute("data-line-number"),10)}computeStyle(t){const e={};if(t&&t.length>0)for(const n of t){const t=n.trim().toLowerCase().split(":"),i=t[0],s=t[1];if(2===t.length)switch(i){case"padding-left":e.margin=[parseInt(s,10),0,0,0];break;case"font-size":e.fontSize=parseInt(s,10);break;case"text-align":switch(s){case"right":case"center":case"justify":e.alignment=s}break;case"font-weight":switch(s){case"bold":e.bold=!0}break;case"text-decoration":switch(s){case"underline":e.decoration="underline";break;case"line-through":e.decoration="lineThrough"}break;case"font-style":switch(s){case"italic":e.italics=!0}break;case"color":e.color=this.parseColor(s);break;case"background-color":e.background=this.parseColor(s)}}return e}parseColor(t){const e=new RegExp("^#([0-9a-f]{3}|[0-9a-f]{6})$"),n=new RegExp("^rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)$"),i=new RegExp("^[a-z]+$");if(e.test(t))return t;if(n.test(t)){const e=n.exec(t).slice(1);for(let t=0;t<3;t++){let n=parseInt(e[t],10);n>255&&(n=255);let i="0"+n.toString(16);i=i.slice(-2),e[t]=i}return"#"+e.join("")}return i.test(t)||console.error('Could not parse color "'+t+'"'),t}create(t,e){const n={};return n[t]=e||[],n}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=s.Pb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},DNKu:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n("mrSG"),s=n("TG9O"),o=n("qnZ9"),a=n("Izkr"),c=n("fXoL"),l=n("0IaG");let r=(()=>{class t{constructor(t,e){this.dialog=t,this.mapper=e}openDialog(t){return Object(i.a)(this,void 0,void 0,(function*(){const e=this.dialog.open(this.dialogComponent,Object.assign({data:t},a.c)),n=yield e.afterClosed().toPromise();if(n){const e=this.mapper.getRepository(t.collectionString);if(t.poll){let i=n;t.state!==o.e.Created&&(i={title:n.title,onehundred_percent_base:n.onehundred_percent_base,majority_method:n.majority_method,description:n.description},t.type===o.f.Analog&&(i=Object.assign(Object.assign({},i),{votes:n.votes,publish_immediately:n.publish_immediately}))),yield e.patch(i,t)}else yield e.create(n)}}))}}return t.\u0275fac=function(e){return new(e||t)(c.dc(l.b),c.dc(s.a))},t.\u0275prov=c.Pb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},JAMN:function(t,e,n){"use strict";n.d(e,"a",(function(){return Y}));var i=n("fXoL"),s=n("kmnG"),o=n("lJxs"),a=n("SSyl"),c=n("aAo1"),l=n("Izkr"),r=n("3Pt+"),b=n("u47x"),d=n("0IaG"),m=n("ofXK"),u=n("oqD5"),p=n("3Xi6"),g=n("bTqV"),h=n("NFeN"),f=n("GTZY"),v=n("sYmb");function S(t,e){if(1&t){const t=i.ac();i.Zb(0,"button",5),i.hc("click",(function(){i.Ic(t);const e=i.lc(2),n=i.Ec(2);return e.openUploadDialog(n)})),i.Zb(1,"mat-icon"),i.Sc(2,"cloud_upload"),i.Yb(),i.Yb()}}function _(t,e){if(1&t&&(i.Zb(0,"div",2),i.Zb(1,"mat-form-field"),i.Ub(2,"os-search-value-selector",3),i.mc(3,"translate"),i.Yb(),i.Qc(4,S,3,0,"button",4),i.Yb()),2&t){const t=i.lc();i.Gb(2),i.uc("placeholder",i.nc(3,5,"Attachments")),i.tc("multiple",!0)("formControl",t.contentForm)("inputListValues",t.mediaFileList),i.Gb(2),i.tc("osPerms","mediafiles.can_manage")}}function P(t,e){if(1&t){const t=i.ac();i.Zb(0,"h1",6),i.Zb(1,"span"),i.Sc(2),i.mc(3,"translate"),i.Yb(),i.Yb(),i.Zb(4,"os-media-upload-content",7),i.hc("uploadSuccessEvent",(function(e){return i.Ic(t),i.lc().uploadSuccess(e)}))("errorEvent",(function(e){return i.Ic(t),i.lc().uploadError(e)})),i.Yb()}2&t&&(i.Gb(2),i.Tc(i.nc(3,1,"Upload files")))}let Y=(()=>{class t extends c.a{constructor(t,e,n,s,o,a){super(t,e,n,s),this.ngControl=s,this.dialogService=o,this.mediaService=a,this.errorHandler=new i.p}get empty(){return!this.contentForm.value.length}get controlType(){return"attachment-control"}ngOnInit(){this.mediaFileList=this.mediaService.getViewModelListObservable().pipe(Object(o.a)(t=>t.filter(t=>!t.is_directory)))}openUploadDialog(t){this.dialogRef=this.dialogService.open(t,Object.assign(Object.assign({},l.c),{disableClose:!1}))}uploadSuccess(t){const e=[...this.contentForm.value,...t];this.updateForm(e),this.dialogRef.close()}uploadError(t){this.errorHandler.emit(t)}onContainerClick(t){}initializeForm(){this.contentForm=this.fb.control([])}updateForm(t){this.contentForm.setValue(t||[])}}return t.\u0275fac=function(e){return new(e||t)(i.Tb(r.f),i.Tb(b.h),i.Tb(i.m),i.Tb(r.r,10),i.Tb(d.b),i.Tb(a.a))},t.\u0275cmp=i.Nb({type:t,selectors:[["os-attachment-control"]],outputs:{errorHandler:"errorHandler"},features:[i.Fb([{provide:s.d,useExisting:t}]),i.Db],decls:3,vars:1,consts:[["class","attachment-container",4,"ngIf"],["uploadDialog",""],[1,"attachment-container"],[1,"selector",3,"multiple","placeholder","formControl","inputListValues"],["type","button","mat-icon-button","",3,"click",4,"osPerms"],["type","button","mat-icon-button","",3,"click"],["mat-dialog-title",""],[3,"uploadSuccessEvent","errorEvent"]],template:function(t,e){1&t&&(i.Qc(0,_,5,7,"div",0),i.Qc(1,P,5,3,"ng-template",null,1,i.Rc)),2&t&&i.tc("ngIf",e.contentForm)},directives:[m.t,s.c,u.a,r.s,r.h,p.a,g.b,h.a,d.i,f.a],pipes:[v.j],styles:["[_nghost-%COMP%]{width:100%}[_nghost-%COMP%]   .attachment-container[_ngcontent-%COMP%]{-ms-flex-pack:justify;justify-content:space-between;display:-ms-flexbox;display:flex}[_nghost-%COMP%]   .attachment-container[_ngcontent-%COMP%]   .selector[_ngcontent-%COMP%]{width:95%}[_nghost-%COMP%]   .attachment-container[_ngcontent-%COMP%]   .mat-icon-button[_ngcontent-%COMP%]{top:20px}"],changeDetection:0}),t})()},QFkl:function(t,e,n){"use strict";n.r(e),n.d(e,"AssignmentsModule",(function(){return vi}));var i=n("ofXK"),s=n("tyNb"),o=n("OwvW"),a=n("mrSG"),c=n("3Pt+"),l=n("2Vo4"),r=n("InfO"),b=n("ctLh"),d=n("SSyl"),m=n("lv9T"),u=n("ZDbo"),p=n("F48D"),g=n("2BSV"),h=n("mV3u"),f=n("f3I0"),v=n("a9GI"),S=n("BBYV"),_=n("HRp2"),P=n("j7f2"),Y=n("6ako"),G=n("QUb3"),O=n("o7cs"),Z=n("fXoL"),C=n("sYmb");let w=(()=>{class t{constructor(t,e,n,i,s,o){this.translate=t,this.htmlToPdfService=e,this.pollKeyVerbose=n,this.parsePollNumber=i,this.pollPercentBase=s,this.assignmentPollService=o}assignmentToDocDef(t){return[this.createTitle(t),this.createPreamble(t),this.createDescription(t),this.createCandidateList(t),this.createPollResultTable(t)]}createTitle(t){return{text:t.title,style:"title"}}createPreamble(t){return{text:[{text:this.translate.instant("Number of persons to be elected")+": ",bold:!0,style:"textItem"},{text:""+t.open_posts,style:"textItem"}]}}createDescription(t){if(t.description){const e=this.htmlToPdfService.addPlainText(t.description);return[{text:this.translate.instant("Description")+": ",bold:!0,style:"textItem"},e]}return{}}createCandidateList(t){if(2!==t.phase){const e=t.assignment_related_users.sort((t,e)=>t.weight-e.weight),n=this.translate.instant("Candidates")+": ",i=e.map(t=>({text:t.user.full_name,margin:[0,0,0,10]}));return{columns:[{text:n,bold:!0,width:"25%",style:"textItem"},{[t.number_poll_candidates?"ol":"ul"]:i,style:"textItem"}]}}return{}}createPollResultTable(t){const e=[];for(const n of t.polls)if(n.isPublished){const t=[];e.push({text:n.title,bold:!0,style:"textItem",margin:[0,15,0,0]}),t.push([{text:this.translate.instant("Candidates"),style:"tableHeader"},{text:this.translate.instant("Votes"),style:"tableHeader"}]);const i=this.assignmentPollService.generateTableData(n);for(const e of i){const i=this.translate.instant(this.pollKeyVerbose.transform(e.votingOption)),s=this.getPollResult(e,n);t.push([{text:i},{text:s}])}e.push({table:{widths:["64%","33%"],headerRows:1,body:t},layout:"switchColorTableLayout"})}return e}getPollResult(t,e){return t.value.filter(t=>e.pollmethod===_.b.Votes?"no"!==t.vote&&"abstain"!==t.vote:e.pollmethod!==_.b.YN||"abstain"!==t.vote).map(t=>{const n=this.translate.instant(this.pollKeyVerbose.transform(t.vote)),i=this.parsePollNumber.transform(t.amount),s=this.pollPercentBase.transform(t.amount,e);return`${n}${n?": ":""}${i} ${t.showPercent&&s?s:""}`}).join("\n")}}return t.\u0275fac=function(e){return new(e||t)(Z.dc(C.k),Z.dc(S.a),Z.dc(Y.a),Z.dc(P.a),Z.dc(G.a),Z.dc(O.a))},t.\u0275prov=Z.Pb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),M=(()=>{class t{constructor(t,e,n){this.translate=t,this.assignmentPdfService=e,this.pdfDocumentService=n}exportSingleAssignment(t){const e=this.assignmentPdfService.assignmentToDocDef(t),n=`${this.translate.instant("Election")}_${t.title}`;this.pdfDocumentService.download(e,n,{title:n})}exportMultipleAssignments(t){const e=this.createDocOfMultipleAssignments(t),n=this.translate.instant("Elections");this.pdfDocumentService.download(e,n,{title:n})}createDocOfMultipleAssignments(t){const e=[],n=t.map((e,n)=>{try{const i=this.assignmentPdfService.assignmentToDocDef(e);return i[0].id=""+e.id,n<t.length-1?[i,this.pdfDocumentService.getPageBreak()]:[i]}catch(i){const t=`${this.translate.instant("Error during PDF creation of election:")} ${e.title}`;throw console.error(t+"\nDebugInfo:\n",i),new v.c(t)}});return t.length>1&&e.push(this.pdfDocumentService.createTitle("assignments_pdf_title"),this.pdfDocumentService.createPreamble("assignments_pdf_preamble"),this.createToc(t)),e.push(n),e}createToc(t){const e=[],n={text:this.translate.instant("Table of contents"),style:"heading2"},i=t.map((t,e)=>this.pdfDocumentService.createTocLine(""+(e+1),t.title,""+t.id));return e.push(this.pdfDocumentService.createTocTableDef(i)),[n,e,this.pdfDocumentService.getPageBreak()]}}return t.\u0275fac=function(e){return new(e||t)(Z.dc(C.k),Z.dc(w),Z.dc(v.b))},t.\u0275prov=Z.Pb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var y=n("TG9O"),T=n("DNKu"),I=n("0IaG"),k=n("Kj3r"),x=n("/uUt"),N=n("qnZ9"),V=n("YIhf"),A=n("aOHa"),D=n("b1ae"),F=n("5NaA"),Q=n("jhN1"),L=n("dNgK"),j=n("bTqV"),R=n("bSwM"),E=n("acT5"),U=n("kmnG");const B=["pollForm"];function H(t,e){if(1&t&&(Z.Zb(0,"span"),Z.Sc(1),Z.Yb()),2&t){const t=Z.lc().$implicit;Z.Gb(1),Z.Tc(t.user.getFullName())}}function q(t,e){1&t&&(Z.Zb(0,"span"),Z.Sc(1),Z.mc(2,"translate"),Z.Yb()),2&t&&(Z.Gb(1),Z.Tc(Z.nc(2,1,"Unknown user")))}function $(t,e){if(1&t&&(Z.Zb(0,"div",15),Z.Ub(1,"os-check-input",16),Z.mc(2,"translate"),Z.mc(3,"translate"),Z.Yb()),2&t){const t=e.$implicit,n=Z.lc().$implicit,i=Z.lc(2);Z.tc("formGroupName",n.user_id),Z.Gb(1),Z.tc("placeholder",Z.nc(2,5,i.voteValueVerbose[t]))("checkboxValue",-1)("checkboxLabel",Z.nc(3,7,"majority"))("formControlName",t)}}function z(t,e){if(1&t&&(Z.Zb(0,"div",13),Z.Zb(1,"div"),Z.Qc(2,H,2,1,"span",2),Z.Qc(3,q,3,3,"span",2),Z.Yb(),Z.Zb(4,"div"),Z.Qc(5,$,4,9,"div",14),Z.Yb(),Z.Yb()),2&t){const t=e.$implicit,n=Z.lc(2);Z.Gb(2),Z.tc("ngIf",t.user),Z.Gb(1),Z.tc("ngIf",!t.user),Z.Gb(2),Z.tc("ngForOf",n.analogPollValues)}}function X(t,e){if(1&t&&(Z.Zb(0,"div",13),Z.Ub(1,"div"),Z.Ub(2,"os-check-input",16),Z.mc(3,"translate"),Z.mc(4,"translate"),Z.Yb()),2&t){const t=e.$implicit,n=Z.lc(2);Z.Gb(2),Z.tc("placeholder",Z.nc(3,4,n.generalValueVerbose[t]))("checkboxValue",-1)("checkboxLabel",Z.nc(4,6,"majority"))("formControlName",t)}}function W(t,e){1&t&&(Z.Ub(0,"os-check-input",17),Z.mc(1,"translate"),Z.mc(2,"translate")),2&t&&(Z.uc("placeholder",Z.nc(1,3,"General No")),Z.tc("checkboxValue",-1)("checkboxLabel",Z.nc(2,5,"majority")))}function K(t,e){1&t&&(Z.Ub(0,"os-check-input",18),Z.mc(1,"translate"),Z.mc(2,"translate")),2&t&&(Z.uc("placeholder",Z.nc(1,3,"General Abstain")),Z.tc("checkboxValue",-1)("checkboxLabel",Z.nc(2,5,"majority")))}function J(t,e){1&t&&(Z.Zb(0,"mat-error"),Z.Sc(1),Z.mc(2,"translate"),Z.Yb()),2&t&&(Z.Gb(1),Z.Uc(" ",Z.nc(2,1,"Error in form field."),""))}function tt(t,e){if(1&t){const t=Z.ac();Z.Xb(0),Z.Zb(1,"form",6),Z.Zb(2,"div",7),Z.Qc(3,z,6,3,"div",8),Z.Yb(),Z.Qc(4,X,5,8,"div",8),Z.Zb(5,"div"),Z.Qc(6,W,3,7,"os-check-input",9),Z.Qc(7,K,3,7,"os-check-input",10),Z.Yb(),Z.Yb(),Z.Zb(8,"div",11),Z.Zb(9,"mat-checkbox",12),Z.hc("ngModelChange",(function(e){return Z.Ic(t),Z.lc().publishImmediately=e}))("change",(function(e){return Z.Ic(t),Z.lc().publishStateChanged(e.checked)})),Z.Zb(10,"span"),Z.Sc(11),Z.mc(12,"translate"),Z.Yb(),Z.Yb(),Z.Qc(13,J,3,3,"mat-error",2),Z.Yb(),Z.Wb()}if(2&t){const t=Z.lc();Z.Gb(1),Z.tc("formGroup",t.dialogVoteForm),Z.Gb(2),Z.tc("ngForOf",t.options),Z.Gb(1),Z.tc("ngForOf",t.sumValues),Z.Gb(2),Z.tc("ngIf",t.globalNoEnabled),Z.Gb(1),Z.tc("ngIf",t.globalAbstainEnabled),Z.Gb(2),Z.tc("ngModel",t.publishImmediately),Z.Gb(2),Z.Tc(Z.nc(12,8,"Publish immediately")),Z.Gb(2),Z.tc("ngIf",!t.dialogVoteForm.valid)}}function et(t,e){if(1&t){const t=Z.ac();Z.Zb(0,"button",19),Z.hc("click",(function(){return Z.Ic(t),Z.lc().submitPoll()})),Z.Zb(1,"span"),Z.Sc(2),Z.mc(3,"translate"),Z.Yb(),Z.Yb()}if(2&t){const t=Z.lc(),e=Z.Ec(1);Z.tc("disabled",e.contentForm.invalid||t.dialogVoteForm.invalid),Z.Gb(2),Z.Tc(Z.nc(3,2,"Save"))}}let nt=(()=>{class t extends D.a{constructor(t,e,n,i,s,o,a){super(e,n,i,s),this.fb=t,this.translate=n,this.dialogRef=s,this.assignmentPollService=o,this.pollData=a,this.voteValueVerbose=V.c,this.generalValueVerbose=V.b,this.AssignmentPollMethodVerbose=A.a,this.AssignmentPollPercentBaseVerbose=A.b}get sumValues(){return["votesvalid","votesinvalid","votescast"]}get isAnalogPoll(){return this.pollForm&&this.pollForm.contentForm&&this.pollForm.contentForm.get("type").value===N.f.Analog}ngOnInit(){this.pollData&&(this.pollData.options?this.options=this.pollData.options:this.pollData.assignment&&this.pollData.assignment.candidates&&this.pollData.assignment.candidates.length&&(this.options=this.pollData.assignment.candidates.map(t=>({user_id:t.id,user:t}),{}))),this.subscriptions.push(this.pollForm.contentForm.valueChanges.pipe(Object(k.a)(150),Object(x.a)()).subscribe(()=>{this.createDialog()}))}setAnalogPollValues(){const t=this.pollForm.contentForm.get("pollmethod").value;this.globalNoEnabled=this.pollForm.contentForm.get("global_no").value,this.globalAbstainEnabled=this.pollForm.contentForm.get("global_abstain").value;const e=["Y"];t!==_.b.Votes&&e.push("N"),t===_.b.YNA&&e.push("A"),this.analogPollValues=e}updateDialogVoteForm(t){const e={options:{},votesvalid:t.votesvalid,votesinvalid:t.votesinvalid,votescast:t.votescast,amount_global_no:t.amount_global_no,amount_global_abstain:t.amount_global_abstain};for(const n of t.options){const i={};i.Y=n.yes,t.pollmethod!==_.b.Votes&&(i.N=n.no),t.pollmethod===_.b.YNA&&(i.A=n.abstain),e.options[n.user_id]=i}if(this.dialogVoteForm){const t=this.undoReplaceEmptyValues(e);this.dialogVoteForm.patchValue(t)}}createDialog(){this.setAnalogPollValues(),this.dialogVoteForm=this.fb.group(Object.assign({options:this.fb.group(this.options.mapToObject(t=>({[t.user_id]:this.fb.group(this.analogPollValues.mapToObject(t=>({[t]:["",[c.G.min(N.b)]]})))}))),amount_global_no:["",[c.G.min(N.b)]],amount_global_abstain:["",[c.G.min(N.b)]]},this.sumValues.mapToObject(t=>({[t]:["",[c.G.min(N.b)]]})))),this.isAnalogPoll&&this.pollData.poll&&this.updateDialogVoteForm(this.pollData)}}return t.\u0275fac=function(e){return new(e||t)(Z.Tb(c.f),Z.Tb(Q.d),Z.Tb(C.k),Z.Tb(L.a),Z.Tb(I.h),Z.Tb(O.a),Z.Tb(I.a))},t.\u0275cmp=Z.Nb({type:t,selectors:[["os-assignment-poll-dialog"]],viewQuery:function(t,e){var n;1&t&&Z.Oc(B,!0),2&t&&Z.Dc(n=Z.ic())&&(e.pollForm=n.first)},features:[Z.Db],decls:9,vars:10,consts:[[3,"data","pollService","pollMethods","percentBases"],["pollForm",""],[4,"ngIf"],["mat-dialog-actions",""],["mat-button","",3,"disabled","click",4,"ngIf"],["mat-button","",3,"mat-dialog-close"],[3,"formGroup"],["formGroupName","options"],["class","votes-grid",4,"ngFor","ngForOf"],["inputType","number","formControlName","amount_global_no",3,"placeholder","checkboxValue","checkboxLabel",4,"ngIf"],["inputType","number","formControlName","amount_global_abstain",3,"placeholder","checkboxValue","checkboxLabel",4,"ngIf"],[1,"spacer-top-20"],[3,"ngModel","ngModelChange","change"],[1,"votes-grid"],[3,"formGroupName",4,"ngFor","ngForOf"],[3,"formGroupName"],["inputType","number",3,"placeholder","checkboxValue","checkboxLabel","formControlName"],["inputType","number","formControlName","amount_global_no",3,"placeholder","checkboxValue","checkboxLabel"],["inputType","number","formControlName","amount_global_abstain",3,"placeholder","checkboxValue","checkboxLabel"],["mat-button","",3,"disabled","click"]],template:function(t,e){if(1&t&&(Z.Ub(0,"os-poll-form",0,1),Z.Qc(2,tt,14,10,"ng-container",2),Z.Zb(3,"div",3),Z.Qc(4,et,4,4,"button",4),Z.Zb(5,"button",5),Z.Zb(6,"span"),Z.Sc(7),Z.mc(8,"translate"),Z.Yb(),Z.Yb(),Z.Yb()),2&t){const t=Z.Ec(1);Z.tc("data",e.pollData)("pollService",e.assignmentPollService)("pollMethods",e.AssignmentPollMethodVerbose)("percentBases",e.AssignmentPollPercentBaseVerbose),Z.Gb(2),Z.tc("ngIf",e.isAnalogPoll&&e.dialogVoteForm),Z.Gb(2),Z.tc("ngIf",t&&e.dialogVoteForm&&t.contentForm),Z.Gb(1),Z.tc("mat-dialog-close",!1),Z.Gb(2),Z.Tc(Z.nc(8,8,"Cancel"))}},directives:[F.a,i.t,I.c,j.b,I.d,c.I,c.t,c.k,c.l,i.s,R.a,c.s,c.v,E.a,c.i,U.b],pipes:[C.j],styles:[".submit-buttons[_ngcontent-%COMP%]{display:-ms-flexbox;display:flex;-ms-flex-pack:end;justify-content:flex-end}.meta-text[_ngcontent-%COMP%]{font-style:italic;margin-left:10px;margin-right:10px}.meta-text[_ngcontent-%COMP%]   mat-chip[_ngcontent-%COMP%]{margin-left:5px;margin-right:2px}.candidate-name[_ngcontent-%COMP%]{word-wrap:break-word;width:100%;border-bottom:1px solid grey}.votes-grid[_ngcontent-%COMP%]{display:grid;grid-gap:5px;margin-bottom:10px;-ms-flex-align:baseline;align-items:baseline;grid-template-columns:auto -webkit-max-content;grid-template-columns:auto max-content}.votes-grid[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]{width:100%}.sum-value[_ngcontent-%COMP%]{display:-ms-flexbox;display:flex;-ms-flex-pack:end;justify-content:flex-end}.width-600[_ngcontent-%COMP%]{max-width:600px}"]}),t})(),it=(()=>{class t extends T.a{constructor(t,e){super(t,e),this.dialogComponent=nt}}return t.\u0275fac=function(e){return new(e||t)(Z.dc(I.b),Z.dc(y.a))},t.\u0275prov=Z.Pb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var st=n("ITcc"),ot=n("mksl"),at=n("STbY"),ct=n("NFeN"),lt=n("Tp2j"),rt=n("3Xi6"),bt=n("40uZ"),dt=n("f0Cb"),mt=n("tCBf"),ut=n("owL4"),pt=n("Izkr"),gt=n("c3p6"),ht=n("EHvM"),ft=n("+KbT");let vt=(()=>{class t extends ht.a{constructor(t,e,n,i,s){super(n,i),this.translate=t,this.assignmentRepo=e,this.pdfService=s,this.configService.get("assignments_pdf_ballot_papers_number").subscribe(t=>this.ballotCustomCount=t),this.configService.get("assignments_pdf_ballot_papers_selection").subscribe(t=>this.ballotCountSelection=t)}printBallots(t,e,n){const i=this.assignmentRepo.getViewModel(t.assignment_id),s=`${this.translate.instant("Election")} - ${i.getTitle()} - ${this.translate.instant("ballot-paper")}`;e||(e=i.getTitle()),n||(n=""),i.polls.length>1&&(n=`${this.translate.instant("Ballot")} ${i.polls.length} ${n}`),n.length>90&&(n=n.substring(0,90)+"...");let o=1;o="votes"===t.pollmethod?t.options.length<=2?4:t.options.length<=5?3:t.options.length<=10?2:1:t.options.length<=2?4:t.options.length<=3?3:t.options.length<=7?2:1;const a=Math.floor(417/o);this.pdfService.downloadWithBallotPaper(this.getPages(o,{sheetend:a,title:e,subtitle:n,poll:t}),s,this.logo)}createBallot(t){return{columns:[{width:1,margin:[0,t.sheetend],text:""},{width:"*",stack:[this.getHeader(),this.getTitle(t.title),this.getSubtitle(t.subtitle),this.createPollHint(t.poll),this.createCandidateFields(t.poll)],margin:[0,0,0,0]}]}}createCandidateFields(t){const e=t.options.sort((t,e)=>t.weight-e.weight).map(e=>"votes"===t.pollmethod?this.createBallotOption(e.user.full_name):this.createYNBallotEntry(e.user.full_name,t.pollmethod));if("votes"===t.pollmethod){if(t.global_no){const t=this.createBallotOption(this.translate.instant("No"));t.margin[1]=25,e.push(t)}if(t.global_abstain){const t=this.createBallotOption(this.translate.instant("Abstain"));t.margin[1]=25,e.push(t)}}return e}createYNBallotEntry(t,e){return[{text:t,margin:[40,10,0,0]},{width:"auto",columns:("YNA"===e?["Yes","No","Abstain"]:["Yes","No"]).map(t=>({width:"auto",stack:[this.createBallotOption(this.translate.instant(t))]}))}]}createPollHint(t){return{text:t.assignment.default_poll_description||"",style:"description"}}}return t.\u0275fac=function(e){return new(e||t)(Z.dc(C.k),Z.dc(b.a),Z.dc(ft.a),Z.dc(u.a),Z.dc(v.b))},t.\u0275prov=Z.Pb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var St=n("Wp6s"),_t=n("DGQJ"),Pt=n("pA48"),Yt=n("M0z7"),Gt=n("Xqcw"),Ot=n("Xa2L");function Zt(t,e){if(1&t&&(Z.Zb(0,"p"),Z.Zb(1,"i"),Z.Sc(2),Z.Yb(),Z.Yb()),2&t){const t=Z.lc(3);Z.Gb(2),Z.Tc(t.pollHint)}}function Ct(t,e){if(1&t&&(Z.Zb(0,"h4"),Z.Sc(1),Z.mc(2,"translate"),Z.Zb(3,"b"),Z.Sc(4),Z.Yb(),Z.Yb()),2&t){const t=Z.lc(3);Z.Gb(1),Z.Uc(" ",Z.nc(2,3,"Available votes"),": "),Z.Gb(3),Z.Vc(" ",t.getVotesAvailable(),"/",t.poll.votes_amount," ")}}function wt(t,e){if(1&t&&(Z.Zb(0,"div",9),Z.Sc(1),Z.Yb()),2&t){const t=Z.lc(3).$implicit;Z.Gb(1),Z.Uc(" ",t.user.getLevelAndNumber()," ")}}function Mt(t,e){if(1&t&&(Z.Zb(0,"span"),Z.Zb(1,"span"),Z.Sc(2),Z.Yb(),Z.Qc(3,wt,2,1,"div",8),Z.Yb()),2&t){const t=Z.lc(2).$implicit;Z.Gb(2),Z.Tc(t.user.short_name),Z.Gb(1),Z.tc("ngIf",t.user.getLevelAndNumber())}}function yt(t,e){1&t&&(Z.Zb(0,"span"),Z.Sc(1),Z.mc(2,"translate"),Z.Yb()),2&t&&(Z.Gb(1),Z.Tc(Z.nc(2,1,"Unknown user")))}function Tt(t,e){if(1&t&&(Z.Zb(0,"span",12),Z.Sc(1),Z.mc(2,"translate"),Z.Yb()),2&t){const t=Z.lc().$implicit;Z.Gb(1),Z.Uc(" ",Z.nc(2,1,t.label)," ")}}function It(t,e){if(1&t){const t=Z.ac();Z.Zb(0,"div"),Z.Zb(1,"button",10),Z.hc("click",(function(){Z.Ic(t);const n=e.$implicit,i=Z.lc(2).$implicit;return Z.lc(3).saveSingleVote(i.id,n.vote)})),Z.Zb(2,"mat-icon"),Z.Sc(3),Z.Yb(),Z.Yb(),Z.Qc(4,Tt,3,3,"span",11),Z.Yb()}if(2&t){const t=e.$implicit,n=Z.lc(2).$implicit,i=Z.lc(3);Z.Gb(1),Z.tc("disabled",i.deliveringVote)("ngClass",i.voteRequestData.votes[n.id]===t.vote||1===i.voteRequestData.votes[n.id]?t.css:""),Z.Gb(2),Z.Uc(" ",t.icon,""),Z.Gb(1),Z.tc("ngIf",i.poll.pollmethod!==i.AssignmentPollMethod.Votes)}}function kt(t,e){1&t&&Z.Ub(0,"mat-divider")}const xt=function(t,e,n){return{"yna-grid":t,"yn-grid":e,"single-vote-grid":n}};function Nt(t,e){if(1&t&&(Z.Zb(0,"div"),Z.Zb(1,"div",6),Z.Zb(2,"div",7),Z.Qc(3,Mt,4,2,"span",0),Z.Qc(4,yt,3,3,"span",0),Z.Yb(),Z.Qc(5,It,5,4,"div",4),Z.Yb(),Z.Qc(6,kt,1,0,"mat-divider",0),Z.Yb()),2&t){const t=Z.lc(),e=t.$implicit,n=t.index,i=Z.lc(3);Z.Gb(1),Z.tc("ngClass",Z.Bc(5,xt,i.poll.pollmethod===i.AssignmentPollMethod.YNA,i.poll.pollmethod===i.AssignmentPollMethod.YN,i.poll.pollmethod===i.AssignmentPollMethod.Votes)),Z.Gb(2),Z.tc("ngIf",e.user),Z.Gb(1),Z.tc("ngIf",!e.user),Z.Gb(1),Z.tc("ngForOf",i.voteActions),Z.Gb(1),Z.tc("ngIf",i.poll.options.length-1>n)}}function Vt(t,e){if(1&t&&(Z.Zb(0,"div"),Z.Qc(1,Nt,7,9,"div",0),Z.Yb()),2&t){const t=e.$implicit,n=Z.lc(3);Z.Gb(1),Z.tc("ngIf",n.poll.type!==n.PollType.Pseudoanonymous||!t.user_has_voted)}}function At(t,e){if(1&t){const t=Z.ac();Z.Zb(0,"div"),Z.Zb(1,"button",14),Z.hc("click",(function(){return Z.Ic(t),Z.lc(4).saveGlobalVote("N")})),Z.Zb(2,"mat-icon"),Z.Sc(3," thumb_down "),Z.Yb(),Z.Yb(),Z.Zb(4,"span",12),Z.Sc(5),Z.mc(6,"translate"),Z.Yb(),Z.Yb()}if(2&t){const t=Z.lc(4);Z.Gb(1),Z.tc("ngClass","N"===t.voteRequestData.global?"voted-no":"")("disabled",t.deliveringVote),Z.Gb(4),Z.Uc(" ",Z.nc(6,3,"General No")," ")}}function Dt(t,e){if(1&t){const t=Z.ac();Z.Zb(0,"div"),Z.Zb(1,"button",15),Z.hc("click",(function(){return Z.Ic(t),Z.lc(4).saveGlobalVote("A")})),Z.Zb(2,"mat-icon"),Z.Sc(3," trip_origin"),Z.Yb(),Z.Yb(),Z.Zb(4,"span",12),Z.Sc(5),Z.mc(6,"translate"),Z.Yb(),Z.Yb()}if(2&t){const t=Z.lc(4);Z.Gb(1),Z.tc("ngClass","A"===t.voteRequestData.global?"voted-abstain":""),Z.Gb(4),Z.Uc(" ",Z.nc(6,2,"General Abstain")," ")}}function Ft(t,e){if(1&t&&(Z.Xb(0),Z.Ub(1,"mat-divider"),Z.Zb(2,"div",13),Z.Qc(3,At,7,5,"div",0),Z.Qc(4,Dt,7,4,"div",0),Z.Yb(),Z.Wb()),2&t){const t=Z.lc(3);Z.Gb(3),Z.tc("ngIf",t.poll.global_no),Z.Gb(1),Z.tc("ngIf",t.poll.global_abstain)}}function Qt(t,e){if(1&t&&(Z.Xb(0),Z.Qc(1,Zt,3,1,"p",0),Z.Qc(2,Ct,5,5,"h4",0),Z.Qc(3,Vt,2,1,"div",4),Z.Qc(4,Ft,5,2,"ng-container",0),Z.Vb(5,5),Z.Wb()),2&t){const t=Z.lc(2),e=Z.Ec(4);Z.Gb(1),Z.tc("ngIf",t.pollHint),Z.Gb(1),Z.tc("ngIf",t.poll.pollmethod===t.AssignmentPollMethod.Votes&&t.poll.votes_amount>1),Z.Gb(1),Z.tc("ngForOf",t.poll.options),Z.Gb(1),Z.tc("ngIf",t.poll.pollmethod===t.AssignmentPollMethod.Votes&&(t.poll.global_no||t.poll.global_abstain)),Z.Gb(1),Z.tc("ngTemplateOutlet",e)}}function Lt(t,e){if(1&t&&(Z.Xb(0),Z.Zb(1,"span"),Z.Sc(2),Z.mc(3,"translate"),Z.Yb(),Z.Wb()),2&t){const t=Z.lc(2);Z.Gb(2),Z.Tc(Z.nc(3,1,t.vmanager.getVotePermissionErrorVerbose(t.poll)))}}function jt(t,e){if(1&t&&(Z.Xb(0),Z.Qc(1,Qt,6,5,"ng-container",3),Z.Qc(2,Lt,4,3,"ng-container",0),Z.Wb()),2&t){const t=Z.lc(),e=Z.Ec(2);Z.Gb(1),Z.tc("ngIf",t.vmanager.canVote(t.poll)&&!t.alreadyVoted&&!t.deliveringVote)("ngIfElse",e),Z.Gb(1),Z.tc("ngIf",!t.vmanager.canVote(t.poll))}}function Rt(t,e){1&t&&(Z.Zb(0,"div"),Z.Zb(1,"mat-icon",18),Z.Sc(2," check_circle "),Z.Yb(),Z.Ub(3,"br"),Z.Zb(4,"span"),Z.Sc(5),Z.mc(6,"translate"),Z.Yb(),Z.Yb()),2&t&&(Z.Gb(5),Z.Tc(Z.nc(6,1,"Voting successful.")))}function Et(t,e){1&t&&(Z.Zb(0,"div",19),Z.Ub(1,"mat-spinner",20),Z.Ub(2,"br"),Z.Zb(3,"span"),Z.Sc(4),Z.mc(5,"translate"),Z.Yb(),Z.Yb()),2&t&&(Z.Gb(4),Z.Tc(Z.nc(5,1,"Delivering vote... Please wait!")))}function Ut(t,e){if(1&t&&(Z.Zb(0,"div",16),Z.Qc(1,Rt,7,3,"div",0),Z.Qc(2,Et,6,3,"div",17),Z.Yb()),2&t){const t=Z.lc();Z.Gb(1),Z.tc("ngIf",!t.deliveringVote),Z.Gb(1),Z.tc("ngIf",t.deliveringVote)}}function Bt(t,e){if(1&t){const t=Z.ac();Z.Zb(0,"div",16),Z.Zb(1,"button",21),Z.hc("click",(function(){return Z.Ic(t),Z.lc().submitVote()})),Z.Zb(2,"mat-icon"),Z.Sc(3," how_to_vote "),Z.Yb(),Z.Zb(4,"span"),Z.Sc(5),Z.mc(6,"translate"),Z.Yb(),Z.Yb(),Z.Yb()}2&t&&(Z.Gb(5),Z.Uc(" ",Z.nc(6,1,"Submit vote now")," "))}let Ht=(()=>{class t extends Gt.a{constructor(t,e,n,i,s,o,a,c){super(t,e,n,i),this.translate=e,this.vmanager=s,this.pollRepo=o,this.promptService=a,this.cd=c,this.AssignmentPollMethod=_.b,this.PollType=N.f,this.voteActions=[],this.voteRequestData={votes:{}}}ngOnInit(){this.poll&&!this.poll.user_has_voted?(this.alreadyVoted=!1,this.defineVoteOptions()):(this.alreadyVoted=!0,this.cd.markForCheck())}get pollHint(){return this.poll.assignment.default_poll_description}defineVoteOptions(){this.voteActions.push({vote:"Y",css:"voted-yes",icon:"thumb_up",label:"Yes"}),this.poll.pollmethod!==_.b.Votes&&this.voteActions.push({vote:"N",css:"voted-no",icon:"thumb_down",label:"No"}),this.poll.pollmethod===_.b.YNA&&this.voteActions.push({vote:"A",css:"voted-abstain",icon:"trip_origin",label:"Abstain"})}getVotesCount(){return Object.keys(this.voteRequestData.votes).filter(t=>this.voteRequestData.votes[t]).length}getVotesAvailable(){return this.poll.votes_amount-this.getVotesCount()}isGlobalOptionSelected(){return!!this.voteRequestData.global}submitVote(){return Object(a.a)(this,void 0,void 0,(function*(){const t=this.translate.instant("Submit selection now?"),e=this.translate.instant("Your decision cannot be changed afterwards.");(yield this.promptService.open(t,e))&&(this.deliveringVote=!0,this.cd.markForCheck(),this.pollRepo.vote(this.voteRequestData,this.poll.id).then(()=>{this.alreadyVoted=!0}).catch(this.raiseError).finally(()=>{this.deliveringVote=!1}))}))}saveSingleVote(t,e){if(this.isGlobalOptionSelected()&&delete this.voteRequestData.global,this.poll.pollmethod===_.b.Votes){const e=this.poll.votes_amount,n=this.poll.options.map(t=>t.id).reduce((n,i)=>(n[i]=0,1===e?i===t&&1!==this.voteRequestData.votes[i]&&(n[i]=1):i===t!=(1===this.voteRequestData.votes[i])&&(n[i]=1),n),{});Object.keys(n).filter(t=>n[t]).length<=e?(this.voteRequestData.votes=n,this.getVotesCount()===e&&this.submitVote()):this.raiseError(this.translate.instant("You reached the maximum amount of votes. Deselect somebody first."))}else this.voteRequestData.votes[t]&&this.voteRequestData.votes[t]===e?delete this.voteRequestData.votes[t]:this.voteRequestData.votes[t]=e,Object.keys(this.voteRequestData.votes).length===this.poll.options.length&&this.submitVote()}saveGlobalVote(t){this.voteRequestData.votes={},this.voteRequestData.global&&this.voteRequestData.global===t?delete this.voteRequestData.global:(this.voteRequestData.global=t,this.submitVote())}}return t.\u0275fac=function(e){return new(e||t)(Z.Tb(Q.d),Z.Tb(C.k),Z.Tb(L.a),Z.Tb(o.a),Z.Tb(Yt.b),Z.Tb(mt.a),Z.Tb(p.a),Z.Tb(Z.h))},t.\u0275cmp=Z.Nb({type:t,selectors:[["os-assignment-poll-vote"]],features:[Z.Db],decls:5,vars:1,consts:[[4,"ngIf"],["cannotVote",""],["sendNow",""],[4,"ngIf","ngIfElse"],[4,"ngFor","ngForOf"],[3,"ngTemplateOutlet"],[3,"ngClass"],[1,"vote-candidate-name"],["class","user-subtitle",4,"ngIf"],[1,"user-subtitle"],["mat-raised-button","",1,"vote-button",3,"disabled","ngClass","click"],["class","vote-label",4,"ngIf"],[1,"vote-label"],[1,"global-option-grid"],["mat-raised-button","",1,"vote-button",3,"ngClass","disabled","click"],["mat-raised-button","",1,"vote-button",3,"ngClass","click"],[1,"centered-button-wrapper"],["class","submit-vote-indicator",4,"ngIf"],[1,"vote-submitted"],[1,"submit-vote-indicator"],[1,"small-spinner"],["mat-flat-button","","color","accent",3,"click"]],template:function(t,e){1&t&&(Z.Qc(0,jt,3,3,"ng-container",0),Z.Qc(1,Ut,3,2,"ng-template",null,1,Z.Rc),Z.Qc(3,Bt,7,3,"ng-template",null,2,Z.Rc)),2&t&&Z.tc("ngIf",e.poll)},directives:[i.t,i.s,i.A,i.q,j.b,ct.a,dt.a,Ot.c],pipes:[C.j],styles:['.yes[_ngcontent-%COMP%]{color:#4caf50}.no[_ngcontent-%COMP%]{color:#cc6c5b}.abstain[_ngcontent-%COMP%]{color:#a6a6a6}.voted-yes[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff}.voted-no[_ngcontent-%COMP%]{background-color:#cc6c5b;color:#fff}.voted-abstain[_ngcontent-%COMP%]{background-color:#a6a6a6;color:#fff}.start-poll-button[_ngcontent-%COMP%]{color:#4caf50}.stop-poll-button[_ngcontent-%COMP%]{color:#ff5252}.publish-poll-button[_ngcontent-%COMP%]{color:#e6b100}.global-option-grid[_ngcontent-%COMP%], .single-vote-grid[_ngcontent-%COMP%], .yn-grid[_ngcontent-%COMP%], .yna-grid[_ngcontent-%COMP%]{display:grid;grid-gap:10px;margin:20px 0}.yn-grid[_ngcontent-%COMP%]{grid-template-areas:"name name" "yes no"}.yna-grid[_ngcontent-%COMP%]{grid-template-areas:"name name name" "yes no abstain"}.single-vote-grid[_ngcontent-%COMP%]{grid-template-areas:"yes name";grid-template-columns:-webkit-min-content auto;grid-template-columns:min-content auto}.global-option-grid[_ngcontent-%COMP%]{grid-template-columns:auto auto}.vote-candidate-name[_ngcontent-%COMP%]{grid-area:name;display:-ms-flexbox;display:flex}.vote-candidate-name[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-top:auto;margin-bottom:auto}.centered-button-wrapper[_ngcontent-%COMP%]{display:-ms-flexbox;display:flex;text-align:center}.centered-button-wrapper[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-left:auto;margin-right:auto}.centered-button-wrapper[_ngcontent-%COMP%]   .vote-submitted[_ngcontent-%COMP%]{color:#4caf50;font-size:200%}.vote-button[_ngcontent-%COMP%]{min-width:50px;min-height:50px}.vote-label[_ngcontent-%COMP%]{margin-left:10px}.mat-divider-horizontal[_ngcontent-%COMP%]{position:static}.submit-vote-indicator[_ngcontent-%COMP%]{text-align:center}.submit-vote-indicator[_ngcontent-%COMP%]   .mat-spinner[_ngcontent-%COMP%]{margin:auto}'],changeDetection:0}),t})();var qt=n("Qu3c");function $t(t,e){if(1&t){const t=Z.ac();Z.Zb(0,"span"),Z.Zb(1,"button",15),Z.hc("click",(function(){return Z.Ic(t),Z.lc(2).openVotingWarning()})),Z.Zb(2,"mat-icon"),Z.Sc(3," warning "),Z.Yb(),Z.Yb(),Z.Yb()}}function zt(t,e){if(1&t&&(Z.Zb(0,"span"),Z.Sc(1),Z.mc(2,"translate"),Z.Yb()),2&t){const t=Z.lc(2);Z.Gb(1),Z.Uc(" ",Z.nc(2,1,t.poll.typeVerbose)," \xb7 ")}}function Xt(t,e){if(1&t){const t=Z.ac();Z.Zb(0,"button",16),Z.hc("click",(function(e){return Z.Ic(t),e.stopPropagation()})),Z.Zb(1,"mat-icon"),Z.Sc(2,"more_horiz"),Z.Yb(),Z.Yb()}if(2&t){Z.lc(2);const t=Z.Ec(2);Z.tc("matMenuTriggerFor",t)}}function Wt(t,e){if(1&t&&(Z.Xb(0),Z.Sc(1),Z.mc(2,"translate"),Z.Wb()),2&t){const t=Z.lc(3);Z.Gb(1),Z.Uc(" ",Z.nc(2,1,t.poll.nextStateActionVerbose)," ")}}function Kt(t,e){1&t&&(Z.Xb(0),Z.Sc(1),Z.mc(2,"translate"),Z.Wb()),2&t&&(Z.Gb(1),Z.Uc(" ",Z.nc(2,1,"In progress, please wait...")," "))}function Jt(t,e){if(1&t){const t=Z.ac();Z.Zb(0,"div"),Z.Zb(1,"button",17),Z.hc("click",(function(){Z.Ic(t);const e=Z.lc(2);return e.changeState(e.poll.nextState)})),Z.Zb(2,"mat-icon"),Z.Sc(3),Z.Yb(),Z.Zb(4,"span",18),Z.Qc(5,Wt,3,3,"ng-container",8),Z.Qc(6,Kt,3,3,"ng-container",8),Z.Yb(),Z.Yb(),Z.Yb()}if(2&t){const t=Z.lc(2);Z.Gb(1),Z.tc("ngClass",t.pollStateActions[t.poll.state].css)("disabled",t.stateChangePending),Z.Gb(2),Z.Uc(" ",t.pollStateActions[t.poll.state].icon,""),Z.Gb(2),Z.tc("ngIf",!t.stateChangePending),Z.Gb(1),Z.tc("ngIf",t.stateChangePending)}}function te(t,e){1&t&&(Z.Zb(0,"div"),Z.Sc(1),Z.mc(2,"translate"),Z.Yb()),2&t&&(Z.Gb(1),Z.Uc(" ",Z.nc(2,1,"Edit to enter votes.")," "))}function ee(t,e){if(1&t&&(Z.Zb(0,"div"),Z.Ub(1,"os-assignment-poll-detail-content",22),Z.Yb()),2&t){const t=Z.lc(3);Z.Gb(1),Z.vc("routerLink","/assignments/polls/",t.poll.id,""),Z.tc("poll",t.poll)}}function ne(t,e){1&t&&(Z.Zb(0,"span"),Z.Sc(1),Z.mc(2,"translate"),Z.Yb()),2&t&&(Z.Gb(1),Z.Uc(" ",Z.nc(2,1,"Counting of votes is in progress ...")," "))}function ie(t,e){if(1&t&&(Z.Zb(0,"div"),Z.Qc(1,ne,3,3,"span",8),Z.Yb()),2&t){const t=Z.lc(3);Z.Gb(1),Z.tc("ngIf",t.poll.isFinished)}}function se(t,e){if(1&t&&(Z.Zb(0,"div",19),Z.Qc(1,ee,2,2,"div",20),Z.Qc(2,ie,2,1,"div",21),Z.Yb()),2&t){const t=Z.lc(2);Z.Gb(1),Z.tc("osPerms","assignments.can_manage")("osPermsOr",t.poll.isPublished),Z.Gb(1),Z.tc("osPerms","assignments.can_manage")("osPermsComplement",!0)}}function oe(t,e){if(1&t&&(Z.Zb(0,"div"),Z.Ub(1,"os-poll-progress",23),Z.Yb()),2&t){const t=Z.lc(2);Z.Gb(1),Z.tc("poll",t.poll)}}function ae(t,e){if(1&t&&Z.Ub(0,"os-assignment-poll-vote",23),2&t){const t=Z.lc(2);Z.tc("poll",t.poll)}}function ce(t,e){if(1&t&&(Z.Zb(0,"a",24),Z.mc(1,"translate"),Z.Zb(2,"mat-icon",25),Z.Sc(3," visibility "),Z.Yb(),Z.Yb()),2&t){const t=Z.lc(2);Z.vc("routerLink","/assignments/polls/",t.poll.id,""),Z.uc("matTooltip",Z.nc(1,2,"More"))}}const le=function(){return["core.can_manage_projector","assignments.can_manage"]};function re(t,e){if(1&t&&(Z.Zb(0,"mat-card",3),Z.Zb(1,"div",4),Z.Zb(2,"div"),Z.Zb(3,"mat-card-title"),Z.Zb(4,"a",5),Z.Sc(5),Z.Yb(),Z.Yb(),Z.Zb(6,"div",6),Z.Qc(7,$t,4,0,"span",7),Z.Qc(8,zt,3,3,"span",8),Z.Zb(9,"span"),Z.Sc(10),Z.mc(11,"translate"),Z.Yb(),Z.Yb(),Z.Zb(12,"div",9),Z.Qc(13,Xt,3,1,"button",10),Z.Yb(),Z.Qc(14,Jt,7,5,"div",7),Z.Qc(15,te,3,3,"div",7),Z.Yb(),Z.Qc(16,se,3,4,"div",11),Z.Qc(17,oe,2,1,"div",7),Z.Qc(18,ae,1,1,"os-assignment-poll-vote",12),Z.Zb(19,"div",13),Z.Qc(20,ce,4,4,"a",14),Z.Yb(),Z.Yb(),Z.Yb()),2&t){const t=Z.lc();Z.Gb(4),Z.vc("routerLink","/assignments/polls/",t.poll.id,""),Z.Gb(1),Z.Uc(" ",t.poll.title," "),Z.Gb(2),Z.tc("osPerms","assignments.can_manage")("osPermsAnd","pseudoanonymous"===t.poll.type),Z.Gb(1),Z.tc("ngIf","analog"!==t.poll.type),Z.Gb(2),Z.Uc(" ",Z.nc(11,16,t.poll.stateVerbose)," "),Z.Gb(3),Z.tc("osPerms",Z.yc(18,le)),Z.Gb(1),Z.tc("osPerms","assignments.can_manage")("osPermsAnd",!t.hideChangeState),Z.Gb(1),Z.tc("osPerms","assignments.can_manage")("osPermsAnd","analog"===t.poll.type&&!t.poll.stateHasVotes),Z.Gb(1),Z.tc("ngIf",t.poll.stateHasVotes),Z.Gb(1),Z.tc("osPerms","assignments.can_manage")("osPermsAnd",t.poll&&t.poll.isStarted),Z.Gb(1),Z.tc("ngIf",t.poll.canBeVotedFor()),Z.Gb(2),Z.tc("ngIf",t.poll.isPublished)}}function be(t,e){if(1&t){const t=Z.ac();Z.Zb(0,"div"),Z.Zb(1,"button",26),Z.hc("click",(function(){return Z.Ic(t),Z.lc().openDialog()})),Z.Zb(2,"mat-icon"),Z.Sc(3,"edit"),Z.Yb(),Z.Zb(4,"span"),Z.Sc(5),Z.mc(6,"translate"),Z.Yb(),Z.Yb(),Z.Yb()}2&t&&(Z.Gb(5),Z.Tc(Z.nc(6,1,"Edit")))}function de(t,e){if(1&t&&(Z.Zb(0,"div"),Z.Ub(1,"os-projector-button",27),Z.Yb()),2&t){const t=Z.lc();Z.Gb(1),Z.tc("object",t.poll)}}function me(t,e){if(1&t){const t=Z.ac();Z.Zb(0,"div"),Z.Zb(1,"button",26),Z.hc("click",(function(){return Z.Ic(t),Z.lc().printBallot()})),Z.Zb(2,"mat-icon"),Z.Sc(3,"picture_as_pdf"),Z.Yb(),Z.Zb(4,"span"),Z.Sc(5),Z.mc(6,"translate"),Z.Yb(),Z.Yb(),Z.Ub(7,"mat-divider"),Z.Zb(8,"button",26),Z.hc("click",(function(){return Z.Ic(t),Z.lc().refreshPoll()})),Z.Zb(9,"mat-icon"),Z.Sc(10,"refresh"),Z.Yb(),Z.Zb(11,"span"),Z.Sc(12),Z.mc(13,"translate"),Z.Yb(),Z.Yb(),Z.Zb(14,"button",26),Z.hc("click",(function(){return Z.Ic(t),Z.lc().resetState()})),Z.Zb(15,"mat-icon",28),Z.Sc(16,"replay"),Z.Yb(),Z.Zb(17,"span"),Z.Sc(18),Z.mc(19,"translate"),Z.Yb(),Z.Yb(),Z.Zb(20,"button",29),Z.hc("click",(function(){return Z.Ic(t),Z.lc().onDeletePoll()})),Z.Zb(21,"mat-icon"),Z.Sc(22,"delete"),Z.Yb(),Z.Zb(23,"span"),Z.Sc(24),Z.mc(25,"translate"),Z.Yb(),Z.Yb(),Z.Yb()}2&t&&(Z.Gb(5),Z.Tc(Z.nc(6,4,"Ballot papers")),Z.Gb(7),Z.Tc(Z.nc(13,6,"Refresh")),Z.Gb(6),Z.Tc(Z.nc(19,8,"Reset state")),Z.Gb(6),Z.Tc(Z.nc(25,10,"Delete")))}let ue=(()=>{class t extends gt.a{constructor(t,e,n,i,s,o,a,c,l,r){super(t,e,n,i,s,o,a),this.pollService=c,this.formBuilder=l,this.pdfService=r,this.candidatesLabels=[]}set poll(t){this.initPoll(t),this.candidatesLabels=this.pollService.getChartLabels(t);const e=this.pollService.generateChartData(t);this.chartDataSubject.next(e)}get poll(){return this._poll}get dirtyDescription(){return this.descriptionForm.get("description").value!==this.poll.description}ngOnInit(){this.descriptionForm=this.formBuilder.group({description:this.poll?this.poll.description:""})}printBallot(){this.pdfService.printBallots(this.poll)}openVotingWarning(){this.dialog.open(ut.a,pt.a)}}return t.\u0275fac=function(e){return new(e||t)(Z.Tb(Q.d),Z.Tb(L.a),Z.Tb(C.k),Z.Tb(I.b),Z.Tb(p.a),Z.Tb(mt.a),Z.Tb(it),Z.Tb(O.a),Z.Tb(c.f),Z.Tb(vt))},t.\u0275cmp=Z.Nb({type:t,selectors:[["os-assignment-poll"]],inputs:{poll:"poll"},features:[Z.Db],decls:6,vars:4,consts:[["class","os-card",4,"ngIf"],["pollItemMenu","matMenu"],[4,"osPerms"],[1,"os-card"],[1,"assignment-poll-wrapper"],[3,"routerLink"],[1,"italic","spacer-bottom-20"],[4,"osPerms","osPermsAnd"],[4,"ngIf"],[1,"poll-menu"],["mat-icon-button","",3,"matMenuTriggerFor","click",4,"osPerms"],["class","poll-result-wrapper",4,"ngIf"],[3,"poll",4,"ngIf"],[1,"poll-detail-button-wrapper"],["mat-icon-button","",3,"routerLink","matTooltip",4,"ngIf"],["mat-icon-button","","color","warn",3,"click"],["mat-icon-button","",3,"matMenuTriggerFor","click"],["mat-stroked-button","",3,"ngClass","disabled","click"],[1,"next-state-label"],[1,"poll-result-wrapper"],[4,"osPerms","osPermsOr"],[4,"osPerms","osPermsComplement"],[3,"routerLink","poll"],[3,"poll"],["mat-icon-button","",3,"routerLink","matTooltip"],[1,"small-icon"],["mat-menu-item","",3,"click"],["menuItem","true",3,"object"],["color","warn"],["mat-menu-item","",1,"red-warning-text",3,"click"]],template:function(t,e){1&t&&(Z.Qc(0,re,21,19,"mat-card",0),Z.Zb(1,"mat-menu",null,1),Z.Qc(3,be,7,3,"div",2),Z.Qc(4,de,2,1,"div",2),Z.Qc(5,me,26,12,"div",2),Z.Yb()),2&t&&(Z.tc("ngIf",e.poll),Z.Gb(3),Z.tc("osPerms","assignments.can_manage"),Z.Gb(1),Z.tc("osPerms","core.can_manage_projector"),Z.Gb(1),Z.tc("osPerms","assignments.can_manage"))},directives:[i.t,at.f,rt.a,St.a,St.m,s.i,j.b,ct.a,at.e,i.q,_t.a,s.g,Pt.a,Ht,j.a,qt.c,at.c,lt.a,dt.a],pipes:[C.j],styles:[".yes[_ngcontent-%COMP%]{color:#4caf50}.no[_ngcontent-%COMP%]{color:#cc6c5b}.abstain[_ngcontent-%COMP%]{color:#a6a6a6}.voted-yes[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff}.voted-no[_ngcontent-%COMP%]{background-color:#cc6c5b;color:#fff}.voted-abstain[_ngcontent-%COMP%]{background-color:#a6a6a6;color:#fff}.start-poll-button[_ngcontent-%COMP%]{color:#4caf50}.stop-poll-button[_ngcontent-%COMP%]{color:#ff5252}.publish-poll-button[_ngcontent-%COMP%]{color:#e6b100}.assignment-poll-wrapper[_ngcontent-%COMP%]{position:relative;margin:0 15px}.assignment-poll-wrapper[_ngcontent-%COMP%]   .poll-menu[_ngcontent-%COMP%]{position:absolute;top:0;right:0}.assignment-poll-wrapper[_ngcontent-%COMP%]   .poll-result-wrapper[_ngcontent-%COMP%]{cursor:pointer}.assignment-poll-wrapper[_ngcontent-%COMP%]   .poll-detail-button-wrapper[_ngcontent-%COMP%]{display:-ms-flexbox;display:flex;margin:auto 0}.assignment-poll-wrapper[_ngcontent-%COMP%]   .poll-detail-button-wrapper[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{margin-left:auto}"]}),t})();var pe=n("A5z7"),ge=n("MutI"),he=n("IBZR"),fe=n("oqD5"),ve=n("qFsG"),Se=n("fB2i"),_e=n("JAMN"),Pe=n("6Ehv"),Ye=n("DShQ"),Ge=n("7jBc");function Oe(t,e){1&t&&(Z.Zb(0,"h2"),Z.Sc(1),Z.mc(2,"translate"),Z.Yb()),2&t&&(Z.Gb(1),Z.Tc(Z.nc(2,1,"Election")))}function Ze(t,e){1&t&&(Z.Zb(0,"h2"),Z.Sc(1),Z.mc(2,"translate"),Z.Yb()),2&t&&(Z.Gb(1),Z.Tc(Z.nc(2,1,"New election")))}function Ce(t,e){if(1&t){const t=Z.ac();Z.Zb(0,"div"),Z.Zb(1,"button",11),Z.hc("click",(function(){return Z.Ic(t),Z.lc().onDownloadPdf()})),Z.Zb(2,"mat-icon"),Z.Sc(3,"picture_as_pdf"),Z.Yb(),Z.Zb(4,"span"),Z.Sc(5),Z.mc(6,"translate"),Z.Yb(),Z.Yb(),Z.Ub(7,"os-speaker-button",6),Z.Yb()}if(2&t){const t=Z.lc();Z.Gb(5),Z.Tc(Z.nc(6,3,"PDF")),Z.Gb(2),Z.tc("object",t.assignment)("menuItem",!0)}}function we(t,e){if(1&t){const t=Z.ac();Z.Zb(0,"button",11),Z.hc("click",(function(){return Z.Ic(t),Z.lc(2).addToAgenda()})),Z.Zb(1,"mat-icon"),Z.Sc(2,"add"),Z.Yb(),Z.Zb(3,"span"),Z.Sc(4),Z.mc(5,"translate"),Z.Yb(),Z.Yb()}2&t&&(Z.Gb(4),Z.Tc(Z.nc(5,1,"Add to agenda")))}function Me(t,e){if(1&t){const t=Z.ac();Z.Zb(0,"button",11),Z.hc("click",(function(){return Z.Ic(t),Z.lc(2).removeFromAgenda()})),Z.Zb(1,"mat-icon"),Z.Sc(2,"remove"),Z.Yb(),Z.Zb(3,"span"),Z.Sc(4),Z.mc(5,"translate"),Z.Yb(),Z.Yb()}2&t&&(Z.Gb(4),Z.Tc(Z.nc(5,1,"Remove from agenda")))}function ye(t,e){if(1&t&&(Z.Zb(0,"div"),Z.Qc(1,we,6,3,"button",12),Z.Qc(2,Me,6,3,"button",12),Z.Yb()),2&t){const t=Z.lc();Z.Gb(1),Z.tc("ngIf",t.assignment&&!t.assignment.item),Z.Gb(1),Z.tc("ngIf",t.assignment&&t.assignment.item)}}function Te(t,e){if(1&t){const t=Z.ac();Z.Zb(0,"div"),Z.Ub(1,"mat-divider"),Z.Zb(2,"button",13),Z.hc("click",(function(){return Z.Ic(t),Z.lc().onDeleteAssignmentButton()})),Z.Zb(3,"mat-icon"),Z.Sc(4,"delete"),Z.Yb(),Z.Zb(5,"span"),Z.Sc(6),Z.mc(7,"translate"),Z.Yb(),Z.Yb(),Z.Yb()}2&t&&(Z.Gb(6),Z.Tc(Z.nc(7,1,"Delete")))}function Ie(t,e){if(1&t&&(Z.Zb(0,"div"),Z.Vb(1,14),Z.Yb()),2&t){Z.lc();const t=Z.Ec(22);Z.Gb(1),Z.tc("ngTemplateOutlet",t)}}function ke(t,e){if(1&t&&(Z.Xb(0),Z.Ub(1,"os-assignment-poll",17),Z.Wb()),2&t){const t=e.$implicit;Z.Gb(1),Z.tc("poll",t)}}function xe(t,e){if(1&t&&(Z.Xb(0),Z.Qc(1,ke,2,1,"ng-container",16),Z.mc(2,"reverse"),Z.Wb()),2&t){const t=Z.lc(2);Z.Gb(1),Z.tc("ngForOf",Z.nc(2,2,t.assignment.polls))("ngForTrackBy",t.trackByIndex)}}function Ne(t,e){if(1&t){const t=Z.ac();Z.Zb(0,"div",18),Z.Zb(1,"button",19),Z.hc("click",(function(){return Z.Ic(t),Z.lc(2).openDialog()})),Z.Zb(2,"mat-icon"),Z.Sc(3,"add"),Z.Yb(),Z.Zb(4,"span"),Z.Sc(5),Z.mc(6,"translate"),Z.Yb(),Z.Yb(),Z.Yb()}2&t&&(Z.Gb(5),Z.Tc(Z.nc(6,1,"New ballot")))}function Ve(t,e){if(1&t&&(Z.Zb(0,"div"),Z.Vb(1,14),Z.Qc(2,xe,3,4,"ng-container",2),Z.Qc(3,Ne,7,3,"div",15),Z.Vb(4,14),Z.Yb()),2&t){const t=Z.lc(),e=Z.Ec(18),n=Z.Ec(20);Z.Gb(1),Z.tc("ngTemplateOutlet",e),Z.Gb(1),Z.tc("ngIf",t.assignment&&t.assignment.polls.length),Z.Gb(1),Z.tc("ngIf",t.assignment&&t.hasPerms("createPoll")),Z.Gb(1),Z.tc("ngTemplateOutlet",n)}}function Ae(t,e){if(1&t&&(Z.Zb(0,"div"),Z.Zb(1,"h1"),Z.Sc(2),Z.Yb(),Z.Yb()),2&t){const t=Z.lc(3);Z.Gb(2),Z.Tc(t.assignment.getTitle())}}function De(t,e){if(1&t&&(Z.Ub(0,"div",30),Z.mc(1,"trust")),2&t){const t=Z.lc(4);Z.tc("innerHTML",Z.oc(1,1,t.assignment.assignment.description,"html"),Z.Jc)}}function Fe(t,e){if(1&t&&(Z.Zb(0,"div"),Z.Qc(1,De,2,4,"div",29),Z.Yb()),2&t){const t=Z.lc(3);Z.Gb(1),Z.tc("ngIf",t.assignment.assignment.description)}}function Qe(t,e){if(1&t&&(Z.Zb(0,"mat-basic-chip",31),Z.Sc(1),Z.mc(2,"translate"),Z.Yb()),2&t){Z.lc();const t=Z.Ec(17),e=Z.lc(2);Z.tc("matMenuTriggerFor",t),Z.Gb(1),Z.Uc(" ",Z.nc(2,2,e.assignment.phaseString)," ")}}function Le(t,e){if(1&t&&(Z.Zb(0,"mat-basic-chip",32),Z.Sc(1),Z.mc(2,"translate"),Z.Yb()),2&t){const t=Z.lc(3);Z.Gb(1),Z.Uc(" ",Z.nc(2,1,t.assignment.phaseString)," ")}}function je(t,e){if(1&t){const t=Z.ac();Z.Zb(0,"button",11),Z.hc("click",(function(){Z.Ic(t);const n=e.$implicit;return Z.lc(3).onSetPhaseButton(n.value)})),Z.Sc(1),Z.mc(2,"translate"),Z.Yb()}if(2&t){const t=e.$implicit;Z.Gb(1),Z.Uc(" ",Z.nc(2,1,t.display_name)," ")}}function Re(t,e){if(1&t&&(Z.Zb(0,"mat-list-item"),Z.Zb(1,"a",35),Z.Sc(2),Z.Yb(),Z.Yb()),2&t){const t=e.$implicit;Z.Gb(1),Z.tc("routerLink",t.url),Z.Gb(1),Z.Tc(t.getTitle())}}function Ee(t,e){if(1&t&&(Z.Zb(0,"div"),Z.Zb(1,"h4"),Z.Sc(2),Z.mc(3,"translate"),Z.Yb(),Z.Zb(4,"mat-list",33),Z.Qc(5,Re,3,2,"mat-list-item",34),Z.Yb(),Z.Yb()),2&t){const t=Z.lc(3);Z.Gb(2),Z.Tc(Z.nc(3,2,"Election documents")),Z.Gb(3),Z.tc("ngForOf",t.assignment.attachments)}}function Ue(t,e){if(1&t&&(Z.Zb(0,"mat-card",21),Z.Qc(1,Ae,3,1,"div",2),Z.Qc(2,Fe,2,1,"div",2),Z.Zb(3,"div",22),Z.Zb(4,"div",23),Z.Zb(5,"h4"),Z.Sc(6),Z.mc(7,"translate"),Z.Yb(),Z.Zb(8,"span"),Z.Sc(9),Z.Yb(),Z.Yb(),Z.Zb(10,"div",24),Z.Zb(11,"h4"),Z.Sc(12),Z.mc(13,"translate"),Z.Yb(),Z.Qc(14,Qe,3,4,"mat-basic-chip",25),Z.Qc(15,Le,3,3,"mat-basic-chip",26),Z.Zb(16,"mat-menu",null,27),Z.Qc(18,je,3,3,"button",28),Z.Yb(),Z.Yb(),Z.Yb(),Z.Qc(19,Ee,6,4,"div",2),Z.Yb()),2&t){const t=Z.lc(2);Z.Gb(1),Z.tc("ngIf",!t.editAssignment&&t.assignment.getTitle),Z.Gb(1),Z.tc("ngIf",t.assignment),Z.Gb(4),Z.Tc(Z.nc(7,9,"Number of persons to be elected")),Z.Gb(3),Z.Tc(t.assignment.assignment.open_posts),Z.Gb(3),Z.Tc(Z.nc(13,11,"Phase")),Z.Gb(2),Z.tc("ngIf",t.hasPerms("manage")),Z.Gb(1),Z.tc("ngIf",!t.hasPerms("manage")),Z.Gb(3),Z.tc("ngForOf",t.phaseOptions),Z.Gb(1),Z.tc("ngIf",t.assignment.attachments.length)}}function Be(t,e){if(1&t&&Z.Qc(0,Ue,20,13,"mat-card",20),2&t){const t=Z.lc();Z.tc("ngIf",t.assignment)}}function He(t,e){if(1&t){const t=Z.ac();Z.Zb(0,"span"),Z.Zb(1,"button",41),Z.hc("click",(function(){Z.Ic(t);const e=Z.lc().$implicit;return Z.lc(4).removeUser(e)})),Z.mc(2,"translate"),Z.Zb(3,"mat-icon"),Z.Sc(4,"clear"),Z.Yb(),Z.Yb(),Z.Yb()}2&t&&(Z.Gb(1),Z.uc("matTooltip",Z.nc(2,1,"Remove candidate")))}function qe(t,e){if(1&t&&Z.Qc(0,He,5,3,"span",2),2&t){const t=Z.lc(4);Z.tc("ngIf",t.hasPerms("manage"))}}function $e(t,e){if(1&t){const t=Z.ac();Z.Zb(0,"div",39),Z.Zb(1,"os-sorting-list",40),Z.hc("sortEvent",(function(e){return Z.Ic(t),Z.lc(3).onSortingChange(e)})),Z.Qc(2,qe,1,1,"ng-template"),Z.Yb(),Z.Yb()}if(2&t){const t=Z.lc(3);Z.Gb(1),Z.tc("input",t.assignment.assignment_related_users)("live",!0)("count",t.assignment.number_poll_candidates)("enable",t.hasPerms("manage"))}}function ze(t,e){if(1&t&&(Z.Zb(0,"form",44),Z.Zb(1,"mat-form-field"),Z.Ub(2,"os-search-value-selector",45),Z.mc(3,"translate"),Z.Yb(),Z.Yb()),2&t){const t=Z.lc(4);Z.tc("formGroup",t.candidatesForm),Z.Gb(2),Z.uc("placeholder",Z.nc(3,4,"Select a new candidate")),Z.tc("multiple",!1)("inputListValues",t.filteredCandidates)}}function Xe(t,e){if(1&t&&(Z.Zb(0,"div",42),Z.Qc(1,ze,4,6,"form",43),Z.Yb()),2&t){const t=Z.lc(3);Z.Gb(1),Z.tc("ngIf",t.hasPerms("addOthers")&&t.filteredCandidates&&t.filteredCandidates.value&&t.filteredCandidates.value.length)}}function We(t,e){if(1&t){const t=Z.ac();Z.Zb(0,"button",47),Z.hc("click",(function(){return Z.Ic(t),Z.lc(4).addSelf()})),Z.Zb(1,"mat-icon"),Z.Sc(2,"add"),Z.Yb(),Z.Zb(3,"span"),Z.Sc(4),Z.mc(5,"translate"),Z.Yb(),Z.Yb()}2&t&&(Z.Gb(4),Z.Tc(Z.nc(5,1,"Add me")))}function Ke(t,e){if(1&t){const t=Z.ac();Z.Zb(0,"button",47),Z.hc("click",(function(){return Z.Ic(t),Z.lc(4).removeSelf()})),Z.Zb(1,"mat-icon"),Z.Sc(2,"remove"),Z.Yb(),Z.Zb(3,"span"),Z.Sc(4),Z.mc(5,"translate"),Z.Yb(),Z.Yb()}2&t&&(Z.Gb(4),Z.Tc(Z.nc(5,1,"Remove me")))}function Je(t,e){if(1&t&&(Z.Zb(0,"div"),Z.Zb(1,"div"),Z.Qc(2,We,6,3,"button",46),Z.Qc(3,Ke,6,3,"button",46),Z.Yb(),Z.Yb()),2&t){const t=Z.lc(3);Z.Gb(2),Z.tc("ngIf",!t.isSelfCandidate),Z.Gb(1),Z.tc("ngIf",t.isSelfCandidate)}}function tn(t,e){if(1&t&&(Z.Zb(0,"mat-card",21),Z.Xb(1),Z.Zb(2,"h3"),Z.Sc(3),Z.mc(4,"translate"),Z.Yb(),Z.Zb(5,"div"),Z.Qc(6,$e,3,4,"div",36),Z.Zb(7,"div",37),Z.Qc(8,Xe,2,1,"div",38),Z.Qc(9,Je,4,2,"div",2),Z.Yb(),Z.Yb(),Z.Wb(),Z.Yb()),2&t){const t=Z.lc(2);Z.Gb(3),Z.Tc(Z.nc(4,4,"Candidates")),Z.Gb(3),Z.tc("ngIf",t.assignment&&t.assignment.assignment_related_users&&t.assignment.assignment_related_users.length>0),Z.Gb(2),Z.tc("ngIf",t.hasPerms("addOthers")),Z.Gb(1),Z.tc("ngIf",t.assignment&&t.hasPerms("addSelf")&&t.assignment.candidates)}}function en(t,e){if(1&t&&Z.Qc(0,tn,10,6,"mat-card",20),2&t){const t=Z.lc();Z.tc("ngIf",t.assignment&&!t.assignment.isFinished)}}function nn(t,e){if(1&t&&Z.Ub(0,"editor",59),2&t){const t=Z.lc(3);Z.tc("init",t.tinyMceSettings)}}function sn(t,e){if(1&t){const t=Z.ac();Z.Zb(0,"div",60),Z.Zb(1,"mat-form-field"),Z.Ub(2,"os-search-value-selector",61),Z.mc(3,"translate"),Z.Yb(),Z.Zb(4,"os-attachment-control",62),Z.hc("errorHandler",(function(e){return Z.Ic(t),Z.lc(3).raiseError(e)})),Z.Yb(),Z.Yb()}if(2&t){const t=Z.lc(3);Z.tc("formGroup",t.assignmentForm),Z.Gb(2),Z.uc("placeholder",Z.nc(3,5,"Tags")),Z.tc("multiple",!0)("includeNone",!0)("inputListValues",t.tagsObserver)}}function on(t,e){if(1&t&&Z.Ub(0,"os-agenda-content-object-form",63),2&t){const t=Z.lc(3);Z.tc("form",t.assignmentForm)}}function an(t,e){1&t&&(Z.Zb(0,"mat-error"),Z.Sc(1),Z.mc(2,"translate"),Z.Yb()),2&t&&(Z.Gb(1),Z.Uc(" ",Z.nc(2,1,"This field is required.")," "))}function cn(t,e){1&t&&(Z.Zb(0,"mat-error"),Z.Sc(1),Z.mc(2,"translate"),Z.Yb()),2&t&&(Z.Gb(1),Z.Uc(" ",Z.nc(2,1,"The number has to be greater than 0.")," "))}function ln(t,e){if(1&t){const t=Z.ac();Z.Zb(0,"form",50),Z.hc("keydown",(function(e){return Z.Ic(t),Z.lc(2).onKeyDown(e)})),Z.Zb(1,"div"),Z.Zb(2,"mat-form-field",51),Z.Ub(3,"input",52),Z.mc(4,"translate"),Z.Zb(5,"mat-error"),Z.Sc(6),Z.mc(7,"translate"),Z.Yb(),Z.Yb(),Z.Yb(),Z.Zb(8,"h4"),Z.Sc(9),Z.mc(10,"translate"),Z.Yb(),Z.Qc(11,nn,1,1,"editor",53),Z.Qc(12,sn,5,7,"div",54),Z.Qc(13,on,1,1,"os-agenda-content-object-form",55),Z.Zb(14,"div"),Z.Zb(15,"mat-form-field"),Z.Ub(16,"input",56),Z.mc(17,"translate"),Z.Yb(),Z.Yb(),Z.Zb(18,"div"),Z.Zb(19,"mat-form-field"),Z.Ub(20,"input",57),Z.mc(21,"translate"),Z.Qc(22,an,3,3,"mat-error",2),Z.Qc(23,cn,3,3,"mat-error",2),Z.Yb(),Z.Yb(),Z.Zb(24,"div"),Z.Zb(25,"mat-checkbox",58),Z.Zb(26,"span"),Z.Sc(27),Z.mc(28,"translate"),Z.Yb(),Z.Yb(),Z.Yb(),Z.Yb()}if(2&t){const t=Z.lc(2);Z.tc("formGroup",t.assignmentForm),Z.Gb(3),Z.uc("placeholder",Z.nc(4,12,"Title")),Z.Gb(3),Z.Tc(Z.nc(7,14,"The title is required")),Z.Gb(3),Z.Uc("",Z.nc(10,16,"Description"),":"),Z.Gb(2),Z.tc("ngIf",t.assignment&&t.editAssignment),Z.Gb(1),Z.tc("ngIf",t.tagsAvailable),Z.Gb(1),Z.tc("ngIf",t.newAssignment),Z.Gb(3),Z.uc("placeholder",Z.nc(17,18,"Hint on voting")),Z.Gb(4),Z.uc("placeholder",Z.nc(21,20,"Number of persons to be elected")),Z.Gb(2),Z.tc("ngIf",t.assignmentForm.get("open_posts").hasError("required")),Z.Gb(1),Z.tc("ngIf",t.assignmentForm.get("open_posts").hasError("min")),Z.Gb(4),Z.Tc(Z.nc(28,22,"Number candidates"))}}function rn(t,e){if(1&t&&(Z.Zb(0,"mat-card",48),Z.Qc(1,ln,29,24,"form",49),Z.Yb()),2&t){const t=Z.lc();Z.Gb(1),Z.tc("ngIf",t.assignment&&t.editAssignment)}}let bn=(()=>{class t extends h.a{constructor(t,e,n,i,s,o,a,r,b,d,m,u,p,g,h,f,v){super(t,e,n),this.translate=e,this.operator=i,this.perms=s,this.router=o,this.route=a,this.repo=b,this.userRepo=d,this.itemRepo=m,this.tagRepo=u,this.promptService=p,this.pdfService=g,this.mediafileRepo=h,this.pollDialog=f,this.assignmentPollService=v,this.newAssignment=!1,this.editAssignment=!1,this.phaseOptions=st.a,this.availableCandidates=new l.a([]),this.filteredCandidates=new l.a([]),this.subscriptions.push(this.userRepo.getViewModelListObservable().subscribe(t=>{this.availableCandidates.next(t),this.filterCandidates()})),this.assignmentForm=r.group({phase:null,tags_id:[],attachments_id:[],title:["",c.G.required],description:[""],default_poll_description:[""],open_posts:[1,[c.G.required,c.G.min(1)]],agenda_create:[""],agenda_parent_id:[],agenda_type:[""],number_poll_candidates:[!1]}),this.candidatesForm=r.group({userId:null})}set assignment(t){this._assignment=t,this.filterCandidates()}get assignment(){return this._assignment}get isSelfCandidate(){return!!this.assignment.candidates.find(t=>t.id===this.operator.user.id)}get tagsAvailable(){return this.tagsObserver.getValue().length>0}get mediafilesAvailable(){return this.mediafilesObserver.getValue().length>0}get parentsAvailable(){return this.agendaObserver.getValue().length>0}ngOnInit(){this.getAssignmentByUrl(),this.agendaObserver=this.itemRepo.getViewModelListBehaviorSubject(),this.tagsObserver=this.tagRepo.getViewModelListBehaviorSubject(),this.mediafilesObserver=this.mediafileRepo.getViewModelListBehaviorSubject()}hasPerms(t){const e=this.operator.hasPerms(o.b.assignmentsCanManage);switch(t){case"addSelf":return!(!e||this.assignment.isFinished)||this.assignment.isSearchingForCandidates&&this.operator.hasPerms(o.b.assignmentsCanNominateSelf)&&!this.assignment.isFinished;case"addOthers":return!(!e||this.assignment.isFinished)||this.assignment.isSearchingForCandidates&&this.operator.hasPerms(o.b.assignmentsCanNominateOther)&&!this.assignment.isFinished;case"createPoll":return e&&this.assignment&&!this.assignment.isFinished&&this.assignment.candidateAmount>0;case"manage":return e;default:return!1}}setEditMode(t){t&&this.hasPerms("manage")&&(this.patchForm(this.assignment),this.editAssignment=!0),!t&&this.newAssignment&&this.router.navigate(["./assignments/"]),t||(this.editAssignment=!1)}patchForm(t){const e={};Object.keys(this.assignmentForm.controls).forEach(n=>{e[n]=t[n]}),this.assignmentForm.patchValue(e)}saveAssignment(){return Object(a.a)(this,void 0,void 0,(function*(){this.newAssignment?this.createAssignment():yield this.updateAssignmentFromForm()}))}openDialog(){const t=Object.assign({collectionString:A.c.COLLECTIONSTRING,assignment_id:this.assignment.id,assignment:this.assignment},this.assignmentPollService.getDefaultPollData(this.assignment.id));this.pollDialog.openDialog(t)}addSelf(){return Object(a.a)(this,void 0,void 0,(function*(){yield this.repo.addSelf(this.assignment).catch(this.raiseError)}))}removeSelf(){return Object(a.a)(this,void 0,void 0,(function*(){yield this.repo.deleteSelf(this.assignment).catch(this.raiseError)}))}addUser(t){return Object(a.a)(this,void 0,void 0,(function*(){const e=this.userRepo.getViewModel(t);e&&(yield this.repo.changeCandidate(e,this.assignment,!0).catch(this.raiseError))}))}removeUser(t){return Object(a.a)(this,void 0,void 0,(function*(){yield this.repo.changeCandidate(t.user,this.assignment,!1).catch(this.raiseError)}))}getAssignmentByUrl(){const t=this.route.snapshot.params;t&&t.id?(this.subscriptions.push(this.repo.getViewModelObservable(+t.id).subscribe(t=>{if(t){const e=t.getTitle();super.setTitle(e),this.assignment=t,this.editAssignment||this.patchForm(this.assignment)}})),this.subscriptions.push(this.candidatesForm.valueChanges.subscribe(t=>{t&&t.userId&&(this.addUser(t.userId),this.candidatesForm.setValue({userId:null}))}))):(super.setTitle("New election"),this.newAssignment=!0,this.editAssignment=!0,this.assignment=new st.b(new g.a))}onDeleteAssignmentButton(){return Object(a.a)(this,void 0,void 0,(function*(){const t=this.translate.instant("Are you sure you want to delete this election?");(yield this.promptService.open(t,this.assignment.getTitle()))&&this.repo.delete(this.assignment).then(()=>this.router.navigate(["../"]),this.raiseError)}))}onTabChange(){}onSetPhaseButton(t){return Object(a.a)(this,void 0,void 0,(function*(){this.repo.update({phase:t},this.assignment).catch(this.raiseError)}))}onDownloadPdf(){this.pdfService.exportSingleAssignment(this.assignment)}createAssignment(){return Object(a.a)(this,void 0,void 0,(function*(){const t=Object.assign({},this.assignmentForm.value);t.agenda_parent_id||delete t.agenda_parent_id;try{const e=yield this.repo.create(t);this.router.navigate(["./assignments/"+e.id])}catch(e){this.raiseError(this.translate.instant(e))}}))}updateAssignmentFromForm(){return Object(a.a)(this,void 0,void 0,(function*(){try{yield this.repo.patch(Object.assign({},this.assignmentForm.value),this.assignment),this.editAssignment=!1}catch(t){this.raiseError(t)}}))}onKeyDown(t){"Enter"===t.key&&t.shiftKey&&this.saveAssignment(),"Escape"===t.key&&this.setEditMode(!1)}filterCandidates(){this.filteredCandidates.next(this.assignment&&this.assignment.candidates.length?this.availableCandidates.getValue().filter(t=>!this.assignment.candidates.some(e=>e.id===t.id)):this.availableCandidates.getValue())}onSortingChange(t){this.repo.sortCandidates(t.map(t=>t.id),this.assignment).catch(this.raiseError)}addToAgenda(){this.itemRepo.addItemToAgenda(this.assignment).catch(this.raiseError)}removeFromAgenda(){this.itemRepo.removeFromAgenda(this.assignment.item).catch(this.raiseError)}}return t.\u0275fac=function(e){return new(e||t)(Z.Tb(Q.d),Z.Tb(C.k),Z.Tb(L.a),Z.Tb(o.a),Z.Tb(f.a),Z.Tb(s.f),Z.Tb(s.a),Z.Tb(c.f),Z.Tb(b.a),Z.Tb(u.a),Z.Tb(r.a),Z.Tb(m.a),Z.Tb(p.a),Z.Tb(M),Z.Tb(d.a),Z.Tb(it),Z.Tb(O.a))},t.\u0275cmp=Z.Nb({type:t,selectors:[["os-assignment-detail"]],features:[Z.Db],decls:23,vars:14,consts:[["mainButtonIcon","edit",3,"hasMainButton","nav","editMode","isSaveButtonEnabled","mainEvent","saveEvent"],[1,"title-slot"],[4,"ngIf"],[1,"menu-slot"],["type","button","mat-icon-button","",3,"matMenuTriggerFor"],["assignmentDetailMenu","matMenu"],[3,"object","menuItem"],[4,"osPerms"],["metaInfoTemplate",""],["candidatesTemplate",""],["assignmentFormTemplate",""],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"click",4,"ngIf"],["mat-menu-item","",1,"red-warning-text",3,"click"],[3,"ngTemplateOutlet"],["class","new-ballot-button",4,"ngIf"],[4,"ngFor","ngForOf","ngForTrackBy"],[3,"poll"],[1,"new-ballot-button"],["mat-stroked-button","",3,"click"],["class","os-card spacer-bottom-60",4,"ngIf"],[1,"os-card","spacer-bottom-60"],[1,"meta-info-grid"],[1,"number-of-elected"],[1,"current-phase"],["class","bluegrey","disableRipple","",3,"matMenuTriggerFor",4,"ngIf"],["class","bluegrey","disableRipple","",4,"ngIf"],["phaseMenu","matMenu"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],[3,"innerHTML",4,"ngIf"],[3,"innerHTML"],["disableRipple","",1,"bluegrey",3,"matMenuTriggerFor"],["disableRipple","",1,"bluegrey"],["dense","",1,"election-document-list"],[4,"ngFor","ngForOf"],["target","_blank",3,"routerLink"],["class","candidates-list",4,"ngIf"],[1,"add-candidates"],["class","search-field",4,"ngIf"],[1,"candidates-list"],[3,"input","live","count","enable","sortEvent"],["mat-icon-button","",3,"matTooltip","click"],[1,"search-field"],[3,"formGroup",4,"ngIf"],[3,"formGroup"],["formControlName","userId",3,"multiple","placeholder","inputListValues"],["mat-button","","color","accent",3,"click",4,"ngIf"],["mat-button","","color","accent",3,"click"],[1,"os-form-card","spacer-bottom-60"],["class","content",3,"formGroup","keydown",4,"ngIf"],[1,"content",3,"formGroup","keydown"],[1,"full-width"],["matInput","","formControlName","title",3,"placeholder"],["formControlName","description",3,"init",4,"ngIf"],["class","content-field",3,"formGroup",4,"ngIf"],[3,"form",4,"ngIf"],["matInput","","formControlName","default_poll_description",3,"placeholder"],["matInput","","formControlName","open_posts","type","number","required","",3,"placeholder"],["formControlName","number_poll_candidates"],["formControlName","description",3,"init"],[1,"content-field",3,"formGroup"],["formControlName","tags_id",3,"multiple","includeNone","placeholder","inputListValues"],["formControlName","attachments_id",3,"errorHandler"],[3,"form"]],template:function(t,e){if(1&t&&(Z.Zb(0,"os-head-bar",0),Z.hc("mainEvent",(function(){return e.setEditMode(!e.editAssignment)}))("saveEvent",(function(){return e.saveAssignment()})),Z.Zb(1,"div",1),Z.Qc(2,Oe,3,3,"h2",2),Z.Qc(3,Ze,3,3,"h2",2),Z.Yb(),Z.Zb(4,"div",3),Z.Zb(5,"button",4),Z.Zb(6,"mat-icon"),Z.Sc(7,"more_vert"),Z.Yb(),Z.Yb(),Z.Yb(),Z.Zb(8,"mat-menu",null,5),Z.Qc(10,Ce,8,5,"div",2),Z.Ub(11,"os-projector-button",6),Z.Qc(12,ye,3,2,"div",7),Z.Qc(13,Te,8,3,"div",2),Z.Yb(),Z.Yb(),Z.Zb(14,"div"),Z.Qc(15,Ie,2,1,"div",2),Z.Qc(16,Ve,5,4,"div",2),Z.Yb(),Z.Qc(17,Be,1,1,"ng-template",null,8,Z.Rc),Z.Qc(19,en,1,1,"ng-template",null,9,Z.Rc),Z.Qc(21,rn,2,1,"ng-template",null,10,Z.Rc)),2&t){const t=Z.Ec(9);Z.tc("hasMainButton",e.hasPerms("manage"))("nav",!1)("editMode",e.editAssignment)("isSaveButtonEnabled",e.assignmentForm.valid),Z.Gb(2),Z.tc("ngIf",!e.newAssignment),Z.Gb(1),Z.tc("ngIf",e.newAssignment),Z.Gb(2),Z.tc("matMenuTriggerFor",t),Z.Gb(5),Z.tc("ngIf",e.assignment),Z.Gb(1),Z.tc("object",e.assignment)("menuItem",!0),Z.Gb(1),Z.tc("osPerms","agenda.can_manage"),Z.Gb(1),Z.tc("ngIf",e.assignment&&e.hasPerms("manage")),Z.Gb(2),Z.tc("ngIf",e.editAssignment),Z.Gb(1),Z.tc("ngIf",!e.editAssignment)}},directives:[ot.a,i.t,j.b,at.e,ct.a,at.f,lt.a,rt.a,at.c,bt.a,dt.a,i.A,i.s,ue,St.a,pe.a,ge.a,ge.d,s.i,he.a,qt.c,c.I,c.t,c.k,U.c,fe.a,c.s,c.i,ve.b,c.c,U.b,c.y,c.D,R.a,Se.a,_e.a,Pe.a],pipes:[C.j,Ye.a,Ge.a],styles:[".full-width[_ngcontent-%COMP%]{width:100%}.meta-info-grid[_ngcontent-%COMP%]{display:grid;grid-column-gap:30px;grid-template-columns:1fr}.meta-info-grid[_ngcontent-%COMP%]   .current-phase[_ngcontent-%COMP%], .meta-info-grid[_ngcontent-%COMP%]   .number-of-elected[_ngcontent-%COMP%]{grid-column:1}@media (min-width:960px){.meta-info-grid[_ngcontent-%COMP%]{grid-template-columns:1fr 2fr}.meta-info-grid[_ngcontent-%COMP%]   .current-phase[_ngcontent-%COMP%]{grid-column:2}}.new-ballot-button[_ngcontent-%COMP%]{display:-ms-flexbox;display:flex}.new-ballot-button[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-left:auto;margin-right:auto}.election-document-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]{height:20px}.candidates-list[_ngcontent-%COMP%]{padding:10px 25px 0}.add-candidates[_ngcontent-%COMP%]   .search-field[_ngcontent-%COMP%]{padding:15px 25px 0;width:auto}.add-candidates[_ngcontent-%COMP%]   .search-field[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]{width:100%}.ballot-controls-grid[_ngcontent-%COMP%]{display:grid;grid-column-gap:10px;grid-template-columns:auto -webkit-min-content;grid-template-columns:auto min-content}.ballot-controls-grid[_ngcontent-%COMP%]   .ballot-title[_ngcontent-%COMP%]{grid-column:1}.ballot-controls-grid[_ngcontent-%COMP%]   .ballot-title[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0}.candidate-list-separator[_ngcontent-%COMP%]{position:static!important;margin:20px 0}.candidate[_ngcontent-%COMP%]{display:-ms-flexbox;display:flex;width:100%;border-bottom:1px solid #d3d3d3;vertical-align:top}.candidate[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{word-wrap:break-word;-ms-flex:1;flex:1}.top-aligned[_ngcontent-%COMP%]{position:absolute;top:0;left:0}"]}),t})();var dn=n("AqIO"),mn=n("KL36"),un=n("wL0i"),pn=n("D/ll"),gn=n("+8Rz");let hn=(()=>{class t extends gn.a{constructor(t,e){super(t,e),this.storageKey="AssignmentList"}getFilterDefinitions(){return[{label:"Phase",property:"phase",options:this.createPhaseOptions()}]}createPhaseOptions(){return st.a.map(t=>({label:t.display_name,condition:t.value,isActive:!1}))}}return t.\u0275fac=function(e){return new(e||t)(Z.dc(dn.a),Z.dc(pn.a))},t.\u0275prov=Z.Pb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var fn=n("A6Ob");let vn=(()=>{class t extends fn.a{constructor(t,e,n){super(t,e,n),this.storageKey="AssignmentList",this.assignmentSortOptions=[{property:"title",label:"Name"},{property:"phase",label:"Phase"},{property:"candidateAmount",label:"Number of candidates"},{property:"id",label:"Creation date"}]}getSortOptions(){return this.assignmentSortOptions}getDefaultDefinition(){return Object(a.a)(this,void 0,void 0,(function*(){return{sortProperty:"title",sortAscending:!0}}))}}return t.\u0275fac=function(e){return new(e||t)(Z.dc(C.k),Z.dc(dn.a),Z.dc(pn.a))},t.\u0275prov=Z.Pb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var Sn=n("0Obk"),_n=n("dRZP");function Pn(t,e){if(1&t&&Z.Ub(0,"a",18),2&t){const t=Z.lc().row;Z.tc("routerLink",t.id)}}function Yn(t,e){if(1&t&&(Z.Zb(0,"mat-chip-list",19),Z.Zb(1,"mat-chip",20),Z.Sc(2),Z.mc(3,"translate"),Z.Yb(),Z.Yb()),2&t){const t=Z.lc().row;Z.Gb(2),Z.Uc(" ",Z.nc(3,1,t.phaseString)," ")}}function Gn(t,e){if(1&t&&(Z.Zb(0,"div",13),Z.Qc(1,Pn,1,1,"a",14),Z.Zb(2,"div",15),Z.Zb(3,"div",16),Z.Sc(4),Z.Yb(),Z.Qc(5,Yn,4,3,"mat-chip-list",17),Z.Yb(),Z.Yb()),2&t){const t=e.row,n=Z.lc();Z.Gb(1),Z.tc("ngIf",!n.isMultiSelect),Z.Gb(3),Z.Uc(" ",t.getListTitle()," "),Z.Gb(1),Z.tc("ngIf",n.vp.isMobile)}}function On(t,e){if(1&t&&(Z.Zb(0,"div",21),Z.Zb(1,"mat-chip-list"),Z.Zb(2,"mat-chip",20),Z.Sc(3),Z.mc(4,"translate"),Z.Yb(),Z.Yb(),Z.Yb()),2&t){const t=e.row;Z.Gb(3),Z.Uc(" ",Z.nc(4,1,t.phaseString)," ")}}function Zn(t,e){if(1&t&&(Z.Zb(0,"div",13),Z.Zb(1,"mat-chip-list"),Z.Zb(2,"mat-chip",22),Z.mc(3,"translate"),Z.Sc(4),Z.Yb(),Z.Yb(),Z.Yb()),2&t){const t=e.row;Z.Gb(2),Z.uc("matTooltip",Z.nc(3,2,"Number of candidates")),Z.Gb(2),Z.Uc(" ",t.candidateAmount," ")}}const Cn=function(t){return{assignment:t}};function wn(t,e){if(1&t){const t=Z.ac();Z.Zb(0,"div",13),Z.Zb(1,"button",23),Z.hc("click",(function(e){return Z.Ic(t),e.stopPropagation()})),Z.Zb(2,"mat-icon"),Z.Sc(3,"more_vert"),Z.Yb(),Z.Yb(),Z.Yb()}if(2&t){const t=e.row,n=Z.lc(),i=Z.Ec(24);Z.Gb(1),Z.tc("disabled",n.isMultiSelect)("matMenuTriggerFor",i)("matMenuTriggerData",Z.zc(3,Cn,t))}}function Mn(t,e){if(1&t&&(Z.Ub(0,"os-projector-button",24),Z.Ub(1,"os-speaker-button",24)),2&t){const t=e.assignment;Z.tc("object",t)("menuItem",!0),Z.Gb(1),Z.tc("object",t)("menuItem",!0)}}function yn(t,e){if(1&t){const t=Z.ac();Z.Zb(0,"button",26),Z.hc("click",(function(){return Z.Ic(t),Z.lc(2).toggleMultiSelect()})),Z.Zb(1,"mat-icon"),Z.Sc(2,"library_add"),Z.Yb(),Z.Zb(3,"span"),Z.Sc(4),Z.mc(5,"translate"),Z.Yb(),Z.Yb()}2&t&&(Z.Gb(4),Z.Tc(Z.nc(5,1,"Multiselect")))}function Tn(t,e){1&t&&(Z.Zb(0,"div"),Z.Ub(1,"mat-divider"),Z.Zb(2,"button",28),Z.Zb(3,"mat-icon"),Z.Sc(4,"settings"),Z.Yb(),Z.Zb(5,"span"),Z.Sc(6),Z.mc(7,"translate"),Z.Yb(),Z.Yb(),Z.Yb()),2&t&&(Z.Gb(6),Z.Tc(Z.nc(7,1,"Settings")))}function In(t,e){if(1&t){const t=Z.ac();Z.Zb(0,"div"),Z.Qc(1,yn,6,3,"button",25),Z.Zb(2,"button",26),Z.hc("click",(function(){return Z.Ic(t),Z.lc().downloadAssignmentButton()})),Z.Zb(3,"mat-icon"),Z.Sc(4,"archive"),Z.Yb(),Z.Zb(5,"span"),Z.Sc(6),Z.mc(7,"translate"),Z.Yb(),Z.Yb(),Z.Qc(8,Tn,8,3,"div",27),Z.Yb()}2&t&&(Z.Gb(1),Z.tc("osPerms","assignment.can_manage"),Z.Gb(5),Z.Tc(Z.nc(7,3,"Export as PDF")),Z.Gb(2),Z.tc("osPerms","core.can_manage_config"))}function kn(t,e){if(1&t){const t=Z.ac();Z.Zb(0,"button",29),Z.hc("click",(function(){Z.Ic(t);const e=Z.lc(2);return e.downloadAssignmentButton(e.selectedRows)})),Z.Zb(1,"mat-icon"),Z.Sc(2,"archive"),Z.Yb(),Z.Zb(3,"span"),Z.Sc(4),Z.mc(5,"translate"),Z.Yb(),Z.Yb()}if(2&t){const t=Z.lc(2);Z.tc("disabled",!t.selectedRows.length),Z.Gb(4),Z.Tc(Z.nc(5,2,"Export selected elections"))}}function xn(t,e){if(1&t){const t=Z.ac();Z.Zb(0,"button",32),Z.hc("click",(function(){return Z.Ic(t),Z.lc(2).deleteSelected()})),Z.Zb(1,"mat-icon"),Z.Sc(2,"delete"),Z.Yb(),Z.Zb(3,"span"),Z.Sc(4),Z.mc(5,"translate"),Z.Yb(),Z.Yb()}if(2&t){const t=Z.lc(2);Z.tc("disabled",!t.selectedRows.length),Z.Gb(4),Z.Tc(Z.nc(5,2,"Delete"))}}function Nn(t,e){if(1&t){const t=Z.ac();Z.Zb(0,"div"),Z.Zb(1,"button",26),Z.hc("click",(function(){return Z.Ic(t),Z.lc().selectAll()})),Z.Zb(2,"mat-icon"),Z.Sc(3,"done_all"),Z.Yb(),Z.Zb(4,"span"),Z.Sc(5),Z.mc(6,"translate"),Z.Yb(),Z.Yb(),Z.Zb(7,"button",29),Z.hc("click",(function(){return Z.Ic(t),Z.lc().deselectAll()})),Z.Zb(8,"mat-icon"),Z.Sc(9,"clear"),Z.Yb(),Z.Zb(10,"span"),Z.Sc(11),Z.mc(12,"translate"),Z.Yb(),Z.Yb(),Z.Ub(13,"mat-divider"),Z.Qc(14,kn,6,4,"button",30),Z.Ub(15,"mat-divider"),Z.Qc(16,xn,6,4,"button",31),Z.Yb()}if(2&t){const t=Z.lc();Z.Gb(5),Z.Tc(Z.nc(6,5,"Select all")),Z.Gb(2),Z.tc("disabled",!t.selectedRows.length),Z.Gb(4),Z.Tc(Z.nc(12,7,"Deselect all")),Z.Gb(3),Z.tc("osPerms","assignment.can_manage"),Z.Gb(2),Z.tc("osPerms","assignment.can_manage")}}let Vn=(()=>{class t extends un.a{constructor(t,e,n,i,s,o,a,c,l,r,b,d,m){super(t,n,i,e),this.translate=n,this.repo=s,this.promptService=o,this.filterService=a,this.sortService=c,this.pdfService=l,this.route=r,this.router=b,this.operator=d,this.vp=m,this.phaseOptions=st.a,this.tableColumnDefinition=[{prop:"title",width:"auto"},{prop:"phase",width:"20%",minWidth:180},{prop:"candidates",width:this.singleButtonWidth}],this.filterProps=["title","candidates","assignment_related_users","tags","candidateAmount"],this.canMultiSelect=!0}get canManageAssignments(){return this.operator.hasPerms(o.b.assignmentsCanManage)}ngOnInit(){super.setTitle("Elections")}onPlusButton(){this.router.navigate(["./new"],{relativeTo:this.route})}getColumnsHiddenInMobile(){const t=["phase","candidates"];return this.operator.hasPerms(o.b.agendaCanSeeListOfSpeakers,o.b.coreCanManageProjector)||t.push("menu"),t}downloadAssignmentButton(t){this.pdfService.exportMultipleAssignments(t||this.repo.getViewModelList())}deleteSelected(){return Object(a.a)(this,void 0,void 0,(function*(){const t=this.translate.instant("Are you sure you want to delete all selected elections?");if(yield this.promptService.open(t))for(const e of this.selectedRows)yield this.repo.delete(e)}))}}return t.\u0275fac=function(e){return new(e||t)(Z.Tb(Q.d),Z.Tb(dn.a),Z.Tb(C.k),Z.Tb(L.a),Z.Tb(b.a),Z.Tb(p.a),Z.Tb(hn),Z.Tb(vn),Z.Tb(M),Z.Tb(s.a),Z.Tb(s.f),Z.Tb(o.a),Z.Tb(mn.a))},t.\u0275cmp=Z.Nb({type:t,selectors:[["os-assignment-list"]],features:[Z.Db],decls:30,vars:24,consts:[[3,"hasMainButton","multiSelectMode","mainEvent"],[1,"title-slot"],[1,"menu-slot"],["type","button","mat-icon-button","",3,"matMenuTriggerFor"],[1,"central-info-slot"],["mat-icon-button","",3,"click"],["listStorageKey","assignments",3,"listObservableProvider","filterService","sortService","columns","filterProps","multiSelect","hiddenInMobile","selectedRows","selectedRowsChange","dataSourceChange"],["class","cell-slot fill",4,"pblNgridCellDef"],["class","cell-slot fill mat-chip-wrapper",4,"pblNgridCellDef"],["singleItemMenu","matMenu"],["matMenuContent",""],["assignmentMenu","matMenu"],[4,"ngIf"],[1,"cell-slot","fill"],["class","detail-link",3,"routerLink",4,"ngIf"],[1,"innerTable"],[1,"title-line","ellipsis-overflow"],["class","ellipsis-overflow",4,"ngIf"],[1,"detail-link",3,"routerLink"],[1,"ellipsis-overflow"],["color","primary","selected",""],[1,"cell-slot","fill","mat-chip-wrapper"],["color","accent","selected","",3,"matTooltip"],["mat-icon-button","",3,"disabled","matMenuTriggerFor","matMenuTriggerData","click"],[3,"object","menuItem"],["mat-menu-item","",3,"click",4,"osPerms"],["mat-menu-item","",3,"click"],[4,"osPerms"],["mat-menu-item","","routerLink","/settings/elections"],["mat-menu-item","",3,"disabled","click"],["mat-menu-item","",3,"disabled","click",4,"osPerms"],["mat-menu-item","","class","red-warning-text",3,"disabled","click",4,"osPerms"],["mat-menu-item","",1,"red-warning-text",3,"disabled","click"]],template:function(t,e){if(1&t&&(Z.Zb(0,"os-head-bar",0),Z.hc("mainEvent",(function(){return e.onPlusButton()})),Z.Zb(1,"div",1),Z.Zb(2,"h2"),Z.Sc(3),Z.mc(4,"translate"),Z.Yb(),Z.Yb(),Z.Zb(5,"div",2),Z.Zb(6,"button",3),Z.Zb(7,"mat-icon"),Z.Sc(8,"more_vert"),Z.Yb(),Z.Yb(),Z.Yb(),Z.Zb(9,"div",4),Z.Zb(10,"button",5),Z.hc("click",(function(){return e.toggleMultiSelect()})),Z.Zb(11,"mat-icon"),Z.Sc(12,"arrow_back"),Z.Yb(),Z.Yb(),Z.Zb(13,"span"),Z.Sc(14),Z.Yb(),Z.Zb(15,"span"),Z.Sc(16),Z.mc(17,"translate"),Z.Yb(),Z.Yb(),Z.Yb(),Z.Zb(18,"os-list-view-table",6),Z.hc("selectedRowsChange",(function(t){return e.selectedRows=t}))("dataSourceChange",(function(t){return e.onDataSourceChange(t)})),Z.Qc(19,Gn,6,3,"div",7),Z.Qc(20,On,5,3,"div",8),Z.Qc(21,Zn,5,4,"div",7),Z.Qc(22,wn,4,5,"div",7),Z.Yb(),Z.Zb(23,"mat-menu",null,9),Z.Qc(25,Mn,2,4,"ng-template",10),Z.Yb(),Z.Zb(26,"mat-menu",null,11),Z.Qc(28,In,9,5,"div",12),Z.Qc(29,Nn,17,9,"div",12),Z.Yb()),2&t){const t=Z.Ec(27);Z.tc("hasMainButton",e.canManageAssignments)("multiSelectMode",e.isMultiSelect),Z.Gb(3),Z.Tc(Z.nc(4,20,"Elections")),Z.Gb(3),Z.tc("matMenuTriggerFor",t),Z.Gb(8),Z.Uc("",e.selectedRows.length,"\xa0"),Z.Gb(2),Z.Tc(Z.nc(17,22,"selected")),Z.Gb(2),Z.tc("listObservableProvider",e.repo)("filterService",e.filterService)("sortService",e.sortService)("columns",e.tableColumnDefinition)("filterProps",e.filterProps)("multiSelect",e.isMultiSelect)("hiddenInMobile",e.getColumnsHiddenInMobile())("selectedRows",e.selectedRows),Z.Gb(1),Z.tc("pblNgridCellDef","title"),Z.Gb(1),Z.tc("pblNgridCellDef","phase"),Z.Gb(1),Z.tc("pblNgridCellDef","candidates"),Z.Gb(1),Z.tc("pblNgridCellDef","menu"),Z.Gb(6),Z.tc("ngIf",!e.isMultiSelect),Z.Gb(1),Z.tc("ngIf",e.isMultiSelect)}},directives:[ot.a,j.b,at.e,ct.a,Sn.a,_n.c,at.f,at.b,i.t,s.i,pe.d,pe.a,qt.c,lt.a,bt.a,rt.a,at.c,dt.a,s.g],pipes:[C.j],styles:[".title-line[_ngcontent-%COMP%]{font-weight:500;font-size:16px}.title-line[_ngcontent-%COMP%]   .icon-prefix[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{display:-ms-inline-flexbox;display:inline-flex;vertical-align:middle;font-size:16px;height:16px;width:16px}.title-line[_ngcontent-%COMP%]   .favorite-star[_ngcontent-%COMP%]{padding-right:3px}.mat-table[_ngcontent-%COMP%]{width:100%}.mat-table[_ngcontent-%COMP%]   .mat-header-row[_ngcontent-%COMP%]   .mat-column-anchor[_ngcontent-%COMP%]{display:none}.mat-table[_ngcontent-%COMP%]   .mat-row[_ngcontent-%COMP%]{position:relative}.mat-table[_ngcontent-%COMP%]   .mat-row[_ngcontent-%COMP%]   .mat-column-anchor[_ngcontent-%COMP%]{position:absolute!important;top:0;right:0;bottom:0;left:0;opacity:.1;z-index:1}.mat-table[_ngcontent-%COMP%]   .mat-row[_ngcontent-%COMP%]   .mat-column-anchor[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:block;height:100%;width:100%}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]{position:relative}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]   .fill[_ngcontent-%COMP%]{position:absolute;display:inherit;height:100%;width:100%;line-height:0}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]   .fill[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{margin-top:auto;margin-bottom:auto}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{z-index:2}.mat-table[_ngcontent-%COMP%]   .mat-table-sticky[_ngcontent-%COMP%]{z-index:3!important}.mat-chip-wrapper[_ngcontent-%COMP%]   .mat-standard-chip[_ngcontent-%COMP%]{height:auto}"],changeDetection:0}),t})();var An=n("TZkb"),Dn=n("R+Vs"),Fn=n("g4jF"),Qn=n("iCsr");function Ln(t,e){if(1&t&&(Z.Zb(0,"h2"),Z.Sc(1),Z.Yb()),2&t){const t=Z.lc();Z.Gb(1),Z.Tc(t.poll.title)}}function jn(t,e){if(1&t&&(Z.Zb(0,"div",11),Z.Zb(1,"button",12),Z.Zb(2,"mat-icon"),Z.Sc(3,"more_vert"),Z.Yb(),Z.Yb(),Z.Yb()),2&t){Z.lc();const t=Z.Ec(9);Z.Gb(1),Z.tc("matMenuTriggerFor",t)}}function Rn(t,e){if(1&t&&(Z.Zb(0,"span"),Z.Sc(1),Z.mc(2,"translate"),Z.Yb()),2&t){const t=Z.lc(3);Z.Gb(1),Z.Uc(" ",Z.nc(2,1,t.poll.typeVerbose)," \xb7 ")}}function En(t,e){if(1&t&&(Z.Ub(0,"os-charts",20),Z.mc(1,"async")),2&t){const t=Z.lc(4);Z.tc("labels",t.candidatesLabels)("data",Z.nc(1,2,t.chartDataSubject))}}function Un(t,e){if(1&t&&(Z.Zb(0,"div"),Z.Sc(1),Z.mc(2,"translate"),Z.Yb()),2&t){const t=e.col;Z.Gb(1),Z.Uc(" ",Z.nc(2,1,t.label)," ")}}function Bn(t,e){if(1&t&&(Z.Zb(0,"div"),Z.Sc(1),Z.mc(2,"translate"),Z.Yb()),2&t){const t=e.col;Z.Gb(1),Z.Uc(" ",Z.nc(2,1,t.label)," ")}}function Hn(t,e){if(1&t&&(Z.Zb(0,"div"),Z.Sc(1),Z.Yb()),2&t){const t=Z.lc(2).row;Z.Gb(1),Z.Uc(" ",t.user.getLevelAndNumber()," ")}}function qn(t,e){if(1&t&&(Z.Zb(0,"div"),Z.Sc(1),Z.mc(2,"translate"),Z.Yb()),2&t){const t=Z.lc(2).row;Z.Gb(1),Z.Vc(" ",Z.nc(2,2,"Vote weight"),": ",t.user.vote_weight," ")}}function $n(t,e){if(1&t&&(Z.Zb(0,"div"),Z.Sc(1),Z.Zb(2,"div",26),Z.Qc(3,Hn,2,1,"div",2),Z.Qc(4,qn,3,4,"div",2),Z.Yb(),Z.Yb()),2&t){const t=Z.lc().row,e=Z.lc(6);Z.Gb(1),Z.Uc(" ",t.user.getShortName()," "),Z.Gb(2),Z.tc("ngIf",t.user.getLevelAndNumber()),Z.Gb(1),Z.tc("ngIf",e.isVoteWeightActive)}}function zn(t,e){1&t&&(Z.Zb(0,"div"),Z.Sc(1),Z.mc(2,"translate"),Z.Yb()),2&t&&(Z.Gb(1),Z.Uc(" ",Z.nc(2,1,"Anonymous")," "))}function Xn(t,e){if(1&t&&(Z.Zb(0,"div"),Z.Qc(1,$n,5,3,"div",2),Z.Qc(2,zn,3,3,"div",2),Z.Yb()),2&t){const t=e.row;Z.Gb(1),Z.tc("ngIf",t.user),Z.Gb(1),Z.tc("ngIf",!t.user)}}function Wn(t,e){if(1&t&&(Z.Zb(0,"div",28),Z.Sc(1),Z.Yb()),2&t){const t=e.$implicit;Z.Gb(1),Z.Tc(t)}}function Kn(t,e){if(1&t&&(Z.Zb(0,"div"),Z.Qc(1,Wn,2,1,"div",27),Z.Yb()),2&t){const t=e.row;Z.Gb(1),Z.tc("ngForOf",t.votes)}}function Jn(t,e){if(1&t&&(Z.Zb(0,"os-list-view-table",23),Z.Qc(1,Un,3,3,"div",24),Z.Qc(2,Bn,3,3,"div",24),Z.Qc(3,Xn,3,2,"div",25),Z.Qc(4,Kn,2,1,"div",25),Z.Yb()),2&t){const t=Z.lc(5);Z.tc("listObservable",t.votesDataObservable)("columns",t.columnDefinitionSingleVotes)("filterProps",t.filterProps)("allowProjector",!1)("fullScreen",!1)("vScrollFixed",-1)("showListOfSpeakers",!1)("showMenu",!1),Z.Gb(1),Z.tc("pblNgridHeaderCellDef","user"),Z.Gb(1),Z.tc("pblNgridHeaderCellDef","votes"),Z.Gb(1),Z.tc("pblNgridCellDef","user"),Z.Gb(1),Z.tc("pblNgridCellDef","votes")}}function ti(t,e){1&t&&(Z.Zb(0,"div"),Z.Sc(1),Z.mc(2,"translate"),Z.Yb()),2&t&&(Z.Gb(1),Z.Uc(" ",Z.nc(2,1,"The individual votes were anonymized.")," "))}function ei(t,e){if(1&t&&(Z.Zb(0,"div",21),Z.Zb(1,"h3"),Z.Sc(2),Z.mc(3,"translate"),Z.Yb(),Z.Qc(4,Jn,5,12,"os-list-view-table",22),Z.Qc(5,ti,3,3,"div",2),Z.Yb()),2&t){const t=Z.lc(4);Z.Gb(2),Z.Tc(Z.nc(3,3,"Single votes")),Z.Gb(2),Z.tc("ngIf",t.votesDataObservable),Z.Gb(1),Z.tc("ngIf",!t.votesDataObservable)}}function ni(t,e){if(1&t&&(Z.Zb(0,"div",15),Z.Ub(1,"os-assignment-poll-detail-content",16),Z.Zb(2,"div",17),Z.Qc(3,En,2,4,"os-charts",18),Z.Yb(),Z.Qc(4,ei,6,5,"div",19),Z.Yb()),2&t){const t=Z.lc(3);Z.Gb(1),Z.tc("poll",t.poll),Z.Gb(2),Z.tc("ngIf",t.chartDataSubject.value),Z.Gb(1),Z.tc("ngIf","named"===t.poll.type)}}function ii(t,e){if(1&t&&(Z.Zb(0,"div"),Z.Zb(1,"h1"),Z.Sc(2),Z.Yb(),Z.Zb(3,"div"),Z.Qc(4,Rn,3,3,"span",2),Z.Zb(5,"span"),Z.Sc(6),Z.mc(7,"translate"),Z.Yb(),Z.Yb(),Z.Qc(8,ni,5,3,"div",14),Z.Yb()),2&t){const t=Z.lc(2);Z.Gb(2),Z.Tc(t.poll.title),Z.Gb(2),Z.tc("ngIf","analog"!==t.poll.type),Z.Gb(2),Z.Uc(" ",Z.nc(7,4,t.poll.stateVerbose)," "),Z.Gb(2),Z.tc("ngIf",t.poll&&t.poll.stateHasVotes)}}function si(t,e){1&t&&(Z.Zb(0,"span"),Z.Sc(1,", "),Z.Yb())}function oi(t,e){if(1&t&&(Z.Zb(0,"span"),Z.Sc(1),Z.mc(2,"translate"),Z.Qc(3,si,2,0,"span",2),Z.Yb()),2&t){const t=e.$implicit,n=e.index,i=Z.lc(4);Z.Gb(1),Z.Uc(" ",Z.nc(2,2,t.getTitle()),""),Z.Gb(2),Z.tc("ngIf",n<i.poll.groups.length-1)}}function ai(t,e){if(1&t&&(Z.Zb(0,"small"),Z.Sc(1),Z.mc(2,"translate"),Z.Qc(3,oi,4,4,"span",30),Z.Yb()),2&t){const t=Z.lc(3);Z.Gb(1),Z.Uc(" ",Z.nc(2,2,"Groups"),": "),Z.Gb(2),Z.tc("ngForOf",t.poll.groups)}}function ci(t,e){if(1&t&&(Z.Zb(0,"small"),Z.Sc(1),Z.mc(2,"translate"),Z.mc(3,"translate"),Z.Yb()),2&t){const t=Z.lc(3);Z.Gb(1),Z.Vc(" ",Z.nc(2,2,"100% base"),": ",Z.nc(3,4,t.poll.percentBaseVerbose)," ")}}function li(t,e){if(1&t&&(Z.Zb(0,"div",29),Z.Qc(1,ai,4,4,"small",2),Z.Qc(2,ci,4,6,"small",2),Z.Yb()),2&t){const t=Z.lc(2);Z.Gb(1),Z.tc("ngIf",t.poll.groups&&t.poll.type&&"analog"!==t.poll.type),Z.Gb(1),Z.tc("ngIf",t.poll.onehundred_percent_base)}}function ri(t,e){if(1&t&&(Z.Qc(0,ii,9,6,"div",2),Z.Qc(1,li,3,2,"div",13)),2&t){const t=Z.lc();Z.tc("ngIf",t.isReady),Z.Gb(1),Z.tc("ngIf",t.poll)}}function bi(t,e){if(1&t&&Z.Ub(0,"os-projector-button",31),2&t){const t=Z.lc();Z.tc("menuItem",!0)("object",t.poll)}}function di(t,e){if(1&t){const t=Z.ac();Z.Zb(0,"button",32),Z.hc("click",(function(){Z.Ic(t);const e=Z.lc();return e.openDialog(e.poll)})),Z.Zb(1,"mat-icon"),Z.Sc(2,"edit"),Z.Yb(),Z.Zb(3,"span"),Z.Sc(4),Z.mc(5,"translate"),Z.Yb(),Z.Yb()}2&t&&(Z.Gb(4),Z.Tc(Z.nc(5,1,"Edit")))}function mi(t,e){if(1&t){const t=Z.ac();Z.Zb(0,"button",32),Z.hc("click",(function(){return Z.Ic(t),Z.lc().pseudoanonymizePoll()})),Z.Zb(1,"mat-icon"),Z.Sc(2,"warning"),Z.Yb(),Z.Zb(3,"span"),Z.Sc(4),Z.mc(5,"translate"),Z.Yb(),Z.Yb()}2&t&&(Z.Gb(4),Z.Tc(Z.nc(5,1,"Anonymize votes")))}function ui(t,e){if(1&t){const t=Z.ac();Z.Zb(0,"button",32),Z.hc("click",(function(){return Z.Ic(t),Z.lc().deletePoll()})),Z.Zb(1,"mat-icon",33),Z.Sc(2,"delete"),Z.Yb(),Z.Zb(3,"span"),Z.Sc(4),Z.mc(5,"translate"),Z.Yb(),Z.Yb()}2&t&&(Z.Gb(4),Z.Tc(Z.nc(5,1,"Delete")))}const pi=[{path:"",component:Vn,pathMatch:"full"},{path:"new",component:bn,data:{basePerm:o.b.assignmentsCanManage}},{path:":id",component:bn,data:{basePerm:o.b.assignmentsCanSee}},{path:"polls",children:[{path:":id",component:(()=>{class t extends Fn.a{constructor(t,e,n,i,s,o,a,c,l,r,b,d,m){super(t,e,n,i,s,o,a,c,r,b),this.pollService=r,this.operator=d,this.router=m,this.filterProps=["user.getFullName"],this.isReady=!1,this.candidatesLabels=[],l.get("users_activate_vote_weight").subscribe(t=>this.isVoteWeightActive=t)}createVotesData(){const t={};let e=!0;for(const n of this.poll.options)for(const i of n.votes){const s=i.user_id;s&&(e=!1,t[s]||(t[s]={user:i.user,votes:[]}),i.weight>0&&t[s].votes.push(this.poll.isMethodY?"Y"===i.value?n.user.getFullName():this.voteValueToLabel(i.value):`${n.user.getShortName()}: ${this.voteValueToLabel(i.value)}`))}if(!e)for(const n of this.poll.voted)t[n.id]||(t[n.id]={user:n,votes:[this.translate.instant("empty vote")]});this.setVotesData(Object.values(t)),this.candidatesLabels=this.pollService.getChartLabels(this.poll),this.columnDefinitionSingleVotes=[{prop:"user",label:"Participant",width:"40%",minWidth:300},{prop:"votes",label:"Votes",width:"60%",minWidth:300}],this.isReady=!0}voteValueToLabel(t){if("Y"===t)return this.translate.instant("Yes");if("N"===t)return this.translate.instant("No");if("A"===t)return this.translate.instant("Abstain");throw new Error("voteValueToLabel received illegal arguments: "+t)}hasPerms(){return this.operator.hasPerms(o.b.assignmentsCanManage)}onDeleted(){this.router.navigate(["assignments",this.poll.assignment_id])}}return t.\u0275fac=function(e){return new(e||t)(Z.Tb(Q.d),Z.Tb(C.k),Z.Tb(L.a),Z.Tb(mt.a),Z.Tb(s.a),Z.Tb(Dn.a),Z.Tb(p.a),Z.Tb(it),Z.Tb(ft.a),Z.Tb(O.a),Z.Tb(An.a),Z.Tb(o.a),Z.Tb(s.f))},t.\u0275cmp=Z.Nb({type:t,selectors:[["os-assignment-poll-detail"]],features:[Z.Db],decls:15,vars:10,consts:[[3,"goBack","nav"],[1,"title-slot"],[4,"ngIf"],["class","menu-slot",4,"osPerms"],[1,"os-card","spacer-bottom-60"],[3,"ngTemplateOutlet"],["viewTemplate",""],["pollDetailMenu","matMenu"],[3,"menuItem","object",4,"osPerms"],["mat-menu-item","",3,"click",4,"osPerms"],["mat-menu-item","",3,"click",4,"osPerms","osPermsAnd"],[1,"menu-slot"],["type","button","mat-icon-button","",3,"matMenuTriggerFor"],["class","assignment-poll-meta",4,"ngIf"],["class","assignment-result-wrapper",4,"ngIf"],[1,"assignment-result-wrapper"],[3,"poll"],[1,"chart-wrapper"],["class","assignment-result-chart",3,"labels","data",4,"ngIf"],["class","named-result-table",4,"ngIf"],[1,"assignment-result-chart",3,"labels","data"],[1,"named-result-table"],["class","single-votes-table","listStorageKey","assignment-poll-vote",3,"listObservable","columns","filterProps","allowProjector","fullScreen","vScrollFixed","showListOfSpeakers","showMenu",4,"ngIf"],["listStorageKey","assignment-poll-vote",1,"single-votes-table",3,"listObservable","columns","filterProps","allowProjector","fullScreen","vScrollFixed","showListOfSpeakers","showMenu"],[4,"pblNgridHeaderCellDef"],[4,"pblNgridCellDef"],[1,"user-subtitle"],["class","single-vote-result",4,"ngFor","ngForOf"],[1,"single-vote-result"],[1,"assignment-poll-meta"],[4,"ngFor","ngForOf"],[3,"menuItem","object"],["mat-menu-item","",3,"click"],["color","warn"]],template:function(t,e){if(1&t&&(Z.Zb(0,"os-head-bar",0),Z.Zb(1,"div",1),Z.Qc(2,Ln,2,1,"h2",2),Z.Yb(),Z.Qc(3,jn,4,1,"div",3),Z.Yb(),Z.Zb(4,"mat-card",4),Z.Vb(5,5),Z.Yb(),Z.Qc(6,ri,2,2,"ng-template",null,6,Z.Rc),Z.Zb(8,"mat-menu",null,7),Z.Qc(10,bi,1,2,"os-projector-button",8),Z.Qc(11,di,6,3,"button",9),Z.Qc(12,mi,6,3,"button",10),Z.Ub(13,"mat-divider"),Z.Qc(14,ui,6,3,"button",9),Z.Yb()),2&t){const t=Z.Ec(7);Z.tc("goBack",!0)("nav",!1),Z.Gb(2),Z.tc("ngIf",!!e.poll),Z.Gb(1),Z.tc("osPerms","assignments.can_manage"),Z.Gb(2),Z.tc("ngTemplateOutlet",t),Z.Gb(5),Z.tc("osPerms","core.can_manage_projector"),Z.Gb(1),Z.tc("osPerms","assignments.can_manage"),Z.Gb(1),Z.tc("osPerms","assignments.can_manage")("osPermsAnd",e.poll&&"named"===e.poll.type),Z.Gb(2),Z.tc("osPerms","assignments.can_manage")}},directives:[ot.a,i.t,rt.a,St.a,i.A,at.f,dt.a,j.b,at.e,ct.a,_t.a,Qn.a,Sn.a,_n.h,_n.c,i.s,lt.a,at.c],pipes:[C.j,i.b],styles:['.assignment-result-wrapper .chart-wrapper{margin-top:2em}.assignment-result-wrapper .named-result-table .mat-form-field{font-size:14px;width:100%}.assignment-result-wrapper .named-result-table .single-votes-table{display:block;height:500px}.assignment-result-wrapper .named-result-table .single-votes-table .list-view-frame{height:100%}.assignment-result-wrapper .named-result-table .single-votes-table .single-vote-result+.single-vote-result{margin-top:1em}.assignment-result-wrapper .named-result-table .vote-field{text-align:center;width:100%;padding-right:12px}.assignment-poll-meta{display:grid;text-align:right;padding-top:20px}.openslides-theme .pbl-ngrid-no-data{top:10%}.openslides-theme .pbl-ngrid-header-cell:first-child{overflow:visible}.openslides-theme .pbl-ngrid-header-cell:first-child:after{content:"";display:block;position:absolute;top:0;right:-1px;height:100%}'],encapsulation:2}),t})()}]}];let gi=(()=>{class t{}return t.\u0275mod=Z.Rb({type:t}),t.\u0275inj=Z.Qb({factory:function(e){return new(e||t)},imports:[[s.j.forChild(pi)],s.j]}),t})();var hi=n("bVYn"),fi=n("PCNd");let vi=(()=>{class t{}return t.\u0275mod=Z.Rb({type:t}),t.\u0275inj=Z.Qb({factory:function(e){return new(e||t)},imports:[[i.c,gi,fi.a,hi.PollsModule]]}),t})()},bVYn:function(t,e,n){"use strict";n.r(e),n.d(e,"PollsModule",(function(){return N}));var i=n("ofXK"),s=n("tyNb"),o=n("AqIO"),a=n("M0z7"),c=n("wL0i"),l=n("D/ll"),r=n("+8Rz"),b=n("qnZ9"),d=n("fXoL"),m=n("sYmb");let u=(()=>{class t extends r.a{constructor(t,e,n){super(t,e),this.translate=n,this.storageKey="PollList"}preFilter(t){return t.filter(t=>!t.isAnalog)}getFilterDefinitions(){return[{property:"state",label:this.translate.instant("State"),options:[{condition:b.e.Created,label:this.translate.instant("created")},{condition:b.e.Started,label:this.translate.instant("started")},{condition:b.e.Finished,label:this.translate.instant("finished (unpublished)")},{condition:b.e.Published,label:this.translate.instant("published")}]},{property:"hasVote",label:this.translate.instant("Votings"),options:[{condition:!1,label:this.translate.instant("Voting is currently in progress.")},{condition:!0,label:this.translate.instant("You have already voted.")}]}]}}return t.\u0275fac=function(e){return new(e||t)(d.dc(o.a),d.dc(l.a),d.dc(m.k))},t.\u0275prov=d.Pb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var p=n("PoOO"),g=n("jhN1"),h=n("dNgK"),f=n("mksl"),v=n("0Obk"),S=n("dRZP"),_=n("NFeN"),P=n("Qu3c");function Y(t,e){if(1&t&&d.Ub(0,"a",5),2&t){const t=d.lc().row;d.tc("routerLink",t.parentLink)}}function G(t,e){if(1&t&&(d.Zb(0,"div",3),d.Qc(1,Y,1,1,"a",4),d.Zb(2,"span"),d.Sc(3),d.Yb(),d.Yb()),2&t){const t=e.row,n=d.lc();d.Gb(1),d.tc("ngIf",!n.isMultiSelect),d.Gb(2),d.Tc(t.title)}}function O(t,e){if(1&t&&d.Ub(0,"a",5),2&t){const t=d.lc().row;d.tc("routerLink",t.parentLink)}}function Z(t,e){if(1&t&&(d.Zb(0,"div",3),d.Qc(1,O,1,1,"a",4),d.Zb(2,"span"),d.Sc(3),d.Yb(),d.Yb()),2&t){const t=e.row,n=d.lc();d.Gb(1),d.tc("ngIf",!n.isMultiSelect),d.Gb(2),d.Tc(t.getContentObject().getListTitle())}}function C(t,e){if(1&t&&d.Ub(0,"a",5),2&t){const t=d.lc().row;d.tc("routerLink",t.parentLink)}}function w(t,e){if(1&t&&(d.Zb(0,"div",3),d.Qc(1,C,1,1,"a",4),d.Zb(2,"span"),d.Sc(3),d.mc(4,"translate"),d.Yb(),d.Yb()),2&t){const t=e.row,n=d.lc();d.Gb(1),d.tc("ngIf",!n.isMultiSelect),d.Gb(2),d.Tc(d.nc(4,2,t.stateVerbose))}}function M(t,e){1&t&&(d.Zb(0,"mat-icon",8),d.mc(1,"translate"),d.Sc(2," check_circle "),d.Yb()),2&t&&d.uc("matTooltip",d.nc(1,1,"You have already voted."))}function y(t,e){1&t&&(d.Zb(0,"mat-icon",9),d.mc(1,"translate"),d.Sc(2," warning "),d.Yb()),2&t&&d.uc("matTooltip",d.nc(1,1,"Voting is currently in progress."))}function T(t,e){if(1&t&&(d.Zb(0,"div",3),d.Qc(1,M,3,3,"mat-icon",6),d.Qc(2,y,3,3,"mat-icon",7),d.Yb()),2&t){const t=e.row;d.Gb(1),d.tc("ngIf",t.hasVote),d.Gb(1),d.tc("ngIf",!t.hasVote&&null!==t.hasVote)}}const I=[{path:"",component:(()=>{class t extends c.a{constructor(t,e,n,i,s,o,a){super(s,o,a,i),this.polls=t,this.filterService=e,this.votingService=n,this.storage=i,this.tableColumnDefinition=[{prop:"title",width:"auto"},{prop:"classType",width:"auto"},{prop:"state",width:"auto"},{prop:"votability",width:"25px"}],this.filterProps=["title","state"],super.setTitle("List of electronic votes")}}return t.\u0275fac=function(e){return new(e||t)(d.Tb(p.a),d.Tb(u),d.Tb(a.b),d.Tb(o.a),d.Tb(g.d),d.Tb(m.k),d.Tb(h.a))},t.\u0275cmp=d.Nb({type:t,selectors:[["os-poll-list"]],features:[d.Db],decls:9,vars:12,consts:[[1,"title-slot"],["listStorageKey","polls",3,"listObservableProvider","vScrollFixed","columns","filterProps","filterService"],["class","cell-slot fill",4,"pblNgridCellDef"],[1,"cell-slot","fill"],["class","detail-link",3,"routerLink",4,"ngIf"],[1,"detail-link",3,"routerLink"],["color","accent",3,"matTooltip",4,"ngIf"],["color","warn",3,"matTooltip",4,"ngIf"],["color","accent",3,"matTooltip"],["color","warn",3,"matTooltip"]],template:function(t,e){1&t&&(d.Zb(0,"os-head-bar"),d.Zb(1,"div",0),d.Sc(2),d.mc(3,"translate"),d.Yb(),d.Yb(),d.Zb(4,"os-list-view-table",1),d.Qc(5,G,4,2,"div",2),d.Qc(6,Z,4,2,"div",2),d.Qc(7,w,5,4,"div",2),d.Qc(8,T,3,2,"div",2),d.Yb()),2&t&&(d.Gb(2),d.Tc(d.nc(3,10,"List of electronic votes")),d.Gb(2),d.tc("listObservableProvider",e.polls)("vScrollFixed",64)("columns",e.tableColumnDefinition)("filterProps",e.filterProps)("filterService",e.filterService),d.Gb(1),d.tc("pblNgridCellDef","title"),d.Gb(1),d.tc("pblNgridCellDef","classType"),d.Gb(1),d.tc("pblNgridCellDef","state"),d.Gb(1),d.tc("pblNgridCellDef","votability"))},directives:[f.a,v.a,S.c,i.t,s.i,_.a,P.c],pipes:[m.j],styles:[""]}),t})(),pathMatch:"full"}];let k=(()=>{class t{}return t.\u0275mod=d.Rb({type:t}),t.\u0275inj=d.Qb({factory:function(e){return new(e||t)},imports:[[s.j.forChild(I)],s.j]}),t})();var x=n("PCNd");let N=(()=>{class t{}return t.\u0275mod=d.Rb({type:t}),t.\u0275inj=d.Qb({factory:function(e){return new(e||t)},imports:[[i.c,k,x.a]]}),t})()},g4jF:function(t,e,n){"use strict";n.d(e,"a",(function(){return d}));var i=n("mrSG"),s=n("2Vo4"),o=n("Cfvw"),a=n("pLZG"),c=n("lJxs"),l=n("g96W"),r=n("mV3u"),b=n("fXoL");let d=(()=>{class t extends r.a{constructor(t,e,n,i,o,a,c,r,b,d){super(t,e,n),this.translate=e,this.repo=i,this.route=o,this.groupRepo=a,this.promptService=c,this.pollDialog=r,this.pollService=b,this.votesRepo=d,this.userGroups=[],this.groupObservable=null,this.voteOptionStyle={Y:{css:"yes",icon:"thumb_up"},N:{css:"no",icon:"thumb_down"},A:{css:"abstain",icon:"trip_origin"}},this.poll=null,this.labels=[],this.chartDataSubject=new s.a(null),this.optionsLoaded=new l.a,this.setup()}setup(){return Object(i.a)(this,void 0,void 0,(function*(){yield this.optionsLoaded,this.votesRepo.getViewModelListObservable().pipe(Object(a.a)(()=>this.poll&&this.canSeeVotes),Object(c.a)(t=>t.filter(t=>t.option.poll_id===this.poll.id)),Object(a.a)(t=>!!t.length)).subscribe(()=>{this.createVotesData()})}))}ngOnInit(){this.findComponentById(),this.groupObservable=this.groupRepo.getViewModelListObservable(),this.subscriptions.push(this.groupRepo.getViewModelListObservable().subscribe(t=>this.userGroups=t))}deletePoll(){return Object(i.a)(this,void 0,void 0,(function*(){const t=this.translate.instant("Are you sure you want to delete this vote?");(yield this.promptService.open(t))&&this.repo.delete(this.poll).then(()=>this.onDeleted(),this.raiseError)}))}pseudoanonymizePoll(){return Object(i.a)(this,void 0,void 0,(function*(){const t=this.translate.instant("Are you sure you want to anonymize all votes? This cannot be undone.");(yield this.promptService.open(t))&&this.repo.pseudoanonymize(this.poll).catch(this.raiseError)}))}openDialog(t){this.pollDialog.openDialog(t)}onStateChanged(){}get canSeeVotes(){return this.hasPerms&&this.poll.isFinished||this.poll.isPublished}setVotesData(t){this.votesDataObservable=t.every(t=>!t.user)?null:Object(o.a)([t])}initChartData(){this.chartDataSubject.next(this.pollService.generateChartData(this.poll))}findComponentById(){const t=this.route.snapshot.params;t&&t.id&&this.subscriptions.push(this.repo.getViewModelObservable(t.id).subscribe(t=>{t&&(this.poll=t,this.createVotesData(),this.initChartData(),this.optionsLoaded.resolve())}))}}return t.\u0275fac=function(t){b.gc()},t.\u0275dir=b.Ob({type:t,features:[b.Db]}),t})()},wL0i:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var i=n("mV3u");class s extends i.a{constructor(t,e,n,i){super(t,e,n),this.storage=i,this.canMultiSelect=!1,this._multiSelectMode=!1,this.singleButtonWidth="40px",this.badgeButtonWidth="45px",this.selectedRows=[]}onDataSourceChange(t){this.dataSource=t}toggleMultiSelect(){!this.canMultiSelect||this.isMultiSelect?(this._multiSelectMode=!1,this.deselectAll()):this._multiSelectMode=!0}selectAll(){this.dataSource.selection.select(...this.dataSource.filteredData)}deselectAll(){this.dataSource&&this.dataSource.selection.clear()}get isMultiSelect(){return this._multiSelectMode}}}}]);