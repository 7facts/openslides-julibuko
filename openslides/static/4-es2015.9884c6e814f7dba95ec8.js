(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{GTZY:function(t,e,n){"use strict";n.d(e,"a",(function(){return Q}));var o=n("mrSG"),i=n("fXoL"),a=n("+0xr"),c=n("SSyl"),l=n("R+Vs"),r=n("3Pt+"),s=n("gfTr"),d=n("ofXK"),b=n("bTqV"),u=n("kmnG"),m=n("oqD5"),p=n("qFsG"),f=n("NFeN"),g=n("Wp6s"),h=n("bv9b"),C=n("sYmb");function _(t,e){if(1&t&&(i.Zb(0,"div",12),i.Zb(1,"mat-form-field"),i.Ub(2,"os-search-value-selector",13),i.mc(3,"translate"),i.Yb(),i.Yb()),2&t){const t=i.lc();i.tc("formGroup",t.directorySelectionForm),i.Gb(2),i.uc("placeholder",i.nc(3,6,"Parent directory")),i.tc("multiple",!1)("includeNone",!0)("noneTitle","Base folder")("inputListValues",t.directoryBehaviorSubject)}}function M(t,e){1&t&&(i.Zb(0,"i"),i.Sc(1),i.mc(2,"translate"),i.Yb()),2&t&&(i.Gb(1),i.Tc(i.nc(2,1,"Base folder")))}function P(t,e){if(1&t&&(i.Zb(0,"i"),i.Sc(1),i.Yb()),2&t){const t=i.lc();i.Gb(1),i.Tc(t.getDirectory(t.selectedDirectoryId).title)}}function O(t,e){1&t&&(i.Zb(0,"th",26),i.Zb(1,"span"),i.Sc(2),i.mc(3,"translate"),i.Yb(),i.Yb()),2&t&&(i.Gb(2),i.Tc(i.nc(3,1,"Title")))}function v(t,e){if(1&t){const t=i.ac();i.Zb(0,"td",27),i.Zb(1,"mat-form-field"),i.Zb(2,"input",28),i.hc("input",(function(n){i.Ic(t);const o=e.$implicit;return i.lc(2).onChangeTitle(n.target.value,o)})),i.Yb(),i.Yb(),i.Yb()}if(2&t){const t=e.$implicit;i.Gb(2),i.tc("value",t.title)}}function y(t,e){1&t&&(i.Zb(0,"th",26),i.Zb(1,"span"),i.Sc(2),i.mc(3,"translate"),i.Yb(),i.Yb()),2&t&&(i.Gb(2),i.Tc(i.nc(3,1,"File name")))}function w(t,e){if(1&t&&(i.Zb(0,"td",27),i.Sc(1),i.Yb()),2&t){const t=e.$implicit;i.Gb(1),i.Tc(t.filename)}}function Z(t,e){1&t&&(i.Zb(0,"th",26),i.Zb(1,"span"),i.Sc(2),i.mc(3,"translate"),i.Yb(),i.Yb()),2&t&&(i.Gb(2),i.Tc(i.nc(3,1,"File information")))}function Y(t,e){if(1&t&&(i.Zb(0,"td",27),i.Zb(1,"div",29),i.Zb(2,"span"),i.Zb(3,"mat-icon",30),i.Sc(4,"insert_drive_file"),i.Yb(),i.Sc(5),i.mc(6,"translate"),i.Yb(),i.Zb(7,"span"),i.Zb(8,"mat-icon",30),i.Sc(9,"data_usage"),i.Yb(),i.Sc(10),i.Yb(),i.Yb(),i.Yb()),2&t){const t=e.$implicit,n=i.lc(2);i.Gb(3),i.tc("inline",!0),i.Gb(2),i.Uc(" ",i.nc(6,4,n.getFiletype(t.mediafile))," "),i.Gb(3),i.tc("inline",!0),i.Gb(2),i.Uc(" ",n.getReadableSize(t.mediafile.size)," ")}}function S(t,e){1&t&&(i.Zb(0,"th",26),i.Zb(1,"span"),i.Sc(2),i.mc(3,"translate"),i.Yb(),i.Yb()),2&t&&(i.Gb(2),i.Tc(i.nc(3,1,"Access groups")))}function G(t,e){if(1&t&&(i.Zb(0,"td",31),i.Zb(1,"mat-form-field"),i.Ub(2,"os-search-value-selector",32),i.mc(3,"translate"),i.Yb(),i.Yb()),2&t){const t=e.$implicit,n=i.lc(2);i.tc("formGroup",t.form),i.Gb(2),i.uc("placeholder",i.nc(3,4,"Access groups")),i.tc("multiple",!0)("inputListValues",n.groupsBehaviorSubject)}}function I(t,e){1&t&&(i.Zb(0,"th",26),i.Zb(1,"span"),i.Sc(2),i.mc(3,"translate"),i.Yb(),i.Yb()),2&t&&(i.Gb(2),i.Tc(i.nc(3,1,"Remove")))}function D(t,e){if(1&t){const t=i.ac();i.Zb(0,"td",27),i.Zb(1,"button",33),i.hc("click",(function(){i.Ic(t);const n=e.$implicit;return i.lc(2).onRemoveButton(n)})),i.Zb(2,"mat-icon"),i.Sc(3,"close"),i.Yb(),i.Yb(),i.Yb()}}function F(t,e){1&t&&i.Ub(0,"tr",34)}function L(t,e){1&t&&i.Ub(0,"tr",35)}function B(t,e){if(1&t&&(i.Zb(0,"div",14),i.Zb(1,"table",15),i.Xb(2,16),i.Qc(3,O,4,3,"th",17),i.Qc(4,v,3,1,"td",18),i.Wb(),i.Xb(5,19),i.Qc(6,y,4,3,"th",17),i.Qc(7,w,2,1,"td",18),i.Wb(),i.Xb(8,20),i.Qc(9,Z,4,3,"th",17),i.Qc(10,Y,11,6,"td",18),i.Wb(),i.Xb(11,21),i.Qc(12,S,4,3,"th",17),i.Qc(13,G,4,6,"td",22),i.Wb(),i.Xb(14,23),i.Qc(15,I,4,3,"th",17),i.Qc(16,D,4,0,"td",18),i.Wb(),i.Qc(17,F,1,0,"tr",24),i.Qc(18,L,1,0,"tr",25),i.Yb(),i.Yb()),2&t){const t=i.lc();i.Gb(1),i.tc("dataSource",t.uploadList),i.Gb(16),i.tc("matHeaderRowDef",t.displayedColumns),i.Gb(1),i.tc("matRowDefColumns",t.displayedColumns)}}function T(t,e){if(1&t&&i.Ub(0,"mat-progress-bar",39),2&t){const t=i.lc(2);i.tc("value",t.calcUploadProgress())}}function U(t,e){1&t&&i.Ub(0,"mat-progress-bar",40)}function x(t,e){if(1&t&&(i.Zb(0,"mat-card",36),i.Qc(1,T,1,1,"mat-progress-bar",37),i.Qc(2,U,1,0,"mat-progress-bar",38),i.Yb()),2&t){const t=i.lc();i.Gb(1),i.tc("ngIf",!t.parallel),i.Gb(1),i.tc("ngIf",t.parallel)}}let Q=(()=>{class t{constructor(t,e,n){this.repo=t,this.formBuilder=e,this.groupRepo=n,this.displayedColumns=["title","filename","information","access_groups","remove"],this.showProgress=!1,this.filesUploadedIds=[],this.parallel=!0,this.uploadSuccessEvent=new i.p,this.errorEvent=new i.p,this.directoryBehaviorSubject=this.repo.getDirectoryBehaviorSubject(),this.groupsBehaviorSubject=this.groupRepo.getViewModelListBehaviorSubject(),this.directorySelectionForm=this.formBuilder.group({parent_id:null})}get showDirectorySelector(){return void 0===this.directoryId}get selectedDirectoryId(){if(this.showDirectorySelector){const t=this.directorySelectionForm.controls.parent_id;return t.value&&"number"==typeof t.value?t.value:null}return this.directoryId}ngOnInit(){this.uploadList=new a.o}getDirectory(t){return this.repo.getViewModel(t)}uploadFile(t){return Object(o.a)(this,void 0,void 0,(function*(){const e=new FormData;e.set("mediafile",t.mediafile),e.set("title",t.title);const n=t.form.value.access_groups_id||[];n.length>0&&e.set("access_groups_id",JSON.stringify(n)),this.selectedDirectoryId&&e.set("parent_id",""+this.selectedDirectoryId),yield this.repo.uploadFile(e).then(e=>{this.filesUploadedIds.push(e.id),this.onRemoveButton(t)},t=>{this.errorMessage=t})}))}getFiletype(t){return t.type||"File"}getReadableSize(t){if(0===t)return"0 B";const e=Math.floor(Math.log(t)/Math.log(1024));return`${t=+(t/Math.pow(1024,e)).toFixed(2)} ${["B","kB","MB","GB","TB"][e]}`}onChangeTitle(t,e){e.title=t}addFile(t){const e={mediafile:t,filename:t.name,title:t.name,form:this.formBuilder.group({access_groups_id:[[]]})};this.uploadList.data.push(e),this.table&&this.table.renderRows()}onSelectFile(t){if(t.target.files&&t.target.files.length>0)for(const e of t.target.files)this.addFile(e)}onDropFile(t){for(const e of t)e.fileEntry.isFile&&e.fileEntry.file(t=>{this.addFile(t)})}onUploadButton(){return Object(o.a)(this,void 0,void 0,(function*(){if(this.uploadList&&this.uploadList.data.length>0){if(this.errorMessage="",this.showProgress=!0,this.parallel){const t=this.uploadList.data.map(t=>this.uploadFile(t));yield Promise.all(t)}else for(const t of this.uploadList.data)yield this.uploadFile(t);if(this.showProgress=!1,""===this.errorMessage)this.uploadSuccessEvent.next(this.filesUploadedIds);else{this.table.renderRows();const t=this.uploadList.data.map(t=>t.filename);this.errorEvent.next(`${this.errorMessage}\n${t}`)}}}))}calcUploadProgress(){return this.filesUploadedIds&&this.filesUploadedIds.length>0&&this.uploadList.data?100/(this.uploadList.data.length/this.filesUploadedIds.length):0}onRemoveButton(t){this.uploadList.data&&(this.uploadList.data.splice(this.uploadList.data.indexOf(t),1),this.table.renderRows())}onClearButton(){this.uploadList.data=[],this.table&&this.table.renderRows()}}return t.\u0275fac=function(e){return new(e||t)(i.Tb(c.a),i.Tb(r.f),i.Tb(l.a))},t.\u0275cmp=i.Nb({type:t,selectors:[["os-media-upload-content"]],viewQuery:function(t,e){var n;1&t&&i.Zc(a.n,!0),2&t&&i.Dc(n=i.ic())&&(e.table=n.first)},inputs:{parallel:"parallel",directoryId:"directoryId"},outputs:{uploadSuccessEvent:"uploadSuccessEvent",errorEvent:"errorEvent"},decls:25,vars:19,consts:[[1,"upload-area"],["hidden","","type","file","multiple","",3,"change"],["fileInput",""],[1,"selection-area"],["contentClassName","file-drop-content-style","dropZoneClassName","file-drop-zone-style",3,"dropZoneLabel","onFileDrop","click"],[3,"formGroup",4,"ngIf"],[4,"ngIf"],["class","table-container",4,"ngIf"],[1,"action-buttons"],["type","button","mat-raised-button","","color","accent",3,"disabled","click"],["type","button","mat-raised-button","",3,"disabled","click"],["class","os-card",4,"ngIf"],[3,"formGroup"],["formControlName","parent_id",3,"multiple","includeNone","noneTitle","placeholder","inputListValues"],[1,"table-container"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","title","sticky",""],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","filename"],["matColumnDef","information"],["matColumnDef","access_groups"],["mat-cell","",3,"formGroup",4,"matCellDef"],["matColumnDef","remove"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["matInput","",3,"value","input"],[1,"file-info-cell"],[3,"inline"],["mat-cell","",3,"formGroup"],["formControlName","access_groups_id",3,"multiple","placeholder","inputListValues"],["mat-icon-button","","color","warn",3,"click"],["mat-header-row",""],["mat-row",""],[1,"os-card"],["mode","determinate",3,"value",4,"ngIf"],["mode","buffer",4,"ngIf"],["mode","determinate",3,"value"],["mode","buffer"]],template:function(t,e){if(1&t){const t=i.ac();i.Zb(0,"div",0),i.Zb(1,"input",1,2),i.hc("change",(function(t){return e.onSelectFile(t)})),i.Yb(),i.Zb(3,"div",3),i.Zb(4,"ngx-file-drop",4),i.hc("onFileDrop",(function(t){return e.onDropFile(t)}))("click",(function(){return i.Ic(t),i.Ec(2).click()})),i.mc(5,"translate"),i.Yb(),i.Yb(),i.Qc(6,_,4,8,"div",5),i.Zb(7,"div"),i.Zb(8,"span"),i.Sc(9),i.mc(10,"translate"),i.Yb(),i.Sc(11," \xa0 "),i.Qc(12,M,3,3,"i",6),i.Qc(13,P,2,1,"i",6),i.Yb(),i.Qc(14,B,19,3,"div",7),i.Yb(),i.Zb(15,"div",8),i.Zb(16,"button",9),i.hc("click",(function(){return e.onUploadButton()})),i.Zb(17,"span"),i.Sc(18),i.mc(19,"translate"),i.Yb(),i.Yb(),i.Zb(20,"button",10),i.hc("click",(function(){return e.onClearButton()})),i.Zb(21,"span"),i.Sc(22),i.mc(23,"translate"),i.Yb(),i.Yb(),i.Yb(),i.Qc(24,x,3,2,"mat-card",11)}2&t&&(i.Gb(4),i.uc("dropZoneLabel",i.nc(5,11,"Drop files into this area OR click here to select files")),i.Gb(2),i.tc("ngIf",e.showDirectorySelector),i.Gb(3),i.Uc(" ",i.nc(10,13,"Upload to:"),""),i.Gb(3),i.tc("ngIf",null===e.selectedDirectoryId),i.Gb(1),i.tc("ngIf",null!==e.selectedDirectoryId),i.Gb(1),i.tc("ngIf",e.uploadList.data.length>0),i.Gb(2),i.tc("disabled",0===e.uploadList.data.length),i.Gb(2),i.Tc(i.nc(19,15,"Upload")),i.Gb(2),i.tc("disabled",0===e.uploadList.data.length),i.Gb(2),i.Tc(i.nc(23,17,"Clear list")),i.Gb(2),i.tc("ngIf",e.showProgress))},directives:[s.a,d.t,b.b,r.t,r.k,u.c,m.a,r.s,r.i,a.n,a.c,a.i,a.b,a.k,a.m,a.h,a.a,p.b,f.a,a.j,a.l,g.a,h.a],pipes:[C.j],styles:[".title-line[_ngcontent-%COMP%]{font-weight:500;font-size:16px}.title-line[_ngcontent-%COMP%]   .icon-prefix[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{display:-ms-inline-flexbox;display:inline-flex;vertical-align:middle;font-size:16px;height:16px;width:16px}.title-line[_ngcontent-%COMP%]   .favorite-star[_ngcontent-%COMP%]{padding-right:3px}.mat-table[_ngcontent-%COMP%]{width:100%}.mat-table[_ngcontent-%COMP%]   .mat-header-row[_ngcontent-%COMP%]   .mat-column-anchor[_ngcontent-%COMP%]{display:none}.mat-table[_ngcontent-%COMP%]   .mat-row[_ngcontent-%COMP%]{position:relative}.mat-table[_ngcontent-%COMP%]   .mat-row[_ngcontent-%COMP%]   .mat-column-anchor[_ngcontent-%COMP%]{position:absolute!important;top:0;right:0;bottom:0;left:0;opacity:.1;z-index:1}.mat-table[_ngcontent-%COMP%]   .mat-row[_ngcontent-%COMP%]   .mat-column-anchor[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:block;height:100%;width:100%}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]{position:relative}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]   .fill[_ngcontent-%COMP%]{position:absolute;display:inherit;height:100%;width:100%;line-height:0}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]   .fill[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{margin-top:auto;margin-bottom:auto}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{z-index:2}.mat-table[_ngcontent-%COMP%]   .mat-table-sticky[_ngcontent-%COMP%]{z-index:3!important}.table-container[_ngcontent-%COMP%]{overflow:auto}.table-container[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   .mat-column-title[_ngcontent-%COMP%]{min-width:100px}.table-container[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   .mat-column-title[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]{width:95%}.table-container[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   .mat-column-filename[_ngcontent-%COMP%], .table-container[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   .mat-column-hidden[_ngcontent-%COMP%], .table-container[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   .mat-column-information[_ngcontent-%COMP%], .table-container[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   .mat-column-remove[_ngcontent-%COMP%]{min-width:100px}.table-container[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   .file-info-cell[_ngcontent-%COMP%]{display:grid;margin:0}.table-container[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   .file-info-cell[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{font-size:130%}.selection-area[_ngcontent-%COMP%]{cursor:pointer}.selection-area[_ngcontent-%COMP%], .upload-area[_ngcontent-%COMP%]{margin-bottom:1em}.action-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]{margin-left:1em}"]}),t})()}}]);